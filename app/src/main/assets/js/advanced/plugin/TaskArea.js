Ext.define("APlan.plugin.TaskArea",{extend:"Ext.AbstractPlugin",alias:"plugin.taskarea",tpl:'<div class="gnt-taskarea" style="{height}px"><div class="gnt-taskarea-inner"></div></div>',config:{enabled:false},setEnabled:function(){this.callParent(arguments);if(this.panel){this.repaintAllAreas()}},init:function(a){var b=this,c=(a.parentTaskBodyTemplate||Gnt.template.ParentTask.prototype.innerTpl)+b.tpl;Ext.apply(a.getSchedulingView(),{parentTaskBodyTemplate:c});b.panel=a;b.taskStore=a.getTaskStore();a.getSchedulingView().on({refresh:this.repaintAllAreas,itemupdate:this.repaintAllAreas,itemremove:this.repaintAllAreas,itemadd:this.repaintAllAreas,delay:1,scope:this});a.on("afterrender",function(){b.getEnabled()&&a.getSchedulingView().getEl().addCls("gnt-taskarea-enabled")},null,{single:true})},getLastVisibleChild:function(b){var a;if(!b||b.isLeaf()||!b.isExpanded()){a=b}else{a=this.getLastVisibleChild(b.lastChild)}return a},repaintAllAreas:function(){if(!this.getEnabled()){return}var a=this.panel.getSchedulingView();var b=this.panel.getSchedulingView().getNodes();Ext.Array.each(b,function(c){if(c){var d=a.getRecord(c);if(d&&!d.isRoot()&&!d.isLeaf()&&!d.isMilestone()&&d.isExpanded()){this.refreshAreaSize(d)}}},this)},refreshAreaSize:function(g){var b=this.panel.getSchedulingView();var d=b.getElementFromEventRecord(g);if(!d){return}var c=d.down(".gnt-taskarea");if(!c){return}var f=this.getLastVisibleChild(g);var a=0;if(f&&f!==g){var e=b.getNode(f);if(e){a=Ext.fly(e).getY()-c.getY()+Ext.fly(e).getHeight()}}if(a<0){return}c.setHeight(a)},updateEnabled:function(d,b){var c=this.getCmp(),a=c.rendered&&c.getSchedulingView();if(a){if(d){a.getEl().addCls("gnt-taskarea-enabled")}else{a.getEl().removeCls("gnt-taskarea-enabled")}}}});