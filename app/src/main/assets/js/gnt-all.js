Ext.define("Robo.Transaction",{actions:null,title:null,constructor:function(b){b=b||{};Ext.apply(this,b);this.callParent([b]);this.actions=[]},hasActions:function(){return this.actions.length>0},addAction:function(b){this.actions.push(b)},getActions:function(){return this.actions},undo:function(){for(var b=this.actions.length-1;b>=0;b--){this.actions[b].undo()}},redo:function(){for(var b=0;b<this.actions.length;b++){this.actions[b].redo()}},getTitle:function(){if(this.title){return this.title}var b=this.actions[0];return b?b.getTitle():null}});Ext.define("Robo.data.Model",{extend:Ext.Mixin,modelName:null,editMementoFix:null,mixinConfig:{before:{endEdit:"onBeforeEndEdit"},after:{endEdit:"onAfterEndEdit"}},onBeforeEndEdit:function(d,f){var e=this.editMemento;if(e){this.editMementoFix=e;if(!f){f=this.getModifiedFieldNames(e.data)}if(!e.previousValues){e.previousValues={}}Ext.Array.each(f,function(a){e.previousValues[a]=e.data[a]})}},onAfterEndEdit:function(d,c){delete this.editMementoFix},getTitle:function(){return""}});Ext.define("Robo.action.Base",{constructor:function(b){Ext.apply(this,b)},undo:function(){throw new Error("Abstract method call")},redo:function(){throw new Error("Abstract method call")},getTitle:function(){return""}});Ext.define("Robo.action.flat.Update",{extend:Robo.action.Base,inheritableStatics:{CUSTOMLY_PROCESSED:{}},config:{record:null,fieldNames:null},oldValues:null,newValues:null,constructor:function(d){var c=this;c.callParent([d]);c.initConfig(d);c.saveValues()},saveValues:function(){var d=this,e=d.getRecord(),f=d.getFieldNames();if(f){d.oldValues=Ext.Array.map(f,function(a){return d.processSavingOldValue(a,e)});d.newValues=Ext.Array.map(f,function(a){return d.processSavingNewValue(a,e)})}},undo:function(){var f,i=this,g=i.getRecord(),h=i.getFieldNames(),j;if(h){f=i.self.CUSTOMLY_PROCESSED;g.beginEdit();j=Robo.util.Array.reduce(h,function(b,a,d){var c;if(a){c=i.processRestoringValue(i.oldValues[d],a,g,"undo");if(c!==f){b[a]=c}}return b},{});g.set(j);g.endEdit()}},redo:function(){var f,i=this,g=i.getRecord(),h=i.getFieldNames(),j;if(h){f=i.self.CUSTOMLY_PROCESSED;g.beginEdit();j=Robo.util.Array.reduce(h,function(b,a,d){var c;if(a){c=i.processRestoringValue(i.newValues[d],a,g,"redo");if(c!==f){b[a]=c}}return b},{});g.set(j);g.endEdit()}},processSavingOldValue:function(f,d){var e=d.previous||d.previousValues;if(e&&e.hasOwnProperty(f)){return e[f]}else{if(d.editMementoFix){e=d.editMementoFix.previousValues||d.editMementoFix.data;return e[f]}else{throw"Can not get previous value"}}},processSavingNewValue:function(c,d){return d.get(c)},processRestoringValue:Ext.identityFn,getTitle:function(){var d=this.getRecord();var c=this.getFieldNames();if(d.getTitle){return"Edit of "+c[0]+" for "+d.getTitle(this)}if(d.modelName){return"Edit of "+d.modelName+" "+d.getId()}return""}});Ext.define("Robo.action.flat.Add",{extend:Robo.action.Base,store:null,records:null,index:null,undo:function(){var d=this.records;this.store.remove(d);for(var c=0;c<d.length;c++){this.store.removeFromRemoved(d[c])}},redo:function(){this.store.insert(this.index,this.records)},getRecord:function(){return this.records[0]},getTitle:function(){var d=this;var c=Ext.Array.map(this.records,function(a){if(a.getTitle){return a.getTitle(d)}if(a.modelName){return a.modelName+" "+a.getId()}return"unknown"});return"Addition of "+c.join(",")}});Ext.define("Robo.action.flat.Remove",{extend:Robo.action.Base,store:null,records:null,index:null,undo:function(){var b=this;b.store.insert(b.index,b.records)},redo:function(){var b=this;b.store.remove(b.records)},getRecord:function(){return this.records[0]},getTitle:function(){var d=this;var c=Ext.Array.map(this.records,function(a){if(a.getTitle){return a.getTitle(d)}if(a.modelName){return a.modelName+" "+a.getId()}return"unknown"});return"Removal of "+c.join(",")}});Ext.define("Robo.action.tree.Append",{extend:Robo.action.Base,parent:null,newChild:null,undo:function(){var d=this.newChild;this.parent.removeChild(d);delete d.data.lastParentId;var c=this.parent.getTreeStore();Ext.Array.remove(c.removedNodes,d)},redo:function(){this.parent.appendChild(this.newChild)},getRecord:function(){return this.newChild},getTitle:function(){var d=this.newChild;var c;if(d.getTitle){c=d.getTitle(this)}else{if(d.modelName){return d.modelName+" "+d.getId()}}return"Append of "+c}});Ext.define("Robo.action.tree.Insert",{extend:Robo.action.Base,parent:null,newChild:null,insertedBefore:null,undo:function(){var d=this.newChild;this.parent.removeChild(d);delete d.data.lastParentId;var c=this.parent.getTreeStore();Ext.Array.remove(c.removedNodes,d)},redo:function(){var c=this.insertedBefore;var d=c&&c.isFirst();this.parent.insertBefore(this.newChild,c);if(d){c.updateInfo(false,{isFirst:false})}},getRecord:function(){return this.newChild},getTitle:function(){var d=this.newChild;var c;if(d.getTitle){c=d.getTitle(this)}else{if(d.modelName){return d.modelName+" "+d.getId()}}return"Insertion of "+c}});Ext.define("Robo.action.tree.Remove",{extend:Robo.action.Base,parent:null,removedChild:null,nextSibling:null,newParent:null,newNextSibling:null,dirty:false,isMove:false,constructor:function(b){this.callParent(arguments);this.dirty=this.removedChild.dirty},undo:function(){if(this.isMove){this.newParent=this.removedChild.parentNode;this.newNextSibling=this.removedChild.nextSibling}var h=this.nextSibling;var e=h&&h.isFirst();var g=this.removedChild;this.parent.insertBefore(g,h);g.dirty=this.dirty;if(!this.isMove){var f=g.getTreeStore();g.cascadeBy(function(a){Ext.Array.remove(f.removedNodes,a)})}if(e){h.updateInfo(false,{isFirst:false})}},redo:function(){if(this.isMove){var c=this.newNextSibling;var d=c&&c.isFirst();this.newParent.insertBefore(this.removedChild,c);if(d){c.updateInfo(false,{isFirst:false})}}else{this.parent.removeChild(this.removedChild);delete this.removedChild.data.lastParentId}},getRecord:function(){return this.removedChild},getTitle:function(){var d=this.removedChild;var c;if(d.getTitle){c=d.getTitle(this)}else{if(d.modelName){return d.modelName+" "+d.getId()}}return this.isMove?"Move of "+c:"Removal of "+c}});Ext.define("Robo.action.tree.Update",{extend:Robo.action.flat.Update,processRestoringValue:function(j,h,g,i){var f=this;if(h==="expanded"){if(j){g.expand()}else{g.collapse()}j=f.self.CUSTOMLY_PROCESSED}else{if(h=="leaf"){j=f.callParent(arguments);if(j===true&&i=="undo"){g.data.loaded=false}}else{j=f.callParent(arguments)}}return j}});Ext.define("Sch.crud.AbstractManager",{mixins:{observable:Ext.util.Observable},revision:null,stores:null,storeIdProperty:"storeId",filterParam:"filter",storesIndex:null,activeRequests:null,delayedSyncs:null,transport:null,trackResponseType:false,phantomIdField:"$PhantomId",autoLoad:false,autoSyncTimeout:100,autoSync:false,resetIdsBeforeSync:true,syncApplySequence:null,writeAllFields:false,ignoreUpdates:0,createMissingRecords:false,autoSyncTimerId:null,constructor:function(d){d=d||{};this.mixins.observable.constructor.call(this,d);this.activeRequests={};this.delayedSyncs=[];this.transport=d.transport||this.transport||{};var e=d.stores||this.stores;this.stores=[];this.addStore(e);var f=d.syncApplySequence||this.syncApplySequence;if(f){this.syncApplySequence=null;this.addStoreToApplySequence(f)}if(this.autoLoad){this.load()}},updateStoreIndex:function(){var e={};for(var g=0,f=this.stores.length;g<f;g++){var h=this.stores[g];if(h.storeId){e[h.storeId]=this.stores[g]}}this.storesIndex=e},getStoreDescriptor:function(d){if(!d){return}if(d.isStore){for(var f=0,e=this.stores.length;f<e;f++){if(this.stores[f].store===d){return this.stores[f]}}}else{if(typeof d=="object"){return this.storesIndex[d.storeId]}else{return this.storesIndex[d]||this.getStoreDescriptor(Ext.data.StoreManager.get(d))}}},getStore:function(d){var c=this.getStoreDescriptor(d);return c&&c.store},forEachStore:function(h,i){if(!h){return}var f=this.stores;for(var j=0,g=f.length;j<g;j++){if(h.call(i||this,f[j].store,f[j].storeId,f[j])===false){break}}},addStore:function(i,q,x){if(!i){return}if(!Ext.isArray(i)){i=[i]}var s=[];for(var r=0,v=i.length;r<v;r++){var j=i[r];if(j.isStore){j={store:j}}else{if(typeof j=="object"){if(j.stores){if(!Ext.isArray(j.stores)){j.stores=[j.stores]}for(var u=0,w=j.stores.length;u<w;u++){var n=j.stores[u],t=n;if("string"===typeof n){t={storeId:n}}t.masterStoreInfo=j;j.stores[u]=t}}}else{j={store:Ext.data.StoreManager.get(j)}}}s.push(this.fillStoreDescriptor(j));j.store.crudManager=this;if(j.store.isTreeStore){j.store.setProxy({type:"memory"})}this.bindStoreListeners(j.store)}if(typeof q==="undefined"){this.stores.push.apply(this.stores,s)}else{var l=q;if(x){if(x.isStore||typeof x!=="object"){x=this.getStoreDescriptor(x)}l+=Ext.Array.indexOf(this.stores,x)}this.stores.splice.apply(this.stores,[].concat([l,0],s))}this.updateStoreIndex()},bindStoreListeners:function(d,e){var f={update:this.onStoreUpdate,clear:this.onStoreChange,scope:this};if(d.isTreeStore){Ext.apply(f,{nodeappend:this.onStoreChange,nodeinsert:this.onStoreChange,noderemove:this.onNodeRemove})}else{Ext.apply(f,{add:this.onStoreChange,remove:this.onStoreChange})}if(e){this.mun(d,f)}else{this.mon(d,f)}},unbindStoreListeners:function(b){this.bindStoreListeners(b,true)},fillStoreDescriptor:function(g){var f=g.store,h=f.storeIdProperty||this.storeIdProperty,e=f.getModel&&f.getModel()||f.model;e=e&&e.prototype;Ext.applyIf(g,{storeId:f[h],phantomIdField:e&&e.phantomIdField,idProperty:e&&e.idProperty,writeAllFields:f.writeAllFields});return g},removeStore:function(e){for(var h=0,f=this.stores.length;h<f;h++){var g=this.stores[h];if(g===e||g.store===e||g.storeId===e){this.unbindStoreListeners(g.store);delete this.storesIndex[g.storeId];this.stores.splice(h,1);if(this.syncApplySequence){this.removeStoreFromApplySequence(e)}break}}},addStoreToApplySequence:function(p,j,n){if(!p){return}if(!Ext.isArray(p)){p=[p]}var l=[];for(var o=0,i=p.length;o<i;o++){var m=this.getStoreDescriptor(p[o]);if(m){l.push(m)}}if(!this.syncApplySequence){this.syncApplySequence=[]}if(typeof j==="undefined"){this.syncApplySequence.push.apply(this.syncApplySequence,l)}else{var k=j;if(n){if(n.isStore||typeof n!=="object"){n=this.getStoreDescriptor(n)}k+=Ext.Array.indexOf(this.syncApplySequence,n)}this.syncApplySequence.splice.apply(this.syncApplySequence,[].concat([k,0],l))}},removeStoreFromApplySequence:function(e){for(var h=0,f=this.syncApplySequence.length;h<f;h++){var g=this.syncApplySequence[h];if(g===e||g.store===e||g.storeId===e){this.syncApplySequence.splice(h,1);break}}},onNodeRemove:function(e,d){var f=e&&e.getTreeStore();f&&f.on("endupdate",this.onStoreChange,this,{single:true})},onStoreUpdate:function(h,j,i,f){if((!h.isTreeStore||j!==h.getRoot())){var g=f&&f.length===1&&j.getField(f[0])&&!j.getField(f[0]).persist;if(!g){this.onStoreChange()}}},onStoreChange:function(){if(this.ignoreUpdates){return}var b=this;this.fireEvent(this.hasChanges()?"haschanges":"nochanges",this);if(this.autoSync){if(!this.autoSyncTimerId){this.autoSyncTimerId=setTimeout(function(){b.autoSyncTimerId=null;b.sync()},this.autoSyncTimeout)}}},hasChanges:function(e){var h;if(e){h=this.getStore(e);if(!h){return false}return this.isStoreDirty(h)}for(var g=0,f=this.stores.length;g<f;g++){if(this.isStoreDirty(this.stores[g].store)){return true}}return false},isStoreDirty:function(k){if(k.getRemovedRecords().length){return true}if(k.isTreeStore){for(var i in k.byIdMap){var g=k.byIdMap[i];if(g.dirty===true&&(!g.get("root")||Ext.Object.getKeys(g.modified).length!==1||!("expanded" in g.modified))){return true}else{if(!g.get("root")&&g.phantom&&g.isValid()){return true}}}}else{var l=k.getData().items;for(var j=0,h=l.length;j<h;j++){if(l[j].dirty||l[j].phantom){return true}}}return false},getLoadPackage:function(i){var p={type:"load",requestId:this.getRequestId(),stores:[]};var l=this.stores,u=p.stores;for(var r=0,t=l.length;r<t;r++){var o=l[r],w=o.filterParam||o.store.filterParam||this.filterParam,x=i&&i[o.storeId],q=o.pageSize||o.store.pageSize;if(o.store.remoteFilter&&w){x=x||{};var v=[];o.store.getFilters().each(function(a){v.push(a.serialize())});x[w]=v}if(x||q){var s=Ext.apply({storeId:o.storeId,page:1,pageSize:q},x);l[r].currentPage=s.page;u.push(s)}else{u.push(o.storeId)}}return p},prepareAdded:function(r,l,p){var f=[];for(var v=0,x=r.length;v<x;v++){var u=r[v],w={},t=u.getFields();if(!w.hasOwnProperty(l)){w[l]=u.getId()}for(var s=0,i=t.length;s<i;s++){var q=t[s];if(q){if(q.persist&&(u.data.hasOwnProperty(q.name)||q.critical)){if(q.serialize){w[q.name]=q.serialize(u.data[q.name],u)}else{w[q.name]=u.data[q.name]}}}}if(this.resetIdsBeforeSync){delete w[u.idProperty]}if(p){this.processSubStores(u,w,p)}f.push(w)}return f},prepareUpdated:function(r,i,j){var f=[],y=j.writeAllFields||(j.writeAllFields!==false&&this.writeAllFields),v,l;for(var u=0,x=r.length;u<x;u++){var t=r[u],s;if(y){v=t.getData();v[t.idProperty]=t.getId();for(s in v){l=t.getField(s);if(!l||!l.persist&&!l.critical){delete v[s]}else{if(l.serialize){v[s]=l.serialize(v[s],t)}else{v[s]=t.get(s)}}}}else{v=t.getChanges();v[t.idProperty]=t.getId();for(s in v){l=t.getField(s);if(!l||!l.persist){delete v[s]}else{if(l.serialize){v[s]=l.serialize(v[s],t)}else{v[s]=t.get(s)}}}var z=t.getCriticalFields();for(var w=0;w<z.length;w++){l=z[w];if(l.serialize){v[l.getName()]=l.serialize(t.get(l.getName()),t)}else{v[l.getName()]=t.get(l.getName())}}}if(i){this.processSubStores(t,v,i)}f.push(v)}return f},prepareRemoved:function(h){var g=[],i;for(var j=0,f=h.length;j<f;j++){i={};i[h[j].idProperty]=h[j].getId();g.push(i)}return g},processSubStores:function(i,m,j){for(var o=0,k=j.length;o<k;o++){var l=j[o].storeId,p=i.get(l);if(p){var n=this.getStoreChanges(Ext.apply({store:p},j[o]));if(n){m[l]=Ext.apply(n,{$store:true})}else{delete m[l]}}else{delete m[l]}}},getStoreChanges:function(o,l){l=l||o.phantomIdField||this.phantomIdField;var m=o.store,n=m.getNewRecords(),p=m.getUpdatedRecords(),k=m.getRemovedRecords(),i=o.stores;var j;if(n.length){n=this.prepareAdded(n,l,i)}if(p.length){p=this.prepareUpdated(p,i,o)}if(k.length){k=this.prepareRemoved(k)}if(n.length||p.length||k.length){j={};if(n.length){j.added=n}if(p.length){j.updated=p}if(k.length){j.removed=k}}return j},getChangeSetPackage:function(){var o={type:"sync",requestId:this.getRequestId(),revision:this.revision};var m=this.stores,i=0;for(var q=0,r=m.length;q<r;q++){var n=m[q],l=n.phantomIdField||this.phantomIdField,k=n.storeId;var p=this.getStoreChanges(n,l);if(p){i++;o[k]=p}}return i?o:null},getSubStoresData:function(k,m,l,n){if(!k){return}var i=[];var r=function(e,d){for(var a=0,c=d.length;a<c;a++){var b=d[a].storeId;if(e[b]){i.push({id:e[l],storeDesc:d[a],data:e[b]});delete e[b]}}};var o=0,p=k.length;if(n){for(;o<p;o++){r(k[o],m);var q=this.getSubStoresData(k[o].children,m,l,true);if(q){i=i.concat(q)}}}else{for(;o<p;o++){r(k[o],m)}}return i},loadDataToTreeStore:function(g,i,f,h){var j=i&&i.rows;g.proxy.data=j;g.load()},loadDataToFlatStore:function(g,j,l,i){var k=j&&j.rows;g.totalCount=j.total;g.currentPage=i.currentPage;var h=Ext.Array.map(k,function(a){return new g.model(a)});g.loadData(h,l&&l.append||j.append);g.fireEvent("load",g,h,true)},loadDataToStore:function(B,x,i){var s=B.store,w=s.getModel(),r=B.stores,q=B.idProperty||w&&w.prototype&&w.prototype.idProperty||"id",u=s.isTreeStore,t;var l=x&&x.rows;s.metaData=x&&x.metaData;if(l){if(r){t=this.getSubStoresData(l,r,q,u)}s.__loading=true;var z=u?this.loadDataToTreeStore:this.loadDataToFlatStore;z.call(this,s,x,i,B);if(t){for(var y=0,A=t.length;y<A;y++){var v=t[y];this.loadDataToStore(Ext.apply({store:s[u?"getNodeById":"getById"](v.id).get(v.storeDesc.storeId)},v.storeDesc),v.data)}}s.__loading=false}},loadData:function(n,m){m=m||{};this.ignoreUpdates++;for(var l=0,h=this.stores.length;l<h;l++){var j=this.stores[l],i=j.storeId,k=n[i];if(k){this.loadDataToStore(j,k,m[i])}}this.ignoreUpdates--},applyChangesToRecord:function(t,r,j,n){var u=t.data,v={},x=false,z;if(j){for(var w=0,y=j.length;w<y;w++){z=j[w].storeId;if(r.hasOwnProperty(z)){v[z]=true;var s=t.get(z);if(s){this.applyChangesToStore(Ext.apply({store:s},j[w]),r[z])}else{Ext.log("Can't find store for the response sub-package")}}}}for(z in r){if(r.hasOwnProperty(z)&&!v[z]){var p=r[z];if(!t.isEqual(u[z],p)){if(!x){x=true;t.beginEdit()}if(z===t.idProperty){t.setId(p)}else{if(z=="parentId"&&n.isTreeStore){var q=(p&&n.getNodeById(p))||n.getRoot();q.appendChild(t)}else{t.set(z,p)}}}}}this.ignoreUpdates++;if(x){t.endEdit()}this.ignoreUpdates--;t.commit()},applyRemovals:function(r,t,A){var k=A.idProperty,s=r.isTreeStore?r.removedNodes:r.removed,j=A.findByIdFn,D=A.removeRecordFn,w=0;for(var x=0,z=t.length;x<z;x++){var y=false;var B=t[x][k];for(var u=0,C=s.length;u<C;u++){if(s[u].getId()==B){s.splice(u,1);y=true;w++;break}}if(!y){var v=j(B);if(v){this.ignoreUpdates++;D(v);Ext.Array.remove(s,v);w++;this.ignoreUpdates--}else{Ext.log("Can't find record to remove from the response package")}}}return w},getApplyChangesToStoreHelpers:function(d){if(d.isTreeStore){var c=function(a){return d.getNodeById(a)};return{findByPhantomFn:c,findByIdFn:c,addRecordFn:function(a){var b=(a.parentId&&d.getNodeById(a.parentId))||d.getRoot();return b.appendChild(a)},removeRecordFn:function(a){return a.parentNode.removeChild(a)}}}else{return{findByPhantomFn:function(a){return d.data.getByKey(a)},findByIdFn:function(a){return d.getById(a)},addRecordFn:function(a){return d.add(a)[0]},removeRecordFn:function(a){return d.remove(a)}}}},applyChangesToStore:function(G,x){var k=this,O=G.phantomIdField||k.phantomIdField,I=G.idProperty,J=G.store;if(!I){var L=J.getModel&&J.getModel()||J.model;L=L&&L.prototype;I=L&&L.idProperty||"id"}var C=k.getApplyChangesToStoreHelpers(J),E=C.findByPhantomFn,F=C.findByIdFn,P=C.addRecordFn,y=C.removeRecordFn;var H=x.rows,z=x.removed,N;if(H){var j,D,M,K=G.stores;for(var A=0,B=H.length;A<B;A++){j=H[A];M=j[O];D=j[I];N=null;if(M!=null){N=E(M)}else{if(I){N=F(D)}}if(N){k.applyChangesToRecord(N,j,K,J)}else{k.ignoreUpdates++;N=P(j);k.ignoreUpdates--;N.commit()}}}if(z&&k.applyRemovals(J,z,{idProperty:I,findByIdFn:F,removeRecordFn:y})){J.fireEvent("datachanged",J)}},applySyncResponse:function(j){var f=this.syncApplySequence||this.stores;for(var i=0,g=f.length;i<g;i++){var h=j[f[i].storeId];if(h){this.applyChangesToStore(f[i],h)}}},applyLoadResponse:function(d,c){this.loadData(d,c)},applyResponse:function(e,d,f){if(this.trackResponseType){e=d.type||e}switch(e){case"load":this.applyLoadResponse(d,f);break;case"sync":this.applySyncResponse(d);break}},getRequestId:function(){return Ext.Date.now()},onResponse:function(g,i,h,j){this.activeRequests[g]=null;var f=this.decode(i);if(!f||!f.success){this.fireEvent("requestfail",this,g,f,h);this.fireEvent(g+"fail",this,f,h,j);this.warn("CrudManager: "+g+" failed, please inspect the server response",i);return f}if((this.fireEvent("beforeresponseapply",this,g,f)!==false)&&(this.fireEvent("before"+g+"apply",this,f,j)!==false)){this.revision=f.revision;this.applyResponse(g,f,j);this.fireEvent("requestdone",this,g,f,h);this.fireEvent(g,this,f,h,j);if(!this.hasChanges()){this.fireEvent("nochanges",this)}}return f},onLoad:function(d,f,e){return this.onResponse("load",d,f,e)},onSync:function(d,f,e){return this.onResponse("sync",d,f,e)},load:function(h,g,i){var f;if(typeof h==="object"){f=h;h=g;g=i;i=arguments[3]}var j=this.getLoadPackage(f);if(this.fireEvent("beforeload",this,j)!==false){i=i||this;if(this.activeRequests.load){this.cancelRequest(this.activeRequests.load.desc);this.fireEvent("loadcanceled",this,j)}this.activeRequests.load={id:j.requestId};this.activeRequests.load.desc=this.sendRequest({data:this.encode(j),type:"load",success:function(b,a){var c=this.onLoad(b,a,f);if(g&&(!c||!c.success)){g.call(i,c,b,f)}else{if(h){h.call(i,c,b,f)}}},failure:function(b,a){this.onLoad(b,a);if(g){g.apply(i,arguments)}},scope:this})}else{this.fireEvent("loadcanceled",this,j)}},sync:function(g,f,h){if(this.activeRequests.sync){this.delayedSyncs.push(arguments);this.fireEvent("syncdelayed",this,arguments);return}var e=this.getChangeSetPackage();h=h||this;if(!e){if(g){g.call(h,null,null)}return}if(this.fireEvent("beforesync",this,e)===false){this.fireEvent("synccanceled",this,e);return}this.activeRequests.sync={id:e.requestId};this.activeRequests.sync.desc=this.sendRequest({data:this.encode(e),type:"sync",success:function(a,c){var b=this.activeRequests.sync;var d=this.onSync(a,c);if(f&&(!d||!d.success)){f.call(h,d,a,b)}else{if(g){g.call(h,d,a,b)}}this.runDelayedSync()},failure:function(a,b){this.onSync(a,b);if(f){f.apply(h,arguments)}this.runDelayedSync()},scope:this})},runDelayedSync:function(){var b=this.delayedSyncs.shift();if(!b){return}this.sync.apply(this,b)},commit:function(){for(var c=0,d=this.stores.length;c<d;c++){this.stores[c].store.commitChanges()}},reject:function(){for(var c=0,d=this.stores.length;c<d;c++){this.stores[c].store.rejectChanges()}},warn:function(){if("console" in window){var b=console;b.log&&b.log.apply&&b.log.apply(b,arguments)}},isLoading:function(){return !!this.activeRequests.load}});Ext.define("Sch.app.CrudManagerDomain",{extend:Ext.app.EventDomain,singleton:true,type:"crudmanager",prefix:"crudmanager.",constructor:function(){var b=this;b.callParent();b.monitor(Sch.crud.AbstractManager)},match:function(g,e){var f=false,h=g.alias;if(e==="*"){f=true}else{if(h){f=Ext.Array.indexOf(h,this.prefix+e)>-1}}return f}});Ext.define("Sch.column.Day",{extend:Ext.grid.column.Column,alias:"widget.weekview-day",align:"center",start:null,end:null,draggable:false,groupable:false,hideable:false,sortable:false,menuDisabled:true,enableLocking:false,flex:1,resizable:false,tdCls:"sch-timetd",initComponent:function(){var b=new Date();this.addCls("sch-daycolumn-header");if(this.isWeekend()){this.addCls("sch-daycolumn-header-weekend");this.tdCls=(this.tdCls||"")+" sch-daycolumn-weekend"}if(this.start.getDate()===b.getDate()&&this.start.getMonth()===b.getMonth()&&this.start.getYear()===b.getYear()){this.addCls("sch-daycolumn-header-today");this.tdCls=(this.tdCls||"")+" sch-daycolumn-today"}this.callParent(arguments)},isWeekend:function(){var b=this.start.getDay();return b===6||b===0}});Ext.define("Sch.column.Resource",{extend:Ext.grid.Column,alias:"widget.resourcecolumn",align:"center",menuDisabled:true,hideable:false,sortable:false,locked:false,lockable:false,draggable:false,enableLocking:false,model:null,initComponent:function(){this.tdCls=(this.tdCls||"")+" sch-timetd";this.cls=(this.cls||"")+" sch-resourcecolumn-header";this.callParent(arguments)}});Ext.define("Sch.view.HorizontalTimeAxis",{extend:Ext.util.Observable,trackHeaderOver:true,compactCellWidthThreshold:15,baseCls:"sch-column-header",tableCls:"sch-header-row",headerHtmlRowTpl:'<table border="0" cellspacing="0" cellpadding="0" style="width: {totalWidth}px; {tstyle}" class="{{tableCls}} sch-header-row-{position} {cls}"><thead><tr><tpl for="cells"><td class="{{baseCls}} {headerCls} sch-header-cell-{align}" data-date="{[fm.date(values.start, \'Ymd_His\')]}" style="position : static; text-align: {align}; width: {width}px; {style}" tabIndex="0"headerPosition="{parent.position}" headerIndex="{[xindex-1]}"><div class="sch-simple-timeheader">{header}</div></td></tpl></tr></thead></table>',model:null,hoverCls:"",containerEl:null,height:null,constructor:function(h){var g=this;var f=!!Ext.versions.touch;Ext.apply(this,h);g.callParent(arguments);g.model.on("update",g.onModelUpdate,this,{priority:5});g.containerEl=Ext.get(g.containerEl);if(!(g.headerHtmlRowTpl instanceof Ext.Template)){g.headerHtmlRowTpl=g.headerHtmlRowTpl.replace("{{baseCls}}",this.baseCls).replace("{{tableCls}}",this.tableCls);g.headerHtmlRowTpl=new Ext.XTemplate(g.headerHtmlRowTpl)}if(g.trackHeaderOver&&g.hoverCls){g.containerEl.on({mousemove:g.highlightCell,delegate:".sch-column-header",scope:g});g.containerEl.on({mouseleave:g.clearHighlight,scope:g})}var e={scope:this,delegate:".sch-column-header"};if(f){e.tap=this.onElClick("tap");e.doubletap=this.onElClick("doubletap")}else{e.click=this.onElClick("click");e.dblclick=this.onElClick("dblclick");e.contextmenu=this.onElClick("contextmenu")}g._listenerCfg=e;if(g.containerEl){g.containerEl.on(e)}},destroy:function(){var b=this;if(b.containerEl){b.containerEl.un(b._listenerCfg);b.containerEl.un({mousemove:b.highlightCell,delegate:".sch-simple-timeheader",scope:b});b.containerEl.un({mouseleave:b.clearHighlight,scope:b})}b.model.un({update:b.onModelUpdate,scope:b})},onModelUpdate:function(){this.render()},getHTML:function(k,l,n){var p=this.model.getColumnConfig();var i=this.model.getTotalWidth();var j=Ext.Object.getKeys(p).length;var m=this.height?this.height/j:0;var o="";if(p.top){this.embedCellWidths(p.top);o+=this.headerHtmlRowTpl.apply({totalWidth:i,cells:p.top,position:"top",tstyle:"border-top : 0;"+(m?"height:"+m+"px":"")})}if(p.middle){this.embedCellWidths(p.middle);o+=this.headerHtmlRowTpl.apply({totalWidth:i,cells:p.middle,position:"middle",tstyle:(p.top?"":"border-top : 0;")+(m?"height:"+m+"px":""),cls:!p.bottom&&this.model.getTickWidth()<=this.compactCellWidthThreshold?"sch-header-row-compact":""})}if(p.bottom){this.embedCellWidths(p.bottom);o+=this.headerHtmlRowTpl.apply({totalWidth:i,cells:p.bottom,position:"bottom",tstyle:(m?"height:"+m+"px":""),cls:this.model.getTickWidth()<=this.compactCellWidthThreshold?"sch-header-row-compact":""})}return o+'<div class="sch-header-secondary-canvas"></div>'},render:function(){if(!this.containerEl){return}var j=this.containerEl,i=j.dom,k=i.style.display,h=this.model.getColumnConfig(),g=i.parentNode;i.style.display="none";g.removeChild(i);var l=this.getHTML();i.innerHTML=l;if(!h.top&&!h.middle){this.containerEl.addCls("sch-header-single-row")}else{this.containerEl.removeCls("sch-header-single-row")}g&&g.appendChild(i);i.style.display=k;this.fireEvent("refresh",this)},embedCellWidths:function(f){var h=(Ext.isIE7||(Ext.isSafari&&!Ext.supports.Touch))?1:0;for(var j=0;j<f.length;j++){var g=f[j];var i=this.model.getDistanceBetweenDates(g.start,g.end);if(i){g.width=i-(j?h:0)}else{g.width=0;g.style="display: none"}}},onElClick:function(b){return function(h,g){g=h.delegatedTarget||g;var a=Ext.fly(g).getAttribute("headerPosition"),j=Ext.fly(g).getAttribute("headerIndex"),i=this.model.getColumnConfig()[a][j];this.fireEvent("timeheader"+b,this,i.start,i.end,h)}},highlightCell:function(f,e){var d=this;if(e!==d.highlightedCell){d.clearHighlight();d.highlightedCell=e;Ext.fly(e).addCls(d.hoverCls)}},clearHighlight:function(){var c=this,d=c.highlightedCell;if(d){Ext.fly(d).removeCls(c.hoverCls);delete c.highlightedCell}}});Ext.define("Sch.column.timeAxis.Horizontal",{extend:Ext.grid.column.Column,alias:"widget.timeaxiscolumn",draggable:false,groupable:false,hideable:false,sortable:false,resizable:false,menuDisabled:true,cls:"sch-simple-timeaxis",tdCls:"sch-timetd",enableLocking:false,locked:false,timeAxisViewModel:null,headerView:null,hoverCls:"",ownHoverCls:"sch-column-header-over",trackHeaderOver:true,compactCellWidthThreshold:(Ext.theme&&Ext.theme.name.toLowerCase()==="classic")?15:35,afterRender:function(){var c=this;var d=c.titleEl.createChild({cls:"sch-horizontaltimeaxis-ct"});c.headerView=new Sch.view.HorizontalTimeAxis({model:c.timeAxisViewModel,containerEl:d,hoverCls:c.ownHoverCls,trackHeaderOver:c.trackHeaderOver,compactCellWidthThreshold:c.compactCellWidthThreshold});c.headerView.on("refresh",c.onTimeAxisViewRefresh,c);c.ownerCt.on("afterlayout",function(){if(!c.ownerCt){return}c.mon(c.ownerCt,"resize",c.onHeaderContainerResize,c);if(this.getWidth()>0){if(c.getAvailableWidthForSchedule()===c.timeAxisViewModel.getAvailableWidth()){c.headerView.render()}else{c.timeAxisViewModel.update(c.getAvailableWidthForSchedule())}c.setWidth(c.timeAxisViewModel.getTotalWidth())}},null,{single:true});this.enableBubble("timeheaderclick","timeheaderdblclick","timeheadercontextmenu");c.relayEvents(c.headerView,["timeheaderclick","timeheaderdblclick","timeheadercontextmenu"]);c.callParent(arguments);c.focusable=false},initRenderData:function(){var b=this;b.renderData.headerCls=b.renderData.headerCls||b.headerCls;return b.callParent(arguments)},destroy:function(){if(this.headerView){this.headerView.destroy()}this.callParent(arguments)},onTimeAxisViewRefresh:function(){this.headerView.un("refresh",this.onTimeAxisViewRefresh,this);this.setWidth(this.timeAxisViewModel.getTotalWidth());this.headerView.on("refresh",this.onTimeAxisViewRefresh,this)},getAvailableWidthForSchedule:function(){var g=this.ownerCt.isVisible(true)?this.ownerCt.getWidth():(this.ownerCt.lastBox&&this.ownerCt.lastBox.width||0),f=this.ownerCt.items,h;for(var e=1;e<f.length;e++){h=f.get(e);if(!h.hidden){g-=h.isVisible(true)?h.getWidth():(h.lastBox&&h.lastBox.width||0)}}return g-Ext.getScrollbarSize().width-1},onResize:function(){this.callParent(arguments);this.timeAxisViewModel.setAvailableWidth(this.getAvailableWidthForSchedule())},onHeaderContainerResize:function(){this.timeAxisViewModel.setAvailableWidth(this.getAvailableWidthForSchedule());this.headerView.render()},refresh:function(){if(this.rendered){this.timeAxisViewModel.update(null,true);this.headerView.render()}}});Ext.define("Sch.column.timeAxis.Vertical",{extend:Ext.grid.column.Column,alias:"widget.verticaltimeaxis",align:"right",width:100,draggable:false,groupable:false,hideable:false,sortable:false,menuDisabled:true,timeAxis:null,timeAxisViewModel:null,cellTopBorderWidth:null,cellBottomBorderWidth:null,totalBorderWidth:null,enableLocking:false,locked:true,flex:1,dataIndex:"start",initComponent:function(){this.callParent(arguments);this.tdCls=(this.tdCls||"")+" sch-verticaltimeaxis-cell";this.scope=this;this.totalBorderWidth=this.cellTopBorderWidth+this.cellBottomBorderWidth},renderer:function(i,f,g,h){var j=this.timeAxisViewModel.getBottomHeader();f.style="height:"+(this.timeAxisViewModel.getTickWidth()-this.totalBorderWidth)+"px";if(j.renderer){return j.renderer.call(j.scope||this,g.data.start,g.data.end,f,h)}else{return Ext.Date.format(i,j.dateFormat)}}});Ext.define("Sch.crud.encoder.Json",{format:"json",encode:function(b){return Ext.JSON.encode(b)},decode:function(b){if(typeof b=="object"){return b}return Ext.JSON.decode(b,true)}});Ext.define("Sch.crud.encoder.Xml",{format:"xml",stringReplaces:[[/&/g,"&amp;"],[/</g,"&lt;"],[/>/g,"&gt;"],[/"/g,"&quot;"]],encodeString:function(h){if(!h){return h}var g=h.toString(),j=this.stringReplaces;for(var i=0,f=j.length;i<f;i++){g=g.replace(j[i][0],j[i][1])}return g},encodeRecords:function(h){var f="";for(var g=0,e=h.length;g<e;g++){f+=this.encodeRecord(h[g])}return f},encodeRecord:function(e){var f="<record>";for(var h in e){var g=e[h];f+='<field id="'+this.encodeString(h)+'">'+(g&&g.$store?this.encodeStoreChanges({storeId:h},g):this.encodeString(g))+"</field>"}f+="</record>";return f},encodeStoreChanges:function(d,f){var e='<store id="'+this.encodeString(d.storeId)+'">';if(f.added){e+="<added>"+this.encodeRecords(f.added)+"</added>"}if(f.updated){e+="<updated>"+this.encodeRecords(f.updated)+"</updated>"}if(f.removed){e+="<removed>"+this.encodeRecords(f.removed)+"</removed>"}e+="</store>";return e},encode:function(h){var g,i,f,j;switch(h.type){case"load":g='<load requestId="'+this.encodeString(h.requestId)+'">';for(i=0,f=h.stores.length;i<f;i++){j=h.stores[i];if(typeof j==="string"){g+='<store id="'+this.encodeString(j)+'"/>'}else{g+='<store id="'+this.encodeString(j.storeId)+'" page="'+this.encodeString(j.page)+'" pageSize="'+this.encodeString(j.pageSize)+'"/>'}}g+="</load>";return g;case"sync":g='<sync requestId="'+this.encodeString(h.requestId)+'" revision="'+this.encodeString(h.revision)+'">';for(i in h){if(h.hasOwnProperty(i)){j=this.getStore(i);if(j){g+=this.encodeStoreChanges(j,h[i])}}}g+="</sync>";break}return g},stringToXML:function(c){if(!c){return}var d;if(window.DOMParser){d=(new DOMParser()).parseFromString(c,"text/xml")}else{if(window.ActiveXObject){d=new ActiveXObject("Microsoft.XMLDOM");d.async=false;d.loadXML(c)}}return d},decodeRecords:function(g){var e=[];for(var h=0,f=g.length;h<f;h++){e.push(this.decodeRecord(g[h]))}return e},decodeRecord:function(m){var i=m.childNodes,j={},l;for(var n=0,p=i.length;n<p;n++){var k=i[n];if(k.nodeName=="field"){l="";if(k.firstChild){var o=this.getElementByTagName(k,"store");l=o?this.decodeStore(o):k.firstChild.nodeValue}j[k.getAttribute("id")]=l}}return j},getElementsByTagName:function(i,l){var j=i.childNodes,g=[];for(var k=0,h=j.length;k<h;k++){if(j[k].nodeName==l){g.push(j[k])}}return g},getElementByTagName:function(h,f){var i=h.childNodes;for(var j=0,g=i.length;j<g;j++){if(i[j].nodeName==f){return i[j]}}},decodeStore:function(g){var i={},j=this.getElementsByTagName(g,"rows");if(j.length){i.rows=this.decodeRecords(this.getElementsByTagName(j[0],"record"));var f=parseInt(j[0].getAttribute("total"),10);if(isNaN(f)||f<i.rows.length){f=i.rows.length}i.total=f}var h=this.getElementByTagName(g,"removed");if(h){i.removed=this.decodeRecords(this.getElementsByTagName(h,"record"))}return i},decode:function(t){var q=typeof t=="string"?this.stringToXML(t):t;if(!q){return}var i={},p=q.documentElement,n=p.getElementsByTagName("store"),o,m;i.requestId=p.getAttribute("requestId");i.revision=p.getAttribute("revision");i.success=p.getAttribute("success")||"false";i.success=i.success.toLowerCase()=="true";if(!i.success){i.code=p.getAttribute("code");var l=p.getElementsByTagName("message")[0];i.message=l&&l.firstChild&&l.firstChild.nodeValue}for(var r=0,s=n.length;r<s;r++){o=n[r];m=o.getAttribute("id");if(this.getStore(m)){i[m]=this.decodeStore(o)}}return i}});Ext.define("Sch.crud.transport.Ajax",{defaultMethod:{load:"GET",sync:"POST"},cancelRequest:function(b){Ext.Ajax.abort(b)},sendRequest:function(h){var n=h.data,m=this.transport[h.type],l=m.paramName,k=Ext.apply({},m&&m.params),j=m.method||this.defaultMethod[h.type];var i=Ext.apply({url:m.url,method:j,params:k,failure:h.failure,success:function(b,a){if(h.success){h.success.call(h.scope||this,b.responseXml||b.responseText)}},scope:h.scope},m.requestConfig);if(!l){if(this.format==="xml"){Ext.apply(i,{xmlData:n})}else{Ext.apply(i,{jsonData:n})}}else{i.params=i.params||{};i.params[l]=n}this.fireEvent("beforesend",this,k,h.type,i);return Ext.Ajax.request(i)}});Ext.define("Sch.util.Patch",{target:null,minVersion:null,maxVersion:null,reportUrl:null,description:null,applyFn:null,ieOnly:false,macOnly:false,overrides:null,onClassExtended:function(d,c){if(Sch.disableOverrides){return}if(c.ieOnly&&!Ext.isIE){return}if(c.macOnly&&!Ext.isMac){return}if((!c.minVersion||Ext.versions.extjs.equals(c.minVersion)||Ext.versions.extjs.isGreaterThan(c.minVersion))&&(!c.maxVersion||Ext.versions.extjs.equals(c.maxVersion)||Ext.versions.extjs.isLessThan(c.maxVersion))){if(c.applyFn){c.applyFn()}else{if(c.overrides){Ext.ClassManager.get(c.target).override(c.overrides)}}}}});Ext.define("Sch.patches.CollectionKey",{extend:Sch.util.Patch,target:"Ext.util.CollectionKey",minVersion:"6.0.0",maxVersion:"6.0.3",reportUrl:"https://www.sencha.com/forum/showthread.php?310532-Ext.util.Collection-key-configuration-application-and-cloning-is-broken",description:["Ext.util.CollectionKey::clone() is broken due to wrong usage of Ext's configuration facility.","We relay on the (though) private Ext.data.LocalStore::extraKeys configuration, we use it to define additional","unique but complex keys for Assignment and Dependency stores. Upon store filtering such keys are being cloned","but due to the broken config key's clone() method throws an exception"].join(" "),applyFn:function(){var b;b=Ext.util.CollectionKey.prototype.applyKeyFn;Ext.util.CollectionKey.prototype.applyKeyFn=Ext.identityFn;Ext.util.CollectionKey.prototype.updateKeyFn=b}});Ext.define("Sch.data.mixin.UniversalModelGetter",{getModelById:function(c){var d=this;return d.getNodeById?d.getNodeById(c):d.getById(c)},getModelByInternalId:function(c){var d=this;return d.byInternalIdMap?d.byInternalIdMap[c]:d.getByInternalId(c)}});Ext.define("Sch.data.mixin.CacheHintHelper",{extend:Ext.Mixin,mixinConfig:{before:{loadRecords:"loadRecords",removeAll:"removeAll"}},loadRecords:function(){this.fireEvent("cacheresethint",this)},removeAll:function(b){if(b){this.fireEvent("cacheresethint",this)}}});Ext.define("Robo.data.Store",{extend:Ext.Mixin,undoRedoPostponed:null,inUndoRedoTransaction:false,undoRedoEventBus:null,mixinConfig:{before:{constructor:"constructor",destroy:"destroy",fireEventArgs:"fireEventArgs",setRoot:"beforeSetRoot",fillNode:"beforeFillNode"},after:{setRoot:"afterSetRoot",fillNode:"afterFillNode"}},constructor:function(){var b=this;b.undoRedoEventBus=new Ext.util.Observable()},destroy:function(){Ext.destroy(this.undoRedoEventBus)},fireEventArgs:function(e,d){var f=this;if(!d.hasOwnProperty("$undoRedoEventBusFired")){d.$undoRedoEventBusFired={}}if(!d.$undoRedoEventBusFired[e]){d.$undoRedoEventBusFired[e]=true;f.undoRedoEventBus.hasListener(e)&&f.undoRedoEventBus.fireEventArgs(e,d)}},isInUndoRedoTransaction:function(){return this.inUndoRedoTransaction},onUndoRedoTransactionStart:function(d,c){this.inUndoRedoTransaction=true},onUndoRedoTransactionEnd:function(d,c){this.inUndoRedoTransaction=false},isUndoingOrRedoing:function(){return !!this.undoRedoPostponed},beforeUndoRedo:function(b){this.undoRedoPostponed=[]},afterUndoRedo:function(d){var c=this;Ext.Array.forEach(c.undoRedoPostponed,function(a){a()});c.undoRedoPostponed=null},postponeAfterUndoRedo:function(b){this.undoRedoPostponed.push(b)},beforeSetRoot:function(){this.__isSettingRoot=true},afterSetRoot:function(){this.__isSettingRoot=false;if(!this.getRoot()){this.fireEvent("clear",this)}},beforeFillNode:function(b){if(b.isRoot()){this.beforeSetRoot()}},afterFillNode:function(b){if(b.isRoot()){this.afterSetRoot()}},isRootSettingOrLoading:function(){return this.isLoading()||(this.isTreeStore&&this.__isSettingRoot)}});Ext.define("Sch.model.Customizable",function(b){return{extend:Ext.data.Model,mixins:{robo:Robo.data.Model},isCustomizableModel:true,customizableFields:null,previous:null,__editing:null,__editCounter:0,constructor:function(){var a=this.callParent(arguments);return a},set:function(h,l){var a;var j;this.previous=this.previous||{};if(typeof h==="string"){a=this.get(h);if(a instanceof Date&&!(l instanceof Date)){l=this.getField(h).convert(l,this)}if((a instanceof Date&&(a-l))||!(a instanceof Date)&&a!==l){this.previous[h]=a}else{return null}}else{for(var i in h){a=this.get(i);var k=h[i];if(a instanceof Date&&!(k instanceof Date)){k=this.getField(i).convert(k,this)}if((a instanceof Date&&(a-k))||!(a instanceof Date)&&a!==k){this.previous[i]=a}}}j=this.callParent(arguments);if(!this.__editing){delete this.previous}return j},reject:function(){var f=this,a=f.modified||{},e;f.__editing=true;f.previous=f.previous||{};for(e in a){if(a.hasOwnProperty(e)){if(typeof a[e]!="function"){f.previous[e]=f.get(e)}}}f.callParent(arguments);delete f.previous;f.__editing=false},beginEdit:function(){this.__editCounter++;this.__editing=true;this.callParent(arguments)},cancelEdit:function(){this.__editCounter=0;this.__editing=false;this.callParent(arguments);delete this.previous},endEdit:function(f,e){if(--this.__editCounter===0){if(!f&&this.getModifiedFieldNames){var a=this.editMemento;if(!e){e=this.getModifiedFieldNames(a.data)}if(e&&e.length===0){f=true}}this.callParent([f].concat(Array.prototype.slice.call(arguments,1)));this.__editing=false;delete this.previous}}}},function(b){b.$onExtended.unshift({fn:function(a,d){if(d){if(Ext.isArray(d)){a.fieldsInitialValue=d.slice()}else{if(d.fields){if(!Ext.isArray(d.fields)){a.fieldsInitialValue=[d.fields]}else{a.fieldsInitialValue=d.fields.slice()}}}}}});b.onExtended(function(h,f,a){var g=a.onBeforeCreated;a.onBeforeCreated=function(c,q){g.apply(this,arguments);var p=c.prototype;if(!p.customizableFields){return}p.allCustomizableFields=(c.superclass.allCustomizableFields||[]).concat(p.customizableFields);var s={};Ext.Array.each(p.allCustomizableFields,function(i){if(typeof i=="string"){i={name:i}}s[i.name]=i});var t=Ext.Array.findBy(c.fields,function(i){return i.name===p.idProperty});this.idField=p.idField=t;if(!c.fieldsMap[p.idProperty]){c.fieldsMap[p.idProperty]=t}var e=p.fields;var d=[];var u=[];Ext.Array.each(e,function(i){if(i.isCustomizableField){u.push(i.getName())}});if(p.idProperty!=="id"&&p.getField("id")){if(!p.getField("id").hasOwnProperty("name")){u.push("id")}}if(p.idProperty!=="Id"&&p.getField("Id")){if(!p.getField("Id").hasOwnProperty("name")){u.push("Id")}}c.removeFields(u);function v(l,m,i){if(!m){return}if(!Ext.isArray(m)){m=[m]}var j;for(var k=m.length-1;k>=0;k--){if(m[k].name==i){j=m[k];break}}Ext.applyIf(l,j)}function r(m){var i=c,l=i.prototype,k=m==="Id"?"idProperty":m.charAt(0).toLowerCase()+m.substr(1)+"Field",n={name:l[k]||m,isCustomizableField:true},j;while(l&&l.isCustomizableModel){j=l[k]||m;l.hasOwnProperty("customizableFields")&&v(n,l.customizableFields,m);v(n,i.fieldsInitialValue,j);l=i.superclass;i=l&&l.self}return n}u=[];Ext.Object.each(s,function(k,z){var y=z.name||z.getName();var l=y==="Id"?"idProperty":y.charAt(0).toLowerCase()+y.substr(1)+"Field";var m=p[l]||y;p.getField(m)&&u.push(m);var n=r(y);d.push(Ext.create("data.field."+(n.type||"auto"),n));var i=Ext.String.capitalize(y);if(i!="Id"){var o="get"+i;var j="set"+i;if(!p[o]||p[o].__getterFor__&&p[o].__getterFor__!=m){p[o]=function(){return this.get(this[l]||m)};p[o].__getterFor__=m}if(!p[j]||p[j].__setterFor__&&p[j].__setterFor__!=m){p[j]=function(w){return this.set(this[l]||m,w)};p[j].__setterFor__=m}}});c.replaceFields(d,u)}})});Ext.define("Sch.model.Assignment",{extend:Sch.model.Customizable,idProperty:"Id",customizableFields:[{name:"ResourceId"},{name:"EventId"}],resourceIdField:"ResourceId",eventIdField:"EventId",getInternalId:function(){return this.internalId},getAssignmentStore:function(){return this.joined&&this.joined[0]},getEventStore:function(){var b=this.getAssignmentStore();return b&&b.getEventStore()},getResourceStore:function(){var b=this.getEventStore();return b&&b.getResourceStore()},getEvent:function(d){var c=this;d=d||c.getEventStore();return d&&d.getModelById(c.getEventId())},getResource:function(c){var d=this;c=c||d.getResourceStore();return c&&c.getModelById(d.getResourceId())},getEventName:function(d){var c=this.getEvent(d);return c&&c.getName()||""},getResourceName:function(d){var c=this.getResource(d);return c&&c.getName()||""},isPersistable:function(){var d=this,e=d.getEvent(),f=d.getResource();return e&&!e.phantom&&f&&!f.phantom},fullCopy:function(){return this.copy.apply(this,arguments)}});Ext.define("Sch.data.AssignmentStore",{extend:Ext.data.Store,mixins:[Sch.data.mixin.UniversalModelGetter,Sch.data.mixin.CacheHintHelper,Robo.data.Store],config:{extraKeys:{byEventIdResourceId:{keyFn:function(b){return Sch.data.AssignmentStore.makeAssignmentEventResourceCompositeKey(b.getEventId(),b.getResourceId())}}}},model:"Sch.model.Assignment",alias:"store.assignmentstore",storeId:"assignments",eventResourceCache:null,resourceEventsCache:null,eventStoreDetacher:null,resourceStoreDetacher:null,eventStore:null,constructor:function(d){var c=this;c.callParent([d]);c.eventAssignmentsCache=c.eventAssignmentsCache||c.createEventAssignmentCache();c.resourceAssignmentsCache=c.resourceAssignmentsCache||c.createResourceAssignmentCache()},destroy:function(){var b=this;Ext.destroyMembers(b,"eventResourceCache","resourceEventsCache","eventAssignmentsCache","resourceEventsCache","eventStoreDetacher","resourceStoreDetacher");b.callParent()},createEventAssignmentCache:function(){return new Sch.data.util.EventAssignmentsCache(this)},createResourceAssignmentCache:function(){return new Sch.data.util.ResourceAssignmentsCache(this)},createAssignmentStoreEventResourcesCache:function(){return new Sch.data.util.AssignmentStoreEventResourcesCache(this)},createAssignmentStoreResourceEventsCache:function(){return new Sch.data.util.AssignmentStoreResourceEventsCache(this)},getEventStore:function(){return this.eventStore},setEventStore:function(e){var d=this,f=d.eventStore;d.eventStore=e&&Ext.StoreMgr.lookup(e)||null;d.attachToEventStore(d.eventStore);if((f||e)&&f!==e){d.fireEvent("eventstorechange",d,e,f)}},attachToEventStore:function(d){var c=this;Ext.destroy(c.eventStoreDetacher);if(d&&d.isTreeStore){c.eventStoreDetacher=d.on({noderemove:c.onEventNodeRemove,resourcestorechange:c.onEventStoreResourceStoreChange,scope:c,destroyable:true,priority:200})}else{if(d){c.eventStoreDetacher=d.on({remove:c.onEventRemove,resourcestorechange:c.onEventStoreResourceStoreChange,scope:c,destroyable:true,priority:200})}}c.attachToResourceStore(d&&d.getResourceStore())},attachToResourceStore:function(c){var d=this;Ext.destroy(d.resourceStoreDetacher);if(c){if(c.isTreeStore){d.resourceStoreDetacher=c.on({noderemove:d.onResourceNodeRemove,scope:d,destroyable:true,priority:200})}else{d.resourceStoreDetacher=c.on({remove:d.onResourceRemove,scope:d,destroyable:true,priority:200})}}},onEventStoreResourceStoreChange:function(d,e,f){this.attachToResourceStore(e)},onEventRemove:function(j,k,l,g){var i=this,h;if(!g){h=[];Ext.Array.each(k,function(a){h=h.concat(i.getAssignmentsForEvent(a))});h.length&&i.remove(h)}},onEventNodeRemove:function(j,h,f){var i=this,g;if(!f){g=[];h.cascadeBy(function(a){g=g.concat(i.getAssignmentsForEvent(a))});g.length&&i.remove(g)}},onResourceRemove:function(j,i,l,g){var k=this,h;if(!g){h=[];Ext.Array.each(i,function(a){h=h.concat(k.getAssignmentsForResource(a))});h.length&&k.remove(h)}},onResourceNodeRemove:function(i,h,f){var j=this,g;if(!f){g=[];h.cascadeBy(function(a){g=g.concat(j.getAssignmentsForResource(a))});g.length&&j.remove(g)}},mapAssignmentsForEvent:function(i,f,h){var j=this,g=[];f=f||Ext.identityFn;h=h||Ext.returnTrue;if(f!==Ext.identityFn||h!==Ext.returnTrue){Ext.Array.each(j.eventAssignmentsCache.get(i),function(a){var b=f(a);h(b)&&g.push(b)})}else{g=g.concat(j.eventAssignmentsCache.get(i))}return g},mapAssignmentsForResource:function(i,f,h){var j=this,g=[];f=f||Ext.identityFn;h=h||Ext.returnTrue;if(f!==Ext.identityFn||h!==Ext.returnTrue){Ext.Array.each(j.resourceAssignmentsCache.get(i),function(a){var b=f(a);h(b)&&g.push(b)})}else{g=[].concat(j.resourceAssignmentsCache.get(i))}return g},getAssignmentsForEvent:function(b){return this.mapAssignmentsForEvent(b)},removeAssignmentsForEvent:function(c){var d=this;d.remove(d.getAssignmentsForEvent(c))},getAssignmentsForResource:function(b){return this.mapAssignmentsForResource(b)},removeAssignmentsForResource:function(c){var d=this;d.remove(d.getAssignmentsForResource(c))},getResourcesForEvent:function(i){var j=this,g;if(j.eventResourceCache){g=j.eventResourceCache.get(i)}else{g=j.mapAssignmentsForEvent(i,function h(a){return a.getResource()},function f(a){return !!a})}return g},getEventsForResource:function(i){var j=this,g;if(j.resourceEventsCache){g=j.resourceEventsCache.get(i)}else{g=j.mapAssignmentsForResource(i,function h(a){return a.getEvent()},function f(a){return !!a})}return g},assignEventToResource:function(l,j,k){var g=this,h=[];k=k||Ext.identityFn;var i=Ext.isArray(j)?j:[j];Ext.Array.each(i,function(b){if(!g.isEventAssignedToResource(l,b)){var a=new g.model();a.setEventId(l instanceof Ext.data.Model&&l.getId()||l);a.setResourceId(b instanceof Ext.data.Model&&b.getId()||b);a=k(a);h.push(a)}});g.add(h);return h},unassignEventFromResource:function(e,h){var f=this,g;if(!h){this.removeAssignmentsForEvent(e)}else{if(f.isEventAssignedToResource(e,h)){g=f.getAssignmentForEventAndResource(e,h);f.remove(g)}}return g},isEventAssignedToResource:function(k,j){var l=this,n=l.getResourcesForEvent(k),h=false,m,i;j=j instanceof Ext.data.Model&&j.getId()||j;for(m=0,i=n.length;!h&&m<i;m++){h=n[m];h=h.getId()==j}return h},getAssignmentForEventAndResource:function(d,f){var e=this;d=d instanceof Ext.data.Model&&d.getId()||d;f=f instanceof Ext.data.Model&&f.getId()||f;return e.byEventIdResourceId.get(e.self.makeAssignmentEventResourceCompositeKey(d,f))},inheritableStatics:{makeAssignmentEventResourceCompositeKey:function(){var b=[];return function(a,d){b.length=0;b.push("event(",a,")-resource(",d,")");return b.join("")}}()}});Ext.define("Sch.model.CalendarDay",{extend:Sch.model.Customizable,idProperty:"Id",customizableFields:[{name:"Date",type:"date",dateFormat:"c",persist:true,convert:function(d,e){if(!d){return}var f=Ext.data.Types.DATE.convert.call(this,d);if(f){Ext.Date.clearTime(f)}return f}},{name:"Weekday",type:"int"},{name:"OverrideStartDate",type:"date",dateFormat:"c"},{name:"OverrideEndDate",type:"date",dateFormat:"c"},{name:"Type",defaultValue:"DAY"},{name:"IsWorkingDay",type:"boolean",defaultValue:false},{name:"Cls",defaultValue:"sch-nonworkingtime"},"Name",{name:"Availability",persist:true,convert:function(c,d){if(c){return typeof c==="string"?[c]:c}else{return[]}}}],availabilityCache:null,weekDayField:"Weekday",overrideStartDateField:"OverrideStartDate",overrideEndDateField:"OverrideEndDate",typeField:"Type",dateField:"Date",isWorkingDayField:"IsWorkingDay",clsField:"Cls",nameField:"Name",availabilityField:"Availability",setDate:function(b){if(b){b=Ext.Date.clearTime(b,true)}this.set(this.dateField,b)},clearDate:function(){this.set(this.dateField,null)},getAvailability:function(d){var f=this;if(d){return this.get(this.availabilityField)}if(this.availabilityCache){return this.availabilityCache}var e=Ext.Array.map(this.get(this.availabilityField),function(a){return typeof a==="string"?f.parseInterval(a):a});this.verifyAvailability(e);return this.availabilityCache=e},setAvailability:function(b){this.availabilityCache=null;this.set(this.availabilityField,this.stringifyIntervals(b));this.getAvailability()},verifyAvailability:function(d){var c=this;d.sort(function(a,b){return a.startTime-b.startTime});Ext.Array.each(d,function(b,a){if(b.startTime>b.endTime){throw new Error("Start time "+Ext.Date.format(b.startTime,"H:i")+" is greater than end time "+Ext.Date.format(b.endTime,"H:i"))}if(a>0&&d[a-1].endTime>b.startTime){throw new Error("Availability intervals should not intersect: ["+c.stringifyInterval(d[a-1])+"] and ["+c.stringifyInterval(b)+"]")}})},prependZero:function(b){return b<10?"0"+b:b},stringifyInterval:function(d){var f=d.startTime;var e=d.endTime;return this.prependZero(f.getHours())+":"+this.prependZero(f.getMinutes())+"-"+(e.getDate()==1?24:this.prependZero(e.getHours()))+":"+this.prependZero(e.getMinutes())},stringifyIntervals:function(d){var c=this;return Ext.Array.map(d,function(a){if(typeof a==="string"){return a}return c.stringifyInterval(a)})},parseInterval:function(c){var d=/(\d\d):(\d\d)-(\d\d):(\d\d)/.exec(c);if(!d){throw"Invalid format for availability string: "+c+". It should have exact format: hh:mm-hh:mm"}return{startTime:new Date(0,0,0,d[1],d[2]),endTime:new Date(0,0,0,d[3],d[4])}},getTotalHours:function(){return this.getTotalMS()/1000/60/60},getTotalMS:function(){var b=0;Ext.Array.each(this.getAvailability(),function(a){b+=a.endTime-a.startTime});return b},addAvailabilityInterval:function(g,e){var f;if(g instanceof Date){f={startTime:g,endTime:e}}else{f=this.parseInterval(g+(e?"-"+e:""))}var h=this.getAvailability().concat(f);this.verifyAvailability(h);this.setAvailability(h)},removeAvailabilityInterval:function(d){var c=this.getAvailability();c.splice(d,1);this.setAvailability(c)},getAvailabilityIntervalsFor:function(h){h=typeof h=="number"?new Date(h):h;var e=h.getFullYear();var g=h.getMonth();var f=h.getDate();return Ext.Array.map(this.getAvailability(),function(b){var a=b.endTime.getDate();return{startDate:new Date(e,g,f,b.startTime.getHours(),b.startTime.getMinutes()),endDate:new Date(e,g,f+(a==1?1:0),b.endTime.getHours(),b.endTime.getMinutes())}})},getAvailabilityStartFor:function(c){var d=this.getAvailabilityIntervalsFor(c);if(!d.length){return null}return d[0].startDate},getAvailabilityEndFor:function(c){var d=this.getAvailabilityIntervalsFor(c);if(!d.length){return null}return d[d.length-1].endDate}});Ext.define("Sch.locale.Locale",{l10n:null,legacyMode:true,localeName:null,namespaceId:null,constructor:function(){if(!Sch.locale.Active){Sch.locale.Active={};this.bindRequire()}var d=this.self.getName().split(".");var e=this.localeName=d.pop();this.namespaceId=d.join(".");var f=Sch.locale.Active[this.namespaceId];if(!(e=="En"&&f&&f.localeName!="En")){this.apply()}},bindRequire:function(){var b=Ext.ClassManager.triggerCreated;Ext.ClassManager.triggerCreated=function(e){b.apply(this,arguments);if(e){var f=Ext.ClassManager.get(e);for(var a in Sch.locale.Active){Sch.locale.Active[a].apply(f)}}}},applyToClass:function(n,h){var m=this,j=m.self.getName();h=h||Ext.ClassManager.get(n);if(h&&(h.activeLocaleId!==j)){var i=m.l10n[n];if(typeof i==="function"){i(n)}else{if(h.singleton){h.l10n=Ext.apply({},i,h.prototype&&h.prototype.l10n)}else{Ext.override(h,{l10n:i})}}if(m.legacyMode){var k;if(h.prototype){k=h.prototype}else{if(h.singleton){k=h}}if(k&&k.legacyMode){if(k.legacyHolderProp){if(!k[k.legacyHolderProp]){k[k.legacyHolderProp]={}}k=k[k.legacyHolderProp]}for(var l in i){if(typeof k[l]!=="function"){k[l]=i[l]}}}}h.activeLocaleId=j;if(h.onLocalized){h.onLocalized()}}},apply:function(j){if(this.l10n){var k=this;if(j){if(!Ext.isArray(j)){j=[j]}var n,h;for(var m=0,i=j.length;m<i;m++){if(Ext.isObject(j[m])){if(j[m].singleton){h=j[m];n=Ext.getClassName(Ext.getClass(h))}else{h=Ext.getClass(j[m]);n=Ext.getClassName(h)}}else{h=null;n="string"===typeof j[m]?j[m]:Ext.getClassName(j[m])}if(n){if(n in this.l10n){k.applyToClass(n,h)}}}}else{Sch.locale.Active[this.namespaceId]=this;for(var l in this.l10n){k.applyToClass(l)}}}}});Ext.define("Sch.locale.En",{extend:Sch.locale.Locale,singleton:true,constructor:function(b){Ext.apply(this,{l10n:{"Sch.util.Date":{unitNames:{YEAR:{single:"year",plural:"years",abbrev:"yr"},QUARTER:{single:"quarter",plural:"quarters",abbrev:"q"},MONTH:{single:"month",plural:"months",abbrev:"mon"},WEEK:{single:"week",plural:"weeks",abbrev:"w"},DAY:{single:"day",plural:"days",abbrev:"d"},HOUR:{single:"hour",plural:"hours",abbrev:"h"},MINUTE:{single:"minute",plural:"minutes",abbrev:"min"},SECOND:{single:"second",plural:"seconds",abbrev:"s"},MILLI:{single:"ms",plural:"ms",abbrev:"ms"}}},"Sch.panel.TimelineGridPanel":{weekStartDay:1,loadingText:"Loading, please wait...",savingText:"Saving changes, please wait..."},"Sch.panel.TimelineTreePanel":{weekStartDay:1,loadingText:"Loading, please wait...",savingText:"Saving changes, please wait..."},"Sch.mixin.SchedulerView":{loadingText:"Loading events..."},"Sch.plugin.CurrentTimeLine":{tooltipText:"Current time"},"Sch.plugin.EventEditor":{saveText:"Save",deleteText:"Delete",cancelText:"Cancel"},"Sch.plugin.SimpleEditor":{newEventText:"New booking..."},"Sch.widget.ExportDialogForm":{formatFieldLabel:"Paper format",orientationFieldLabel:"Orientation",rangeFieldLabel:"Schedule range",showHeaderLabel:"Show header",showFooterLabel:"Show footer",orientationPortraitText:"Portrait",orientationLandscapeText:"Landscape",completeViewText:"Complete schedule",currentViewText:"Visible schedule",dateRangeText:"Date range",dateRangeFromText:"Export from",dateRangeToText:"Export to",exportersFieldLabel:"Control pagination",adjustCols:"Adjust column width",adjustColsAndRows:"Adjust column width and row height",specifyDateRange:"Specify date range",columnPickerLabel:"Select columns",completeDataText:"Complete schedule (for all events)",dpiFieldLabel:"DPI (dots per inch)",rowsRangeLabel:"Rows range",allRowsLabel:"All rows",visibleRowsLabel:"Visible rows",columnEmptyText:"[no title]"},"Sch.widget.ExportDialog":{title:"Export Settings",exportButtonText:"Export",cancelButtonText:"Cancel",progressBarText:"Exporting..."},"Sch.plugin.Export":{generalError:"An error occurred",fetchingRows:"Fetching row {0} of {1}",builtPage:"Built page {0} of {1}",requestingPrintServer:"Please wait..."},"Sch.plugin.Printable":{dialogTitle:"Print settings",exportButtonText:"Print"},"Sch.plugin.exporter.AbstractExporter":{name:"Exporter"},"Sch.plugin.exporter.SinglePage":{name:"Single page"},"Sch.plugin.exporter.MultiPageVertical":{name:"Multiple pages (vertically)"},"Sch.plugin.exporter.MultiPage":{name:"Multiple pages"},"Sch.preset.Manager":{hourAndDay:{displayDateFormat:"G:i",middleDateFormat:"G:i",topDateFormat:"D d/m"},secondAndMinute:{displayDateFormat:"g:i:s",topDateFormat:"D, d g:iA"},dayAndWeek:{displayDateFormat:"m/d h:i A",middleDateFormat:"D d M"},weekAndDay:{displayDateFormat:"m/d",bottomDateFormat:"d M",middleDateFormat:"Y F d"},weekAndMonth:{displayDateFormat:"m/d/Y",middleDateFormat:"m/d",topDateFormat:"m/d/Y"},weekAndDayLetter:{displayDateFormat:"m/d/Y",middleDateFormat:"D d M Y"},weekDateAndMonth:{displayDateFormat:"m/d/Y",middleDateFormat:"d",topDateFormat:"Y F"},monthAndYear:{displayDateFormat:"m/d/Y",middleDateFormat:"M Y",topDateFormat:"Y"},year:{displayDateFormat:"m/d/Y",middleDateFormat:"Y"},manyYears:{displayDateFormat:"m/d/Y",middleDateFormat:"Y"}}}});this.callParent(arguments)}});Ext.define("Sch.mixin.Localizable",{legacyMode:false,activeLocaleId:"",l10n:null,isLocaleApplied:function(){var c=(this.singleton&&this.activeLocaleId)||this.self.activeLocaleId;if(!c){return false}for(var d in Sch.locale.Active){if(c===Sch.locale.Active[d].self.getName()){return true}}return false},applyLocale:function(){for(var b in Sch.locale.Active){Sch.locale.Active[b].apply(this.singleton?this:this.self.getName())}},L:function(){return this.localize.apply(this,arguments)},localize:function(q,o,l){if(!this.isLocaleApplied()&&!l){this.applyLocale()}if(this.hasOwnProperty("l10n")&&this.l10n.hasOwnProperty(q)&&"function"!=typeof this.l10n[q]){return this.l10n[q]}var p=this.self&&this.self.prototype;if(this.legacyMode){var r=o||this.legacyHolderProp;var k=r?this[r]:this;if(k&&k.hasOwnProperty(q)&&"function"!=typeof k[q]){return k[q]}if(p){var n=r?p[r]:p;if(n&&n.hasOwnProperty(q)&&"function"!=typeof n[q]){return n[q]}}}var j=p.l10n&&p.l10n[q];if(j===null||j===undefined){var m=p&&p.superclass;if(m&&m.localize){j=m.localize(q,o,l)}if(j===null||j===undefined){throw"Cannot find locale: "+q+" ["+this.self.getName()+"]"}}return j}});Ext.define("Sch.util.Date",{mixins:[Sch.mixin.Localizable],singleton:true,stripEscapeRe:/(\\.)/g,hourInfoRe:/([gGhHisucUOPZ]|MS)/,unitHash:null,unitsByName:{},constructor:function(){var e=Ext.Date;var f=this.unitHash={MILLI:e.MILLI,SECOND:e.SECOND,MINUTE:e.MINUTE,HOUR:e.HOUR,DAY:e.DAY,WEEK:"w",MONTH:e.MONTH,QUARTER:"q",YEAR:e.YEAR};Ext.apply(this,f);var d=this;this.units=[d.MILLI,d.SECOND,d.MINUTE,d.HOUR,d.DAY,d.WEEK,d.MONTH,d.QUARTER,d.YEAR]},onLocalized:function(){this.setUnitNames(this.L("unitNames"))},setUnitNames:function(h){var i=this.unitsByName={};this.l10n.unitNames=h;this._unitNames=Ext.apply({},h);var f=this.unitHash;for(var g in f){if(f.hasOwnProperty(g)){var j=f[g];this._unitNames[j]=this._unitNames[g];i[g]=j;i[j]=j}}},betweenLesser:function(e,g,f){var h=e.getTime();return g.getTime()<=h&&h<f.getTime()},constrain:function(d,f,e){return this.min(this.max(d,f),e)},compareUnits:function(h,e){var f=Ext.Array.indexOf(this.units,h),g=Ext.Array.indexOf(this.units,e);return f>g?1:(f<g?-1:0)},isUnitGreater:function(c,d){return this.compareUnits(c,d)>0},copyTimeValues:function(c,d){c.setHours(d.getHours());c.setMinutes(d.getMinutes());c.setSeconds(d.getSeconds());c.setMilliseconds(d.getMilliseconds())},add:function(d,j,i){var h=Ext.Date.clone(d);if(!j||i===0){return h}switch(j.toLowerCase()){case this.MILLI:h=new Date(d.getTime()+i);break;case this.SECOND:h=new Date(d.getTime()+(i*1000));break;case this.MINUTE:h=new Date(d.getTime()+(i*60000));break;case this.HOUR:h=new Date(d.getTime()+(i*3600000));break;case this.DAY:h.setDate(d.getDate()+i);if(h.getHours()===23&&d.getHours()===0){h=Ext.Date.add(h,Ext.Date.HOUR,1)}break;case this.WEEK:h.setDate(d.getDate()+i*7);break;case this.MONTH:var g=d.getDate();if(g>28){g=Math.min(g,Ext.Date.getLastDateOfMonth(this.add(Ext.Date.getFirstDateOfMonth(d),this.MONTH,i)).getDate())}h.setDate(g);h.setMonth(h.getMonth()+i);break;case this.QUARTER:h=this.add(d,this.MONTH,i*3);break;case this.YEAR:h.setFullYear(d.getFullYear()+i);break}return h},getUnitDurationInMs:function(b){return this.add(new Date(1,0,1),b,1)-new Date(1,0,1)},getMeasuringUnit:function(b){if(b===this.WEEK){return this.DAY}return b},getDurationInUnit:function(h,g,j,i){var f;switch(j){case this.YEAR:f=this.getDurationInYears(h,g);break;case this.QUARTER:f=this.getDurationInMonths(h,g)/3;break;case this.MONTH:f=this.getDurationInMonths(h,g);break;case this.WEEK:f=this.getDurationInDays(h,g)/7;break;case this.DAY:f=this.getDurationInDays(h,g);break;case this.HOUR:f=this.getDurationInHours(h,g);break;case this.MINUTE:f=this.getDurationInMinutes(h,g);break;case this.SECOND:f=this.getDurationInSeconds(h,g);break;case this.MILLI:f=this.getDurationInMilliseconds(h,g);break}return i?f:Math.round(f)},getUnitToBaseUnitRatio:function(c,d){if(c===d){return 1}switch(c){case this.YEAR:switch(d){case this.QUARTER:return 1/4;case this.MONTH:return 1/12}break;case this.QUARTER:switch(d){case this.YEAR:return 4;case this.MONTH:return 1/3}break;case this.MONTH:switch(d){case this.YEAR:return 12;case this.QUARTER:return 3}break;case this.WEEK:switch(d){case this.DAY:return 1/7;case this.HOUR:return 1/168}break;case this.DAY:switch(d){case this.WEEK:return 7;case this.HOUR:return 1/24;case this.MINUTE:return 1/1440}break;case this.HOUR:switch(d){case this.DAY:return 24;case this.MINUTE:return 1/60}break;case this.MINUTE:switch(d){case this.HOUR:return 60;case this.SECOND:return 1/60;case this.MILLI:return 1/60000}break;case this.SECOND:switch(d){case this.MILLI:return 1/1000}break;case this.MILLI:switch(d){case this.SECOND:return 1000}break}return -1},getDurationInMilliseconds:function(c,d){return(d-c)},getDurationInSeconds:function(c,d){return(d-c)/1000},getDurationInMinutes:function(c,d){return(d-c)/60000},getDurationInHours:function(c,d){return(d-c)/3600000},getDurationInDays:function(f,d){var e=f.getTimezoneOffset()-d.getTimezoneOffset();return(d-f+e*60*1000)/86400000},getDurationInMonths:function(c,d){return((d.getFullYear()-c.getFullYear())*12)+(d.getMonth()-c.getMonth())},getDurationInYears:function(c,d){return this.getDurationInMonths(c,d)/12},min:function(c,d){return(c&&c.valueOf()||c)<(d&&d.valueOf()||d)?c:d},max:function(c,d){return(c&&c.valueOf()||c)>(d&&d.valueOf()||d)?c:d},intersectSpans:function(h,g,e,f){return this.betweenLesser(h,e,f)||this.betweenLesser(e,h,g)},getNameOfUnit:function(b){b=this.getUnitByName(b);switch(b.toLowerCase()){case this.YEAR:return"YEAR";case this.QUARTER:return"QUARTER";case this.MONTH:return"MONTH";case this.WEEK:return"WEEK";case this.DAY:return"DAY";case this.HOUR:return"HOUR";case this.MINUTE:return"MINUTE";case this.SECOND:return"SECOND";case this.MILLI:return"MILLI"}throw"Incorrect UnitName"},getReadableNameOfUnit:function(c,d){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[c][d?"plural":"single"]},getShortNameOfUnit:function(b){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[b].abbrev},getUnitByName:function(b){if(!this.isLocaleApplied()){this.applyLocale()}if(!this.unitsByName[b]){Ext.Error.raise("Unknown unit name: "+b)}return this.unitsByName[b]},getNext:function(n,j,i,k){var l=Ext.Date.clone(n);k=arguments.length<4?1:k;i=i==null?1:i;switch(j){case this.MILLI:l=this.add(n,j,i);break;case this.SECOND:l=this.add(n,j,i);if(l.getMilliseconds()>0){l.setMilliseconds(0)}break;case this.MINUTE:l=this.add(n,j,i);if(l.getSeconds()>0){l.setSeconds(0)}if(l.getMilliseconds()>0){l.setMilliseconds(0)}break;case this.HOUR:l=this.add(n,j,i);if(l.getMinutes()>0){l.setMinutes(0)}if(l.getSeconds()>0){l.setSeconds(0)}if(l.getMilliseconds()>0){l.setMilliseconds(0)}break;case this.DAY:var m=n.getHours()===23&&this.add(l,this.HOUR,1).getHours()===1;if(m){l=this.add(l,this.DAY,2);this.clearTime(l);return l}this.clearTime(l);l=this.add(l,this.DAY,i);if(l.getHours()===1){this.clearTime(l)}break;case this.WEEK:this.clearTime(l);var h=l.getDay();l=this.add(l,this.DAY,k-h+7*(i-(k<=h?0:1)));if(l.getDay()!==k){l=this.add(l,this.HOUR,1)}else{this.clearTime(l)}break;case this.MONTH:l=this.add(l,this.MONTH,i);l.setDate(1);this.clearTime(l);break;case this.QUARTER:l=this.add(l,this.MONTH,((i-1)*3)+(3-(l.getMonth()%3)));this.clearTime(l);l.setDate(1);break;case this.YEAR:l=new Date(l.getFullYear()+i,0,1);break;default:throw"Invalid date unit"}return l},getNumberOfMsFromTheStartOfDay:function(b){return b-this.clearTime(b,true)||86400000},getNumberOfMsTillTheEndOfDay:function(b){return this.getStartOfNextDay(b,true)-b},getStartOfNextDay:function(g,i,j){var k=this.add(j?g:this.clearTime(g,i),this.DAY,1);if(k.getDate()==g.getDate()){var l=this.add(this.clearTime(g,i),this.DAY,2).getTimezoneOffset();var h=g.getTimezoneOffset();k=this.add(k,this.MINUTE,h-l)}return k},getEndOfPreviousDay:function(d,f){var e=f?d:this.clearTime(d,true);if(e-d){return e}else{return this.add(e,this.DAY,-1)}},timeSpanContains:function(h,e,g,f){return(g-h)>=0&&(e-f)>=0},compareWithPrecision:function(j,l,i){var k=Sch.util.Date,g=Ext.Date,h;switch(i){case k.DAY:j=Number(g.format(j,"Ymd"));l=Number(g.format(l,"Ymd"));break;case k.WEEK:j=Number(g.format(j,"YmW"));l=Number(g.format(l,"YmW"));break;case k.MONTH:j=Number(g.format(j,"Ym"));l=Number(g.format(l,"Ym"));break;case k.QUARTER:j=j.getFullYear()*4+Math.floor(j.getMonth()/3);l=l.getFullYear()*4+Math.floor(l.getMonth()/3);break;case k.YEAR:j=j.getFullYear();l=l.getFullYear();break;default:case k.MILLI:case k.SECOND:case k.MINUTE:case k.HOUR:i=i&&this.getUnitDurationInMs(i)||1;j=Math.floor(j.valueOf()/i);l=Math.floor(l.valueOf()/i);break}((j<l)&&(h=-1))||((j>l)&&(h=+1))||(h=0);return h},getValueInUnits:function(d,c){switch(c){case this.MONTH:return d.getMonth();case this.DAY:return d.getDate();case this.HOUR:return d.getHours();case this.MINUTE:return d.getMinutes();case this.SECOND:return d.getSeconds()}},setValueInUnits:function(f,j,h){var g=Ext.Date.clone(f),i;switch(j){case this.YEAR:i="setFullYear";break;case this.MONTH:i="setMonth";break;case this.DAY:i="setDate";break;case this.HOUR:i="setHours";break;case this.MINUTE:i="setMinutes";break;case this.SECOND:i="setSeconds";break;case this.MILLI:i="setMilliseconds";break}g[i](h);return g},getSubUnit:function(b){switch(b){case this.YEAR:return this.MONTH;case this.MONTH:return this.DAY;case this.DAY:return this.HOUR;case this.HOUR:return this.MINUTE;case this.MINUTE:return this.SECOND;case this.SECOND:return this.MILLI}},setValueInSubUnits:function(e,d,f){d=this.getSubUnit(d);return this.setValueInUnits(e,d,f)},mergeDates:function(h,e,f){var g=Ext.Date.clone(h);switch(f){case this.YEAR:g.setFullYear(e.getFullYear());case this.MONTH:g.setMonth(e.getMonth());case this.WEEK:case this.DAY:if(f===this.WEEK){g=this.add(g,this.DAY,e.getDay()-g.getDay())}else{g.setDate(e.getDate())}case this.HOUR:g.setHours(e.getHours());case this.MINUTE:g.setMinutes(e.getMinutes());case this.SECOND:g.setSeconds(e.getSeconds());case this.MILLI:g.setMilliseconds(e.getMilliseconds())}return g},splitToSubUnits:function(g,h,f,e){f=f||1;e=arguments.length<4?1:e;switch(h){case this.MONTH:return this.splitMonth(g,f,e);case this.WEEK:case this.DAY:return this.splitDay(g,f);default:break}},splitYear:function(h,j){var f=this.clearTime(h,true);f.setMonth(0);f.setDate(1);var g=[];for(var i=0;i<=12;i=i+j){g.push(this.add(f,this.MONTH,i))}return g},splitMonth:function(k,p,l){var i=this.clearTime(k,true);i.setDate(1);i=this.add(i,this.DAY,l-i.getDay());var o=Ext.Date.clone(i);var m=this.add(i,this.MONTH,1);var j=[];for(var n=0;o.getTime()<m.getTime();n=n+p){o=this.add(i,this.WEEK,n);j.push(o)}return j},splitWeek:function(i,l,j){var g=this.add(i,this.DAY,j-i.getDay());g=this.clearTime(g);var h=[];for(var k=0;k<=7;k=k+l){h.push(this.add(g,this.DAY,k))}return h},splitDay:function(h,f){var i=this.clearTime(h,true);var g=[];for(var j=0;j<=24;j=j+f){g.push(this.add(i,this.HOUR,j))}return g},splitHour:function(h,f){var i=new Date(h.getTime());i.setMinutes(0);i.setSeconds(0);i.setMilliseconds(0);var g=[];for(var j=0;j<=60;j=j+f){g.push(this.add(i,this.MINUTE,j))}return g},splitMinute:function(h,f){var i=Ext.Date.clone(h);i.setSeconds(0);i.setMilliseconds(0);var g=[];for(var j=0;j<=60;j=j+f){g.push(this.add(i,this.SECOND,j))}return g},clearTime:function(d,c){if(d.getHours()>0||d.getMinutes()>0||d.getSeconds()>0){return Ext.Date.clearTime(d,c)}return c?Ext.Date.clone(d):d}});Ext.define("Sch.model.Range",{extend:Sch.model.Customizable,idProperty:"Id",startDateField:"StartDate",endDateField:"EndDate",nameField:"Name",clsField:"Cls",customizableFields:[{name:"StartDate",type:"date",dateFormat:"c"},{name:"EndDate",type:"date",dateFormat:"c"},{name:"Cls",type:"string"},{name:"Name",type:"string"}],setStartDate:function(f,g){var h=this.getEndDate();var e=this.getStartDate();this.beginEdit();this.set(this.startDateField,f);if(g===true&&h&&e){this.setEndDate(Sch.util.Date.add(f,Sch.util.Date.MILLI,h-e))}this.endEdit()},setEndDate:function(e,g){var f=this.getStartDate();var h=this.getEndDate();this.beginEdit();this.set(this.endDateField,e);if(g===true&&f&&h){this.setStartDate(Sch.util.Date.add(e,Sch.util.Date.MILLI,-(h-f)))}this.endEdit()},setStartEndDate:function(c,d){this.beginEdit();this.set(this.startDateField,c);this.set(this.endDateField,d);this.endEdit()},getDates:function(){var f=[],d=this.getEndDate();for(var e=Ext.Date.clearTime(this.getStartDate(),true);e<d;e=Sch.util.Date.add(e,Sch.util.Date.DAY,1)){f.push(e)}return f},forEachDate:function(c,d){return Ext.Array.each(this.getDates(),c,d)},isScheduled:function(){var b=this;return b.getStartDate()&&b.getEndDate()&&b.areDatesValid()},isValid:function(){var h=this,f=h.callParent(),g,e;if(f){g=h.getStartDate(),e=h.getEndDate();f=!g||!e||(e-g>=0)}return f},areDatesValid:function(){var d=this,f=d.getStartDate(),e=d.getEndDate();return !f||!e||(e-f>=0)},shift:function(c,d){this.setStartEndDate(Sch.util.Date.add(this.getStartDate(),c,d),Sch.util.Date.add(this.getEndDate(),c,d))},fullCopy:function(){return this.copy.apply(this,arguments)},intersectsRange:function(g,f){var h=this.getStartDate();var e=this.getEndDate();return h&&e&&Sch.util.Date.intersectSpans(h,e,g,f)}});Ext.define("Sch.data.Calendar",{extend:Ext.data.Store,alias:"store.calendar",mixins:[Sch.data.mixin.UniversalModelGetter,Robo.data.Store],model:"Sch.model.CalendarDay",daysPerMonth:30,daysPerWeek:7,hoursPerDay:24,unitsInMs:null,defaultNonWorkingTimeCssCls:"sch-nonworkingtime",weekendsAreWorkdays:false,weekendFirstDay:6,weekendSecondDay:0,holidaysCache:null,availabilityIntervalsCache:null,daysIndex:null,weekAvailability:null,defaultWeekAvailability:null,nonStandardWeeksByStartDate:null,nonStandardWeeksStartDates:null,calendarId:null,parent:null,defaultAvailability:["00:00-24:00"],name:null,suspendCacheUpdate:0,availabilitySearchLimit:1825,inheritableStatics:{getCalendar:function(b){if(b instanceof Sch.data.Calendar){return b}return Ext.data.StoreManager.lookup("GNT_CALENDAR:"+b)},getAllCalendars:function(){var b=[];Ext.data.StoreManager.each(function(a){if(a instanceof Sch.data.Calendar){b.push(a)}});return b},removeAll:function(){var b=Ext.data.StoreManager;b.each(function(a){if(a instanceof Sch.data.Calendar){b.unregister(a);Ext.destroy(a)}})}},constructor:function(e){e=e||{};var d=e.parent;delete e.parent;var f=e.calendarId;delete e.calendarId;this.callParent(arguments);this.setParent(d);this.setCalendarId(f);this.unitsInMs={MILLI:1,SECOND:1000,MINUTE:60*1000,HOUR:60*60*1000,DAY:this.hoursPerDay*60*60*1000,WEEK:this.daysPerWeek*this.hoursPerDay*60*60*1000,MONTH:this.daysPerMonth*this.hoursPerDay*60*60*1000,QUARTER:3*this.daysPerMonth*24*60*60*1000,YEAR:4*3*this.daysPerMonth*24*60*60*1000};this.defaultWeekAvailability=this.getDefaultWeekAvailability();this.on({update:this.clearCache,datachanged:this.clearCache,clear:this.clearCache,scope:this});this.clearCache()},getCalendarId:function(){return this.calendarId},setCalendarId:function(c){if(this.calendarId!=null){Ext.data.StoreManager.unregister(this)}this.calendarId=c;if(c!=null){this.storeId="GNT_CALENDAR:"+c;Ext.data.StoreManager.register(this)}else{this.storeId=null}var d=this.proxy;if(d&&d.extraParams){d.extraParams.calendarId=c}},getDefaultWeekAvailability:function(){var h=this.defaultAvailability;var i=this.weekendFirstDay;var g=this.weekendSecondDay;var j=[];for(var f=0;f<7;f++){j.push(this.weekendsAreWorkdays||f!=i&&f!=g?new this.model({Type:"WEEKDAY",Weekday:f,Availability:h&&h.slice()||[],IsWorkingDay:true}):new this.model({Type:"WEEKDAY",Weekday:f,Availability:[]}))}return j},clearCache:function(){if(this.suspendCacheUpdate>0){return}this.holidaysCache={};this.availabilityIntervalsCache={};var h=this.daysIndex={};var f=this.weekAvailability=[];var g=this.nonStandardWeeksStartDates=[];var e=this.nonStandardWeeksByStartDate={};this.each(function(d){var t=d.getId();var a=/^(\d)-(\d\d\d\d\/\d\d\/\d\d)-(\d\d\d\d\/\d\d\/\d\d)$/.exec(t);var o=/^WEEKDAY:(\d+)$/.exec(t);var b=d.getType();var c=d.getWeekday();if(b=="WEEKDAYOVERRIDE"||a){var s,p;if(b=="WEEKDAYOVERRIDE"){s=d.getOverrideStartDate();p=d.getOverrideEndDate()}if(a){s=Ext.Date.parse(a[2],"Y/m/d");p=Ext.Date.parse(a[3],"Y/m/d");c=a[1]}if(s&&p&&c!=null){var q=s-0;if(!e[q]){e[q]={startDate:new Date(s),endDate:new Date(p),name:d.getName(),weekAvailability:[],mainDay:null};g.push(q)}if(c>=0){e[q].weekAvailability[c]=d}else{e[q].mainDay=d}}}else{if(b=="WEEKDAY"||o){if(o){c=o[1]}if(c!=null){if(c<0||c>6){throw new Error("Incorrect week day index")}f[c]=d}}else{var r=d.getDate();if(r){h[r-0]=d}}}});g.sort(function(a,b){return a-b});this.fireEvent("calendarchange",this)},intersectsWithCurrentWeeks:function(d,f){var e=false;this.forEachNonStandardWeek(function(a){var c=a.startDate;var b=a.endDate;if(c<=d&&d<b||c<f&&f<=b){e=true;return false}});return e},addNonStandardWeek:function(h,k,i,n){h=Ext.Date.clearTime(new Date(h));k=Ext.Date.clearTime(new Date(k));if(this.intersectsWithCurrentWeeks(h,k)){throw new Error("Can not add intersecting week")}var l=this.model;var j=[];Ext.Array.each(i,function(c,b){if(c instanceof Sch.model.CalendarDay){c.setType("WEEKDAYOVERRIDE");c.setOverrideStartDate(h);c.setOverrideEndDate(k);c.setWeekday(b);c.setName(n||"Week override");j.push(c)}else{if(Ext.isArray(c)){var a=new l();a.setType("WEEKDAYOVERRIDE");a.setOverrideStartDate(h);a.setOverrideEndDate(k);a.setWeekday(b);a.setName(n||"Week override");a.setAvailability(c);j.push(a)}}});var m=new l();m.setType("WEEKDAYOVERRIDE");m.setOverrideStartDate(h);m.setOverrideEndDate(k);m.setWeekday(-1);m.setName(n||"Week override");j.push(m);this.add(j)},getNonStandardWeekByStartDate:function(b){return this.nonStandardWeeksByStartDate[Ext.Date.clearTime(new Date(b))-0]||null},getNonStandardWeekByDate:function(i){i=Ext.Date.clearTime(new Date(i))-0;var h=this.nonStandardWeeksStartDates;var g=this.nonStandardWeeksByStartDate;for(var j=0;j<h.length;j++){var f=g[h[j]];if(f.startDate>i){break}if(f.startDate<=i&&i<=f.endDate){return f}}return null},removeNonStandardWeek:function(d){d=Ext.Date.clearTime(new Date(d))-0;var c=this.getNonStandardWeekByStartDate(d);if(!c){return}this.remove(Ext.Array.clean(c.weekAvailability).concat(c.mainDay))},forEachNonStandardWeek:function(j,l){var k=this;var i=this.nonStandardWeeksStartDates;var h=this.nonStandardWeeksByStartDate;for(var g=0;g<i.length;g++){if(j.call(l||k,h[i[g]])===false){return false}}},setWeekendsAreWorkDays:function(b){if(b!==this.weekendsAreWorkdays){this.weekendsAreWorkdays=b;this.defaultWeekAvailability=this.getDefaultWeekAvailability();this.clearCache()}},areWeekendsWorkDays:function(){return this.weekendsAreWorkdays},getCalendarDay:function(b){b=typeof b=="number"?new Date(b):b;return this.getOverrideDay(b)||this.getWeekDay(b.getDay(),b)||this.getDefaultCalendarDay(b.getDay())},getOverrideDay:function(b){return this.getOwnCalendarDay(b)||this.parent&&this.parent.getOverrideDay(b)||null},getOwnCalendarDay:function(b){b=typeof b=="number"?new Date(b):b;return this.daysIndex[Ext.Date.clearTime(b,true)-0]},getWeekDay:function(f,d){if(d){var e=this.getNonStandardWeekByDate(d);if(e&&e.weekAvailability[f]){return e.weekAvailability[f]}}return this.weekAvailability[f]||this.parent&&this.parent.getWeekDay(f,d)||null},getDefaultCalendarDay:function(b){if(!this.hasOwnProperty("defaultAvailability")&&!this.hasOwnProperty("weekendsAreWorkdays")&&this.parent){return this.parent.getDefaultCalendarDay(b)}return this.defaultWeekAvailability[b]},isHoliday:function(h){var e=h-0;var g=this.holidaysCache;if(g[e]!=null){return g[e]}h=typeof h=="number"?new Date(h):h;var f=this.getCalendarDay(h);if(!f){throw"Can't find day for "+h}return g[e]=!f.getIsWorkingDay()},isWeekend:function(c){var d=c.getDay();return d===this.weekendFirstDay||d===this.weekendSecondDay},isWorkingDay:function(b){return !this.isHoliday(b)},convertMSDurationToUnit:function(d,c){return d/this.unitsInMs[Sch.util.Date.getNameOfUnit(c)]},convertDurationToMs:function(c,d){return c*this.unitsInMs[Sch.util.Date.getNameOfUnit(d)]},getHolidaysRanges:function(p,m,r){if(p>m){Ext.Error.raise("startDate can't be bigger than endDate")}p=Ext.Date.clearTime(p,true);m=Ext.Date.clearTime(m,true);var q=[],l,o;for(o=p;o<m;o=Sch.util.Date.getNext(o,Sch.util.Date.DAY,1)){if(this.isHoliday(o)||(this.weekendsAreWorkdays&&r&&this.isWeekend(o))){var k=this.getCalendarDay(o);var j=k&&k.getCls()||this.defaultNonWorkingTimeCssCls;var n=Sch.util.Date.getNext(o,Sch.util.Date.DAY,1);if(!l){l=new Sch.model.Range({StartDate:o,EndDate:n,Cls:j})}else{if(l.getCls()==j){l.setEndDate(n)}else{q.push(l);l=new Sch.model.Range({StartDate:o,EndDate:n,Cls:j})}}}else{if(l){q.push(l);l=null}}}if(l){q.push(l)}return q},forEachAvailabilityInterval:function(i,C,s){s=s||this;var w=this;var E=i.startDate;var y=i.endDate;var t=i.isForward!==false;if(t?!E:!y){throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option")}var H=new Date(t?E:y);var F=Sch.util.Date;if(t){if(!y){y=F.add(E,"d",i.availabilitySearchLimit||this.availabilitySearchLimit||5*365)}}else{if(!E){E=F.add(y,"d",-(i.availabilitySearchLimit||this.availabilitySearchLimit||5*365))}}var B=false;while(t?H<y:H>E){var z=this.getAvailabilityIntervalsFor(H-(t?0:1),t?B:false);for(var A=t?0:z.length-1;t?A<z.length:A>=0;t?A++:A--){var G=z[A];var x=G.startDate;var u=G.endDate;if(x>=y||u<=E){continue}var D=x<E?E:x;var v=u>y?y:u;if(C.call(s,D,v)===false){return false}}H=t?F.getStartOfNextDay(H,false,B):F.getEndOfPreviousDay(H,B);B=true}},calculateDuration:function(f,g,e){var h=0;this.forEachAvailabilityInterval({startDate:f,endDate:g},function(a,b){var c=a.getTimezoneOffset()-b.getTimezoneOffset();h+=b-a+c*60*1000});return this.convertMSDurationToUnit(h,e)},calculateEndDate:function(h,i,g){if(!i){return new Date(h)}var j=Sch.util.Date,k;i=this.convertDurationToMs(i,g);var l=i===0&&Ext.Date.clearTime(h,true)-h===0?j.add(h,Sch.util.Date.DAY,-1):h;this.forEachAvailabilityInterval({startDate:l},function(b,c){var a=c-b;var d=b.getTimezoneOffset()-c.getTimezoneOffset();if(a>=i){k=new Date(b-0+i);return false}else{i-=a+d*60*1000}});return k},calculateStartDate:function(g,h,e){if(!h){return new Date(g)}var f;h=this.convertDurationToMs(h,e);this.forEachAvailabilityInterval({endDate:g,isForward:false},function(b,c){var a=c-b;if(a>=h){f=new Date(c-h);return false}else{h-=a}});return f},skipNonWorkingTime:function(e,f){var d=false;this.forEachAvailabilityInterval(f?{startDate:e}:{endDate:e,isForward:false},function(a,b){e=f?a:b;d=true;return false});if(!d){throw"skipNonWorkingTime: Cannot skip non-working time, please ensure that this calendar has any working period of time specified"}return new Date(e)},skipWorkingTime:function(e,f,d){return f>=0?this.calculateEndDate(e,f,d):this.calculateStartDate(e,-f,d)},getAvailabilityIntervalsFor:function(d,c){if(c){d=(d).valueOf()}else{if(d instanceof Date){d=(new Date(d.getFullYear(),d.getMonth(),d.getDate())).valueOf()}else{d=Ext.Date.clearTime(new Date(d)).valueOf()}}return this.availabilityIntervalsCache[d]=(this.availabilityIntervalsCache[d]||this.getCalendarDay(d).getAvailabilityIntervalsFor(d))},isChildOf:function(f){var e=this,d=false;while(e&&!d){d=e===f;e=e.parent}return d},getParentableCalendars:function(){var d=this,e=[],f=Sch.data.Calendar.getAllCalendars();Ext.Array.each(f,function(a){if(a!==d&&!a.isChildOf(d)){e.push({Id:a.calendarId,Name:a.name||a.calendarId})}});return e},setParent:function(h){var i=Sch.data.Calendar.getCalendar(h);if(h&&!i){throw new Error("Invalid parent specified for the calendar")}if(this.parent!=i){var f=this.proxy;var j={calendarchange:this.clearCache,destroy:this.onParentDestroy,scope:this};var g=this.parent;if(g){g.un(j)}this.parent=i;if(i){i.on(j)}if(f&&f.extraParams){f.extraParams.parentId=i?i.calendarId:null}this.clearCache();this.fireEvent("parentchange",this,i,g)}},onParentDestroy:function(){this.setParent(null)},isAvailabilityIntersected:function(j,y,r){var l,z,v,s;for(var t=0;t<7;t++){l=this.getWeekDay(t)||this.getDefaultCalendarDay(t);v=j.getWeekDay(t)||j.getDefaultCalendarDay(t);if(!l||!v){continue}z=l.getAvailability();s=v.getAvailability();for(var u=0,x=z.length;u<x;u++){for(var w=0,k=s.length;w<k;w++){if(s[w].startTime<z[u].endTime&&s[w].endTime>z[u].startTime){return true}}}}var i=false;this.forEachNonStandardWeek(function(a){if(a.startDate>=r){return false}if(y<a.endDate){i=true;return false}});return i}});Ext.define("Sch.data.CrudManager",{extend:Sch.crud.AbstractManager,mixins:[Sch.crud.encoder.Json,Sch.crud.transport.Ajax],resourceStore:null,eventStore:null,assignmentStore:null,dependencyStore:null,addRelatedStores:true,constructor:function(p){p=p||{};var k=p.resourceStore||this.resourceStore||new Sch.data.ResourceStore(),o=p.eventStore||this.eventStore||new Sch.data.EventStore(),l=p.assignmentStore||this.assignmentStore,r=p.dependencyStore||this.dependencyStore,j=[];if(o&&p.addRelatedStores!==false){var m=this.getEventStoreInfo(o,p);l=l||m.assignmentStore;k=k||m.resourceStore;r=r||m.dependencyStore}o&&j.push(o);k&&j.push(k);l&&j.push(l);r&&j.push(r);if(j.length){var q=[];k&&q.push(k);o&&q.push(o);l&&q.push(l);r&&q.push(r);if(q.length){p.syncApplySequence=(p.syncApplySequence||p.stores||[]).concat(q)}var n=p.stores||this.stores;if(n&&!Ext.isArray(n)){n=[n]}p.stores=(n||[]).concat(j)}this.callParent([p]);this.eventStore=this.getStoreDescriptor(o);this.resourceStore=this.getStoreDescriptor(k);this.assignmentStore=this.getStoreDescriptor(l);this.dependencyStore=this.getStoreDescriptor(r)},getEventStoreInfo:function(k,l){if(!k.isStore){if(typeof k=="string"){k=Ext.data.StoreManager.get(k)}else{k=k.store}}var h={},i=l.assignmentStore,j=l.resourceStore,g=l.dependencyStore;!i&&(h.assignmentStore=k.getAssignmentStore());!j&&(h.resourceStore=k.getResourceStore());!g&&(h.dependencyStore=k.getDependencyStore());return h},getResourceStore:function(){return this.resourceStore&&this.resourceStore.store},setResourceStore:function(b){if(this.getResourceStore()){this.removeStore(this.getResourceStore())}this.addStore(b);this.resourceStore={store:b}},getEventStore:function(){return this.eventStore&&this.eventStore.store},setEventStore:function(b){if(this.getEventStore()){this.removeStore(this.getEventStore())}this.addStore(b);this.eventStore={store:b}},getAssignmentStore:function(){return this.assignmentStore&&this.assignmentStore.store},setAssignmentStore:function(b){if(this.getAssignmentStore()){this.removeStore(this.getAssignmentStore())}this.addStore(b);this.assignmentStore={store:b}},getDependencyStore:function(){return this.dependencyStore&&this.dependencyStore.store},setDependencyStore:function(b){if(this.getDependencyStore()){this.removeStore(this.getDependencyStore())}this.addStore(b);this.dependencyStore={store:b}}});Ext.define("Sch.model.Dependency",{extend:Sch.model.Customizable,inheritableStatics:{Type:{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}},idProperty:"Id",customizableFields:[{name:"From"},{name:"To"},{name:"Type",type:"int",defaultValue:2},{name:"Cls",defaultValue:""},{name:"Bidirectional",type:"boolean"}],fromField:"From",toField:"To",typeField:"Type",clsField:"Cls",bidirectionalField:"Bidirectional",constructor:function(d){var c=this;c.callParent(arguments);if(d){if(d[c.fromField]&&d[c.fromField] instanceof Sch.model.Range){c.setSourceEvent(d[c.fromField]);delete d.fromField}if(d[c.toField]&&d[c.toField] instanceof Sch.model.Range){c.setTargetEvent(d[c.toField]);delete d.toField}}},getEventStore:function(){return this.store.getEventStore()},getSourceEvent:function(d){var c=this;return(d||c.getEventStore()).getModelById(c.getSourceId())},setSourceEvent:function(b){this.setSourceId(b.getId())},getTargetEvent:function(d){var c=this;return(d||c.getEventStore()).getModelById(c.getTargetId())},setTargetEvent:function(b){this.setTargetId(b.getId())},getSourceId:function(){return this.getFrom()},setSourceId:function(b){return this.setFrom(b)},getTargetId:function(){return this.getTo()},setTargetId:function(b){return this.setTo(b)},isPersistable:function(){var e=this,d=e.getSourceEvent(),f=e.getTargetEvent();return d&&!d.phantom&&f&&!f.phantom},isValid:function(g){var j=this,k=j.callParent(arguments),i=j.getSourceId(),h=j.getTargetId(),l=j.getType();return Ext.isNumber(l)&&!Ext.isEmpty(i)&&!Ext.isEmpty(h)&&i!=h}});Ext.define("Sch.data.DependencyStore",{extend:Ext.data.Store,mixins:[Sch.data.mixin.UniversalModelGetter,Sch.data.mixin.CacheHintHelper,Robo.data.Store],config:{extraKeys:{bySourceTargetId:{keyFn:function(b){return Sch.data.DependencyStore.makeDependencySourceTargetCompositeKey(b.getSourceId(),b.getTargetId())}}}},model:"Sch.model.Dependency",alias:"store.sch_dependencystore",storeId:"dependencies",eventDependencyCache:null,eventStoreDetacher:null,eventStore:null,constructor:function(d){var c=this;c.callParent([d]);c.eventDependencyCache=c.eventDependencyCache||c.createEventDependencyCache()},destroy:function(){var b=this;Ext.destroyMembers(b,"eventDependencyCache","eventStoreDetacher");b.callParent()},createEventDependencyCache:function(){return new Sch.data.util.EventDependencyCache(this)},getEventStore:function(){return this.eventStore},setEventStore:function(e){var d=this,f=d.eventStore;d.eventStore=e&&Ext.StoreMgr.lookup(e)||null;d.attachToEventStore(d.eventStore);if((f||e)&&f!==e){d.fireEvent("eventstorechange",d,e,f)}},attachToEventStore:function(d){var c=this;Ext.destroy(c.eventStoreDetacher);if(d&&d.isTreeStore){c.eventStoreDetacher=d.on({noderemove:c.onEventNodeRemove,scope:c,destroyable:true,priority:200})}else{if(d){c.eventStoreDetacher=d.on({remove:c.onEventRemove,scope:c,destroyable:true,priority:200})}}},onEventRemove:function(g,h,e,f){!f&&this.removeEventDependencies(h,false)},onEventNodeRemove:function(d,f,e){!e&&this.removeEventDependencies(f,false)},reduceEventDependencies:function(k,j,h,i,g){var l=this;g=g||function(a){return l.eventDependencyCache.get(a)};k=Ext.isArray(k)?k:[k];i=i===undefined?true:false;Ext.Array.reduce(k,function(b,a){if(a.isNode&&!i){a.cascadeBy(function(c){b=Ext.Array.reduce(g(c),j,b)})}else{b=Ext.Array.reduce(g(a),j,b)}},h);return h},reduceEventIncomingDependencies:function(j,i,g,h){var f=this;return f.reduceEventDependencies(j,i,g,h,function(a){return f.eventDependencyCache.getPredecessors(a)})},reduceEventOutgoingDependencies:function(j,i,g,h){var f=this;return f.reduceEventDependencies(j,i,g,h,function(a){return f.eventDependencyCache.getSuccessors(a)})},mapEventDependencies:function(j,f,i,h,g){return this.reduceEventDependencies(j,function(b,a){i(a)&&b.push(a);return b},[],h,g)},mapEventIncomingDependencies:function(e,f,h,g){return this.reduceEventIncomingDependencies(e,function(b,a){h(a)&&b.push(a);return b},[],g)},mapEventOutgoingDependencies:function(e,f,h,g){return this.reduceEventOutgoingDependencies(e,function(b,a){h(a)&&b.push(a);return b},[],g)},getEventDependencies:function(d,c){return this.mapEventDependencies(d,Ext.identityFn,Ext.returnTrue,c)},getEventIncomingDependencies:function(d,c){return this.mapEventIncomingDependencies(d,Ext.identityFn,Ext.returnTrue,c)},getEventOutgoingDependencies:function(d,c){return this.mapEventOutgoingDependencies(d,Ext.identityFn,Ext.returnTrue,c)},getEventPredecessors:function(h,g){var e=this,f=e.getEventStore();return e.reduceEventDependencies(h,function(d,b){var c=b.getFrom(),a=c&&f.getModelById(c);if(a){d.push(a)}return d},[],g,function(a){return e.eventDependencyCache.getPredecessors(a)})},getEventSuccessors:function(h,g){var e=this,f=e.getEventStore();return e.reduceEventDependencies(h,function(d,b){var a=b.getTo(),c=a&&f.getModelById(a);if(c){d.push(c)}return d},[],g,function(a){return e.eventDependencyCache.getSuccessors(a)})},removeEventDependencies:function(e,g){var f=this,h;h=f.getEventDependencies(e,g);h.length&&f.remove(Ext.Array.unique(h))},removeEventIncomingDependencies:function(e,g){var f=this,h;h=f.getEventIncomingDependencies(e,g);h.length&&f.remove(Ext.Array.unique(h))},removeEventOutgoingDependencies:function(e,g){var f=this,h;h=f.getEventOutgoingDependencies(e,g);h.length&&f.remove(Ext.Array.unique(h))},getDependencyForSourceAndTargetEvents:function(e,d){var f=this;e=e instanceof Ext.data.Model&&e.getId()||e;d=d instanceof Ext.data.Model&&d.getId()||d;return f.bySourceTargetId.get(f.self.makeDependencySourceTargetCompositeKey(e,d))},getEventsLinkingDependency:function(d,e){var f=this;return f.getDependencyForSourceAndTargetEvents(d,e)||f.getDependencyForSourceAndTargetEvents(e,d)},inheritableStatics:{makeDependencySourceTargetCompositeKey:function(){var b=[];return function(d,a){b.length=0;b.push("source(",d,")-target(",a,")");return b.join("")}}()}});Ext.define("Sch.data.util.IdConsistencyManager",{config:{eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(b){this.initConfig(b)},updateEventStore:function(e,f){var d=this;Ext.destroyMembers(d,"eventStoreDetacher");if(e){d.eventStoreDetacher=e.on({idchanged:d.onEventIdChanged,scope:d,destroyable:true,priority:200})}},updateResourceStore:function(e,d){var f=this;Ext.destroyMembers(f,"resourceStoreDetacher");if(e){f.resourceStoreDetacher=e.on({idchanged:f.onResourceIdChanged,scope:f,destroyable:true,priority:200})}},onEventIdChanged:function(m,r,o,n){var j=this,l=j.getAssignmentStore(),p=j.getDependencyStore(),q,k;if(l){q=j.getUpdateAssignmentEventIdFieldFn(l,o,n)}if(p){k=j.getUpdateDependencySourceTargedIdFieldFn(p,o,n)}if(q||k){m.on("update",function(){q&&q();k&&k()},null,{single:true,priority:200})}},onResourceIdChanged:function(j,n,q,o){var k=this,m=k.getEventStore(),l=k.getAssignmentStore(),p,r;if(m&&!l){p=k.getUpdateEventResourceIdFieldFn(m,q,o)}if(l){r=k.getUpdateAssignmentResourceIdFieldFn(l,q,o)}if(p||l){j.on("update",function(){p&&p();r&&r()},null,{single:true,priority:200})}},getUpdateEventResourceIdFieldFn:function(h,g,f){var e=h.getRange();return function(){Ext.Array.each(e,function(a){a.getResourceId()==g&&a.setResourceId(f)})}},getUpdateAssignmentEventIdFieldFn:function(h,g,e){var f=h.getAssignmentsForEvent(g);return function(){Ext.Array.each(f,function(a){a.getEventId()==g&&a.setEventId(e)})}},getUpdateAssignmentResourceIdFieldFn:function(h,g,e){var f=h.getAssignmentsForResource(g);return function(){Ext.Array.each(f,function(a){a.getResourceId()==g&&a.setResourceId(e)})}},getUpdateDependencySourceTargedIdFieldFn:function(e,g,f){var h=e.getEventDependencies(g);return function(){Ext.Array.each(h,function(a){a.getSourceId()==g&&a.setSourceId(f);a.getTargetId()==g&&a.setTargetId(f)})}}});Ext.define("Sch.data.util.ModelPersistencyManager",{config:{eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,assignmentStoreDetacher:null,dependencyStoreDetacher:null,constructor:function(b){this.initConfig(b)},updateEventStore:function(e,f){var d=this;Ext.destroyMembers(d,"eventStoreDetacher");if(e&&e.autoSync){d.eventStoreDetacher=e.on({beforesync:d.onEventStoreBeforeSync,scope:d,destroyable:true,priority:100})}},updateResourceStore:function(e,d){var f=this;Ext.destroyMembers(f,"resourceStoreDetacher");if(e&&e.autoSync){f.resourceStoreDetacher=e.on({beforesync:f.onResourceStoreBeforeSync,scope:f,destroyable:true,priority:100})}},updateAssignmentStore:function(e,d){var f=this;Ext.destroyMembers(f,"assignmentStoreDetacher");if(e&&e.autoSync){f.assignmentStoreDetacher=e.on({beforesync:f.onAssignmentStoreBeforeSync,scope:f,destroyable:true,priority:100})}},updateDependencyStore:function(f,e){var d=this;Ext.destroyMembers(d,"dependencyStoreDetacher");if(f&&f.autoSync){d.dependencyStoreDetacher=f.on({beforesync:d.onDependencyStoreBeforeSync,scope:d,destroyable:true,priority:100})}},onEventStoreBeforeSync:function(d){var c=this;c.removeNonPersistableRecordsToCreate(d);return c.shallContinueSync(d)},onResourceStoreBeforeSync:function(d){var c=this;c.removeNonPersistableRecordsToCreate(d);return c.shallContinueSync(d)},onAssignmentStoreBeforeSync:function(d){var c=this;c.removeNonPersistableRecordsToCreate(d);return c.shallContinueSync(d)},onDependencyStoreBeforeSync:function(d){var c=this;c.removeNonPersistableRecordsToCreate(d);return c.shallContinueSync(d)},removeNonPersistableRecordsToCreate:function(e){var f=e.create||[],g,h;for(h=f.length-1;h>=0;--h){g=f[h];if(!g.isPersistable()){Ext.Array.remove(f,g)}}if(f.length===0){delete e.create}},shallContinueSync:function(b){return Boolean((b.create&&b.create.length>0)||(b.update&&b.update.length>0)||(b.destroy&&b.destroy.length>0))}});Ext.define("Sch.util.Cache",{cache:null,constructor:function(){this.cache={}},key:function(c){var d;if(c instanceof Ext.data.Model){d=c.getId().toString()}else{if(c===undefined||c===null){d="[ undefined / null ]"}else{d=(c).toString()}}return d},get:function(e,h){var g=this,f;e=g.key(e);f=g.cache.hasOwnProperty(e)&&g.cache[e];if(!f&&h){f=h()}else{if(!f){f=[]}}g.cache[e]=f;return f},add:function(h,e){var g=this,f=g.key(h);if(!g.cache.hasOwnProperty(f)){g.cache[f]=g.get(h)}Ext.Array.include(g.cache[f],e);return g},remove:function(d,e){var f=this;d=f.key(d);if(f.cache.hasOwnProperty(d)){Ext.Array.remove(f.cache[d],e)}return f},move:function(h,g,f){var e=this;h=e.key(h);g=e.key(g);if(h!=g&&arguments.length>=3){e.remove(h,f);e.add(g,f)}else{if(h!=g&&e.cache.hasOwnProperty(h)&&e.cache.hasOwnProperty(g)){e.cache[g]=Ext.Array.union(e.cache[g],e.cache[h]);e.cache[h]=[]}else{if(h!=g&&e.cache.hasOwnProperty(h)){e.cache[g]=e.cache[h];e.cache[h]=[]}}}return e},clear:function(d){var c=this;if(!arguments.length){c.cache={}}else{d=c.key(d);if(c.cache.hasOwnProperty(d)){delete c.cache[d]}}return c},uncache:function(d){var f=this,e;for(e in f.cache){if(f.cache.hasOwnProperty(e)){f.cache[e]=Ext.Array.remove(f.cache[e],d)}}return f}});Ext.define("Sch.data.util.ResourceEventsCache",{extend:Sch.util.Cache,eventStore:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(v){var p=this,o=v.getResourceStore();p.callParent();function m(b,a){Ext.Array.each(a,function(c){p.add(c.getResourceId(),c)})}function t(b,a){Ext.Array.each(a,function(c){p.remove(c.getResourceId(),c)})}function u(f,c,g,d){var b=c.resourceIdField,e=c.previous&&b in c.previous,a=e&&c.previous[b];if(e){p.move(a,c.getResourceId(),c)}}function r(){p.clear()}function n(c,a,b){p.clear();x(a)}function q(d,c,b,a){p.move(b,a)}function s(a,b){Ext.Array.each(b,function(c){p.clear(c)})}function w(){p.clear()}function x(a){Ext.destroy(p.resourceStoreDetacher);p.resourceStoreDetacher=a&&a.on({idchanged:q,remove:s,clear:w,cacheresethint:w,rootchange:w,priority:100,destroyable:true})}p.eventStoreDetacher=v.on({add:m,remove:t,update:u,clear:r,cacheresethint:r,rootchange:r,resourcestorechange:n,priority:100,destroyable:true});p.eventStoreFiltersDetacher=v.getFilters().on("endupdate",r,this,{priority:1002,destroyable:true});x(o);p.eventStore=v},destroy:function(){var b=this;Ext.destroyMembers(b,"eventStoreDetacher","eventStoreFiltersDetacher","resourceStoreDetacher");b.eventStore=null},get:function(e,d){var f=this;e=f.key(e);d=d||function(){return Ext.Array.filter(f.eventStore.getRange(),function(a){return a.getResourceId()==e})};return f.callParent([e,d])}});Ext.define("Sch.data.mixin.EventStore",{extend:Ext.Mixin,isEventStore:true,resourceStore:null,resourceStoreDetacher:null,assignmentStore:null,resourceEventsCache:null,idConsistencyManager:null,modelPersistencyManager:null,mixinConfig:{after:{constructor:"constructor",destroy:"destroy"}},constructor:function(){var b=this;b.resourceEventsCache=b.createResourceEventsCache();b.idConsistencyManager=b.createIdConsistencyManager();b.modelPersistencyManager=b.createModelPersistencyManager()},destroy:function(){var b=this;Ext.destroyMembers(b,"resourceEventsCache","idConsistencyManager","modelPersistencyManager")},createResourceEventsCache:function(){return new Sch.data.util.ResourceEventsCache(this)},createIdConsistencyManager:function(){var b=this;return new Sch.data.util.IdConsistencyManager({eventStore:b,resourceStore:b.getResourceStore(),assignmentStore:b.getAssignmentStore(),dependencyStore:b.getDependencyStore()})},createModelPersistencyManager:function(){var b=this;return new Sch.data.util.ModelPersistencyManager({eventStore:b,resourceStore:b.getResourceStore(),assignmentStore:b.getAssignmentStore(),dependencyStore:b.getDependencyStore()})},getResourceStore:function(){return this.resourceStore},setResourceStore:function(d){var e=this,f=e.resourceStore;if(e.resourceStore){e.resourceStore.setEventStore(null);e.idConsistencyManager&&e.idConsistencyManager.setResourceStore(null);e.modelPersistencyManager&&e.modelPersistencyManager.setResourceStore(null)}e.resourceStore=d&&Ext.StoreMgr.lookup(d)||null;if(e.resourceStore){e.modelPersistencyManager&&e.modelPersistencyManager.setResourceStore(e.resourceStore);e.idConsistencyManager&&e.idConsistencyManager.setResourceStore(e.resourceStore);d.setEventStore(e)}if((f||d)&&f!==d){e.fireEvent("resourcestorechange",e,d,f)}},getAssignmentStore:function(){return this.assignmentStore},setAssignmentStore:function(d){var e=this,f=e.assignmentStore;if(e.assignmentStore){e.assignmentStore.setEventStore(null);e.idConsistencyManager&&e.idConsistencyManager.setAssignmentStore(null);e.modelPersistencyManager&&e.modelPersistencyManager.setAssignmentStore(null)}e.assignmentStore=d&&Ext.StoreMgr.lookup(d)||null;if(e.assignmentStore){e.modelPersistencyManager&&e.modelPersistencyManager.setAssignmentStore(e.assignmentStore);e.idConsistencyManager&&e.idConsistencyManager.setAssignmentStore(e.assignmentStore);e.assignmentStore.setEventStore(e);Ext.destroy(e.resourceEventsCache)}else{e.resourceEventsCache=e.createResourceEventsCache()}if((f||d)&&f!==d){e.fireEvent("assignmentstorechange",e,d,f)}},getDependencyStore:function(){return this.dependencyStore},setDependencyStore:function(e){var d=this,f=d.DependencyStore;if(d.dependencyStore){d.dependencyStore.setEventStore(null);d.idConsistencyManager&&d.idConsistencyManager.setDependencyStore(null);d.modelPersistencyManager&&d.modelPersistencyManager.setDependencyStore(null)}d.dependencyStore=e&&Ext.StoreMgr.lookup(e)||null;if(d.dependencyStore){d.modelPersistencyManager&&d.modelPersistencyManager.setDependencyStore(d.dependencyStore);d.idConsistencyManager&&d.idConsistencyManager.setDependencyStore(d.dependencyStore);d.dependencyStore.setEventStore(d)}if((f||e)&&f!==e){d.fireEvent("dependencystorechange",d,e,f)}},isDateRangeAvailable:function(j,i,n,l){var k=Sch.util.Date,h=this.getEventsForResource(l),m=true;Ext.each(h,function(a){m=n===a||!k.intersectSpans(j,i,a.getStartDate(),a.getEndDate());return m});return m},getEventsInTimeSpan:function(i,g,h){var k=new Ext.util.MixedCollection();var l=[];if(h!==false){var j=Sch.util.Date;this.forEachScheduledEvent(function(a,b,c){if(j.intersectSpans(b,c,i,g)){l.push(a)}})}else{this.forEachScheduledEvent(function(a,b,c){if(b-i>=0&&g-c>=0){l.push(a)}})}k.addAll(l);return k},forEachScheduledEvent:function(c,d){this.each(function(a){var b=a.getStartDate(),f=a.getEndDate();if(b&&f){return c.call(d||this,a,b,f)}},this)},getTotalTimeSpan:function(){var e=new Date(9999,0,1),d=new Date(0),f=Sch.util.Date;this.each(function(a){if(a.getStartDate()){e=f.min(a.getStartDate(),e)}if(a.getEndDate()){d=f.max(a.getEndDate(),d)}});e=e<new Date(9999,0,1)?e:null;d=d>new Date(0)?d:null;this.lastTotalTimeSpan={start:e||null,end:d||e||null};return this.lastTotalTimeSpan},filterEventsForResource:function(g,h,e){var f=g.getEvents(this);return Ext.Array.filter(f,h,e||this)},append:function(b){throw"Must be implemented by consuming class"},getResourcesForEvent:function(i){var j=this,h=j.getAssignmentStore(),f=j.getResourceStore(),g;if(h){g=h.getResourcesForEvent(i)}else{if(f){i=i instanceof Sch.model.Event&&i||j.getModelById(i);g=i&&f.getModelById(i.getResourceId());g=g&&[g]||[]}else{g=[]}}return g},getEventsForResource:function(h){var e=this,g=e.getAssignmentStore(),f;if(g){f=g.getEventsForResource(h)}else{if(e.resourceEventsCache){f=e.resourceEventsCache.get(h)}else{f=[]}}return f},getAssignmentsForEvent:function(d){var e=this,f=e.getAssignmentStore();return f&&f.getAssignmentsForEvent(d)||[]},getAssignmentsForResource:function(d){var e=this,f=e.getAssignmentStore();return f&&f.getAssignmentsForResource(d)||[]},assignEventToResource:function(e,h){var f=this,g=f.getAssignmentStore();if(g){g.assignEventToResource(e,h)}else{e=e instanceof Sch.model.Event&&e||f.getModelById(e);h=h instanceof Sch.model.Resource?h.getId():h;e&&e.setResourceId(h)}},unassignEventFromResource:function(e,h){var f=this,g=f.getAssignmentStore();if(g){g.unassignEventFromResource(e,h)}else{e=e instanceof Sch.model.Event&&e||f.getModelById(e);h=h instanceof Sch.model.Resource?h.getId():h;if(e&&e.getResourceId()==h){e.setResourceId(null)}}},reassignEventFromResourceToResource:function(i,g,f){var j=this,h=j.getAssignmentStore();if(h){h.unassignEventFromResource(i,g);h.assignEventToResource(i,f)}else{i=i instanceof Sch.model.Event&&i||j.getModelById(i);g=g instanceof Sch.model.Resource?g.getId():g;f=f instanceof Sch.model.Resource?f.getId():f;if(i.getResourceId()==g){i.setResourceId(f)}}},isEventAssignedToResource:function(j,i){var f=this,h=f.getAssignmentStore(),g;if(h){g=h.isEventAssignedToResource(j,i)}else{j=j instanceof Sch.model.Event&&j||f.getModelById(j);i=i instanceof Sch.model.Resource?i.getId():i;g=j&&(j.getResourceId()==i)||false}return g},removeAssignmentsForEvent:function(d){var e=this,f=e.getAssignmentStore();if(f){f.removeAssignmentsForEvent(d)}else{d=d instanceof Sch.model.Event&&d||e.getModelById(d);d&&d.setResourceId(null)}},removeAssignmentsForResource:function(h){var e=this,g=e.getAssignmentStore(),f=e.getResourceStore();if(g){g.removeAssignmentsForResource(h)}else{if(f){h=h instanceof Sch.model.Resource&&h||f.getModelById(h);h&&Ext.Array.each(e.resourceEventsCache.get(h),function(a){a.setResourceId(null)})}else{h=h instanceof Sch.model.Resource?h.getId():h;Ext.Array.each(e.getRange(),function(a){a.getResourceId()==h&&a.setResourceId(null)})}}},isEventPersistable:function(l){var m=this,j=m.getAssignmentStore(),k,n,h,i=true;if(!j){k=l.getResources();for(n=0,h=k.length;i&&n<h;++n){i=k[n].phantom!==true}}return i}});Ext.define("Sch.model.Event",{extend:Sch.model.Range,idProperty:"Id",customizableFields:[{name:"IconCls"},{name:"ResourceId"},{name:"Draggable",type:"boolean",persist:false,defaultValue:true},{name:"Resizable",persist:false,defaultValue:true}],resourceIdField:"ResourceId",draggableField:"Draggable",resizableField:"Resizable",iconClsField:"IconCls",getInternalId:function(){return this.internalId},getEventStore:function(){var c=this,d=c.joined&&c.joined[0];if(d&&!d.isEventStore){Ext.Array.sort(c.joined,function(a,b){return(a.isEventStore||false)>(b.isEventStore||false)&&-1||1});d=c.joined[0];d=d.isEventStore?d:null}return d},getResourceStore:function(){var b=this.getEventStore();return b&&b.getResourceStore()},getAssignmentStore:function(){var b=this.getEventStore();return b&&b.getAssignmentStore()},getResources:function(){var c=this,d=c.getEventStore();return d&&d.getResourcesForEvent(c)||[]},forEachResource:function(g,h){var f=this.getResources();for(var e=0;e<f.length;e++){if(g.call(h||this,f[e])===false){return}}},getResource:function(h){var i=this,g=null,f=i.getEventStore(),j=f&&f.getResourceStore();h=h==null?i.getResourceId():h;if(f&&(h===null||h===undefined)){g=f.getResourcesForEvent(i);if(g.length==1){g=g[0]}else{if(g.length>1){Ext.Error.raise("Event::getResource() is not applicable for events with multiple assignments, please use Event::getResources() instead.")}else{g=null}}}else{if(j){g=j.getModelById(h)}}return g},setResource:function(f){var d=this,e=d.getEventStore();e&&e.removeAssignmentsForEvent(d);d.assign(f)},assign:function(f){var d=this,e=d.getEventStore();f=f instanceof Sch.model.Resource?f.getId():f;if(e){e.assignEventToResource(d,f)}else{d.setResourceId(f)}},unassign:function(f){var d=this,e=d.getEventStore();f=f instanceof Sch.model.Resource?f.getId():f;if(e){e.unassignEventFromResource(d,f)}else{if(d.getResourceId()==f){d.setResourceId(null)}}},reassign:function(f,e){var g=this,h=g.getEventStore();f=f instanceof Sch.model.Resource?f.getId():f;e=e instanceof Sch.model.Resource?e.getId():e;if(h){h.reassignEventFromResourceToResource(g,f,e)}else{g.setResourceId(e)}},isAssignedTo:function(g){var h=this,e=h.getEventStore(),f=false;g=g instanceof Sch.model.Resource&&g.getId()||g;if(e){f=e.isEventAssignedToResource(h,g)}else{f=h.getResourceId()==g}return f},getAssignments:function(){var c=this,d=c.getEventStore();return d&&d.getAssignmentsForEvent(c)},isDraggable:function(){return this.getDraggable()},isResizable:function(){return this.getResizable()},isPersistable:function(){var c=this,d=c.getEventStore();return d&&d.isEventPersistable(c)}});Ext.define("Sch.data.EventStore",{extend:Ext.data.Store,alias:"store.eventstore",mixins:[Sch.data.mixin.UniversalModelGetter,Sch.data.mixin.CacheHintHelper,Sch.data.mixin.EventStore,Robo.data.Store],storeId:"events",model:"Sch.model.Event",config:{model:"Sch.model.Event"},constructor:function(d){var c=this;c.callParent([d]);c.resourceStore&&c.setResourceStore(c.resourceStore);c.assignmentStore&&c.setAssignmentStore(c.assignmentStore);if(c.getModel()!==Sch.model.Event&&!(c.getModel().prototype instanceof Sch.model.Event)){throw"The model for the EventStore must subclass Sch.model.Event"}},append:function(b){this.add(b)}});Ext.define("Sch.data.mixin.ResourceStore",{eventStore:null,getEventStore:function(){return this.eventStore},setEventStore:function(e){var d=this,f;if(d.eventStore!==e){f=d.eventStore;d.eventStore=e&&Ext.StoreMgr.lookup(e)||null;d.fireEvent("eventstorechange",d,e,f)}},getScheduledEventsInTimeSpan:function(h,g,j){var f=[];var i=Sch.util.Date;j=j||this.getEventStore();Ext.Array.each(this.getRange(),function(a){Ext.Array.each(j.getEventsForResource(a),function(b){if(b.intersectsRange(h,g)){f.push(b)}})});return f}});Ext.define("Sch.model.Resource",{extend:Sch.model.Customizable,idProperty:"Id",config:Ext.versions.touch?{idProperty:"Id"}:null,nameField:"Name",customizableFields:[{name:"Name",type:"string"}],getInternalId:function(){return this.internalId},getResourceStore:function(){return this.joined&&this.joined[0]},getEventStore:function(){var b=this.getResourceStore();return b&&b.getEventStore()||this.parentNode&&this.parentNode.getEventStore()},getAssignmentStore:function(){var b=this.getEventStore();return b&&b.getAssignmentStore()},getEvents:function(d){var c=this;d=d||c.getEventStore();return d&&d.getEventsForResource(c)||[]},getAssignments:function(){var c=this,d=c.getEventStore();return d&&d.getAssignmentsForResource(c)},isPersistable:function(){var b=this.parentNode;return !b||!b.phantom||(b.isRoot&&b.isRoot())},isAbove:function(o){var m=this,k=m.getResourceStore(),j=false,n,p,q,r,l;if(m==o){j=false}else{if(k instanceof Ext.data.TreeStore){n=m;p=[];while(n){p.push(n);n=n.parentNode}n=o;q=[];while(n){q.push(n);n=n.parentNode}r=0;while(r<p.length-1&&r<q.length-1&&p[r]==q[r]){++r}l=p[r];m=p[r+1];o=q[r+1];j=l.indexOf(m)<l.indexOf(o)}else{j=k.indexOf(m)<k.indexOf(o)}}return j}});Ext.define("Sch.data.ResourceStore",{extend:Ext.data.Store,model:"Sch.model.Resource",config:{model:"Sch.model.Resource"},alias:"store.resourcestore",mixins:[Sch.data.mixin.UniversalModelGetter,Sch.data.mixin.CacheHintHelper,Sch.data.mixin.ResourceStore,Robo.data.Store],storeId:"resources",constructor:function(){this.callParent(arguments);if(this.getModel()!==Sch.model.Resource&&!(this.getModel().prototype instanceof Sch.model.Resource)){throw"The model for the ResourceStore must subclass Sch.model.Resource"}}});Ext.define("Sch.patches.TreeStore",{extend:Sch.util.Patch,target:"Ext.data.TreeStore",minVersion:"5.1.0",overrides:{getRejectRecords:function(){return this.getModifiedRecords()},rejectChanges:function(){this.removed=this.removedNodes;this.callParent(arguments)},remove:function(c){if(c.isModel){c.remove()}else{if(c instanceof Array&&c[0].isModel){for(var d=0;d<c.length;d++){c[d].remove()}}else{this.callParent(arguments)}}}}});Ext.define("Sch.patches.TreeStoreInternalIdMap",{extend:Sch.util.Patch,target:"Ext.data.TreeStore",minVersion:"5.1.1",overrides:{registerNode:function(f,e){var d=this;if(!d.byInternalIdMap){d.byInternalIdMap={}}d.byInternalIdMap[f.internalId]=f;d.callParent(arguments)},unregisterNode:function(f,e){var d=this;if(d.byInternalIdMap){delete d.byInternalIdMap[f.internalId]}d.callParent(arguments)},updateRoot:function(){this.byInternalIdMap={};this.callParent(arguments)}}});Ext.define("Sch.data.mixin.FilterableTreeStore",{isFilteredFlag:false,isHiddenFlag:false,treeFilter:null,lastTreeFilter:null,lastTreeHiding:null,allowExpandCollapseWhileFiltered:true,reApplyFilterOnDataChange:true,suspendIncrementalFilterRefresh:0,filterGeneration:0,currentFilterGeneration:null,dataChangeListeners:null,monitoringDataChange:false,filterUpdateSuspended:false,onClassMixedIn:function(b){b.override(Sch.data.mixin.FilterableTreeStore.prototype.inheritables()||{})},initTreeFiltering:function(){this.treeFilter=new Ext.util.Filter({filterFn:this.isNodeFilteredIn,scope:this});this.dataChangeListeners={nodeappend:this.onNeedToUpdateFilter,nodeinsert:this.onNeedToUpdateFilter,scope:this};Ext.apply(this.dataChangeListeners,{beforeload:this.onStoreBeforeLoad,load:this.onStoreLoad})},onStoreBeforeLoad:function(){this.filterUpdateSuspended=true},onStoreLoad:function(){this.filterUpdateSuspended=false;this.onNeedToUpdateFilter()},startDataChangeMonitoring:function(){if(this.monitoringDataChange){return}this.monitoringDataChange=true;this.on(this.dataChangeListeners)},stopDataChangeMonitoring:function(){if(!this.monitoringDataChange){return}this.monitoringDataChange=false;this.un(this.dataChangeListeners)},onNeedToUpdateFilter:function(){if(this.reApplyFilterOnDataChange&&!this.filterUpdateSuspended&&!this.suspendIncrementalFilterRefresh){this.reApplyFilter()}},clearTreeFilter:function(){if(!this.isTreeFiltered()){return}this.currentFilterGeneration=null;this.isFilteredFlag=false;this.lastTreeFilter=null;if(!this.isTreeFiltered(true)){this.stopDataChangeMonitoring()}this.refreshNodeStoreContent();this.fireEvent("filter-clear",this)},reApplyFilter:function(){if(this.isHiddenFlag){this.hideNodesBy.apply(this,this.lastTreeHiding.concat(this.isFilteredFlag))}if(this.isFilteredFlag){this.filterTreeBy(this.lastTreeFilter)}},refreshNodeStoreContent:function(){var c=this,d=c.getFilters();if(d.indexOf(c.treeFilter)<0){c.addFilter(c.treeFilter)}else{this.getFilters().fireEvent("endupdate",this.getFilters())}},getIndexInTotalDataset:function(m){var n=this.getRootNode(),k=-1;var j=this.rootVisible;if(!j&&m==n){return -1}var h=this.isTreeFiltered();var i=this.currentFilterGeneration;var l=function(b){if(h&&b.__filterGen!=i||b.hidden){if(b==m){return false}}if(j||b!=n){k++}if(b==m){return false}if(!b.isLeaf()&&b.isExpanded()){var a=b.childNodes,c=a.length;for(var d=0;d<c;d++){if(l(a[d])===false){return false}}}};l(n);return k},isTreeFiltered:function(b){return this.isFilteredFlag||b&&this.isHiddenFlag},markFilteredNodes:function(v,C){var w=this;var A=this.currentFilterGeneration;var B={};var u=this.getRootNode(),s=this.rootVisible;var p=function(a){var b=a.parentNode;while(b&&!B[b.internalId]){B[b.internalId]=true;b=b.parentNode}};var D=C.filter;var q=C.scope||this;var t=C.shallow;var r=C.checkParents||t;var y=C.fullMatchingParents;var z=C.onlyParents||y;if(z&&r){throw new Error("Can't combine `onlyParents` and `checkParents` options")}if(s){B[u.internalId]=true}var x=function(b){b.addedWhileFiltered=false;if(b.hidden){return}var d,a,c,e;if(b.isLeaf()){if(D.call(q,b,B)){B[b.internalId]=true;p(b)}}else{if(z){d=D.call(q,b);a=b.childNodes;c=a.length;if(d){B[b.internalId]=true;p(b);if(y){b.cascadeBy(function(f){B[f.internalId]=true});return}}for(e=0;e<c;e++){if(d&&a[e].isLeaf()){B[a[e].internalId]=true}else{if(!a[e].isLeaf()){x(a[e])}}}}else{if(r){d=D.call(q,b,B);if(d){B[b.internalId]=true;p(b)}}if(!r||!t||t&&(d||b==u&&!s)){a=b.childNodes;c=a.length;for(e=0;e<c;e++){x(a[e])}}}}};x(v);u.cascadeBy(function(a){if(B[a.internalId]){a.__filterGen=A;if(w.allowExpandCollapseWhileFiltered&&!a.isLeaf()){a.expand()}}})},filterTreeBy:function(f,d){this.currentFilterGeneration=this.filterGeneration++;var e;if(arguments.length==1&&Ext.isObject(arguments[0])){d=f.scope;e=f.filter}else{e=f;f={filter:e,scope:d}}this.fireEvent("nodestore-datachange-start",this);f=f||{};this.markFilteredNodes(this.getRootNode(),f);this.startDataChangeMonitoring();this.isFilteredFlag=true;this.lastTreeFilter=f;this.fireEvent("nodestore-datachange-end",this);this.fireEvent("filter-set",this);this.refreshNodeStoreContent()},isNodeFilteredIn:function(f){var d=this.isTreeFiltered();var e=this.currentFilterGeneration;return this.loading||!Boolean(d&&f.__filterGen!=e||f.hidden)},hasNativeFilters:function(){var f=this,d=f.getFilters(),e=d.getCount();return(e&&e>1)||d.indexOf(f.treeFilter)<0},hideNodesBy:function(e,f,g){var h=this;if(h.isFiltered()&&h.hasNativeFilters()){throw new Error("Can't hide nodes of a filtered tree store")}f=f||h;h.getRootNode().cascadeBy(function(a){a.hidden=Boolean(e.call(f,a,h))});h.startDataChangeMonitoring();h.isHiddenFlag=true;h.lastTreeHiding=[e,f];if(!g){h.refreshNodeStoreContent()}},showAllNodes:function(b){this.getRootNode().cascadeBy(function(a){a.hidden=false});this.isHiddenFlag=false;this.lastTreeHiding=null;if(!this.isTreeFiltered(true)){this.stopDataChangeMonitoring()}if(!b){this.refreshNodeStoreContent()}},inheritables:function(){return{onNodeExpand:function(f,d,e){if(this.isTreeFiltered(true)&&f==this.getRoot()){this.callParent(arguments);this.reApplyFilter()}else{return this.callParent(arguments)}},onNodeCollapse:function(r,w,o,p,n){var s=this;var u=s.data;var m=u.contains;var v=s.isTreeFiltered();var t=s.currentFilterGeneration;u.contains=function(){var d,e,b;var f=s.indexOf(r)+1;var c=false;for(var a=0;a<w.length;a++){if(!(w[a].hidden||v&&w[a].__filterGen!=t)&&m.call(this,w[a])){d=r;while(d.parentNode){e=d;do{e=e.nextSibling}while(e&&(e.hidden||v&&e.__filterGen!=t));if(e){c=true;b=s.indexOf(e);break}else{d=d.parentNode}}if(!c){b=s.getCount()}s.removeAt(f,b-f);break}}return false};this.callParent(arguments);if(this.isTreeFiltered()){if(s.needsLocalFilter()){w=Ext.Array.filter(w,s.filterVisible)}if(!w.length){var q=s.indexOf(r)+1;var x=s.indexOfNextVisibleNode(r);s.removeAt(q,x-q)}}u.contains=m},handleNodeExpand:function(k,r,i){var n=this;var m=[];var q=n.isTreeFiltered();var l=n.currentFilterGeneration;for(var p=0;p<r.length;p++){var o=r[p];if(!(q&&o.__filterGen!=l||o.hidden)){m[m.length]=o}}return this.callParent([k,m,i])},onNodeInsert:function(r,F,y){var v=this,x,q,u,E,t,A,D=F.raw||F.data,z=v.removedNodes,s,B,C,w=this.isTreeFiltered();if(v.filterFn){B=v.filterFn(F);F.set("visible",B);if(B){r.set("visible",v.filterFn(r))}}if(!this.reApplyFilterOnDataChange&&w){F.addedWhileFiltered=true}v.registerNode(F,true);v.beginUpdate();if(v.isVisible(F)||(w&&F.addedWhileFiltered)){if(y===0||!F.previousSibling){x=r}else{for(q=F.previousSibling;q&&!q.addedWhileFiltered&&!q.get("visible");q=q.previousSibling){}if(!q){x=r}else{while(q.isExpanded()&&q.lastChild){q=q.lastChild}for(;q&&!q.addedWhileFiltered&&!q.get("visible");q=q.previousSibling){}x=q}}v.insert(v.indexOf(x)+1,F);if(!F.isLeaf()&&F.isExpanded()){if(F.isLoaded()){v.onNodeExpand(F,F.childNodes)}else{if(!v.fillCount){F.set("expanded",false);F.expand()}}}}Ext.Array.remove(z,F);v.needsSync=v.needsSync||F.phantom||F.dirty;if(!F.isLeaf()&&!F.isLoaded()&&!v.lazyFill){u=v.getProxy().getReader();E=F.getProxy();t=E?E.getReader():null;A=t&&t.initialConfig.rootProperty?t:u;s=A.getRoot(D);if(s){C=F.childType;v.fillNode(F,A.extractData(s,C?{model:C}:undefined))}}v.endUpdate()},isFiltered:function(){return this.callParent(arguments)||this.isTreeFiltered()},afterEdit:function(f,d){var e=this;if(Ext.getVersion().isGreaterThan("6.0.2")){if(e.needsLocalFilter()){e.doFilter(f)}e.superclass.superclass.afterEdit.apply(e,[f,d])}else{return e.callParent([f,d])}}}}});Ext.define("Sch.data.ResourceTreeStore",{extend:Ext.data.TreeStore,mixins:[Sch.data.mixin.UniversalModelGetter,Sch.data.mixin.CacheHintHelper,Sch.data.mixin.ResourceStore,Sch.data.mixin.FilterableTreeStore,Robo.data.Store],alias:"store.resourcetreestore",model:"Sch.model.Resource",storeId:"resources",constructor:function(){this.callParent(arguments);this.initTreeFiltering();if(this.getModel()!==Sch.model.Resource&&!(this.getModel().prototype instanceof Sch.model.Resource)){throw"The model for the ResourceTreeStore must subclass Sch.model.Resource"}},setRootNode:function(){this.isSettingRoot=true;var b=this.callParent(arguments);this.isSettingRoot=false;return b}});Ext.define("Sch.model.TimeAxisTick",{extend:Sch.model.Range,startDateField:"start",endDateField:"end"});Ext.define("Sch.data.TimeAxis",{extend:Ext.data.JsonStore,model:"Sch.model.TimeAxisTick",continuous:true,originalContinuous:null,autoAdjust:true,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,weekStartDay:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,isConfigured:false,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,presetName:null,mode:"plain",startTime:0,endTime:24,constructor:function(e){var f=this;e=e||{};if(f.setModel){f.setModel(f.model)}f.setMode(e.mode||f.mode);f.originalContinuous=f.continuous;f.callParent(arguments);f.on(Ext.versions.touch?"refresh":"datachanged",function(){f.fireEvent("reconfigure",f,false)});f.on("endreconfigure",function(b,a){b.fireEvent("reconfigure",b,a)});if(e.viewPreset){var d=Sch.preset.Manager.getPreset(e.viewPreset);d&&f.consumeViewPreset(d)}if(e.start||f.start){f.reconfigure(e)}},reconfigure:function(s,v){this.isConfigured=true;Ext.apply(this,s);var l=this.getAdjustedDates(s.start,s.end,true);var m=this.getAdjustedDates(s.start,s.end);var u=m.start;var r=m.end;if(this.fireEvent("beforereconfigure",this,u,r)!==false){this.fireEvent("beginreconfigure",this);var o=this.unit;var n=this.increment||1;var p=this.generateTicks(u,r,o,n);this.removeAll(true);this.suspendEvents();this.add(p);if(this.getCount()===0){Ext.Error.raise("Invalid time axis configuration or filter, please check your input data.")}this.resumeEvents();var t=Sch.util.Date;var q=p.length;if(this.isContinuous()){this.adjustedStart=l.start;this.adjustedEnd=this.getNext(q>1?p[q-1].start:l.start,o,n)}else{this.adjustedStart=this.getStart();this.adjustedEnd=this.getEnd()}do{this.visibleTickStart=(this.getStart()-this.adjustedStart)/(t.getUnitDurationInMs(o)*n);if(this.visibleTickStart>=1){this.adjustedStart=t.getNext(this.adjustedStart,o,n)}}while(this.visibleTickStart>=1);do{this.visibleTickEnd=q-(this.adjustedEnd-this.getEnd())/(t.getUnitDurationInMs(o)*n);if(q-this.visibleTickEnd>=1){this.adjustedEnd=t.getNext(this.adjustedEnd,o,-1)}}while(q-this.visibleTickEnd>=1);this.fireEvent("endreconfigure",this,v)}},setMode:function(b){this.mode=b;if(b==="calendar"){this.generateTicksValidatorFn=function(a){if(this.startTime>0||this.endTime<24){return(a.getHours()>=this.startTime&&a.getHours()<this.endTime)}else{return true}}}else{this.generateTicksValidatorFn=function(){return true}}},setTimeSpan:function(f,e){var d=this.getAdjustedDates(f,e);f=d.start;e=d.end;if(this.getStart()-f!==0||this.getEnd()-e!==0){this.reconfigure({start:f,end:e})}},filterBy:function(c,d){this.continuous=false;d=d||this;this.clearFilter(true);this.suspendEvents(true);this.filter([{filterFn:function(a,b){return c.call(d,a.data,b)}}]);if(this.getCount()===0){this.clearFilter();this.resumeEvents();Ext.Error.raise("Invalid time axis filter - no ticks passed through the filter. Please check your filter method.")}this.resumeEvents()},isContinuous:function(){return this.continuous&&!this.isFiltered()},clearFilter:function(){this.continuous=this.originalContinuous;this.callParent(arguments)},generateTicks:function(t,q,n,l){var m=[],o,s=Sch.util.Date,p=0;n=n||this.unit;l=l||this.increment;var k=this.getAdjustedDates(t,q);t=k.start;q=k.end;while(t<q){o=this.getNext(t,n,l);if(!this.autoAdjust&&o>q){o=q}if(n===s.HOUR&&l>1&&m.length>0&&p===0){var r=m[m.length-1];p=((r.start.getHours()+l)%24)-r.end.getHours();if(p!==0){o=s.add(o,s.HOUR,p)}}this.generateTicksValidatorFn(t)&&m.push({start:t,end:o});t=o}return m},getVisibleTickTimeSpan:function(){return this.isContinuous()?this.visibleTickEnd-this.visibleTickStart:this.getCount()},getAdjustedDates:function(q,n,o){var p=Sch.util.Date;q=q||this.getStart();n=n||p.add(q,this.mainUnit,this.defaultSpan);if(this.mode==="calendar"){if(this.shiftUnit===p.MONTH){var l=p.add(q,p.WEEK,1);var m=p.add(n,p.WEEK,-1);if(!n){n=this.getNext(q,this.shiftUnit,1);n=this.ceilDate(n,false,this.shiftUnit);n=this.ceilDate(n,false,this.mainUnit)}if(l.getMonth()!==q.getMonth()&&m.getMonth()!==n.getMonth()){return{start:q,end:n}}}var j,r,k;j=this.floorDate(q,false,this.shiftUnit,1);j=this.floorDate(j,false,this.mainUnit,1);if(this.autoAdjust){k=this.getNext(q,this.shiftUnit,1);r=this.ceilDate(k,false,this.shiftUnit);r=this.ceilDate(r,false,this.mainUnit)}else{r=this.ceilDate(n,false,this.shiftUnit);r=this.ceilDate(r,false,this.mainUnit)}return{start:j,end:r}}else{return this.autoAdjust||o?{start:this.floorDate(q,false,this.autoAdjust?this.mainUnit:this.unit,1),end:this.ceilDate(n,false,this.autoAdjust?this.mainUnit:this.unit,1)}:{start:q,end:n}}},getTickFromDate:function(q){var l=this.data.items;var m=l.length-1;if(q.valueOf()<l[0].data.start.valueOf()||q.valueOf()>l[m].data.end.valueOf()){return -1}var o,n,s;if(this.isContinuous()){if(q-l[0].data.start===0){return this.visibleTickStart}if(q-l[m].data.end===0){return this.visibleTickEnd}var i=this.adjustedStart;var t=this.adjustedEnd;var r=Math.floor(l.length*(q-i)/(t-i));if(r>m){r=m}n=r===0?i:l[r].data.start;s=r==m?t:l[r].data.end;o=r+(q-n)/(s-n);if(o<this.visibleTickStart||o>this.visibleTickEnd){return -1}return o}else{for(var p=0;p<=m;p++){s=l[p].data.end;if(q<=s){n=l[p].data.start;o=p+(q>n?(q-n)/(s-n):0);return o}}}return -1},getDateFromTick:function(n,j){if(n===this.visibleTickEnd){return this.getEnd()}var q=Math.floor(n),l=n-q,k=this.getAt(q);if(!k){return null}var m=k.data;var r=q===0?this.adjustedStart:m.start;var o=(q==this.getCount()-1)&&this.isContinuous()?this.adjustedEnd:m.end;var p=Sch.util.Date.add(r,Sch.util.Date.MILLI,l*(o-r));if(j){p=this[j+"Date"](p)}return p},getTicks:function(){var b=[];this.each(function(a){b.push(a.data)});return b},getStart:function(){var b=this.first();if(b){return new Date(b.data.start)}return null},getEnd:function(){var b=this.last();if(b){return new Date(b.data.end)}return null},floorDate:function(t,r,q,x){r=r!==false;var v=Ext.Date.clone(t),u=r?this.getStart():null,m=x||this.resolutionIncrement,n;if(q){n=q}else{n=r?this.resolutionUnit:this.mainUnit}var w=Sch.util.Date;var s=function(b,a){return Math.floor(b/a)*a};switch(n){case w.MILLI:if(r){v=w.add(u,w.MILLI,s(w.getDurationInMilliseconds(u,v),m))}break;case w.SECOND:if(r){v=w.add(u,w.MILLI,s(w.getDurationInSeconds(u,v),m)*1000)}else{v.setMilliseconds(0);v.setSeconds(s(v.getSeconds(),m))}break;case w.MINUTE:if(r){v=w.add(u,w.SECOND,s(w.getDurationInMinutes(u,v),m)*60)}else{v.setMinutes(s(v.getMinutes(),m));v.setSeconds(0);v.setMilliseconds(0)}break;case w.HOUR:if(r){v=w.add(u,w.MINUTE,s(w.getDurationInHours(this.getStart(),v),m)*60)}else{v.setMinutes(0);v.setSeconds(0);v.setMilliseconds(0);v.setHours(s(v.getHours(),m))}break;case w.DAY:if(r){v=w.add(u,w.DAY,s(w.getDurationInDays(u,v),m))}else{Sch.util.Date.clearTime(v);v.setDate(s(v.getDate()-1,m)+1)}break;case w.WEEK:var o=v.getDay()||7;var p=this.weekStartDay||7;Sch.util.Date.clearTime(v);v=w.add(v,w.DAY,o>=p?p-o:-(7-p+o));if(v.getDay()!==p&&v.getHours()===23){v=w.add(v,w.HOUR,1)}break;case w.MONTH:if(r){v=w.add(u,w.MONTH,s(w.getDurationInMonths(u,v),m))}else{Sch.util.Date.clearTime(v);v.setDate(1);v.setMonth(s(v.getMonth(),m))}break;case w.QUARTER:Sch.util.Date.clearTime(v);v.setDate(1);v=w.add(v,w.MONTH,-(v.getMonth()%3));break;case w.YEAR:if(r){v=w.add(u,w.YEAR,s(w.getDurationInYears(u,v),m))}else{v=new Date(s(t.getFullYear()-1,m)+1,0,1)}break}return v},roundDate:function(w,M){var C=Ext.Date.clone(w),v=this.resolutionIncrement;M=M||this.getStart();switch(this.resolutionUnit){case Sch.util.Date.MILLI:var J=Sch.util.Date.getDurationInMilliseconds(M,C),K=Math.round(J/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.MILLI,K);break;case Sch.util.Date.SECOND:var F=Sch.util.Date.getDurationInSeconds(M,C),x=Math.round(F/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.MILLI,x*1000);break;case Sch.util.Date.MINUTE:var A=Sch.util.Date.getDurationInMinutes(M,C),N=Math.round(A/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.SECOND,N*60);break;case Sch.util.Date.HOUR:var B=Sch.util.Date.getDurationInHours(M,C),E=Math.round(B/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.MINUTE,E*60);break;case Sch.util.Date.DAY:var L=Sch.util.Date.getDurationInDays(M,C),I=Math.round(L/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.DAY,I);break;case Sch.util.Date.WEEK:Sch.util.Date.clearTime(C);var z=C.getDay()-this.weekStartDay,u;if(z<0){z=7+z}if(Math.round(z/7)===1){u=7-z}else{u=-z}C=Sch.util.Date.add(C,Sch.util.Date.DAY,u);break;case Sch.util.Date.MONTH:var y=Sch.util.Date.getDurationInMonths(M,C)+(C.getDate()/Ext.Date.getDaysInMonth(C)),G=Math.round(y/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.MONTH,G);break;case Sch.util.Date.QUARTER:Sch.util.Date.clearTime(C);C.setDate(1);C=Sch.util.Date.add(C,Sch.util.Date.MONTH,3-(C.getMonth()%3));break;case Sch.util.Date.YEAR:var D=Sch.util.Date.getDurationInYears(M,C),H=Math.round(D/v)*v;C=Sch.util.Date.add(M,Sch.util.Date.YEAR,H);break}return C},ceilDate:function(n,h,k){var l=Ext.Date.clone(n);h=h!==false;var i=h?this.resolutionIncrement:1,j=false,m;if(k){m=k}else{m=h?this.resolutionUnit:this.mainUnit}switch(m){case Sch.util.Date.HOUR:if(l.getMinutes()>0||l.getSeconds()>0||l.getMilliseconds()>0){j=true}break;case Sch.util.Date.DAY:if(l.getHours()>0||l.getMinutes()>0||l.getSeconds()>0||l.getMilliseconds()>0){j=true}break;case Sch.util.Date.WEEK:Sch.util.Date.clearTime(l);if(l.getDay()!==this.weekStartDay||n.getTime()-l.getTime()>0){j=true}break;case Sch.util.Date.MONTH:Sch.util.Date.clearTime(l);if(l.getDate()!==1||n.getTime()-l.getTime()>0){j=true}break;case Sch.util.Date.QUARTER:Sch.util.Date.clearTime(l);if(l.getMonth()%3!==0||l.getDate()!==1||n.getTime()-l.getTime()>0){j=true}break;case Sch.util.Date.YEAR:Sch.util.Date.clearTime(l);if(l.getMonth()!==0||l.getDate()!==1||n.getTime()-l.getTime()>0){j=true}break;default:break}if(j){return this.getNext(l,m,i)}else{return l}},getNext:function(d,f,e){return Sch.util.Date.getNext(d,f,e,this.weekStartDay)},getResolution:function(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}},setResolution:function(c,d){this.resolutionUnit=c;this.resolutionIncrement=d||1},shift:function(d,c){this.setTimeSpan(Sch.util.Date.add(this.getStart(),c,d),Sch.util.Date.add(this.getEnd(),c,d))},shiftNext:function(d){d=d||this.getShiftIncrement();var c=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),c,d),Sch.util.Date.add(this.getEnd(),c,d))},shiftPrevious:function(d){d=-(d||this.getShiftIncrement());var c=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),c,d),Sch.util.Date.add(this.getEnd(),c,d))},getShiftUnit:function(){return this.shiftUnit||this.mainUnit},getShiftIncrement:function(){return this.shiftIncrement||1},getUnit:function(){return this.unit},getIncrement:function(){return this.increment},getRowTicks:function(){if(this.mode!=="plain"){var f=this.getStart();var e=Sch.util.Date.add(f,this.headerConfig.middle.splitUnit,1);var d=this.findBy(function(a){return a.getStartDate().getTime()>=e.getTime()});if(d===-1){return this.getRange()}return this.getRange(0,d-1)}},dateInAxis:function(b){return Sch.util.Date.betweenLesser(b,this.getStart(),this.getEnd())},timeSpanInAxis:function(c,d){if(this.isContinuous()){return Sch.util.Date.intersectSpans(c,d,this.getStart(),this.getEnd())}else{return(c<this.getStart()&&d>this.getEnd())||this.getTickFromDate(c)!==this.getTickFromDate(d)}},isRangeInAxis:function(d){var f=d.getStartDate(),e=d.getEndDate();if(!f||!e){return false}return this.timeSpanInAxis(f,e)},forEachAuxInterval:function(k,i,j,m){m=m||this;var p=this.getEnd(),l=this.getStart(),n=0,o;if(l>p){throw"Invalid time axis configuration"}while(l<p){o=Sch.util.Date.min(this.getNext(l,k,i||1),p);j.call(m,l,o,n);l=o;n++}},consumeViewPreset:function(b){Ext.apply(this,{unit:b.getBottomHeader().unit,increment:b.getBottomHeader().increment||1,resolutionUnit:b.timeResolution.unit,resolutionIncrement:b.timeResolution.increment,mainUnit:b.getMainHeader().unit,shiftUnit:b.shiftUnit,shiftIncrement:b.shiftIncrement||1,defaultSpan:b.defaultSpan||1,presetName:b.name,headerConfig:b.headerConfig})}});Ext.define("Robo.Manager",{extend:Ext.util.Observable,stores:null,storesById:null,treeStoreListeners:null,flatStoreListeners:null,stub:function(){},undoQueue:null,redoQueue:null,ignoredFieldNames:{expanded:1},state:"created",transactionBoundary:"timeout",transactionMaxDuration:100,clearQueuesOnLoad:false,transactionTimeout:null,currentTransaction:null,constructor:function(d){var f=this;d=d||{};Ext.apply(f,d);f.treeStoreListeners={nodeappend:f.onTreeStoreAppend,nodeinsert:f.onTreeStoreInsert,noderemove:f.onTreeStoreRemove,update:f.onTreeStoreUpdate,scope:f};f.flatStoreListeners={add:f.onFlatStoreAdd,remove:f.onFlatStoreRemove,update:f.onFlatStoreUpdate,scope:f};if(f.clearQueuesOnLoad){Ext.apply(f.treeStoreListeners,{load:f.clearQueues,clear:f.clearQueues});Ext.apply(f.flatStoreListeners,{load:f.clearQueues,clear:f.clearQueues})}f.callParent([d]);var e=f.stores||[];f.stores=[];f.storesById={};f.undoQueue=[];f.redoQueue=[];Ext.Array.forEach(e,function(a){f.addStore(a)})},addStore:function(p,k){p=Ext.data.StoreManager.lookup(p);this.stores.push(p);if(k){p.setStoreId(k)}var o=p.getModel();var n=o.prototype.associations||{};for(var j in n){var l=n[j];var i=l.getAssociatedStore;if(i&&!i.ROBO_MANAGED){var m=this;l.getAssociatedStore=function(){var a=i.apply(this,arguments);if(!m.hasStore(a)){m.addStore(a);if(m.state!=="disabled"&&m.state!=="created"){m.bindStore(a)}}return a};l.getAssociatedStore.ROBO_MANAGED=true}}if(p.storeId){this.storesById[p.storeId]=p}},getStoreById:function(b){return this.storesById[b]},hasStore:function(b){return Ext.Array.indexOf(this.stores,b)!=-1},bindStore:function(b){(b.undoRedoEventBus||b).on(this.getStoreTypeListeners(b));if(b.undoRedoEventBus){b.on(this.getStoreTypeListenerStubs(b))}},unbindStore:function(b){(b.undoRedoEventBus||b).un(this.getStoreTypeListeners(b));if(b.undoRedoEventBus){b.un(this.getStoreTypeListenerStubs(b))}},getStoreTypeListenerStubs:function(e){var f=this;var d=this.getStoreTypeListeners(e);d=Ext.apply({},d);Ext.Object.each(d,function(b,a){d[b]=f.stub});return d},getStoreTypeListeners:function(d){var c;if(Ext.data.TreeStore&&d instanceof Ext.data.TreeStore){c=this.treeStoreListeners}else{c=this.flatStoreListeners}return c},removeStore:function(b){Ext.Array.remove(this.stores,b);this.storesById[b.storeId]=null;this.unbindStore(b)},forEachStore:function(b){Ext.Array.forEach(this.stores,b,this)},onAnyChangeInAnyStore:function(b){if(this.state==="paused"||(b.isRootSettingOrLoading&&b.isRootSettingOrLoading())){return false}if(!this.currentTransaction){this.startTransaction()}return true},hasPersistableChanges:function(e,f){var d=this.ignoredFieldNames;return Robo.util.Array.reduce(f,function(c,a){var b=e.getField(a);return c||!b||(b.persist&&(!e.isNode||!d.hasOwnProperty(a)))},false)},onFlatStoreUpdate:function(h,f,e,g){if(!this.onAnyChangeInAnyStore(h)||e!="edit"||!g||!g.length||!this.hasPersistableChanges(f,g)){return}this.currentTransaction.addAction(new Robo.action.flat.Update({record:f,fieldNames:g}))},onFlatStoreAdd:function(d,e,f){if(!this.onAnyChangeInAnyStore(d)){return}this.currentTransaction.addAction(new Robo.action.flat.Add({store:d,records:e,index:f}))},onFlatStoreRemove:function(h,e,g,f){if(!this.onAnyChangeInAnyStore(h)){return}this.currentTransaction.addAction(new Robo.action.flat.Remove({store:h,records:e,index:g,isMove:f}))},onTreeStoreUpdate:function(h,f,e,g){if(!this.onAnyChangeInAnyStore(h)||e!="edit"||!g||!g.length||!this.hasPersistableChanges(f,g)){return}this.currentTransaction.addAction(new Robo.action.tree.Update({record:f,fieldNames:g}))},onTreeStoreAppend:function(f,e,d){if(!f||!this.onAnyChangeInAnyStore(f.getTreeStore())){return}if(e.$undoRedoMoving){delete e.$undoRedoMoving}else{this.currentTransaction.addAction(new Robo.action.tree.Append({parent:f,newChild:e}))}},onTreeStoreInsert:function(f,e,d){if(!f||!this.onAnyChangeInAnyStore(f.getTreeStore())){return}if(e.$undoRedoMoving){delete e.$undoRedoMoving}else{this.currentTransaction.addAction(new Robo.action.tree.Insert({parent:f,newChild:e,insertedBefore:d}))}},onTreeStoreRemove:function(h,g,f,e){if(!this.onAnyChangeInAnyStore(h.getTreeStore())){return}if(f){g.$undoRedoMoving=true}this.currentTransaction.addAction(new Robo.action.tree.Remove({parent:h,removedChild:g,nextSibling:e.nextSibling,isMove:f}))},start:function(){if(this.state=="created"||this.state=="disabled"){this.fireEvent("start",this);this.fireEvent("undoqueuechange",this,this.undoQueue);this.fireEvent("redoqueuechange",this,this.redoQueue)}if(this.state!=="hold"){this.forEachStore(this.bindStore);this.state="enabled"}},stop:function(){this.endTransaction();this.forEachStore(this.unbindStore);this.state="disabled";this.clearQueues();this.fireEvent("stop",this)},clearQueues:function(){this.clearUndoQueue();this.clearRedoQueue()},pause:function(){this.state="paused"},resume:function(){this.state="enabled"},hold:function(){this.state="hold"},release:function(){this.state="enabled"},getUndoQueue:function(){return this.undoQueue.slice()},getRedoQueue:function(){return this.redoQueue.slice()},clearUndoQueue:function(){if(this.undoQueue.length){this.undoQueue=[];this.fireEvent("undoqueuechange",this,this.undoQueue.slice())}},clearRedoQueue:function(){if(this.redoQueue.length){this.redoQueue=[];this.fireEvent("redoqueuechange",this,this.redoQueue.slice())}},startTransaction:function(f){var e=this,d;if(e.state=="disabled"){return}if(e.currentTransaction){e.endTransaction()}d=new Robo.Transaction({title:f});e.currentTransaction=d;e.notifyStoresAboutTransactionStart(d);if(e.transactionBoundary=="timeout"){e.scheduleEndTransaction()}},scheduleEndTransaction:function(){var b=this;if(b.transactionTimeout){clearTimeout(b.transactionTimeout)}b.transactionTimeout=setTimeout(function(){if(b.state!=="hold"){b.endTransaction();b.transactionTimeout=null}else{b.scheduleEndTransaction()}},b.transactionMaxDuration)},endTransaction:function(){var c=this,d=c.currentTransaction;if(!d){return false}c.currentTransaction=null;if(c.transactionBoundary=="timeout"){clearTimeout(c.transactionTimeout);c.transactionTimeout=null}if(d.hasActions()){c.addTransaction(d)}c.notifyStoresAboutTransactionEnd(d);return d.hasActions()},addTransaction:function(b){this.undoQueue.push(b);this.fireEvent("undoqueuechange",this,this.undoQueue.slice());if(this.redoQueue.length){this.redoQueue.length=0;this.fireEvent("redoqueuechange",this,this.redoQueue.slice())}this.fireEvent("transactionadd",this,b)},undo:function(j){var l=this.undoQueue,g,i,k,h=l.length;if(this.state=="disabled"||j===0||!l.length){return}if(j instanceof Robo.Transaction){g=Ext.Array.indexOf(l,j);if(g==-1){return}j=l.length-g}j=j||1;this.fireEvent("beforeundo",this);this.pause();this.notifyStoresAboutUndoRedoStart();for(k=0;k<Math.min(j,h);k++){i=l.pop();i.undo();this.redoQueue.unshift(i)}this.notifyStoresAboutUndoRedoComplete();this.fireEvent("undoqueuechange",this,l.slice());this.fireEvent("redoqueuechange",this,this.redoQueue.slice());this.resume();this.fireEvent("afterundo",this)},redo:function(k){var j=this.redoQueue,i,g,l,h=j.length;if(this.state=="disabled"||k===0||!j.length){return}if(k instanceof Robo.Transaction){g=Ext.Array.indexOf(j,k);if(g==-1){return}k=g+1}k=k||1;this.fireEvent("beforeredo",this);this.pause();this.notifyStoresAboutUndoRedoStart();for(l=0;l<Math.min(k,h);l++){i=this.redoQueue.shift();i.redo();this.undoQueue.push(i)}this.notifyStoresAboutUndoRedoComplete();this.fireEvent("redoqueuechange",this,this.redoQueue.slice());this.fireEvent("undoqueuechange",this,this.undoQueue.slice());this.resume();this.fireEvent("afterredo",this)},undoAll:function(){this.undo(this.undoQueue.length)},notifyStoresAboutTransactionStart:function(b){this.forEachStore(function(a){a.onUndoRedoTransactionStart&&a.onUndoRedoTransactionStart(this,b)})},notifyStoresAboutTransactionEnd:function(b){this.forEachStore(function(a){a.onUndoRedoTransactionEnd&&a.onUndoRedoTransactionEnd(this,b)})},notifyStoresAboutUndoRedoStart:function(){this.forEachStore(function(b){b.beforeUndoRedo&&b.beforeUndoRedo(this)})},notifyStoresAboutUndoRedoComplete:function(){this.forEachStore(function(b){b.afterUndoRedo&&b.afterUndoRedo(this)})}},function(){Ext.apply(Robo,{VERSION:"4.2.3"})});Ext.define("Sch.data.util.AssignmentStoreEventResourcesCache",{extend:Sch.util.Cache,assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(y){var x=this,C=y.getEventStore(),t=C&&C.getResourceStore();x.callParent();function v(c,d){var b=x.assignmentStore.getEventStore(),a=b&&b.getResourceStore();Ext.Array.each(d,function(e){var f=a&&a.getModelById(e.getResourceId());if(f){x.add(e.getEventId(),f)}else{x.clear(e.getEventId())}})}function G(c,d){var b=x.assignmentStore.getEventStore(),a=b&&b.getResourceStore();Ext.Array.each(d,function(e){var f=a.getModelById(e.getResourceId());if(f){x.remove(e.getEventId(),f)}else{x.clear(e.getEventId())}})}function r(c,l,g){var f=l.resourceIdField,b=l.previous&&f in l.previous,j=b&&l.previous[f],e=l.eventIdField,a=l.previous&&e in l.previous,k=a&&l.previous[e],h=x.assignmentStore.getEventStore(),d=h&&h.getResourceStore(),i;if(b||a){j=b?j:l.getResourceId();k=a?k:l.getEventId();i=d.getModelById(j);if(i){x.remove(k,i)}else{x.clear(k)}i=d.getModelById(l.getResourceId());if(i){x.add(l.getEventId(),i)}else{x.clear(l.getEventId())}}}function u(a){x.clear()}function F(b,a){x.clear();H(a);E(a&&a.getResourceStore())}function w(c,b,a,d){x.move(a,d)}function B(a,b){Ext.Array.each(b,function(c){x.clear(c)})}function z(){x.clear()}function s(b,a){x.clear();E(a)}function A(b,a){Ext.Array.each(a,function(c){x.uncache(c)})}function D(){x.clear()}function H(a){Ext.destroy(x.eventStoreDetacher);x.eventStoreDetacher=a&&a.on({idchanged:w,remove:B,clear:z,cacheresethint:z,rootchange:z,resourcestorechange:s,priority:100,destroyable:true})}function E(a){Ext.destory(x.resourceStoreDetacher);x.resourceStoreDetacher=a&&a.on({remove:A,clear:D,cacheresethint:D,rootchange:D,priority:100,destroyable:true})}x.assignmentStoreDetacher=y.on({add:v,remove:G,update:r,clear:u,cacheresethint:u,priority:100,destroyable:true});x.assignmentStore=y},destroy:function(){var b=this;Ext.destroyMembers(b,"assignmentStoreDetacher","eventStoreDetacher","resourceStoreDetacher");b.assignmentStore=null},get:function(e,d){var f=this;d=d||function(){return f.assignmentStore.mapAssignmentsForEvent(e,function a(c){return c.getResource()},function b(c){return !!c})};return f.callParent([e,d])}});Ext.define("Sch.data.util.AssignmentStoreResourceEventsCache",{extend:Sch.util.Cache,assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(y){var w=this,C=y.getEventStore(),t=C&&C.getResourceStore();w.callParent();function v(b,c){var a=w.assignmentStore.getEventStore();Ext.Array.each(c,function(d){var e=a&&a.getModelById(d.getEventId());if(e){w.add(d.getResourceId(),e)}else{w.clear(d.getResourceId())}})}function G(b,c){var a=w.assignmentStore.getEventStore();Ext.Array.each(c,function(d){var e=a&&a.getModelById(d.getEventId());if(e){w.remove(d.getResourceId(),e)}else{w.clear(d.getResourceId())}})}function r(c,j,f){var e=j.resourceIdField,b=j.previous&&e in j.previous,h=b&&j.previous[e],d=j.eventIdField,a=j.previous&&d in j.previous,i=a&&j.previous[d],g=w.assignmentStore.getEventStore(),k;if(b||a){h=b?h:j.getResourceId();i=a?i:j.getEventId();k=g&&g.getModelById(i);if(k){w.remove(h,k)}else{w.clear(h)}k=g&&g.getModelById(j.getEventId());if(k){w.add(j.getResourceId(),k)}else{w.clear(j.getResourceId())}}}function u(a){w.clear()}function F(b,a){w.clear();H(a);E(a&&a.getResourceStore())}function B(a,b){Ext.Array.each(b,function(c){w.uncache(c)})}function z(){w.clear()}function s(b,a){w.clear();E(a)}function x(c,b,a,d){w.move(a,d)}function A(b,a){Ext.Array.each(a,function(c){w.clear(c)})}function D(){w.clear()}function H(a){Ext.destroy(w.eventStoreDetacher);w.eventStoreDetacher=a&&a.on({remove:B,cacheresethint:z,clear:z,rootchange:z,resourcestorechange:s,priority:100,destroyable:true})}function E(a){Ext.destroy(w.resourceStoreDetacher);w.resourceStoreDetacher=a&&a.on({idchanged:x,remove:A,cacheresethint:D,clear:D,rootchange:D,priority:100,destroyable:true})}w.assignmentStoreDetacher=y.on({add:v,remove:G,update:r,cacheresethint:u,clear:u,eventstorechange:F,priority:100,destroyable:true});H(C);E(t);w.assignmentStore=y},destroy:function(){var b=this;Ext.destroyMembers(b,"assignmentStoreDetacher","eventStoreDetacher","resourceStoreDetacher");b.assignmentStore=null},get:function(e,d){var f=this;d=d||function(){return f.assignmentStore.mapAssignmentsForResource(e,function a(c){return c.getEvent()},function b(c){return !!c})};return f.callParent([e,d])}});Ext.define("Sch.data.util.EventAssignmentsCache",{extend:Sch.util.Cache,assignmentStore:null,assignmentStoreDetacher:null,assignmentStoreFiltersDetacher:null,eventStoreDetacher:null,constructor:function(r){var q=this,u=r.getEventStore();q.callParent();function o(b,a){Ext.Array.each(a,function(c){q.add(c.getEventId(),c)})}function w(b,a){Ext.Array.each(a,function(c){q.remove(c.getEventId(),c)})}function m(e,b,f){var d=b.eventIdField,a=b.previous&&d in b.previous,c=a&&b.previous[d];if(a){q.move(c,b.getEventId(),b)}}function n(a){q.clear()}function v(a,b){q.clear();x(b)}function p(d,c,b,a){q.move(b,a)}function t(b,a){Ext.Array.each(a,function(c){q.clear(c)})}function s(){q.clear()}function x(a){Ext.destroy(q.eventStoreDetacher);q.eventStoreDetacher=a&&a.on({idchanged:p,remove:t,cacheresethint:s,clear:s,rootchange:s,priority:100,destroyable:true})}q.assignmentStoreDetacher=r.on({add:o,remove:w,update:m,cacheresethint:n,clear:n,eventstorechange:v,priority:100,destroyable:true});q.assignmentStoreFiltersDetacher=r.getFilters().on({endupdate:n,priority:1002,destroyable:true});x(u);q.assignmentStore=r},destroy:function(){var b=this;Ext.destroyMembers(b,"assignmentStoreDetacher","assignmentStoreFiltersDetacher","eventStoreDetacher");b.assignmentStore=null},get:function(e,d){var f=this;e=f.key(e);d=d||function(){return Ext.Array.filter(f.assignmentStore.getRange(),function(a){return a.getEventId()==e})};return f.callParent([e,d])}});Ext.define("Sch.data.util.EventDependencyCache",{extend:Sch.util.Cache,dependencyStore:null,dependencyStoreDetacher:null,eventStoreDetacher:null,constructor:function(v){var n=this,r=v.getEventStore();function o(a,b){Ext.Array.each(b,function(d){var c=d.getSourceId(),e=d.getTargetId();if(c){n.add(c,d)}if(e){n.add(e,d)}if(c&&e){n.addSuccessor(c,d);n.addPredecessor(e,d)}})}function t(a,b){Ext.Array.each(b,function(d){var c=d.getSourceId(),e=d.getTargetId();if(c){n.remove(c,d);n.removeSuccessor(c,d)}if(e){n.remove(e,d);n.removePredecessor(e,d)}})}function u(a,e,c){var i=e.fromField,d=e.toField,f=e.previous&&i in e.previous,b=e.previous&&d in e.previous,g=f&&e.previous[i],h=b&&e.previous[d];if(f){n.move(g,e.getSourceId(),e);n.moveSuccessors(g,e.getSourceId(),e)}if(b){n.move(h,e.getTargetId(),e);n.movePredecessors(h,e.getTargetId(),e)}}function w(a){n.clear()}function s(a,b){n.clear();x(b)}function m(d,c,b,a){n.move(b,a);n.moveSuccessors(b,a);n.movePredecessors(b,a)}function q(b,a){Ext.Array.each(a,function(c){n.clear(c);n.clearSuccessors(c);n.clearPredecessors(c)})}function p(){n.clear()}function x(a){Ext.destroy(n.eventStoreDetacher);n.eventStoreDetacher=a&&a.on({idchanged:m,remove:q,cacheresethint:p,clear:p,rootchange:p,priority:100,destroyable:true})}n.dependencyStoreDetacher=v.on({add:o,remove:t,update:u,cacheresethint:w,clear:w,eventstorechange:s,priority:100,destroyable:true});n.dependencyStoreFiltersDetacher=v.getFilters().on({endupdate:w,priority:1002,destroyable:true});x(r);n.dependencyStore=v},destroy:function(){var b=this;Ext.destroyMembers(b,"dependencyStoreDetacher","eventStoreDetacher");b.dependencyStore=null},get:function(h,l){var k=this,j,i,g;if(!l){h=k.key(h);j=k.self.splitKey(h);i=j.id;g=j.type;switch(g){case"pred":l=function(){return Ext.Array.filter(k.get(i),function(a){return a.getTargetId()==i})};break;case"succ":l=function(){return Ext.Array.filter(k.get(i),function(a){return a.getSourceId()==i})};break;default:l=function(){return Ext.Array.filter(k.dependencyStore.getRange(),function(a){return a.getTargetId()==i||a.getSourceId()==i})}}}return k.callParent([h,l])},getSuccessors:function(d){var c=this;return c.get(c.self.makeSuccessorsKey(c.key(d)))},getPredecessors:function(d){var c=this;return c.get(c.self.makePredecessorsKey(c.key(d)))},addSuccessor:function(d,e){var f=this;return f.add(f.self.makeSuccessorsKey(f.key(d)),e)},addPredecessor:function(d,e){var f=this;return f.add(f.self.makePredecessorsKey(f.key(d)),e)},removeSuccessor:function(d,e){var f=this;return f.remove(f.self.makeSuccessorsKey(f.key(d)),e)},removePredecessor:function(d,e){var f=this;return f.remove(f.self.makePredecessorsKey(f.key(d)),e)},moveSuccessors:function(h,g,f){var e=this;return arguments.length>=3?e.move(e.self.makeSuccessorsKey(e.key(h)),e.self.makeSuccessorsKey(e.key(g)),f):e.move(e.self.makeSuccessorsKey(e.key(h)),e.self.makeSuccessorsKey(e.key(g)))},movePredecessors:function(h,g,f){var e=this;return arguments.length>=3?e.move(e.self.makePredecessorsKey(e.key(h)),e.self.makePredecessorsKey(e.key(g)),f):e.move(e.self.makePredecessorsKey(e.key(h)),e.self.makePredecessorsKey(e.key(g)))},clearSuccessors:function(d){var c=this;return c.clear(c.self.makeSuccessorsKey(c.key(d)))},clearPredecessors:function(d){var c=this;return c.clear(c.self.makePredecessorsKey(c.key(d)))},inheritableStatics:{splitKey:function(b){b=b.split("@#!#@");return{id:b[0],type:b.length&&b[1]||false}},makeSuccessorsKey:function(b){return b+"@#!#@succ"},makePredecessorsKey:function(b){return b+"@#!#@pred"}}});Ext.define("Sch.data.util.ResourceAssignmentsCache",{extend:Sch.util.Cache,assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(w){var u=this,y=w.getEventStore(),r=y&&y.getResourceStore();u.callParent();function t(a,b){Ext.Array.each(b,function(c){u.add(c.getResourceId(),c)})}function C(a,b){Ext.Array.each(b,function(c){u.remove(c.getResourceId(),c)})}function p(d,a,e){var b=a.resourceIdField,c=a.previous&&b in a.previous,f=c&&a.previous[b];if(c){u.move(f,a.getResourceId(),a)}}function s(a){u.clear()}function B(b,a){D(a);A(a&&a.getResourceStore())}function q(b,a){u.clear();A(a)}function v(c,b,a,d){u.move(a,d)}function x(b,a){Ext.Array.each(a,function(c){u.clear(c)})}function z(){u.clear()}function D(a){Ext.destroy(u.eventStoreDetacher);u.eventStoreDetacher=a&&a.on({resourcestorechange:q,priority:100,destroyable:true})}function A(a){Ext.destroy(u.resourceStoreDetacher);u.resourceStoreDetacher=a&&a.on({idchanged:v,remove:x,clear:z,cacheresethint:z,rootchange:z,priority:100,destroyable:true})}u.assignmentStoreDetacher=w.on({add:t,remove:C,update:p,clear:s,cacheresethint:s,eventstorechange:B,priority:100,destroyable:true});u.assignmentStoreFiltersDetacher=w.getFilters().on("endupdate",s,u,{priority:1002,destroyable:true});D(y);A(r);u.assignmentStore=w},destroy:function(){var b=this;Ext.destroyMembers(b,"assignmentStoreDetacher","assignmentStoreFiltersDetacher","eventStoreDetacher","resourceStoreDetacher");b.assignmentStore=null},get:function(e,d){var f=this;e=f.key(e);d=d||function(){return Ext.Array.filter(f.assignmentStore.getRange(),function(a){return a.getResourceId()==e})};return f.callParent([e,d])}});Ext.define("Sch.eventlayout.Horizontal",{nbrOfBandsByResource:null,bandIndexToPxConvertFn:null,bandIndexToPxConvertScope:null,constructor:function(b){Ext.apply(this,b);this.nbrOfBandsByResource={}},clearCache:function(b){if(b){delete this.nbrOfBandsByResource[b.internalId]}else{this.nbrOfBandsByResource={}}},getNumberOfBands:function(j,f){var g=this.nbrOfBandsByResource;if(g.hasOwnProperty(j.internalId)){return g[j.internalId]}var h=Ext.isFunction(f)?f():f;var i=Ext.Array.map(h,function(a){return{start:a.getStartDate(),end:a.getEndDate(),event:a}});return this.applyLayout(i,j)},applyLayout:function(f,h){var g=f.slice();var e=this;g.sort(function(a,b){return e.sortEvents(a.event,b.event)});return this.nbrOfBandsByResource[h.internalId]=this.layoutEventsInBands(g)},sortEvents:function(b,i){var a=b.getStartDate();var h=i.getStartDate();var j=(a-h===0);if(j){return b.getEndDate()>i.getEndDate()?-1:1}else{return(a<h)?-1:1}},layoutEventsInBands:function(d){var e=0;do{var f=d[0];while(f){f.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertScope||this,e,f.event);Ext.Array.remove(d,f);f=this.findClosestSuccessor(f,d)}e++}while(d.length>0);return e},findClosestSuccessor:function(r,i){var m=Infinity,q,l=r.end,k,p=r.end-r.start===0;for(var n=0,o=i.length;n<o;n++){k=i[n].start-l;if(k>=0&&k<m&&(k>0||i[n].end-i[n].start>0||!p)){q=i[n];m=k}}return q}});Ext.define("Sch.eventlayout.Vertical",{view:null,constructor:function(b){Ext.apply(this,b)},applyLayout:function(J,D){if(J.length===0){return}var i=this;J.sort(function(a,b){return i.sortEvents(a.event,b.event)});var G,H,C=this.view,B=Sch.util.Date,z=1,v,I,F,w;for(var l=0,x=J.length;l<x;l++){F=J[l];G=F.start;H=F.end;I=this.findStartSlot(J,F);var j=this.getCluster(J,l);if(j.length>1){F.left=I.start;F.width=I.end-I.start;w=1;while(w<(j.length-1)&&j[w+1].start-F.start===0){w++}var y=this.findStartSlot(J,j[w]);if(y&&y.start<0.8){j=j.slice(0,w)}}var E=j.length,A=(I.end-I.start)/E;for(w=0;w<E;w++){j[w].width=A;j[w].left=I.start+(w*A)}l+=E-1}for(l=0,x=J.length;l<x;l++){J[l].width=J[l].width*D;J[l].left=C.barMargin+(J[l].left*D)}},findStartSlot:function(h,g){var f=this.getPriorOverlappingEvents(h,g),e;if(f.length===0){return{start:0,end:1}}for(e=0;e<f.length;e++){if(e===0&&f[0].left>0){return{start:0,end:f[0].left}}else{if(f[e].left+f[e].width<(e<f.length-1?f[e+1].left:1)){return{start:f[e].left+f[e].width,end:e<f.length-1?f[e+1].left:1}}}}return false},getPriorOverlappingEvents:function(n,m){var l=Sch.util.Date,k=m.start,i=m.end,p=[];for(var o=0,j=Ext.Array.indexOf(n,m);o<j;o++){if(l.intersectSpans(k,i,n[o].start,n[o].end)){p.push(n[o])}}p.sort(this.sortOverlappers);return p},sortOverlappers:function(c,d){return c.left<d.left?-1:1},getCluster:function(n,l){if(l>=n.length-1){return[n[l]]}var p=[n[l]],k=n[l].start,i=n[l].end,j=n.length,m=Sch.util.Date,o=l+1;while(o<j&&m.intersectSpans(k,i,n[o].start,n[o].end)){p.push(n[o]);k=m.max(k,n[o].start);i=m.min(n[o].end,i);o++}return p},sortEvents:function(k,m){var j=k.getStartDate(),a=k.getEndDate();var l=m.getStartDate(),b=m.getEndDate();var n=(j-l===0);if(n){return a>b?-1:1}else{return(j<l)?-1:1}}});Ext.define("Sch.feature.AbstractTimeSpan",{extend:Ext.AbstractPlugin,mixins:{observable:Ext.util.Observable},lockableScope:"top",schedulerView:null,timeAxis:null,containerEl:null,expandToFitView:false,disabled:false,cls:null,clsField:"Cls",template:null,store:null,renderElementsBuffered:false,renderDelay:15,refreshSizeOnItemUpdate:true,_resizeTimer:null,_renderTimer:null,showHeaderElements:false,headerTemplate:null,innerHeaderTpl:null,headerContainerCls:"sch-header-secondary-canvas",headerContainerEl:null,renderingDoneEvent:null,constructor:function(b){this.uniqueCls=this.uniqueCls||("sch-timespangroup-"+Ext.id());Ext.apply(this,b);this.mixins.observable.constructor.call(this);this.callParent(arguments)},setDisabled:function(b){if(b){this.removeElements()}this.disabled=b},removeElements:function(){this.removeBodyElements();if(this.showHeaderElements){this.removeHeaderElements()}},getBodyElements:function(){if(this.containerEl){return this.containerEl.select("."+this.uniqueCls)}return null},getHeaderContainerEl:function(){var f=this.headerContainerEl,d=Ext.baseCSSPrefix,e;if(!f||!f.dom){if(this.schedulerView.isHorizontal()){e=this.panel.getHorizontalTimeAxisColumn().headerView.containerEl}else{e=this.panel.el.down("."+d+"grid-inner-locked ."+d+"panel-body ."+d+"grid-view")}if(e){f=e.down("."+this.headerContainerCls);if(!f){f=e.appendChild({cls:this.headerContainerCls})}this.headerContainerEl=f}}return f},getHeaderElements:function(){var b=this.getHeaderContainerEl();if(b){return b.select("."+this.uniqueCls)}return null},removeBodyElements:function(){var b=this.getBodyElements();if(b){b.each(function(a){a.destroy()})}},removeHeaderElements:function(){var b=this.getHeaderElements();if(b){b.each(function(a){a.destroy()})}},getElementId:function(b){return this.uniqueCls+"-"+b.internalId},getHeaderElementId:function(b){return this.uniqueCls+"-header-"+b.internalId},getTemplateData:function(b){return this.prepareTemplateData?this.prepareTemplateData(b):b.data},getElementCls:function(e,f){var d=e.clsField||this.clsField;if(!f){f=this.getTemplateData(e)}return this.cls+" "+this.uniqueCls+" "+(f[d]||"")},getHeaderElementCls:function(e,f){var d=e.clsField||this.clsField;if(!f){f=this.getTemplateData(e)}return"sch-header-indicator "+this.uniqueCls+" "+(f[d]||"")},init:function(d){if(Ext.versions.touch&&!d.isReady()){d.on("viewready",function(){this.init(d)},this);return}if(typeof this.innerHeaderTpl==="string"){this.innerHeaderTpl=new Ext.XTemplate(this.innerHeaderTpl)}var c=this.innerHeaderTpl;if(!this.headerTemplate){this.headerTemplate=new Ext.XTemplate('<tpl for=".">','<div id="{id}" class="{cls}" style="{side}:{position}px;">'+(c?"{[this.renderInner(values)]}":"")+"</div>","</tpl>",{renderInner:function(a){return c.apply(a)}})}this.schedulerView=d.getSchedulingView();this.panel=d;this.timeAxis=d.getTimeAxis();this.store=Ext.StoreManager.lookup(this.store);if(!this.store){Ext.Error.raise("Error: You must define a store for this plugin")}if(!this.schedulerView.getEl()){this.schedulerView.on({afterrender:this.onAfterRender,scope:this})}else{this.onAfterRender()}},onAfterRender:function(f){var e=this.schedulerView;this.containerEl=e.getSecondaryCanvasEl();this.storeListeners={load:this.renderElements,datachanged:this.renderElements,clear:this.renderElements,add:this.renderElements,remove:this.renderElements,update:this.refreshSingle,addrecords:this.renderElements,removerecords:this.renderElements,updaterecord:this.refreshSingle,expand:this.renderElements,collapse:this.renderElements,scope:this};this.store.on(this.storeListeners);e.on({bufferedrefresh:this.renderElements,refresh:this.renderElements,itemadd:this.refreshSizeOnItemUpdate?this.refreshSizes:this.renderElements,itemremove:this.refreshSizeOnItemUpdate?this.refreshSizes:this.renderElements,itemupdate:this.refreshSizeOnItemUpdate?this.refreshSizes:this.renderElements,groupexpand:this.renderElements,groupcollapse:this.renderElements,columnwidthchange:this.renderElements,resize:this.renderElements,scope:this});if(e.headerCt){e.headerCt.on({add:this.renderElements,remove:this.renderElements,scope:this})}this.panel.on({viewchange:this.renderElements,show:this.refreshSizes,modechange:this.forceNewRenderingTimeout,scope:this});var d=e.getRowContainerEl();if(d&&d.down(".sch-timetd",true)){this.renderElements()}},forceNewRenderingTimeout:function(){this.renderElementsBuffered=false;clearTimeout(this._renderTimer);clearTimeout(this._resizeTimer);this.renderElements()},refreshSizesInternal:function(){if(!this.schedulerView.isDestroyed&&this.schedulerView.isHorizontal()){var b=this.schedulerView.getTimeSpanRegion(new Date(),null,this.expandToFitView);this.getBodyElements().setHeight(b.bottom-b.top)}},refreshSizes:function(){clearTimeout(this._resizeTimer);this._resizeTimer=Ext.Function.defer(this.refreshSizesInternal,this.renderDelay,this)},renderElements:function(){if(this.renderElementsBuffered||this.disabled){return}this.renderElementsBuffered=true;clearTimeout(this._renderTimer);this._renderTimer=Ext.Function.defer(this.renderElementsInternal,this.renderDelay,this)},setElementX:function(c,d){if(this.panel.rtl){c.setRight(d)}else{c.setLeft(d)}},getHeaderElementPosition:function(c){var d=this.schedulerView.getTimeAxisViewModel();return Math.round(d.getPositionFromDate(c))},renderBodyElementsInternal:function(e){var g=this.timeAxis.getStart(),f=this.timeAxis.getEnd(),h=this.getElementData(g,f,e);this.template.append(this.containerEl,h)},getHeaderElementData:function(d,c){throw"Abstract method call"},renderHeaderElementsInternal:function(e){var f=this.getHeaderContainerEl();if(f){var d=this.getHeaderElementData(e);this.headerTemplate.append(f,d)}},renderElementsInternal:function(){this.renderElementsBuffered=false;if(this.disabled||this.schedulerView.isDestroyed){return}if(Ext.versions.extjs&&!this.schedulerView.getEl().down("."+Ext.baseCSSPrefix+"grid-item-container")){return}this.removeElements();this.renderBodyElementsInternal();if(this.showHeaderElements){this.headerContainerEl=null;this.renderHeaderElementsInternal()}if(this.renderingDoneEvent){this.fireEvent(this.renderingDoneEvent,this)}},getElementData:function(g,h,f,e){throw"Abstract method call"},updateBodyElement:function(f){var j=Ext.get(this.getElementId(f));if(j){var h=this.timeAxis.getStart(),g=this.timeAxis.getEnd(),i=this.getElementData(h,g,[f])[0];if(i){j.dom.className=i.$cls;j.setTop(i.top);this.setElementX(j,i.left);j.setSize(i.width,i.height)}else{Ext.destroy(j)}}else{this.renderBodyElementsInternal([f])}},updateHeaderElement:function(e){var d=Ext.get(this.getHeaderElementId(e));if(d){var f=this.getHeaderElementData([e])[0];if(f){d.dom.className=f.cls;if(this.schedulerView.isHorizontal()){this.setElementX(d,f.position);d.setWidth(f.size)}else{d.setTop(f.position);d.setHeight(f.size)}}else{Ext.destroy(d)}}else{this.renderHeaderElementsInternal([e])}},destroy:function(){clearTimeout(this._renderTimer);clearTimeout(this._resizeTimer);this.store.un(this.storeListeners);if(this.store.autoDestroy){this.store.destroy()}},refreshSingle:function(c,d){d=d instanceof Array?d:[d];Ext.Array.each(d,function(a){this.updateBodyElement(a);if(this.showHeaderElements){this.updateHeaderElement(a)}},this)}});Ext.define("Sch.plugin.Lines",{extend:Sch.feature.AbstractTimeSpan,alias:"plugin.scheduler_lines",cls:"sch-timeline",showTip:true,innerTpl:null,prepareTemplateData:null,side:null,init:function(d){if(typeof this.innerTpl==="string"){this.innerTpl=new Ext.XTemplate(this.innerTpl)}this.side=d.rtl?"right":"left";var c=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for=".">','<div id="{id}" '+(this.showTip?'title="{[this.getTipText(values)]}" ':"")+'class="{$cls}" style="'+this.side+':{left}px;top:{top}px;height:{height}px;width:{width}px">'+(c?"{[this.renderInner(values)]}":"")+"</div>","</tpl>",{getTipText:function(a){return d.getSchedulingView().getFormattedDate(a.Date)+" "+(a.Text||"")},renderInner:function(a){return c.apply(a)}})}this.callParent(arguments)},getElementData:function(E,G,s){var z=this.store,H=this.schedulerView,B=H.isHorizontal(),C=H.isCalendar(),A=s||z.getRange(),I=H.getTimeSpanRegion(E,null,this.expandToFitView),i=[],y,x,J,l,F;if(Ext.versions.touch){y="100%"}else{y=B?I.bottom-I.top:1}if(!C){x=B?1:I.right-I.left}for(var v=0,w=A.length;v<w;v++){J=A[v];l=J.get("Date");if(l&&Sch.util.Date.betweenLesser(l,E,G)){F=Ext.apply({},this.getTemplateData(J));F.id=this.getElementId(J);F.$cls=this.getElementCls(J,F);if(C){I=H.getTimeSpanRegion(l,l);x=I.right-I.left;F.left=I.x;F.top=I.y}else{var D=H.getCoordinateFromDate(l);if(B){F.left=D}else{F.top=D}}F.width=x;F.height=y;i.push(F)}}return i},getHeaderElementData:function(t){var v=this.timeAxis.getStart(),l=this.timeAxis.getEnd(),i=this.schedulerView.isHorizontal(),p=[],o,u,n,r;t=t||this.store.getRange();for(var q=0,s=t.length;q<s;q++){o=t[q];u=o.get("Date");if(u&&Sch.util.Date.betweenLesser(u,v,l)){n=this.getHeaderElementPosition(u);r=this.getTemplateData(o);r=Ext.apply({side:i?this.side:"top",cls:this.getHeaderElementCls(o,r),position:n},r);r.id=this.getHeaderElementId(o);p.push(r)}}return p}});Ext.define("Sch.feature.ColumnLines",{extend:Sch.plugin.Lines,cls:"sch-column-line",showTip:false,timeAxisViewModel:null,renderingDoneEvent:"columnlinessynced",useLowestHeader:null,init:function(b){this.timeAxis=b.getTimeAxis();this.timeAxisViewModel=b.timeAxisViewModel;this.panel=b;this.store=new Ext.data.JsonStore({fields:["Date"]});this.callParent(arguments);b.on({modechange:this.populate,destroy:this.onHostDestroy,scope:this});this.timeAxisViewModel.on("update",this.populate,this);this.populate()},onHostDestroy:function(){this.timeAxisViewModel.un("update",this.populate,this)},populate:function(){this.store.setData(this.getData())},getElementData:function(){var b=this.schedulerView;if(b.isHorizontal()&&b.store.getCount()>0){return this.callParent(arguments)}return[]},getData:function(){var z=this.panel,p=[];if(z.isHorizontal()){var q=this.timeAxisViewModel;var t=this.useLowestHeader?q.getLowestHeader():q.columnLinesFor;var v=!!(q.headerConfig&&q.headerConfig[t].cellGenerator);if(v){var i=q.getColumnConfig()[t];for(var w=1,y=i.length;w<y;w++){p.push({Date:i[w].start})}}else{var x,r,l=q.getColumnConfig(),u;if(t==="bottom"){x="middle"}else{if(t==="middle"){x="top"}}r=l[x];if(r){var s=q.headerConfig;if(s[x].increment!==s[t].increment||s[x].unit!==s[t].unit){u={};Ext.Array.each(r,function(a){u[a.start.getTime()]=1})}}q.forEachInterval(t,function(b,a,c){if(c>0){p.push({Date:b,Cls:u&&u[b.getTime()]?"sch-column-line-solid":""})}})}}return p}});Ext.define("Sch.util.ScrollManager",{singleton:true,vthresh:25,hthresh:25,increment:100,frequency:500,animate:true,animDuration:200,activeCmp:null,activeEl:null,scrollElRegion:null,scrollProcess:{},pt:null,scrollWidth:null,scrollHeight:null,direction:"both",constructor:function(){this.doScroll=Ext.Function.bind(this.doScroll,this)},triggerRefresh:function(){if(this.activeEl){this.refreshElRegion();this.clearScrollInterval();this.onMouseMove()}},doScroll:function(){var m=this.scrollProcess,l=m.cmp,k=l.rtl,q=m.dir[0],j=this.increment,p=this.activeCmp.getScrollX(),r=this.activeCmp.getScrollY();if(q==="r"){j=Math.min(j,k?p:this.scrollWidth-p-this.activeEl.dom.clientWidth)}else{if(q==="d"){j=Math.min(j,this.scrollHeight-r-this.activeEl.dom.clientHeight)}}j=Math.max(j,0);var n=0,o=0;if(q==="r"){n=j}if(q==="l"){n=-j}if(q==="u"){o=-j}if(q==="d"){o=j}if(k){n=-n}l.scrollBy(n,o,{duration:this.animDuration,callback:this.triggerRefresh,scope:this})},clearScrollInterval:function(){var b=this.scrollProcess;if(b.id){clearTimeout(b.id)}b.id=0;b.cmp=null;b.dir=""},isScrollAllowed:function(b){switch(this.direction){case"both":return true;case"horizontal":return b==="right"||b==="left";case"vertical":return b==="up"||b==="down";default:throw"Invalid direction: "+this.direction}},startScrollInterval:function(c,d){if(!this.isScrollAllowed(d)){return}this.clearScrollInterval();this.scrollProcess.cmp=c;this.scrollProcess.dir=d;this.scrollProcess.id=setTimeout(this.doScroll,this.frequency)},onMouseMove:function(w){var e=w?w.getPoint():this.pt,p=e.x,r=e.y,v=this.scrollProcess,q=this.activeCmp,y=q.getScrollX(),z=q.getScrollY(),B,s=q.rtl,A=this.activeEl,t=this.scrollElRegion,x=A.dom,u=this;this.pt=e;if(t&&t.contains(e)&&A.isScrollable()){if(t.bottom-r<=u.vthresh&&(this.scrollHeight-z-x.clientHeight>0)){if(v.cmp!=q){this.startScrollInterval(q,"down")}return}else{if(t.right-p<=u.hthresh&&(s?y>0:this.scrollWidth-y-x.clientWidth>0)){if(v.cmp!=q){this.startScrollInterval(q,"right")}return}else{if(r-t.top<=u.vthresh&&z>0){if(v.cmp!=q){this.startScrollInterval(q,"up")}return}else{if(p-t.left<=u.hthresh&&(s?x.clientWidth+y<this.scrollWidth:y>0)){if(v.cmp!=q){this.startScrollInterval(q,"left")}return}}}}}this.clearScrollInterval()},refreshElRegion:function(){this.scrollElRegion=this.activeEl.getRegion()},activate:function(e,h){var f=Ext.getScrollbarSize();this.direction=h||"both";this.activeCmp=e;this.activeEl=e.getEl();var g=e.getScrollable().getMaxPosition();this.scrollWidth=g.x+e.getWidth()-f.width;this.scrollHeight=g.y+e.getHeight()-f.height;this.refreshElRegion();this.activeEl.on("mousemove",this.onMouseMove,this)},deactivate:function(){this.clearScrollInterval();this.activeEl.un("mousemove",this.onMouseMove,this);this.activeEl=this.activeCmp=this.scrollElRegion=this.scrollWidth=this.scrollHeight=null;this.direction="both"}});Ext.define("Sch.util.DragTracker",{extend:Ext.dd.DragTracker,xStep:1,yStep:1,deferredTouchActivation:0,constructor:function(){this.callParent(arguments);this.on("dragstart",function(){var c=this.el;var d={scroll:this.onMouseMove,pinchstart:this.onMouseUp,scope:this};c.on(d);this.on("dragend",function(){c.un(d)},this,{single:true})});this.moveListener={pinchstart:this.abortWait,touchend:this.abortWait,mouseup:this.abortWait,mousemove:this.onMoveWhileWaiting,scope:this,capture:true}},setXStep:function(b){this.xStep=b},startScroll:null,deferTimer:null,deferTolerance:10,moveListener:null,setYStep:function(b){this.yStep=b},onMoveWhileWaiting:function(g,f){var h=g.getXY();var e=this.startXY;if(Math.max(Math.abs(e[0]-h[0]),Math.abs(e[1]-h[1]))>this.deferTolerance){this.abortWait();this.onMouseUp(g)}},abortWait:function(){clearTimeout(this.deferTimer);this.deferTimer=null;Ext.getDoc().un(this.moveListener)},getRegion:function(){var q=this.startXY,u=this.el.getScroll();if(Ext.isIE&&this.rtl){u.left=this.el.dom.scrollWidth-this.el.getWidth()-u.left}var o=this.getXY(),x=o[0],y=o[1],s=u.left-this.startScroll.left,n=u.top-this.startScroll.top,r=q[0]-s,t=q[1]-n,v=Math.min(r,x),w=Math.min(t,y),z=Math.abs(r-x),p=Math.abs(t-y);return new Ext.util.Region(w,v+z,w+p,v)},onMouseDown:function(g,h){var e=g.event.touches||[];if(e.length>1){return}g.stopPropagation=Ext.emptyFn;this.startXY=g.getXY();if(this.deferredTouchActivation&&e.length===1){var f=this;Ext.getDoc().on(this.moveListener);this.deferTimer=setTimeout(function(){var a=f.deferredTouchActivation;Ext.getDoc().un(f.moveListener);f.deferredTouchActivation=false;f.onMouseDown(g,h);f.deferredTouchActivation=a},this.deferredTouchActivation);return}this.callParent([g,h]);this.lastXY=this.startXY;this.startScroll=this.el.getScroll();if(Ext.isIE&&this.rtl){this.startScroll.left=this.el.dom.scrollWidth-this.el.getWidth()-this.startScroll.left}},onMouseMove:function(k,l){if(this.active&&k.type==="mousemove"&&Ext.isIE9m&&!k.browserEvent.button){k.preventDefault();this.onMouseUp(k);return}k.preventDefault();var m=k.type==="scroll"?this.lastXY:k.getXY(),e=this.startXY;if(!this.active){if(Math.max(Math.abs(e[0]-m[0]),Math.abs(e[1]-m[1]))>this.tolerance){this.triggerStart(k)}else{return}}var i=m[0],j=m[1];if(this.xStep>1){i-=this.startXY[0];i=Math.round(i/this.xStep)*this.xStep;i+=this.startXY[0]}if(this.yStep>1){j-=this.startXY[1];j=Math.round(j/this.yStep)*this.yStep;j+=this.startXY[1]}var n=this.xStep>1||this.yStep>1;if(!n||i!==m[0]||j!==m[1]){this.lastXY=[i,j];if(this.fireEvent("mousemove",this,k)===false){this.onMouseUp(k)}else{this.onDrag(k);this.fireEvent("drag",this,k)}}}});Ext.define("Sch.tooltip.ClockTemplate",{extend:Ext.XTemplate,minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,mode:"hour",getRotateStyle:function(b){return"transform:rotate(Ddeg);-ms-transform:rotate(Ddeg);-moz-transform: rotate(Ddeg);-webkit-transform: rotate(Ddeg);-o-transform:rotate(Ddeg);".replace(/D/g,b)},getRotateStyleIE:(function(){var f=Math.PI/180,d=Math.cos,e=Math.sin;return function(x,r,b){var u=this,t=x*f,v=d(t),p=e(t),s=b*e((90-x)*f),q=b*d((90-x)*f),c=Math.min(b,b-s),w=x>180?q:0,a="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11 = "+v+", M12 = "+(-p)+", M21 = "+p+", M22 = "+v+")";return Ext.String.format("filter:{0};-ms-filter:{0};top:{1}px;left:{2}px;",a,c+r,w+u.handLeft)}})(),constructor:function(){var b=Ext.isIE&&Ext.isIE8m;this.callParent(['<div class="sch-clockwrap '+(b?"":"sch-supports-border-radius")+' sch-clock-{[this.mode]}"><div class="sch-clock"><div class="sch-hourIndicator" style="{[this.getHourStyle((values.date.getHours() % 12) * 30,'+this.hourTop+", + "+this.hourHeight+')]}">{[Ext.Date.monthNames[values.date.getMonth()].substr(0,3)]}</div><div class="sch-minuteIndicator" style="{[this.getMinuteStyle(values.date.getMinutes() * 6,'+this.minuteTop+", + "+this.minuteHeight+')]}">{[values.date.getDate()]}</div>'+(b?"":'<div class="sch-clock-dot"></div>')+'</div><span class="sch-clock-text">{text}</span></div>',{getMinuteStyle:b?this.getRotateStyleIE:this.getRotateStyle,getHourStyle:b?this.getRotateStyleIE:this.getRotateStyle}])}});Ext.define("Sch.tooltip.Tooltip",{extend:Ext.tip.ToolTip,autoHide:false,anchor:"b",padding:"0 3 0 0",showDelay:0,hideDelay:0,quickShowInterval:0,dismissDelay:0,trackMouse:false,anchorOffset:5,shadow:false,frame:false,schedulerView:null,message:null,startDate:null,endDate:null,template:null,valid:true,mode:null,offsetAdjust:[18,5],constructor:function(c){var d=new Sch.tooltip.ClockTemplate();this.startDate=this.endDate=new Date();if(!this.template){this.template=Ext.create("Ext.XTemplate",'<div class="sch-tip-{[values.valid ? "ok" : "notok"]}">{[this.renderClock(values.startDate, values.startText, "sch-tooltip-startdate")]}{[this.renderClock(values.endDate, values.endText, "sch-tooltip-enddate")]}<div class="sch-tip-message">{message}</div></div>',{disableFormats:true,renderClock:function(b,a,f){return d.apply({date:b,text:a,cls:f})}})}this.callParent(arguments)},update:function(i,j,k,l){if(this.startDate-i!==0||this.endDate-j!==0||this.valid!==k||this.message!==l){var m=(this.message&&!l)||(!this.message&&l);this.startDate=i;this.endDate=j;this.valid=k;this.message=l;var n=this.schedulerView.getFormattedDate(i),h=this.schedulerView.getFormattedEndDate(j,i);if(this.mode==="calendar"&&j.getHours()===0&&j.getMinutes()===0&&!(j.getYear()===i.getYear()&&j.getMonth()===i.getMonth()&&j.getDate()===i.getDate())){j=Sch.util.Date.add(j,Sch.util.Date.DAY,-1)}this.callParent([this.template.apply({valid:k,startDate:i,endDate:j,startText:n,endText:h,message:l})]);if(m){this.realign()}}},show:function(c,d){if(!c||Ext.isArray(c)){return}if(this.rendered===true){this.setPosition(0,0)}if(Sch.util.Date.compareUnits(this.schedulerView.getTimeResolution().unit,Sch.util.Date.DAY)>=0){this.mode="calendar";this.addCls("sch-day-resolution");this.removeCls("sch-hour-resolution")}else{this.mode="clock";this.removeCls("sch-day-resolution");this.addCls("sch-hour-resolution")}d=arguments.length>1?d:this.offsetAdjust[0];this.mouseOffsets=[d-this.offsetAdjust[0],-this.offsetAdjust[1]];this.setTarget(c);this.callParent();this.realign()},realign:function(){this.el.alignTo(this.target,"bl-tl",this.mouseOffsets)},afterRender:function(){this.callParent(arguments);this.el.on("mouseenter",this.realign,this)}});Ext.define("Sch.tooltip.HoverTip",{extend:Ext.tip.ToolTip,alias:"widget.scheduler_hovertip",trackMouse:true,bodyCls:"sch-hovertip",messageTpl:'<div class="sch-hovertip-msg">{message}</div>',autoHide:false,dismissDelay:1000,showDelay:0,schedulerView:null,clockTpl:null,lastTime:null,lastResource:null,initComponent:function(){var c=this;var d=c.schedulerView;c.clockTpl=new Sch.tooltip.ClockTemplate();c.messageTpl=new Ext.XTemplate(c.messageTpl);c.callParent(arguments);c.on("beforeshow",c.tipOnBeforeShow,c);d.mon(d.el,{mouseleave:function(){c.hide()},mousemove:c.handleMouseMove,scope:c});d.mon(d.el,{click:c.onBodyMouseDown,scope:c,delay:1})},onBodyMouseDown:function(){this.hide()},handleMouseMove:function(h){var j=this;var g=j.schedulerView;if(j.disabled){return}if(h.getTarget("."+g.itemCls,5)&&!h.getTarget(g.eventSelector)){var i=g.getDateFromDomEvent(h,"floor");if(i){var e=g.resolveResource(h.getTarget());if(i-j.lastTime!==0||e!==j.lastResource){j.lastResource=e;if(j.hidden){if(Sch.util.Date.compareUnits(this.schedulerView.getTimeResolution().unit,Sch.util.Date.DAY)>=0){j.clockTpl.mode="day"}else{j.clockTpl.mode="hour"}j.show()}j.updateHoverTip(i,h)}}else{j.hide();j.lastTime=null;j.lastResource=null}}else{j.hide();j.lastTime=null;j.lastResource=null}},getText:function(){},updateHoverTip:function(h,g){if(h){var e=this.clockTpl.apply({date:h,text:this.schedulerView.getFormattedDate(h)});var f=this.messageTpl.apply({message:this.getText(h,g)});this.update(e+f);this.lastTime=h}},tipOnBeforeShow:function(b){return !this.disabled&&this.lastTime!==null}});Ext.define("Sch.feature.DragCreator",{disabled:false,showHoverTip:true,showDragTip:true,dragTip:null,dragTolerance:2,hoverTip:null,validatorFn:Ext.emptyFn,validatorFnScope:null,trackerConfig:null,schedulerView:null,template:'<div class="sch-dragcreator-proxy"><div class="sch-event-inner">&#160;</div></div>',constructor:function(b){Ext.apply(this,b||{});this.lastTime=new Date();if(!(this.template instanceof Ext.Template)){this.template=new Ext.Template(this.template)}this.schedulerView.on("destroy",this.onSchedulerDestroy,this);if(Ext.supports.Touch){this.schedulerView.on("boxready",this.initDragTracker,this)}else{this.schedulerView.el.on("mousemove",this.initDragTracker,this,{single:true})}this.callParent([b])},setDisabled:function(b){this.disabled=b;if(this.hoverTip){this.hoverTip.setDisabled(b)}if(this.dragTip){this.dragTip.setDisabled(b)}},getProxy:function(){if(!this.proxy){this.proxy=this.template.append(this.schedulerView.getSecondaryCanvasEl(),{},true);var b=this.schedulerView.rtl;this.proxy.hide=function(){if(b){this.setStyle({right:"-10000px",top:"-10000px"})}else{this.setStyle({left:"-10000px",top:"-10000px"})}}}return this.proxy},onBeforeDragStart:function(k,i){var e=this.schedulerView,h=i.getTarget("."+e.timeCellCls,5);if(h&&this.isCreateAllowed(i)&&(!i.event.touches||i.event.touches.length===1)){var l=e.resolveResource(h);var j=e.getDateFromDomEvent(i);if(!this.disabled&&h&&e.fireEvent("beforedragcreate",e,l,j,i)!==false){this.resourceRecord=l;this.originalStart=j;this.resourceRegion=e.getScheduleRegion(this.resourceRecord,this.originalStart);this.dateConstraints=e.getDateConstraints(this.resourceRecord,this.originalStart);return true}}return false},isCreateAllowed:function(b){return !b.getTarget(this.schedulerView.eventSelector)},disableHoverTip:function(){this.hoverTip&&this.hoverTip.disable()},onDragStart:function(){var g=this,e=g.schedulerView,f=g.tracker.getRegion(),h=g.getProxy();this.dragging=true;if(this.hoverTip){this.hoverTip.on("enable",this.disableHoverTip,this);this.hoverTip.disable()}g.start=g.originalStart;g.end=g.start;g.originalScroll=e.getScroll();if(e.getMode()==="horizontal"){g.rowBoundaries={top:g.resourceRegion.top,bottom:g.resourceRegion.bottom}}else{g.rowBoundaries={left:g.resourceRegion.left,right:g.resourceRegion.right}}Ext.apply(f,g.rowBoundaries);if(e.rtl){h.setStyle({right:"auto"})}h.setBox(f);h.show();e.fireEvent("dragcreatestart",e,h);if(g.showDragTip){g.dragTip.enable();g.dragTip.update(g.start,g.end,true);g.dragTip.show(h);g.dragTip.setStyle("visibility","visible")}Sch.util.ScrollManager.activate(e,e.getMode()==="horizontal"?"horizontal":"vertical")},onDrag:function(){var l=this,o=l.schedulerView,p=l.tracker.getRegion(),k=o.getStartEndDatesFromRegion(p,"round"),m="";if(!k){return}l.start=k.start||l.start;l.end=k.end||l.end;var i=l.dateConstraints;if(i){l.end=Sch.util.Date.constrain(l.end,i.start,i.end);l.start=Sch.util.Date.constrain(l.start,i.start,i.end)}l.valid=this.validatorFn.call(l.validatorFnScope||l,l.resourceRecord,l.start,l.end);if(l.valid&&typeof l.valid!=="boolean"){m=l.valid.message;l.valid=l.valid.valid}l.valid=(l.valid!==false);if(l.showDragTip){l.dragTip.update(l.start,l.end,l.valid,m)}Ext.apply(p,l.rowBoundaries);var j=o.getScroll();var n=this.getProxy();n.setBox(p);if(o.isHorizontal()){n.setY(l.resourceRegion.top+l.originalScroll.top-j.top)}},eventSwallower:function(b){b.stopPropagation();b.preventDefault()},onDragEnd:function(k,j){var l=this,n=l.schedulerView,m=true,i=j.getTarget(),e=Ext.get(i);e.on("click",this.eventSwallower);setTimeout(function(){e.un("click",l.eventSwallower)},100);l.dragging=false;if(l.showDragTip){l.dragTip.disable()}if(!l.start||!l.end||(l.end-l.start<=0)){l.valid=false}l.createContext={start:l.start,end:l.end,resourceRecord:l.resourceRecord,e:j,finalize:function(){l.finalize.apply(l,arguments)}};if(l.valid){m=n.fireEvent("beforedragcreatefinalize",l.schedulerView,l.createContext,j,this.getProxy())!==false}if(m){l.finalize(l.valid)}Sch.util.ScrollManager.deactivate()},finalize:function(f){var e=this.createContext;var g=this.schedulerView;if(f){var h=Ext.create(g.getEventStore().getModel());if(h.setCalendar){h.setCalendar(g.getEventStore().getCalendar())}h.setStartEndDate(e.start,e.end);if(h.setCalendar){h.setCalendar(null)}g.fireEvent("dragcreateend",g,h,e.resourceRecord,e.e,this.getProxy())}else{this.proxy.hide()}this.schedulerView.fireEvent("afterdragcreate",g,this.getProxy());if(this.hoverTip){this.hoverTip.un("enable",this.disableHoverTip,this);this.hoverTip.enable()}},dragging:false,initDragTracker:function(){var g=this,e=Ext.supports.Touch,f=g.schedulerView;var h=Ext.apply({el:f.el,rtl:f.rtl,deferredTouchActivation:e?1000:false,tolerance:g.dragTolerance,listeners:{mousedown:g.verifyLeftButtonPressed,beforedragstart:g.onBeforeDragStart,dragstart:g.onDragStart,drag:g.onDrag,dragend:g.onDragEnd,scope:g}},this.trackerConfig);this.bindRightClickPreventer();if(e){this.showDragTip=false;this.showHoverTip=false;this.dragTip=null;this.hoverTip=null}else{this.setupTooltips()}g.tracker=new Sch.util.DragTracker(h)},bindRightClickPreventer:function(){var b;if(Ext.isIE9m){b="mousedown"}else{b="contextmenu"}this.schedulerView.el.on(b,this.stopDragCreateOnRightClick,this,{priority:999})},stopDragCreateOnRightClick:function(b){if(b.button!==0&&this.dragging){this.tracker.onMouseUp(b)}},setupTooltips:function(){var h=this,f=h.schedulerView;if(this.showDragTip){var e=this.dragTip;if(e instanceof Ext.tip.ToolTip){e.schedulerView=f;e.on("beforeshow",function(){return h.dragging})}else{this.dragTip=new Sch.tooltip.Tooltip(Ext.apply({cls:"sch-dragcreate-tip",schedulerView:f,listeners:{beforeshow:function(){return h.dragging}}},e))}}if(h.showHoverTip){var g=h.hoverTip;if(g instanceof Ext.tip.ToolTip){g.schedulerView=f}else{h.hoverTip=Ext.ComponentManager.create(Ext.applyIf({renderTo:Ext.getBody(),target:f.el,schedulerView:f},g),"scheduler_hovertip")}}},verifyLeftButtonPressed:function(d,c){return c.button===0},onSchedulerDestroy:function(){if(this.hoverTip){this.hoverTip.destroy()}if(this.dragTip){this.dragTip.destroy()}if(this.tracker){this.tracker.destroy()}if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}}});Ext.define("Sch.feature.SchedulerDragZone",{extend:Ext.dd.DragZone,repairHighlight:false,repairHighlightColor:"transparent",containerScroll:false,showTooltip:true,tip:null,tipIsProcessed:false,deltaSetXY:null,schedulerView:null,lastXY:null,showExactDropPosition:false,enableCopy:false,enableCopyKey:"SHIFT",validatorFn:function(e,g,j,h,i){return true},validatorFnScope:null,copyKeyPressed:false,dragDropProxyCls:"sch-dd-ref",constructor:function(h,f){if(Ext.isIE8m&&window.top!==window){Ext.dd.DragDropManager.notifyOccluded=true}var e=this.proxy=this.proxy||new Ext.dd.StatusProxy({shadow:false,dropAllowed:this.dropAllowed,dropNotAllowed:this.dropNotAllowed,ensureAttachedToBody:Ext.emptyFn});this.callParent(arguments);this.isTarget=true;this.scroll=false;this.ignoreSelf=false;var g=this.schedulerView;if(g.touchScroll){this.showTooltip=false}g.el.appendChild(e.el);this.bindRightClickPreventer();e.addCls("sch-dragproxy");g.on({eventdragstart:function(){Sch.util.ScrollManager.activate(g,g.constrainDragToResource&&g.getMode())},aftereventdrop:function(){Sch.util.ScrollManager.deactivate()},scope:this})},bindRightClickPreventer:function(){var b;if(Ext.isIE10){b="contextmenu"}else{b="mousedown"}this.schedulerView.el.on(b,this.preventRightClick,this,{priority:999})},destroy:function(){this.callParent(arguments);Ext.destroyMembers(this,"tip")},preventRightClick:function(b){if(this.dragging&&b.button!==0){b.stopEvent();return false}},autoOffset:function(){this.setDelta(0,0)},setupConstraints:function(l,s,p,r,n,q,t){this.clearTicks();var v=n&&!this.showExactDropPosition&&q>1?q:0;var o=!n&&!this.showExactDropPosition&&q>1?q:0;this.resetConstraints();this.initPageX=l.left+p;this.initPageY=l.top+r;var u=s.right-s.left;var m=s.bottom-s.top;if(n){if(t){this.setXConstraint(l.left+p,l.right-u+p,v)}else{this.setXConstraint(l.left,l.right,v)}this.setYConstraint(l.top+r,l.bottom-m+r,o)}else{this.setXConstraint(l.left+p,l.right-u+p,v);if(t){this.setYConstraint(l.top+r,l.bottom-m+r,o)}else{this.setYConstraint(l.top,l.bottom,o)}}},setXConstraint:function(f,d,e){this.leftConstraint=f;this.rightConstraint=d;this.minX=f;this.maxX=d;if(e){this.setXTicks(this.initPageX,e)}this.constrainX=true},setYConstraint:function(e,f,d){this.topConstraint=e;this.bottomConstraint=f;this.minY=e;this.maxY=f;if(d){this.setYTicks(this.initPageY,d)}this.constrainY=true},onDragEnter:Ext.emptyFn,onDragOut:Ext.emptyFn,setVisibilityForSourceEvents:function(b){Ext.Array.each(this.dragData.getEventBarElements(),function(a){a[b?"show":"hide"]()})},onDragOver:function(q){if(q&&q.event.touches&&q.event.touches.length>1){Ext.dd.DragDropManager.handleMouseUp(q);return}var e=q?q.getXY():this.lastXY;if(!e){return}this.checkShiftChange();var m=this.dragData;if(!m.originalHidden){this.setVisibilityForSourceEvents(false);m.originalHidden=true}var u=m.startDate;var s=m.newResource;var p=this.schedulerView;this.updateDragContext(q);if(this.showExactDropPosition){var o=p.isHorizontal();var v=p.getDateFromCoordinate(o?e[0]:e[1])-m.sourceDate;var n=new Date(m.origStart-0+v);var r=p.timeAxisViewModel.getDistanceBetweenDates(n,m.startDate);if(m.startDate>p.timeAxis.getStart()){var t=this.proxy.el;if(r){if(p.isHorizontal()){t.setX(e[0]+(this.schedulerView.rtl?-r:r))}else{t.setY(e[1]+r)}}}}if(m.startDate-u!==0||s!==m.newResource){this.schedulerView.fireEvent("eventdrag",this.schedulerView,m.draggedRecords,m.startDate,m.newResource,m)}if(this.showTooltip){this.tip.realign();this.tip.update(m.startDate,m.endDate,m.valid,m.message)}if(q){this.lastXY=q.getXY()}},getCoordinate:function(b){switch(this.schedulerView.getMode()){case"horizontal":return b[0];case"vertical":return b[1];case"calendar":return b}},getDragData:function(w){var x=this.schedulerView,y=w.getTarget(x.eventSelector);if(!y||w.event.touches&&w.event.touches.length>1){return}var D=x.resolveEventRecord(y),A=x.resolveResource(y),H=x.resolveAssignmentRecord(y);if(!D||D.isDraggable()===false||x.fireEvent("beforeeventdrag",x,D,w)===false){return null}var F=w.getXY(),L=Ext.get(y),s=L.getXY(),E=[F[0]-s[0],F[1]-s[1]],B=L.getRegion();this.lastXY=null;var C=x.getMode()==="horizontal";x.constrainDragToResource&&!A&&Ext.Error.raise("Resource could not be resolved for event: "+D.getId());var t=x.getDateConstraints(x.constrainDragToResource?A:null,D);this.setupConstraints(x.getScheduleRegion(x.constrainDragToResource?A:null,D),B,E[0],E[1],C,x.getSnapPixelAmount(),Boolean(t));var K=D.getStartDate(),z=D.getEndDate(),J=x.timeAxis,G=this.getRelatedRecords(H||D)||[],e=x.getElementsFromEventRecord(D,x.isCalendar()?null:A);Ext.Array.each(G,function(a){if(a instanceof Sch.model.Assignment){e=e.concat(x.getElementsFromEventRecord(a.getEvent(),a.getResource()))}else{e=e.concat(x.getElementsFromEventRecord(a))}});e=Ext.Array.unique(e);var I={offsets:E,repairXY:s,prevScroll:x.getScroll(),dateConstraints:t,eventBarEls:e,getEventBarElements:function(){return I.eventBarEls=Ext.Array.map(I.eventBarEls,function(a){return a.dom&&a||Ext.get(a.id)})},draggedRecords:[H||D].concat(G),resourceRecord:A,sourceDate:x.getDateFromCoordinate(this.getCoordinate(F)),origStart:K,origEnd:z,startDate:K,endDate:z,timeDiff:0,startsOutsideView:K<J.getStart(),endsOutsideView:z>J.getEnd(),duration:z-K,bodyScroll:Ext.getBody().getScroll(),eventObj:w};I.ddel=this.getDragElement(L,I);return I},onStartDrag:function(){var c=this.schedulerView,d=this.dragData;Ext.Array.each(d.getEventBarElements(),function(a){a.removeCls("sch-event-hover")});c.fireEvent("eventdragstart",c,d.draggedRecords);c.getScrollable().on("scroll",this.onViewScroll,this)},alignElWithMouse:function(f,h,i){this.callParent(arguments);var j=this.getTargetCoord(h,i),g=f.dom?f:Ext.fly(f,"_dd");this.setLocalXY(g,j.x+this.deltaSetXY[0],j.y+this.deltaSetXY[1])},onViewScroll:function(m,q,n){var o=this.proxy,j=this.schedulerView,l=this.dragData;this.setVisibilityForSourceEvents(false);var k=o.getXY();var p;if(j.rtl){p=[k[0]-q+l.prevScroll.left,k[1]+n-l.prevScroll.top]}else{p=[k[0]+q-l.prevScroll.left,k[1]+n-l.prevScroll.top]}var r=this.deltaSetXY;if(j.rtl){this.deltaSetXY=[r[0]-q+l.prevScroll.left,r[1]+n-l.prevScroll.top]}else{this.deltaSetXY=[r[0]+q-l.prevScroll.left,r[1]+n-l.prevScroll.top]}l.prevScroll={left:q,top:n};o.setXY(p);this.onDragOver()},getCopyKeyPressed:function(){return Boolean(this.enableCopy&&this.dragData.eventObj[this.enableCopyKey.toLowerCase()+"Key"])},checkShiftChange:function(){var c=this.getCopyKeyPressed(),d=this.dragData;if(c!==this.copyKeyPressed){this.copyKeyPressed=c;if(c){d.refElements.addCls("sch-event-copy");this.setVisibilityForSourceEvents(true)}else{d.refElements.removeCls("sch-event-copy");this.setVisibilityForSourceEvents(false)}}},onKey:function(b){if(this.enableCopy&&b.getKey()===b[this.enableCopyKey]){this.checkShiftChange()}if(b.getKey()===b.ESC){this.dragData.ddCallbackArgs=[b.getTarget(),b,this.id];this.finalize(false);Ext.dd.DragDropManager.stopDrag(b);Ext.dd.DragDropManager.stopEvent(b)}},startDrag:function(){Ext.getDoc().on({keydown:this.onKey,keyup:this.onKey,useCapture:true,scope:this});var h=this.callParent(arguments);var i=this.dragData;i.refElement=this.proxy.el.down("."+this.dragDropProxyCls);i.refElements=this.proxy.el.select(".sch-event");i.refElement.removeCls("sch-event-hover");if(this.showTooltip){var g=this.schedulerView,j=g.up("[lockable=true]").el;if(!this.tipIsProcessed){this.tipIsProcessed=true;var f=this.tip;if(f instanceof Ext.tip.ToolTip){f.schedulerView=g}else{this.tip=new Sch.tooltip.Tooltip(Ext.apply({schedulerView:g,cls:"sch-dragdrop-tip",constrainTo:j},f))}}this.tip.update(i.origStart,i.origEnd,true);this.tip.setStyle("visibility");this.tip.show(i.refElement,i.offsets[0])}this.copyKeyPressed=this.getCopyKeyPressed();if(this.copyKeyPressed){i.refElements.addCls("sch-event-copy");i.originalHidden=true}return h},endDrag:function(){this.schedulerView.getScrollable().un("scroll",this.onViewScroll,this);Ext.getDoc().un({keydown:this.onKey,keyup:this.onKey,useCapture:true,scope:this});this.callParent(arguments)},onMouseUp:function(){if(!this.dragging){this.afterDragFinalized()}},afterDragFinalized:function(){this.proxy.el.setStyle({left:0,top:0})},updateRecords:function(z){var r=this,q=r.schedulerView,w=q.getEventStore(),o=q.getResourceStore(),t=w.getAssignmentStore(),v=z.newResource,u=z.draggedRecords[0],A=z.draggedRecords.slice(1),s=z.resourceRecord,p=r.getCopyKeyPressed(),y=z.startDate,B=z.timeDiff,x=q.getMode();if(t&&w instanceof Sch.data.EventStore){r.updateRecordsMultipleAssignmentMode(y,B,u,A,s,v,w,o,t,p,x)}else{if(t){r.updateRecordsSingleAssignmentMode(y,B,u.getEvent(),Ext.Array.map(A,function(a){return a.getEvent()}),s,v,w,o,p,x)}else{r.updateRecordsSingleAssignmentMode(y,B,u,A,s,v,w,o,p,x)}}q.fireEvent("eventdrop",q,z.draggedRecords,p)},updateRecordsSingleAssignmentMode:function(x,y,o,r,v,q,u,p,z,w){var s=this,n=[];if(z){o=o.fullCopy(null);n.push(o)}o.beginEdit();if(!z&&q!==v&&v instanceof Sch.model.Resource&&q instanceof Sch.model.Resource){o.reassign(v,q)}else{if(q!==v&&v instanceof Sch.model.Resource&&q instanceof Sch.model.Resource){o.assign(q)}}o.setStartDate(x,true,u.skipWeekendsDuringDragDrop);o.endEdit();if(w!=="calendar"){var t=p.indexOf(v)-p.indexOf(q);Ext.Array.each(r,function(a){var b=a.getResources();if(z){a=a.fullCopy(null);n.push(a)}a.beginEdit();a.setStartDate(s.adjustStartDate(a.getStartDate(),y),true,u.skipWeekendsDuringDragDrop);t!==0&&b.length&&Ext.Array.each(b,function(c){var d=p.indexOf(c)-t,e;if(d<0){d=0}else{if(d>=p.getCount()){d=p.getCount()-1}}e=p.getAt(d);a.reassign(c,e)});a.endEdit()})}if(n.length){u.append(n)}},updateRecordsMultipleAssignmentMode:function(v,w,q,m,t,o,s,n,r,x,u){var p=this;Ext.Array.each([].concat(q,m),function(b){var a=b.getEvent();a.setStartDate(p.adjustStartDate(a.getStartDate(),w),true,s.skipWeekendsDuringDragDrop);if(u!="calendar"&&t!==o){if(x){a.assign(o)}else{if(!a.isAssignedTo(o)){a.reassign(b.getResource(),o)}else{a.unassign(b.getResource())}}}})},isValidDrop:function(e,d,f){if(e!==d){if(f instanceof Sch.model.Assignment){return !f.getEvent().isAssignedTo(d)}else{return !f.isAssignedTo(d)}}return true},resolveResource:function(j){var l=this.proxy.el.dom;var i=this.dragData.bodyScroll;l.style.display="none";var k=document.elementFromPoint(j[0]-i.left,j[1]-i.top);if(Ext.isIE8&&window.top.Siesta){k=document.elementFromPoint(j[0]-i.left,j[1]-i.top)}l.style.display="block";if(!k){return null}var h=this.schedulerView;if(k.className.match(Ext.baseCSSPrefix+"grid-item")){return this.resolveResource([j[0],j[1]+3])}if(!k.className.match(h.timeCellCls)){var g=Ext.fly(k).up("."+h.timeCellCls);if(g){k=g.dom}else{return null}}return h.resolveResource(k)},adjustStartDate:function(e,f){var d=this.schedulerView;return d.timeAxis.roundDate(new Date(e-0+f),d.snapRelativeToEventStartDate?e:false)},updateDragContext:function(l){var e=this.dragData,m=l?l.getXY():this.lastXY;if(!e.refElement){return}var n=this.schedulerView,k=e.refElement.getRegion();if(n.timeAxis.isContinuous()){if((n.isHorizontal()&&this.minX<m[0]&&m[0]<this.maxX)||(!n.isHorizontal()&&this.minY<m[1]&&m[1]<this.maxY)){var p=n.getDateFromCoordinate(this.getCoordinate(m));e.timeDiff=p-e.sourceDate;e.startDate=this.adjustStartDate(e.origStart,e.timeDiff);e.endDate=new Date(e.startDate-0+e.duration)}}else{var o=this.resolveStartEndDates(k);e.startDate=o.startDate;e.endDate=o.endDate;e.timeDiff=e.startDate-e.origStart}e.newResource=n.constrainDragToResource?e.resourceRecord:this.resolveResource([k.left+e.offsets[0],k.top+e.offsets[1]]);if(e.newResource){var j=!l||this.validatorFn.call(this.validatorFnScope||this,e.draggedRecords,e.newResource,e.startDate,e.duration,l);if(!j||typeof j==="boolean"){e.valid=j!==false;e.message=""}else{e.valid=j.valid!==false;e.message=j.message}}else{e.valid=false}},getRelatedRecords:function(h){var e=this.schedulerView,g=e.getEventSelectionModel(),f=g.getDraggableSelections();return Ext.Array.filter(f,function(a){return h!==a})},getDragElement:function(i,n){var k=n.getEventBarElements();var l;var o;var j=n.offsets[0];var m=n.offsets[1];if(k.length>1){var p=Ext.core.DomHelper.createDom({tag:"div",cls:"sch-dd-wrap",style:{overflow:"visible"}});Ext.Array.each(k,function(a){l=a.dom.cloneNode(true);l.id=Ext.id();if(a.dom===i.dom){l.className+=" "+this.dragDropProxyCls;if(Ext.isIE8){Ext.fly(l).addCls(this.dragDropProxyCls)}}p.appendChild(l);var b=a.getOffsetsTo(i);Ext.fly(l).setStyle({left:b[0]-j+"px",top:b[1]-m+"px"})},this);o=p}else{l=i.dom.cloneNode(true);l.id=Ext.id();l.style.left=-j+"px";l.style.top=-m+"px";l.className+=" "+this.dragDropProxyCls;if(Ext.isIE8){Ext.fly(l).addCls(this.dragDropProxyCls)}o=l}if(!i.dom.style.height){Ext.fly(o).setHeight(i.getHeight())}return o},onDragDrop:function(l,k){this.updateDragContext(l);var o=this,e=o.schedulerView,m=o.cachedTarget||Ext.dd.DragDropMgr.getDDById(k),n=o.dragData,j=false,p=true;n.ddCallbackArgs=[m,l,k];if(n.valid&&n.startDate&&n.endDate){n.finalize=function(){o.finalize.apply(o,arguments)};p=e.fireEvent("beforeeventdropfinalize",o,n,l)!==false;if(p&&o.isValidDrop(n.resourceRecord,n.newResource,n.draggedRecords[0])){j=(n.startDate-n.origStart)!==0||n.newResource!==n.resourceRecord}}if(p){o.finalize(n.valid&&j)}else{o.proxy.el.addCls("sch-before-drag-finalized")}},finalize:function(n){var k=this,h=k.schedulerView,m=h.getEventStore(),j=k.dragData;k.proxy.el.removeCls("sch-before-drag-finalized");if(k.tip){k.tip.hide()}if(n){var i,l=function(){i=true};m.on("update",l,null,{single:true});k.updateRecords(j);m.un("update",l,null,{single:true});if(!i){k.onInvalidDrop.apply(k,j.ddCallbackArgs)}else{if(Ext.isIE9){k.proxy.el.setStyle("visibility","hidden");Ext.Function.defer(k.onValidDrop,10,k,j.ddCallbackArgs)}else{k.onValidDrop.apply(k,j.ddCallbackArgs)}h.fireEvent("aftereventdrop",h,j.draggedRecords)}k.afterDragFinalized()}else{k.onInvalidDrop.apply(k,j.ddCallbackArgs)}},onInvalidDrop:function(i,j,h){if(!j){j=i;i=j.getTarget()||document.body}if(this.tip){this.tip.hide()}this.setVisibilityForSourceEvents(true);var g=this.schedulerView,e=this.callParent([i,j,h]);g.fireEvent("aftereventdrop",g,this.dragData.draggedRecords);this.afterDragFinalized();return e},resolveStartEndDates:function(i){var h=this.dragData,l,j=h.origStart,g=h.origEnd;var k=Sch.util.Date;if(!h.startsOutsideView){l=this.schedulerView.getStartEndDatesFromRegion(i,"round");if(l){j=l.start||h.startDate;g=k.add(j,k.MILLI,h.duration)}}else{if(!h.endsOutsideView){l=this.schedulerView.getStartEndDatesFromRegion(i,"round");if(l){g=l.end||h.endDate;j=k.add(g,k.MILLI,-h.duration)}}}return{startDate:j,endDate:g}}});Ext.define("Sch.feature.DragDrop",{validatorFn:function(e,g,j,h,i){return true},validatorFnScope:null,dragConfig:null,constructor:function(c,d){Ext.apply(this,d);this.schedulerView=c;c.eventDragZone=new Sch.feature.SchedulerDragZone(c.ownerCt.el,Ext.apply({ddGroup:c.id,schedulerView:c,validatorFn:this.validatorFn,validatorFnScope:this.validatorFnScope},this.dragConfig));this.schedulerView.on("destroy",this.cleanUp,this);this.callParent([d])},cleanUp:function(){var b=this.schedulerView;if(b.eventDragZone){b.eventDragZone.destroy()}}});Ext.define("Sch.feature.ResizeZone",{extend:Ext.util.Observable,showTooltip:true,showExactResizePosition:false,validatorFn:Ext.emptyFn,validatorFnScope:null,schedulerView:null,origEl:null,handlePos:null,eventRec:null,tip:null,tipInstance:null,startScroll:null,constructor:function(d){Ext.apply(this,d);var c=this.schedulerView;c.on({destroy:this.cleanUp,scope:this});c.el.on({mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,delegate:".sch-resizable-handle"});this.bindRightClickPreventer();this.callParent(arguments)},bindRightClickPreventer:function(){var d;if(Ext.isIE9m){d="mousedown"}else{d="contextmenu"}var c={scope:this,priority:999};c[d]=this.preventRightClick;this.schedulerView.el.on(c)},preventRightClick:function(b){if(b.button!==0&&this.resizer){b.stopEvent();return false}},onMouseDown:function(h,g){var e=this.schedulerView;var i=this.eventRec=e.resolveEventRecord(g);var j=i.isResizable();if(h.button!==0||(j===false||typeof j==="string"&&!g.className.match(j))){return}this.eventRec=i;this.handlePos=this.getHandlePosition(g);this.origEl=Ext.get(h.getTarget(".sch-event"));e.el.on({mousemove:this.onMouseMove,scope:this,single:true})},onMouseUp:function(f,e){var d=this.schedulerView;d.el.un({mousemove:this.onMouseMove,scope:this,single:true})},getTipInstance:function(){if(this.tipInstance){return this.tipInstance}var e=this.schedulerView;var f=this.tip;var d=e.up("[lockable=true]").el;if(f instanceof Ext.tip.ToolTip){f.schedulerView=e}else{f=new Sch.tooltip.Tooltip(Ext.apply({rtl:this.rtl,schedulerView:e,constrainTo:d,cls:"sch-resize-tip"},f))}return this.tipInstance=f},onMouseMove:function(j,i){var e=this.schedulerView,k=this.eventRec,m=this.handlePos;if(!k||e.fireEvent("beforeeventresize",e,k,j)===false){return}delete this.eventRec;j.stopEvent();this.origEl.addCls("sch-event-resizing");this.resizer=this.createResizer(this.origEl,k,m);var n=this.resizer.resizeTracker;if(this.showTooltip){var l=this.getTipInstance();l.setTarget(this.origEl);l.update(k.getStartDate(),k.getEndDate(),true);l.show(this.origEl,j.getX()-this.origEl.getX())}n.onMouseDown(j,this.resizer[m].dom);n.onMouseMove(j,this.resizer[m].dom);e.fireEvent("eventresizestart",e,k);e.getScrollable().on("scroll",this.onViewScroll,this)},getHandlePosition:function(c){var d=c.className.match("start");if(this.schedulerView.getMode()==="horizontal"){if(this.schedulerView.rtl){return d?"east":"west"}return d?"west":"east"}else{return d?"north":"south"}},createResizer:function(C,x,D){var q=this.schedulerView,y=this,z=q.resolveResource(C),u=q.getSnapPixelAmount(),r=q.getScheduleRegion(z,x),E=q.getDateConstraints(z,x),s=C.getHeight(),F=(q.rtl&&D[0]==="e")||(!q.rtl&&D[0]==="w")||D[0]==="n",w=q.getMode()!=="horizontal",A={otherEdgeX:F?C.getRight():C.getLeft(),otherEdgeY:F?C.getBottom():C.getTop(),target:C,isStart:F,startYOffset:C.getY()-C.parent().getY(),startXOffset:C.getX()-C.parent().getX(),dateConstraints:E,resourceRecord:z,eventRecord:x,handles:D[0],minHeight:s,constrainTo:r,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}};if(w){if(u>0){var v=C.getWidth();Ext.apply(A,{minHeight:u,minWidth:v,maxWidth:v,heightIncrement:u})}}else{if(u>0){Ext.apply(A,{minWidth:u,maxHeight:s,widthIncrement:u})}}var t=new Ext.resizer.Resizer(A);if(t.resizeTracker){t.resizeTracker.tolerance=-1;var B=t.resizeTracker.updateDimensions;t.resizeTracker.updateDimensions=function(a){if(!Ext.isWebKit||!a.getTarget||a.getTarget(".sch-timelineview")){var b;if(w){b=q.getScrollY()-y.startScroll.top;t.resizeTracker.minHeight=A.minHeight-Math.abs(b)}else{b=q.getScrollX()-y.startScroll.left;t.resizeTracker.minWidth=A.minWidth-Math.abs(b)}B.apply(this,arguments)}};t.resizeTracker.resize=function(b){var a;if(w){a=q.getScrollY()-y.startScroll.top;if(D[0]==="s"){b.y-=a}b.height+=Math.abs(a)}else{a=q.getScrollX()-y.startScroll.left;if(D[0]==="e"){b.x-=a}b.width+=Math.abs(a)}Ext.resizer.ResizeTracker.prototype.resize.apply(this,arguments)}}C.setStyle("z-index",parseInt(C.getStyle("z-index"),10)+1);Sch.util.ScrollManager.activate(q,q.getMode()==="horizontal"?"horizontal":"vertical");this.startScroll=q.getScroll();return t},getStartEndDates:function(){var l=this.resizer,n=l.el,m=this.schedulerView,h=l.isStart,j,i,k;if(h){if(m.getMode()==="horizontal"){k=[m.rtl?n.getRight():n.getLeft()+1,n.getTop()]}else{k=[(n.getRight()+n.getLeft())/2,n.getTop()]}i=l.eventRecord.getEndDate();if(m.snapRelativeToEventStartDate){j=m.getDateFromXY(k);j=m.timeAxis.roundDate(j,l.eventRecord.getStartDate())}else{j=m.getDateFromXY(k,"round")}}else{if(m.getMode()==="horizontal"){k=[m.rtl?n.getLeft():n.getRight(),n.getBottom()]}else{k=[(n.getRight()+n.getLeft())/2,n.getBottom()]}j=l.eventRecord.getStartDate();if(m.snapRelativeToEventStartDate){i=m.getDateFromXY(k);i=m.timeAxis.roundDate(i,l.eventRecord.getEndDate())}else{i=m.getDateFromXY(k,"round")}}j=j||l.start;i=i||l.end;if(l.dateConstraints){j=Sch.util.Date.constrain(j,l.dateConstraints.start,l.dateConstraints.end);i=Sch.util.Date.constrain(i,l.dateConstraints.start,l.dateConstraints.end)}return{start:j,end:i}},partialResize:function(x,s,w,r){var z=this.schedulerView,F=r?r.getXY():this.resizer.resizeTracker.lastXY,y=this.getStartEndDates(F),G=y.start,H=y.end,I=x.eventRecord,C=z.isHorizontal();if(C){x.target.el.setY(x.target.parent().getY()+x.startYOffset)}else{x.target.el.setX(x.target.parent().getX()+x.startXOffset)}if(this.showTooltip){var v=this.validatorFn.call(this.validatorFnScope||this,x.resourceRecord,I,G,H);var A="";if(v&&typeof v!=="boolean"){A=v.message;v=v.valid}this.getTipInstance().update(G,H,v!==false,A)}if(this.showExactResizePosition){var e=x.target.el,D,B,E;if(x.isStart){if(z.isCalendar()){var J=z.calendar.getEventColumns(I)[0];D=z.timeAxisViewModel.getDistanceBetweenDates(G,J.end)}else{D=z.timeAxisViewModel.getDistanceBetweenDates(G,I.getEndDate())}if(C){B=z.getDateFromCoordinate(x.otherEdgeX-Math.min(s,x.maxWidth))||G;E=z.timeAxisViewModel.getDistanceBetweenDates(B,G);e.setWidth(D);e.setX(e.getX()+E)}else{B=z.getDateFromCoordinate(x.otherEdgeY-Math.min(s,x.maxHeight))||G;E=z.timeAxisViewModel.getDistanceBetweenDates(B,G);e.setHeight(D);e.setY(e.getY()+E)}}else{D=z.timeAxisViewModel.getDistanceBetweenDates(I.getStartDate(),H);if(C){e.setWidth(D)}else{e.setHeight(D)}}}else{if(!G||!H||((x.start-G===0)&&(x.end-H===0))){return}}x.end=H;x.start=G;z.fireEvent("eventpartialresize",z,I,G,H,x.el)},onViewScroll:function(c,d){this.resizer.resizeTracker.onDrag({});this.partialResize(this.resizer,0,0)},afterResize:function(C,s,y,x){var v=this,w=C.resourceRecord,u=C.eventRecord,z=u.getStartDate(),e=u.getEndDate(),B=C.start||z,A=C.end||e,h=v.schedulerView,r=false,t=true,D=v.validatorFn.call(v.validatorFnScope||v,w,u,B,A,x);Sch.util.ScrollManager.deactivate();h.getScrollable().un("scroll",this.onViewScroll,this);if(this.showTooltip){this.getTipInstance().hide()}h.el.select("[id^=calendar-resizer-placeholder]").remove();v.resizeContext={resourceRecord:C.resourceRecord,eventRecord:u,start:B,end:A,finalize:function(){v.finalize.apply(v,arguments)}};if(D&&typeof D!=="boolean"){D=D.valid}if(B&&A&&(A-B>0)&&((B-z!==0)||(A-e!==0))&&D!==false){t=h.fireEvent("beforeeventresizefinalize",v,v.resizeContext,x)!==false;r=true}else{h.repaintEventsForResource(w)}if(t){v.finalize(r)}},finalize:function(g){var f=this.schedulerView;var h=this.resizeContext;var i=false;var j=function(){i=true};f.getEventStore().on("update",j);this.resizer.target.destroy();if(Ext.isIE){document.body.focus()}if(g){if(this.resizer.isStart){h.eventRecord.setStartDate(h.start,false,f.getEventStore().skipWeekendsDuringDragDrop)}else{h.eventRecord.setEndDate(h.end,false,f.getEventStore().skipWeekendsDuringDragDrop)}if(!i){f.repaintEventsForResource(h.resourceRecord)}}else{f.repaintEventsForResource(h.resourceRecord)}this.resizer.destroy();delete this.resizer;f.getEventStore().un("update",j);f.fireEvent("eventresizeend",f,h.eventRecord);this.resizeContext=null},cleanUp:function(){if(this.tipInstance){this.tipInstance.destroy()}}});Ext.define("Sch.plugin.Zones",{extend:Sch.feature.AbstractTimeSpan,alias:"plugin.scheduler_zones",innerTpl:null,cls:"sch-zone",side:null,init:function(d){if(typeof this.innerTpl==="string"){this.innerTpl=new Ext.XTemplate(this.innerTpl)}this.side=d.rtl?"right":"left";var c=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for="."><div id="{id}" class="{$cls}" style="'+this.side+':{left}px;top:{top}px;height:{height}px;width:{width}px;{style}">'+(c?"{[this.renderInner(values)]}":"")+"</div></tpl>",{renderInner:function(a){return c.apply(a)}})}if(typeof this.innerHeaderTpl==="string"){this.innerHeaderTpl=new Ext.XTemplate(this.innerHeaderTpl)}this.callParent(arguments)},getElementData:function(E,I,w,G){var F=this.schedulerView,l=[];var J=F.getTimeSpanRegion(E,I,this.expandToFitView);var K,C,L,D,A,H;w=w||this.store.getRange();for(var x=0,y=w.length;x<y;x++){K=w[x];C=K.getStartDate();L=K.getEndDate();H=this.getTemplateData(K);if(C&&L&&Sch.util.Date.intersectSpans(C,L,E,I)){D=Ext.apply({},H);D.id=this.getElementId(K);D.$cls=this.getElementCls(K,H);var B=F.getMode();if(B==="calendar"){var v=F.getTimeSpanRegion(C,L);D.left=v.left;D.top=v.top;D.height=v.bottom-v.top;D.width=v.right-v.left}else{var i=F.getCoordinateFromDate(Sch.util.Date.max(C,E));var z=F.getCoordinateFromDate(Sch.util.Date.min(L,I));if(B==="horizontal"){D.left=i;D.top=J.top;D.width=G?0:z-i;D.height=J.bottom-J.top;D.style=G?("border-left-width:"+(z-i)+"px"):""}else{D.left=J.left;D.top=i;D.height=G?0:z-i;D.width=J.right-J.left;D.style=G?("border-top-width:"+(z-i)+"px"):""}}l.push(D)}}return l},getHeaderElementId:function(c,d){return this.callParent([c])+(d?"-start":"-end")},getHeaderElementCls:function(e,g,f){var h=e.clsField||this.clsField;if(!g){g=this.getTemplateData(e)}return"sch-header-indicator sch-header-indicator-"+(f?"start ":"end ")+this.uniqueCls+" "+(g[h]||"")},getZoneHeaderElementData:function(q,k,m,r){var p=r?m.getStartDate():m.getEndDate(),n=null,l,j,o;if(p&&Sch.util.Date.betweenLesser(p,q,k)){l=this.getHeaderElementPosition(p);j=this.schedulerView.isHorizontal();o=this.getTemplateData(m);n=Ext.apply({id:this.getHeaderElementId(m,r),cls:this.getHeaderElementCls(m,o,r),isStart:r,side:j?this.side:"top",position:l},o)}return n},getHeaderElementData:function(q){var r=this.timeAxis.getStart(),k=this.timeAxis.getEnd(),n=[],l,o,i;q=q||this.store.getRange();for(var m=0,p=q.length;m<p;m++){l=q[m];o=this.getZoneHeaderElementData(r,k,l,true);if(o){n.push(o)}i=this.getZoneHeaderElementData(r,k,l,false);if(i){n.push(i)}}return n},updateZoneHeaderElement:function(d,c){d.dom.className=c.cls;if(this.schedulerView.isHorizontal()){this.setElementX(d,c.position)}else{d.setTop(c.position)}},updateHeaderElement:function(n){var i=this.timeAxis.getStart(),j=this.timeAxis.getEnd(),k=Ext.get(this.getHeaderElementId(n,true)),l=Ext.get(this.getHeaderElementId(n,false)),m=this.getZoneHeaderElementData(i,j,n,true),h=this.getZoneHeaderElementData(i,j,n,false);if(!(k&&h)||!(l&&h)){Ext.destroy(k,l);this.renderHeaderElementsInternal([n])}else{if(k){if(!m){Ext.destroy(k)}else{this.updateZoneHeaderElement(k,m)}}if(l){if(!h){Ext.destroy(l)}else{this.updateZoneHeaderElement(l,h)}}}}});Ext.define("Sch.plugin.ResourceZones",{extend:Sch.plugin.Zones,alias:"plugin.scheduler_resourcezones",innerTpl:null,store:null,cls:"sch-resourcezone",init:function(d){this.store=Ext.StoreManager.lookup(this.store);this.uniqueCls=this.uniqueCls||("sch-timespangroup-"+Ext.id());this.scheduler=d;d.registerRenderer(this.renderer,this);if(typeof this.innerTpl==="string"){this.innerTpl=new Ext.XTemplate(this.innerTpl)}var c=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for="."><div id="'+this.uniqueCls+'-{id}" class="'+this.cls+" "+this.uniqueCls+' {Cls}" style="'+(d.rtl?"right":"left")+':{start}px;width:{width}px;top:{start}px;height:{width}px;{style}">'+(c?"{[this.renderInner(values)]}":("{"+this.store.getModel().prototype.nameField+"}"))+"</div></tpl>",{renderInner:function(a){return c.apply(a)}})}this.storeListeners={load:this.fullRefresh,datachanged:this.fullRefresh,clear:this.fullRefresh,add:this.fullRefresh,remove:this.fullRefresh,update:this.onModelUpdate,addrecords:this.fullRefresh,removerecords:this.fullRefresh,updaterecord:this.onModelUpdate,scope:this};this.store.on(this.storeListeners)},destroy:function(){this.store.un(this.storeListeners);this.callParent(arguments)},fullRefresh:function(){this.scheduler.getSchedulingView().refreshView()},renderer:function(h,e,f,g){if(this.scheduler.getOrientation()==="horizontal"||g===0){return this.renderZones(f)}return""},renderZones:function(z){var B=this.store,w=this.scheduler,u=w.timeAxis.getStart(),q=w.timeAxis.getEnd(),x=[],s=z.getEvents(B),i,A;for(var y=0,t=s.length;y<t;y++){var v=s[y];i=v.getStartDate();A=v.getEndDate();if(i&&A&&Sch.util.Date.intersectSpans(i,A,u,q)){var r=w.getSchedulingView()[w.getOrientation()].getEventRenderData(v);var C,D;if(w.getMode()==="horizontal"){C=w.rtl?r.right:r.left;D=r.width}else{C=r.top;D=r.height}x[x.length]=Ext.apply({id:v.internalId,start:C,width:D,Cls:v.getCls()},v.data)}}return this.template.apply(x)},onModelUpdate:function(n,o){var t=document.getElementById(this.uniqueCls+"-"+o.internalId);if(t){var r=this.scheduler,q=r.timeAxis.getStart(),m=r.timeAxis.getEnd();var u=Sch.util.Date.max(q,o.getStartDate()),s=Sch.util.Date.min(m,o.getEndDate()),l=o.getCls();var p=r.getSchedulingView().getCoordinateFromDate(u);var v=r.getSchedulingView().getCoordinateFromDate(s)-p;t.className=this.cls+" "+this.uniqueCls+" "+(l||"");t.style.left=p+"px";t.style.top=p+"px";t.style.height=v+"px";t.style.width=v+"px"}}});Ext.define("Sch.mixin.AbstractSchedulerPanel",{eventBarIconClsField:"",enableEventDragDrop:true,resourceColumnClass:"Sch.column.Resource",resourceColumnWidth:null,calendarColumnWidth:null,allowOverlap:true,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:false,eventRenderer:null,eventRendererScope:null,eventStore:null,resourceStore:null,onEventCreated:function(b){},resourceZones:null,resourceZonesConfig:null,initStores:function(){var b=this.resourceStore||this.store;if(this.crudManager&&!(this.crudManager instanceof Sch.data.CrudManager)){this.crudManager=new Sch.data.CrudManager(this.crudManager)}if(!b){if(this.crudManager){b=this.resourceStore=this.crudManager.getResourceStore()}if(!b){if(this.isTree){b=new Sch.data.ResourceTreeStore({proxy:"memory"})}else{b=new Sch.data.ResourceStore()}}}if(!this.dependencyStore){if(this.crudManager){this.dependencyStore=this.crudManager.getDependencyStore()}}if(!this.eventStore){if(this.crudManager){this.eventStore=this.crudManager.getEventStore()}this.eventStore=this.eventStore||new Sch.data.EventStore()}this.store=Ext.StoreManager.lookup(b);this.resourceStore=this.store;this.setEventStore(this.eventStore);if(!this.eventStore||!this.eventStore.isEventStore){Ext.Error.raise("Your eventStore should be a subclass of Sch.data.EventStore (or consume the EventStore mixin)")}this.resourceStore.eventStore=this.getEventStore()},_initializeSchedulerPanel:function(){this.initStores();if(this.eventBodyTemplate&&typeof this.eventBodyTemplate==="string"){this.eventBodyTemplate=new Ext.XTemplate(this.eventBodyTemplate)}this.on("destroy",function(){this.setResourceStore(null);this.setEventStore(null)})},getResourceStore:function(){return this.resourceStore},setResourceStore:function(g){var j=this.getResourceStore();var l=j===this.store;g=g&&Ext.StoreManager.lookup(g);var k=this.getEventStore();var i=this.getAssignmentStore();this.resourceStore=g;if(k){k.setResourceStore(g)}var h=this.getSchedulingView();h&&h.setResourceStore(g);if(g){this.fireEvent("resourcestorechange",this,g,j);if(l){this.reconfigure(this.resourceStore)}else{this.rendered&&this.getView().relayFn("refreshView")}}},getEventStore:function(){return this.eventStore},setEventStore:function(h){var j=this.getEventStore();h=h&&Ext.StoreManager.lookup(h);if(this.getEventStore()){this.mun(this.getEventStore(),"beforeload",this.applyStartEndParameters,this)}var k=this.getResourceStore();var i=this.getAssignmentStore();var l=this.getDependencyStore();this.eventStore=h;if(k){k.setEventStore(h)}if(i&&h&&!h.getAssignmentStore()){h.setAssignmentStore(i)}if(l&&h&&!h.getDependencyStore()){h.setDependencyStore(l)}var g=this.getSchedulingView();g&&g.setEventStore(h);if(h){this.fireEvent("eventstorechange",this,h,j);if(this.passStartEndParameters){this.mon(h,"beforeload",this.applyStartEndParameters,this)}this.rendered&&this.getView().relayFn("refreshView")}},applyStartEndParameters:function(f,e){var d=f.getProxy();d.setExtraParam(this.startParamName,this.getStart());d.setExtraParam(this.endParamName,this.getEnd())},getAssignmentStore:function(){var c=this,d=c.getEventStore();return d&&d.isStore&&d.getAssignmentStore()||c.assignmentStore},setAssignmentStore:function(d){var c=this.getAssignmentStore();this.getEventStore().setAssignmentStore(d);if(d){this.fireEvent("assignmentstorechange",this,d,c);this.rendered&&this.getView().relayFn("refreshView")}},getDependencyStore:function(){var c=this,d=c.getEventStore();return d&&d.isStore&&d.getDependencyStore()||c.dependencyStore},setDependencyStore:function(d){var c=this.getDependencyStore();this.getEventStore().setDependencyStore(d);if(d){this.fireEvent("dependencystorechange",this,d,c);this.rendered&&this.getView().relayFn("refreshView")}},createResourceColumns:function(b){return Ext.Array.map(this.resourceStore.getRange(),function(a){return{xclass:this.resourceColumnClass,renderer:this.mainRenderer,scope:this,width:b||100,text:a.getName(),model:a}},this)}});Ext.define("Sch.template.Event",{extend:Ext.XTemplate,eventPrefix:null,resizeHandles:null,resizeTpl:'<div class="sch-resizable-handle sch-resizable-handle-DIR"></div>',constructor:function(b){Ext.apply(this,b);this.callParent(['<tpl for="."><div unselectable="on" tabindex="-1" id="'+this.eventPrefix+'{id}" style="right:{right}px;left:{left}px;top:{top}px;height:{height}px;width:{width}px;{style}" class="sch-event '+Ext.baseCSSPrefix+'unselectable {internalCls} {cls}">'+((this.resizeHandles==="start"||this.resizeHandles==="both")?this.resizeTpl.replace(/DIR/,"start"):"")+'<div unselectable="on" class="sch-event-inner {iconCls}">{body}</div>'+((this.resizeHandles==="end"||this.resizeHandles==="both")?this.resizeTpl.replace(/DIR/,"end"):"")+"</div></tpl>"])}});Ext.define("Sch.view.Vertical",{view:null,constructor:function(b){Ext.apply(this,b)},translateToScheduleCoordinate:function(c){var d=this.view;return c-d.getEl().getY()+d.getScroll().top},translateToPageCoordinate:function(g){var e=this.view;var h=e.getEl(),f=e.getScroll();return g+h.getY()-f.top},getDateFromXY:function(h,e,f){var g=h[1];if(!f){g=this.translateToScheduleCoordinate(g)}return this.view.timeAxisViewModel.getDateFromPosition(g,e)},getEventRenderData:function(v,u){var o=Math,p=v.getStartDate(),q=v.getEndDate(),n=this.view,r=n.timeAxis.getStart(),m=n.timeAxis.getEnd(),s=o.floor(n.getCoordinateFromDate(Sch.util.Date.max(p,r))),l=o.floor(n.getCoordinateFromDate(Sch.util.Date.min(q,m))),t={event:v};t.top=o.max(0,o.min(s,l)-n.eventBorderWidth);t.height=o.max(1,o.abs(s-l));t.start=p;t.end=q;t.startsOutsideView=p<r;t.endsOutsideView=q>m;return t},getScheduleRegion:function(s,q){var o=this.view,p=s?Ext.fly(o.getScheduleCell(o.getNodes()[0],o.getResourceStore().indexOf(s))).getRegion():o.getTableRegion(),r=o.timeAxis.getStart(),l=o.timeAxis.getEnd(),v=o.getDateConstraints(s,q)||{start:r,end:l},t=this.translateToPageCoordinate(o.getCoordinateFromDate(Sch.util.Date.max(r,v.start))),m=this.translateToPageCoordinate(o.getCoordinateFromDate(Sch.util.Date.min(l,v.end))),u=p.left+o.barMargin,n=(s?(p.left+this.getResourceColumnWidth(s)):p.right)-o.barMargin;return new Ext.util.Region(Math.min(t,m),n,Math.max(t,m),u)},getResourceColumnWidth:function(b){return this.view.timeAxisViewModel.resourceColumnWidth},getResourceColumnLayoutAvailableWidth:function(c){var d=this;return d.getResourceColumnWidth(c)-(2*d.view.barMargin)-d.view.cellBorderWidth},getResourceRegion:function(s,y,t){var q=this.view,v=q.getResourceStore().indexOf(s)*this.getResourceColumnWidth(s),r=q.timeAxis.getStart(),n=q.timeAxis.getEnd(),z=y?Sch.util.Date.max(r,y):r,w=t?Sch.util.Date.min(n,t):n,u=Math.max(0,q.getCoordinateFromDate(z)-q.cellTopBorderWidth),o=q.getCoordinateFromDate(w)-q.cellTopBorderWidth,x=v+q.cellBorderWidth,p=v+this.getResourceColumnWidth(s)-q.cellBorderWidth;return new Ext.util.Region(Math.min(u,o),p,Math.max(u,o),x)},columnRenderer:function(A,i,v,t,l){var s=this.view;var B="";if(t===0){var F=Sch.util.Date,w=s.timeAxis,u,D,x,z;u=[];D=s.getEventStore().getEventsForResource(v);for(x=0,z=D.length;x<z;x++){var E=D[x],C=E.getStartDate(),y=E.getEndDate();if(C&&y&&w.timeSpanInAxis(C,y)){u.push(s.generateTplData(E,v,l))}}s.eventLayout.vertical.applyLayout(u,this.getResourceColumnLayoutAvailableWidth(v));B="&#160;"+s.eventTpl.apply(u)}if(l%2===1){i.tdCls=(i.tdCls||"")+" "+s.altColCls;i.cellCls=(i.cellCls||"")+" "+s.altColCls}return B},resolveResource:function(i){var j=this,g=j.view,k,l,h;k=Ext.fly(i).is(g.eventSelector)&&i||Ext.fly(i).up(g.eventSelector,null,true);if(k){h=g.getResourceRecordFromDomId(k.id)}else{i=Ext.fly(i).is(g.timeCellSelector)?i:Ext.fly(i).up(g.timeCellSelector,null,true);l=-1;if(i&&Ext.isIE8m){i=i.previousSibling;while(i){if(i.nodeType===1){l++}i=i.previousSibling}}else{if(i){l=Ext.Array.indexOf(Array.prototype.slice.call(i.parentNode.children),i)}}h=l>=0&&g.getResourceStore().getAt(l)||null}return h},onEventUpdate:function(m,x){var p=this;var r=x.previous||{};var o=p.view;var s=o.timeAxis;var w=x.getStartDate();var q=x.getEndDate();var v=r.StartDate||w;var t=r.EndDate||q;var n=v&&t&&s.timeSpanInAxis(v,t);var u;if(x.resourceIdField in r&&n){u=m.getResourceStore().getById(r[x.resourceIdField]);u&&p.relayoutRenderedEvents(u)}if((w&&q&&s.timeSpanInAxis(w,q))||n){p.renderSingle(x);Ext.Array.each(x.getResources(),function(a){p.relayoutRenderedEvents(a);o.getEventSelectionModel().isSelected(x)&&o.onEventBarSelect(x,true)})}},onEventAdd:function(n,k){var l=this,h=l.view,m,i,j;if(k.length===1){m=k[0];i=m.getStartDate();j=m.getEndDate();if(i&&j&&h.timeAxis.timeSpanInAxis(i,j)){l.renderSingle(m);Ext.Array.each(n.getResourcesForEvent(m),function(a){l.relayoutRenderedEvents(a)})}}else{h.repaintAllEvents()}},onEventRemove:function(i,l){var n=this,m=n.view,t,r,p,q,o,s;for(s=false,q=0,o=l.length;!s&&q<o;q++){t=l[q];r=t.getStartDate();p=t.getEndDate();s=r&&p&&m.timeAxis.timeSpanInAxis(r,p);s&&m.repaintAllEvents()}},relayoutRenderedEvents:function(g){var h=[],f=this.view,e=f.getEventStore().getEventsForResource(g);Ext.Array.each(e,function(a){var b=f.getElementsFromEventRecord(a,g);b.length&&h.push({start:a.getStartDate(),end:a.getEndDate(),event:a,node:b[0]})});f.eventLayout.vertical.applyLayout(h,this.getResourceColumnLayoutAvailableWidth(g));Ext.Array.each(h,function(a){a.node.setStyle({left:a.left+"px",width:a.width+"px"});f.fireEvent("eventrepaint",f,a.event,a.node)})},renderSingle:function(k){var l=this,g=l.view,h=k.getStartDate(),i=k.getEndDate(),j;Ext.Array.each(g.getElementsFromEventRecord(k),function(a){a.destroy()});if(h&&i&&g.timeAxis.timeSpanInAxis(h,i)){Ext.Array.each(k.getResources(),function(a){var b=g.getResourceStore().indexOf(a),d=Ext.fly(g.getScheduleCell(0,b)),c;if(d){c=g.generateTplData(k,a,b);g.eventTpl.append(d.first(),[c])}})}},getTimeSpanRegion:function(h,j){var m=this.view,i=m.getCoordinateFromDate(h),k=j?m.getCoordinateFromDate(j):i,n=m.getTableRegion(),l=n?n.right-n.left:m.getEl().dom.clientWidth;return new Ext.util.Region(Math.min(i,k),l,Math.max(i,k),0)},getStartEndDatesFromRegion:function(i,j,f){var g=this.view.getDateFromCoordinate(i.top,j),h=this.view.getDateFromCoordinate(i.bottom,j);if(g&&h){return{start:Sch.util.Date.min(g,h),end:Sch.util.Date.max(g,h)}}else{return null}},setColumnWidth:function(f,d){var e=this.view;e.resourceColumnWidth=f;e.getTimeAxisViewModel().setViewColumnWidth(f,d)},getVisibleDateRange:function(){var j=this.view;if(!j.rendered){return null}var l=j.getScroll(),g=j.getHeight(),k=j.getTableRegion(),i=j.timeAxis.getEnd();if(k.bottom-k.top<g){var h=j.timeAxis.getStart();return{startDate:h,endDate:i}}return{startDate:j.getDateFromCoordinate(l.top,null,true),endDate:j.getDateFromCoordinate(l.top+g,null,true)||i}},getItemBox:function(d){var c=this;return Ext.Array.map(d.getResources(),function(a){return c.getResourceEventBox(d,a)})},getResourceEventBox:function(x,z){var C=Sch.util.Date,y=this,r=null,u=y.view.timeAxis.getStart(),w=y.view.timeAxis.getEnd(),A=x.getStartDate(),t=x.getEndDate(),D,E,s,F,B,G,v,H;if(A&&t&&C.intersectSpans(A,t,u,w)){if(y.view.managedEventSizing){D=y.view.eventLayout.vertical;E=Ext.Array.map(z.getEvents(),y.getEventRenderData,y);D.applyLayout(E,y.getResourceColumnLayoutAvailableWidth(z));s=Ext.Array.findBy(E,function(a){return a.event==x});if(s){F=y.view.getResourceStore().indexOf(z)*y.getResourceColumnWidth(z);r={rendered:true,start:s.left+F,end:s.left+s.width+F,top:s.top,bottom:s.top+s.height}}}else{B=y.view.getElementsFromEventRecord(x,x!==z&&z);if(B.length){G=B[0];v=G.getOffsetsTo(y.view.getEl()),H=G.getBox();r={rendered:true,start:v[0],end:v[0]+H.width,top:v[1],bottom:v[1]+H.height}}}if(r){r=y.adjustItemBox(x,r)}}return r},adjustItemBox:function(d,c){return c},getConnectorStartSide:function(b){return"top"},getConnectorEndSide:function(b){return"bottom"}});Ext.define("Sch.mixin.AbstractSchedulerView",{_cmpCls:"sch-schedulerview",scheduledEventName:"event",eventTemplateClass:"Sch.template.Event",eventTpl:null,barMargin:0,constrainDragToResource:false,allowOverlap:null,readOnly:null,altColCls:"sch-col-alt",dynamicRowHeight:true,managedEventSizing:true,eventAnimations:true,horizontalLayoutCls:"Sch.eventlayout.Horizontal",horizontalEventSorterFn:null,verticalLayoutCls:"Sch.eventlayout.Vertical",verticalEventSorterFn:null,eventCls:"sch-event",verticalViewClass:"Sch.view.Vertical",eventStore:null,resourceStore:null,eventLayout:null,_initializeSchedulerView:function(){var d=Ext.ClassManager.get(this.horizontalLayoutCls);var c=Ext.ClassManager.get(this.verticalLayoutCls);this.eventSelector="."+this.eventCls;this.eventLayout={};this.eventTpl=this.eventTpl||Ext.create(this.eventTemplateClass,{eventPrefix:this.eventPrefix,resizeHandles:this.eventResizeHandles});if(d){this.eventLayout.horizontal=new d(Ext.apply({timeAxisViewModel:this.timeAxisViewModel},{bandIndexToPxConvertFn:this.horizontal.layoutEventVertically,bandIndexToPxConvertScope:this.horizontal},this.horizontalEventSorterFn?{sortEvents:this.horizontalEventSorterFn}:{}))}if(c){this.eventLayout.vertical=new c(Ext.apply({},{view:this},this.verticalEventSorterFn?{sortEvents:this.verticalEventSorterFn}:{}))}this.store=this.store||this.resourceStore;this.resourceStore=this.resourceStore||this.store},generateTplData:function(n,o,p){var l=this[this.mode].getEventRenderData(n,o,p),k=n.getStartDate(),i=n.getEndDate(),j=n.getCls()||"";j+=" sch-event-resizable-"+n.getResizable();if(n.dirty){j+=" sch-dirty "}if(l.endsOutsideView){j+=" sch-event-endsoutside "}if(l.startsOutsideView){j+=" sch-event-startsoutside "}if(this.eventBarIconClsField){j+=" sch-event-withicon "}if(n.isDraggable()===false){j+=" sch-event-fixed "}if(i-k===0){j+=" sch-event-milestone "}if(this.getEventSelectionModel().isSelected(n)){j+=" "+this.selectedEventCls+" "}l.id=n.internalId+"-"+o.internalId+(this.isCalendar()?("-"+p):"-x");l.internalCls=j;l.start=k;l.end=i;l.iconCls=n.data[this.eventBarIconClsField]||(n.getIconCls&&n.getIconCls())||"";l.event=n;if(this.eventRenderer){var m=this.eventRenderer.call(this.eventRendererScope||this,n,o,l,p);if(this.eventBodyTemplate){l.body=this.eventBodyTemplate.apply(m)}else{l.body=m}}else{if(this.eventBodyTemplate){l.body=this.eventBodyTemplate.apply(n.data)}else{if(this.eventBarTextField){l.body=n.data[this.eventBarTextField]||""}}}return l},resolveResource:function(c){var d=this;return d[d.mode].resolveResource(c)},getResourceRegion:function(d,e,f){return this[this.mode].getResourceRegion(d,e,f)},resolveEventRecord:function(b){b=b.dom?b.dom:b;if(!(Ext.fly(b).is(this.eventSelector))){b=Ext.fly(b).up(this.eventSelector)}return b&&this.getEventRecordFromDomId(b.id)},resolveEventRecordFromResourceRow:function(g){var j=this,h=j.getEventSelectionModel(),i,f;g=g.dom?g.dom:g;i=j.getRecord(g);return h.getFirstSelectedEventForResource(i)},resolveAssignmentRecord:function(h){var l=this,j=l.getEventStore().getAssignmentStore(),i=null,g,k;if(j){g=l.getEventRecordFromDomId(h.id);k=l.getResourceRecordFromDomId(h.id);if(g&&k){i=j.getAssignmentForEventAndResource(g,k)}}return i},getEventRecordFromDomId:function(b){b=this.getEventIdFromDomNodeId(b);return this.getEventStore().getModelByInternalId(b)},getResourceRecordFromDomId:function(b){b=this.getResourceIdFromDomNodeId(b);return this.getResourceStore().getByInternalId(b)},isDateRangeAvailable:function(g,f,e,h){return this.getEventStore().isDateRangeAvailable(g,f,e,h)},getEventsInView:function(){var c=this.timeAxis.getStart(),d=this.timeAxis.getEnd();return this.getEventStore().getEventsInTimeSpan(c,d)},getEventNodes:function(){return this.getEl().select(this.eventSelector)},highlightEvents:function(e){var d=this;var f=[];Ext.Array.each([].concat(e),function(a){f.push.apply(f,d.getElementsFromEventRecord(a,null,null,true))});Ext.Array.each([].concat(f),function(a){Ext.fly(a).addCls("sch-event-highlighted")})},highlightEventsBy:function(f,d){var e=this.getEventsInView();this.highlightEvents(e.filterBy(f,d).getRange())},clearHighlightedEvents:function(c,d){this.getEl().select(".sch-event-highlighted").removeCls("sch-event-highlighted")},onEventCreated:function(b){},getEventStore:function(){return this.eventStore},registerEventEditor:function(b){this.eventEditor=b},getEventEditor:function(){return this.eventEditor},onEventUpdate:function(d,f,e){this[this.mode].onEventUpdate(d,f,e)},onEventAdd:function(d,c){if(!Ext.isArray(c)){c=[c]}this[this.mode].onEventAdd(d,c)},onAssignmentAdd:function(d,e){var f=this;Ext.Array.each(e,function(a){var b=a.getResource();b&&f.repaintEventsForResource(b)})},onAssignmentUpdate:function(m,j){var k=this,i=j.previous&&j.previous[j.resourceIdField],l=j.getResourceId(),h,n;if(i){h=k.getResourceStore().getModelById(i);k.repaintEventsForResource(h)}if(l){n=k.getResourceStore().getModelById(l);k.repaintEventsForResource(n)}},onAssignmentRemove:function(d,e){var f=this;Ext.Array.each(e,function(b){var a=b.getResourceId();var c=a&&f.getResourceStore().getModelById(a);c&&f.repaintEventsForResource(c)})},onEventRemove:function(d,c){this[this.mode].onEventRemove(d,c)},setEventStore:function(o,i){var m=this;var k=m.getEventStore();var j={scope:m,refresh:m.onEventDataRefresh,addrecords:m.onEventAdd,updaterecord:m.onEventUpdate,removerecords:m.onEventRemove,add:m.onEventAdd,update:m.onEventUpdate,remove:m.onEventRemove,nodeinsert:m.onEventAdd,nodeappend:m.onEventAdd};var p={scope:m,refresh:m.onEventDataRefresh,load:m.onEventDataRefresh,update:m.onAssignmentUpdate,add:m.onAssignmentAdd,remove:m.onAssignmentRemove};if(!Ext.versions.touch){j.clear=m.onEventDataRefresh}if(!i&&m.eventStore){m.eventStore.setResourceStore(null);if(o!==m.eventStore&&m.eventStore.autoDestroy){m.eventStore.destroy()}else{if(m.mun){m.mun(m.eventStore,j);var n=m.eventStore.getAssignmentStore();if(n){m.mun(n,p)}}else{m.eventStore.un(j)}}if(!o){m.eventStore=null}}if(o){o=Ext.data.StoreManager.lookup(o);if(m.mon){m.mon(o,j)}else{o.on(j)}m.eventStore=o;o.setResourceStore(m.getResourceStore());var l=o.getAssignmentStore();if(l){m.mon(l,p)}}if(o&&!i){this.getTimeAxisViewModel().setEventStore(o);this.getEventSelectionModel().bindStore(o);this.fireEvent("eventstorechange",this,o,k);m.refreshView()}},onEventDataRefresh:function(){this.refreshKeepingScroll()},onEventBarSelect:function(f){var h=this,e,g;if(f instanceof Sch.model.Assignment){e=f.getEvent();g=f.getResource()}else{e=f;g=null}Ext.Array.each(h.getElementsFromEventRecord(e,g),function(a){a.addCls(h.selectedEventCls)})},onEventBarDeselect:function(f){var h=this,e,g;if(f instanceof Sch.model.Assignment){e=f.getEvent();g=f.getResource()}else{e=f;g=null}e&&Ext.Array.each(h.getElementsFromEventRecord(e,g),function(a){a.removeCls(h.selectedEventCls)})},refresh:function(){throw"Abstract method call"},repaintEventsForResource:function(b){throw"Abstract method call"},repaintAllEvents:function(){this.refreshKeepingScroll()},scrollEventIntoView:function(k,h,i,j,n){var m=this,l=k.getResources();l.length&&m.scrollResourceEventIntoView(l[0],k,null,h,i,j,n)},getResourceStore:function(){return this.resourceStore},setResourceStore:function(d){var c=this.resourceStore;this.resourceStore=d;if(d){this.fireEvent("resourcestorechange",this,d,c)}}});Ext.define("Sch.preset.ViewPreset",{name:null,rowHeight:null,timeColumnWidth:50,timeRowHeight:null,timeAxisColumnWidth:null,displayDateFormat:"G:i",shiftUnit:"HOUR",shiftIncrement:1,defaultSpan:12,timeResolution:null,headerConfig:null,columnLinesFor:"middle",headers:null,mainHeader:0,constructor:function(b){Ext.apply(this,b)},getHeaders:function(){if(this.headers){return this.headers}var b=this.headerConfig;this.mainHeader=b.top?1:0;return this.headers=[].concat(b.top||[],b.middle||[],b.bottom||[])},getMainHeader:function(){return this.getHeaders()[this.mainHeader]},getBottomHeader:function(){var b=this.getHeaders();return b[b.length-1]},clone:function(){var d={};var c=this;Ext.Array.each(["rowHeight","timeColumnWidth","timeRowHeight","timeAxisColumnWidth","displayDateFormat","shiftUnit","shiftIncrement","defaultSpan","timeResolution","headerConfig"],function(a){d[a]=c[a]});return new this.self(Ext.clone(d))}});Ext.define("Sch.preset.Manager",{extend:Ext.util.MixedCollection,mixins:[Sch.mixin.Localizable],singleton:true,defaultPresets:{secondAndMinute:{timeColumnWidth:30,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i:s",shiftIncrement:10,shiftUnit:"MINUTE",defaultSpan:24,timeResolution:{unit:"SECOND",increment:5},headerConfig:{middle:{unit:"SECOND",increment:10,align:"center",dateFormat:"s"},top:{unit:"MINUTE",align:"center",dateFormat:"D, d g:iA"}}},minuteAndHour:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"HOUR",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{middle:{unit:"MINUTE",increment:"30",align:"center",dateFormat:"i"},top:{unit:"HOUR",align:"center",dateFormat:"D, gA/d"}}},hourAndDay:{timeColumnWidth:60,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"DAY",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{middle:{unit:"HOUR",align:"center",dateFormat:"G:i"},top:{unit:"DAY",align:"center",dateFormat:"D d/m"}}},dayAndWeek:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d G:i",shiftUnit:"DAY",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"HOUR",increment:1},headerConfig:{middle:{unit:"DAY",align:"center",dateFormat:"D d M"},top:{unit:"WEEK",align:"center",renderer:function(f,d,e){return Sch.util.Date.getShortNameOfUnit("WEEK")+"."+Ext.Date.format(f,"W M Y")}}}},weekAndDay:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"DAY",increment:1},headerConfig:{bottom:{unit:"DAY",align:"center",increment:1,dateFormat:"d/m"},middle:{unit:"WEEK",dateFormat:"D d M"}}},weekAndMonth:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"WEEK",align:"center",renderer:function(f,d,e){return Ext.Date.format(f,"d M")}},top:{unit:"MONTH",align:"center",dateFormat:"M Y"}}},monthAndYear:{timeColumnWidth:110,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftIncrement:3,shiftUnit:"MONTH",defaultSpan:12,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"MONTH",align:"center",dateFormat:"M Y"},top:{unit:"YEAR",align:"center",dateFormat:"Y"}}},year:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"MONTH",increment:1},headerConfig:{middle:{unit:"QUARTER",align:"center",renderer:function(f,d,e){return Ext.String.format(Sch.util.Date.getShortNameOfUnit("QUARTER").toUpperCase()+"{0}",Math.floor(f.getMonth()/3)+1)}},top:{unit:"YEAR",align:"center",dateFormat:"Y"}}},manyYears:{timeColumnWidth:50,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"YEAR",increment:1},headerConfig:{middle:{unit:"YEAR",align:"center",dateFormat:"Y",increment:5},bottom:{unit:"YEAR",align:"center",dateFormat:"y",increment:1}}},weekAndDayLetter:{timeColumnWidth:20,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"DAY",increment:1},headerConfig:{bottom:{unit:"DAY",align:"center",renderer:function(b){return Ext.Date.dayNames[b.getDay()].substring(0,1)}},middle:{unit:"WEEK",dateFormat:"D d M Y"}}},weekDateAndMonth:{timeColumnWidth:30,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"WEEK",align:"center",dateFormat:"d"},top:{unit:"MONTH",dateFormat:"Y F"}}},day:{timeRowHeight:40,calendarColumnWidth:200,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"DAY",defaultSpan:1,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{bottom:{unit:"HOUR",align:"center",renderer:function(b){return Ext.String.format('<div class="sch-calendarcolumn-ct"><span class="sch-calendarcolumn-hours">{0}</span><span class="sch-calendarcolumn-minutes">{1}</span></div>',Ext.Date.format(b,"H"),Ext.Date.format(b,"i"))}},middle:{unit:"DAY",align:"center",dateFormat:"D d/m",splitUnit:"DAY"}}},week:{timeRowHeight:40,calendarColumnWidth:164,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"WEEK",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{bottom:{unit:"HOUR",align:"center",dateFormat:"H:i",renderer:function(b){return Ext.String.format('<div class="sch-calendarcolumn-ct"><span class="sch-calendarcolumn-hours">{0}</span><span class="sch-calendarcolumn-minutes">{1}</span></div>',Ext.Date.format(b,"H"),Ext.Date.format(b,"i"))}},middle:{unit:"WEEK",align:"center",dateFormat:"D d",splitUnit:"DAY"}}},month:{timeColumnWidth:60,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"MONTH",defaultSpan:4,timeResolution:{unit:"HOUR",increment:12},headerConfig:{bottom:{unit:"DAY",align:"center",dateFormat:"D",splitUnit:"WEEK"},middle:{unit:"WEEK",align:"center",dateFormat:"D d/m"},top:{unit:"MONTH",align:"center",renderer:function(f,d,e){return Ext.Date.format(f,"d/m")+" - "+Ext.Date.format(d,"d/m, Y")},splitUnit:"WEEK"}}}},constructor:function(){this.callParent(arguments);this.registerDefaults()},onLocalized:function(){var b=this;this.eachKey(function(f,e){if(b.l10n[f]){var a=b.L(f);a.displayDateFormat&&(e.displayDateFormat=a.displayDateFormat);a.middleDateFormat&&(e.headerConfig.middle.dateFormat=a.middleDateFormat);a.topDateFormat&&(e.headerConfig.top.dateFormat=a.topDateFormat);a.bottomDateFormat&&(e.headerConfig.bottom.dateFormat=a.bottomDateFormat)}})},registerPreset:function(h,i){if(i){var n=i.headerConfig;var k=Sch.util.Date;for(var j in n){if(n.hasOwnProperty(j)){if(k[n[j].unit]){n[j].unit=k[n[j].unit.toUpperCase()]}if(k[n[j].splitUnit]){n[j].splitUnit=k[n[j].splitUnit.toUpperCase()]}}}if(!i.timeColumnWidth){i.timeColumnWidth=50}if(!i.rowHeight){i.rowHeight=24}var m=i.timeResolution;if(m&&k[m.unit]){m.unit=k[m.unit.toUpperCase()]}var l=i.shiftUnit;if(l&&k[l]){i.shiftUnit=k[l.toUpperCase()]}}if(this.isValidPreset(i)){if(this.containsKey(h)){this.removeAtKey(h)}i.name=h;this.add(h,new Sch.preset.ViewPreset(i))}else{throw"Invalid preset, please check your configuration"}},isValidPreset:function(h){var j=Sch.util.Date,l=true,k=Sch.util.Date.units,g={};for(var i in h.headerConfig){if(h.headerConfig.hasOwnProperty(i)){g[i]=true;l=l&&Ext.Array.indexOf(k,h.headerConfig[i].unit)>=0}}if(!(h.columnLinesFor in g)){h.columnLinesFor="middle"}if(h.timeResolution){l=l&&Ext.Array.indexOf(k,h.timeResolution.unit)>=0}if(h.shiftUnit){l=l&&Ext.Array.indexOf(k,h.shiftUnit)>=0}return l},getPreset:function(b){return this.get(b)},deletePreset:function(b){this.removeAtKey(b)},registerDefaults:function(){var d=this,e=this.defaultPresets;for(var f in e){d.registerPreset(f,e[f])}}});Ext.define("Sch.view.model.TimeAxis",{extend:Ext.util.Observable,timeAxis:null,availableWidth:0,tickWidth:100,snapToIncrement:false,forceFit:false,headerConfig:null,headers:null,mainHeader:0,timeAxisColumnWidth:null,resourceColumnWidth:null,calendarColumnWidth:null,timeColumnWidth:null,rowHeightHorizontal:null,rowHeightVertical:null,mode:"horizontal",suppressFit:false,refCount:0,columnConfig:{},viewPreset:null,columnLinesFor:"middle",eventStore:null,originalTickWidth:null,constructor:function(e){var f=this;Ext.apply(this,e);if(this.viewPreset){if(this.viewPreset instanceof Sch.preset.ViewPreset){this.consumeViewPreset(this.viewPreset)}else{var d=Sch.preset.Manager.getPreset(this.viewPreset);d&&this.consumeViewPreset(d)}}f.timeAxis.on("reconfigure",f.onTimeAxisReconfigure,f);this.callParent(arguments)},destroy:function(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this)},onTimeAxisReconfigure:function(d,c){if(!c){this.update()}},reconfigure:function(b){this.headers=null;Ext.apply(this,b);switch(this.mode){case"horizontal":this.setTickWidth(this.timeColumnWidth);break;case"vertical":this.setTickWidth(this.rowHeightVertical);break;case"calendar":this.setTickWidth(this.rowHeightVertical);break}this.fireEvent("reconfigure",this)},getColumnConfig:function(){return this.columnConfig},update:function(k,g){var j=this.timeAxis,l=this.headerConfig;this.availableWidth=Math.max(k||this.availableWidth,0);if(!Ext.isNumber(this.availableWidth)){throw"Invalid available width provided to Sch.view.model.TimeAxis"}if(this.forceFit&&this.availableWidth<=0){return}this.columnConfig={};for(var i in l){if(l[i].cellGenerator){this.columnConfig[i]=l[i].cellGenerator.call(this,j.getStart(),j.getEnd())}else{this.columnConfig[i]=this.createHeaderRow(i,l[i])}}var h=this.calculateTickWidth(this.originalTickWidth);if(!Ext.isNumber(h)||h<=0){throw"Invalid column width calculated in Sch.view.model.TimeAxis"}this.updateTickWidth(h);if(!g){this.fireEvent("update",this)}},createHeaderRow:function(h,k){var l=[],j=this,i=k.align,g=Ext.Date.clearTime(new Date());j.forEachInterval(h,function(a,d,c){var b={align:i,start:a,end:d,headerCls:""};if(k.renderer){b.header=k.renderer.call(k.scope||j,a,d,b,c,j.eventStore)}else{b.header=Ext.Date.format(a,k.dateFormat)}if(k.unit===Sch.util.Date.DAY&&(!k.increment||k.increment===1)){b.headerCls+=" sch-dayheadercell-"+a.getDay();if(Ext.Date.clearTime(a,true)-g===0){b.headerCls+=" sch-dayheadercell-today"}}l.push(b)});return l},getDistanceBetweenDates:function(c,d){return Math.round(this.getPositionFromDate(d,true)-this.getPositionFromDate(c))},getPositionFromDate:function(r,s){if(this.mode==="calendar"){var v=this.rowHeightVertical;var t=this.getHeaders();var u=this.timeAxis.getStart();var p=Sch.util.Date;var n=p.mergeDates(u,r,t[1].unit);var m=p.getDurationInUnit(u,n,t[1].unit,true)*v;var l=Math.round(m);if(l===0&&s){return this.calendarRowsAmount*v}return l}else{var o=-1,q=this.timeAxis.getTickFromDate(r);if(q>=0){o=Math.round(this.tickWidth*(q-this.timeAxis.visibleTickStart))}return o}},getDateFromPosition:function(p,m){if(this.mode==="calendar"){var w=this.rowHeightVertical;var q=Sch.util.Date;var v=this.timeAxis.getStart();var u=this.getHeaders();var o=q.add(v,u[0].splitUnit,Math.floor(p[0]/this.calendarColumnWidth));var r=this.timeAxis.first();var t=(r.get("end")-r.get("start"))/w;var n=q.add(o,q.MILLI,Math.round(p[1]*t));if(m){n=this.timeAxis[m+"Date"](n)}return n}else{var s=p/this.getTickWidth()+this.timeAxis.visibleTickStart,x=this.timeAxis.getCount();if(s<0||s>x){return null}return this.timeAxis.getDateFromTick(s,m)}},getSingleUnitInPixels:function(b){return Sch.util.Date.getUnitToBaseUnitRatio(this.timeAxis.getUnit(),b)*this.tickWidth/this.timeAxis.increment},getSnapPixelAmount:function(){if(this.snapToIncrement){var b=this.timeAxis.getResolution();return(b.increment||1)*this.getSingleUnitInPixels(b.unit)}else{return 1}},getTickWidth:function(){return this.tickWidth},setTickWidth:function(c,d){this.originalTickWidth=c;this.updateTickWidth(c);this.update(null,d)},updateTickWidth:function(b){this.tickWidth=b;switch(this.mode){case"horizontal":this.timeColumnWidth=b;break;case"vertical":this.rowHeightVertical=b;break;case"calendar":this.rowHeightVertical=b;break}},getTotalWidth:function(){return Math.round(this.tickWidth*this.timeAxis.getVisibleTickTimeSpan())},calculateTickWidth:function(t){var n=this.forceFit;var q=this.timeAxis;var v=0,r=q.getUnit(),o=Number.MAX_VALUE,u=Sch.util.Date;if(this.snapToIncrement){var s=q.getResolution();o=u.getUnitToBaseUnitRatio(r,s.unit)*s.increment}else{var p=u.getMeasuringUnit(r);o=Math.min(o,u.getUnitToBaseUnitRatio(r,p))}if(!this.suppressFit){var m=this.mode==="calendar"?q.endTime-q.startTime:q.getVisibleTickTimeSpan(),w=Math[n?"floor":"round"](this.getAvailableWidth()/m);v=(n||t<w)?w:t;if(o>0&&(!n||o<1)){var x=Ext.versions.touch&&n?"ceil":(n?"floor":"round");v=Math.round(Math.max(1,Math[x](o*v))/o)}}else{v=t}return v},getAvailableWidth:function(){return this.availableWidth},setAvailableWidth:function(d){this.availableWidth=Math.max(0,d);var c=this.calculateTickWidth(this.originalTickWidth);if(c!==this.tickWidth){this.update()}},fitToAvailableWidth:function(d){var c=Math.floor(this.availableWidth/this.timeAxis.getVisibleTickTimeSpan());this.setTickWidth(c,d)},setForceFit:function(b){if(b!==this.forceFit){this.forceFit=b;this.update()}},setSnapToIncrement:function(b){if(b!==this.snapToIncrement){this.snapToIncrement=b;this.update()}},getViewRowHeight:function(){var b=this.mode=="horizontal"?this.rowHeightHorizontal:this.rowHeightVertical;if(!b){throw"rowHeight info not available"}return b},setViewRowHeight:function(h,f){var g=this.mode==="horizontal";var e="rowHeight"+Ext.String.capitalize(this.mode);if(this[e]!=h){this[e]=h;if(g){if(!f){this.fireEvent("update",this)}}else{this.setTickWidth(h,f)}}},setViewColumnWidth:function(c,d){switch(this.mode){case"horizontal":this.setTickWidth(c,d);break;case"vertical":this.resourceColumnWidth=c;break;case"calendar":this.calendarColumnWidth=c;break}if(!d){this.fireEvent("columnwidthchange",this,c)}},getHeaders:function(){if(this.headers){return this.headers}var b=this.headerConfig;this.mainHeader=b.top?1:0;return this.headers=[].concat(b.top||[],b.middle||[],b.bottom||[])},getMainHeader:function(){return this.getHeaders()[this.mainHeader]},getBottomHeader:function(){var b=this.getHeaders();return b[b.length-1]},forEachInterval:function(f,g,i){i=i||this;var j=this.headerConfig;if(!j){return}if(f==="top"||(f==="middle"&&j.bottom)){var h=j[f];this.timeAxis.forEachAuxInterval(h.unit,h.increment,g,i)}else{this.timeAxis.each(function(a,b){return g.call(i,a.data.start,a.data.end,b)})}},forEachMainInterval:function(d,c){this.forEachInterval("middle",d,c)},getLowestHeader:function(){return"bottom" in this.headerConfig?"bottom":"middle"},consumeViewPreset:function(d){this.headers=null;var c=this.mode=="horizontal";Ext.apply(this,{headerConfig:d.headerConfig,columnLinesFor:d.columnLinesFor||"middle",rowHeightHorizontal:d.rowHeight,tickWidth:c?d.timeColumnWidth:d.timeRowHeight||d.timeColumnWidth||60,timeColumnWidth:d.timeColumnWidth,rowHeightVertical:d.timeRowHeight||d.timeColumnWidth||60,timeAxisColumnWidth:d.timeAxisColumnWidth,resourceColumnWidth:d.resourceColumnWidth||100});this.originalTickWidth=this.tickWidth},setEventStore:function(b){this.eventStore=b}});Ext.define("Sch.mixin.Zoomable",{zoomLevels:[{width:40,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:80,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:30,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:7,preset:"monthAndYear",resolutionUnit:"DAY"},{width:30,increment:1,resolution:1,preset:"weekDateAndMonth",resolutionUnit:"DAY"},{width:35,increment:1,resolution:1,preset:"weekAndMonth",resolutionUnit:"DAY"},{width:50,increment:1,resolution:1,preset:"weekAndMonth",resolutionUnit:"DAY"},{width:20,increment:1,resolution:1,preset:"weekAndDayLetter"},{width:50,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:100,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:50,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:60,increment:2,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:60,increment:1,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:30,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:15,resolution:5,preset:"minuteAndHour"},{width:130,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:5,resolution:5,preset:"minuteAndHour"},{width:100,increment:5,resolution:5,preset:"minuteAndHour"},{width:50,increment:2,resolution:1,preset:"minuteAndHour"},{width:30,increment:10,resolution:5,preset:"secondAndMinute"},{width:60,increment:10,resolution:5,preset:"secondAndMinute"},{width:130,increment:5,resolution:5,preset:"secondAndMinute"}],minZoomLevel:null,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:false,cachedCenterDate:null,initializeZooming:function(){this.zoomLevels=this.zoomLevels.slice();this.setMinZoomLevel(this.minZoomLevel||0);this.setMaxZoomLevel(this.maxZoomLevel!==null?this.maxZoomLevel:this.zoomLevels.length-1);this.on("viewchange",this.clearCenterDateCache,this)},getZoomLevelUnit:function(b){return Sch.preset.Manager.getPreset(b.preset).getBottomHeader().unit},getMilliSecondsPerPixelForZoomLevel:function(f,e){var d=Sch.util.Date;return Math.round((d.add(new Date(1,0,1),this.getZoomLevelUnit(f),f.increment)-new Date(1,0,1))/(e?f.width:f.actualWidth||f.width))},presetToZoomLevel:function(c){var d=Sch.preset.Manager.getPreset(c);return{preset:c,increment:d.getBottomHeader().increment||1,resolution:d.timeResolution.increment,resolutionUnit:d.timeResolution.unit,width:d.timeColumnWidth}},zoomLevelToPreset:function(f){var d=Sch.preset.Manager.getPreset(f.preset).clone();var e=d.getBottomHeader();e.increment=f.increment;d.timeColumnWidth=f.width;if(f.resolutionUnit||f.resolution){d.timeResolution={unit:f.resolutionUnit||d.timeResolution.unit||e.unit,increment:f.resolution||d.timeResolution.increment||1}}return d},calculateCurrentZoomLevel:function(){var l=this.presetToZoomLevel(this.viewPreset),o=Number.MAX_VALUE,i=this.timeAxisViewModel,m=i.timeColumnWidth;l.width=m;l.increment=i.getBottomHeader().increment||1;for(var p=0,j=this.zoomLevels.length;p<j;p++){var n=this.zoomLevels[p];if(n.preset!==l.preset){continue}var k=Math.abs(n.width-m);if(k<o){o=k;l.actualWidth=n.actualWidth;l.width=n.width}}return l},getCurrentZoomLevelIndex:function(){var i=this.calculateCurrentZoomLevel();var g=this.getMilliSecondsPerPixelForZoomLevel(i);var j=this.zoomLevels;for(var l=0;l<j.length;l++){var k=this.getMilliSecondsPerPixelForZoomLevel(j[l]);if(k==g){return l}if(l===0&&g>k){return -0.5}if(l==j.length-1&&g<k){return j.length-1+0.5}var h=this.getMilliSecondsPerPixelForZoomLevel(j[l+1]);if(k>g&&g>h){return l+0.5}}throw"Can't find current zoom level index"},setMaxZoomLevel:function(b){if(b<0||b>=this.zoomLevels.length){throw new Error("Invalid range for `setMinZoomLevel`")}this.maxZoomLevel=b},setMinZoomLevel:function(b){if(b<0||b>=this.zoomLevels.length){throw new Error("Invalid range for `setMinZoomLevel`")}this.minZoomLevel=b},getViewportCenterDateCached:function(){if(this.cachedCenterDate){return this.cachedCenterDate}return this.cachedCenterDate=this.getViewportCenterDate()},clearCenterDateCache:function(){this.cachedCenterDate=null},zoomToLevel:function(K,u,H){K=Ext.Number.constrain(K,this.minZoomLevel,this.maxZoomLevel);H=H||{};var v=this.calculateCurrentZoomLevel();var J=this.getMilliSecondsPerPixelForZoomLevel(v);var A=this.zoomLevels[K];var L=this.getMilliSecondsPerPixelForZoomLevel(A);if(J==L&&!u){return null}var t=this;t.fireEvent("beforezoomchange",t,K);var z=this.getSchedulingView();var E=z.getOuterEl();var D=this.mode=="vertical";var F=u?new Date((u.start.getTime()+u.end.getTime())/2):this.getViewportCenterDateCached();var y=D?E.getHeight():E.getWidth();var x=Sch.preset.Manager.getPreset(A.preset).clone();var w=x.getBottomHeader();var G=Boolean(u);u=this.calculateOptimalDateRange(F,y,A,u);x[D?"timeRowHeight":"timeColumnWidth"]=H.customWidth||A.width;w.increment=A.increment;this.isZooming=true;this.viewPreset=A.preset;var I=this.timeAxis;x.increment=A.increment;x.timeResolution.unit=Sch.util.Date.getUnitByName(A.resolutionUnit||x.timeResolution.unit||w.unit);x.timeResolution.increment=A.resolution;this.setViewPreset(x,u.start||this.getStart(),u.end||this.getEnd(),false,true);A.actualWidth=this.timeAxisViewModel.getTickWidth();if(G){F=H.centerDate||new Date((I.getStart().getTime()+I.getEnd().getTime())/2)}var B=null,C=null;z.un("scroll",t.clearCenterDateCache,t);z.on("scroll",function(){z.on("scroll",t.clearCenterDateCache,t,{single:true})},z,{single:true});t.cachedCenterDate=F;if(D){C=z.getYFromDate(F,true)-y/2;z.scrollTo(null,C)}else{B=z.getXFromDate(F,true)-y/2;z.headerCt.scrollTo(B);z.scrollTo(B)}t.isZooming=false;t.fireEvent("zoomchange",t,K,B,C);return K},setZoomLevel:function(){this.zoomToLevel.apply(this,arguments)},zoomToSpan:function(y,v){v=v||{};if(v.leftMargin||v.rightMargin){v.adjustStart=0;v.adjustEnd=0}Ext.applyIf(v,{leftMargin:0,rightMargin:0});if(y.start&&y.end){var H=y.start,K=y.end,J=v.adjustStart>=0&&v.adjustEnd>=0;if(J){H=Sch.util.Date.add(H,this.timeAxis.mainUnit,-v.adjustStart);K=Sch.util.Date.add(K,this.timeAxis.mainUnit,v.adjustEnd)}if(H<=K){var N=this.getSchedulingView().getTimeAxisViewModel().getAvailableWidth();var B=Math.floor(this.getCurrentZoomLevelIndex());if(B==-1){B=0}var u=this.zoomLevels;var M=K-H||1,E=this.getMilliSecondsPerPixelForZoomLevel(u[B],true),C=M/E+v.leftMargin+v.rightMargin>N?-1:1,I=B+C;var z,G=null;while(I>=0&&I<=u.length-1){z=u[I];E=this.getMilliSecondsPerPixelForZoomLevel(z,true);var x=M/E+v.leftMargin+v.rightMargin;if(C==-1){if(x<=N){G=I;break}}else{if(x<=N){if(B!==I-C){G=I}}else{break}}I+=C}G=G!==null?G:I-C;z=u[G];var L=Sch.preset.Manager.getPreset(z.preset).getBottomHeader().unit;if(v.leftMargin||v.rightMargin){H=new Date(H.getTime()-E*v.leftMargin);K=new Date(K.getTime()+E*v.rightMargin)}var w=Sch.util.Date.getDurationInUnit(H,K,L,true)/z.increment;if(w===0){return}var F=Math.floor(N/w);var D=new Date((H.getTime()+K.getTime())/2);var A;if(J){A={start:H,end:K}}else{A=this.calculateOptimalDateRange(D,N,z)}return this.zoomToLevel(G,A,{customWidth:F,centerDate:D})}}return null},zoomIn:function(d){d=d||1;var c=this.getCurrentZoomLevelIndex();if(c>=this.zoomLevels.length-1){return null}return this.zoomToLevel(Math.floor(c)+d)},zoomOut:function(d){d=d||1;var c=this.getCurrentZoomLevelIndex();if(c<=0){return null}return this.zoomToLevel(Math.ceil(c)-d)},zoomInFull:function(){return this.zoomToLevel(this.maxZoomLevel)},zoomOutFull:function(){return this.zoomToLevel(this.minZoomLevel)},calculateOptimalDateRange:function(r,m,p,k){if(k){return k}var n=this.timeAxis;if(this.zoomKeepsOriginalTimespan){return{start:n.getStart(),end:n.getEnd()}}var s=Sch.util.Date;var l=this.getZoomLevelUnit(p);var q=Math.ceil(m/p.width*p.increment*this.visibleZoomFactor/2);var t=s.add(r,l,-q);var o=s.add(r,l,q);return{start:n.floorDate(t,false,l,p.increment),end:n.ceilDate(o,false,l,p.increment)}}});Ext.define("Sch.mixin.AbstractTimelinePanel",{mixins:[Sch.mixin.Zoomable],orientation:"horizontal",snapToIncrement:false,readOnly:false,forceFit:false,eventResizeHandles:"both",timeAxis:null,autoAdjustTimeAxis:true,timeAxisViewModel:null,crudManager:null,viewPreset:"weekAndDay",calendarViewPreset:"week",trackHeaderOver:true,startDate:null,endDate:null,startTime:0,endTime:24,columnLines:true,getDateConstraints:Ext.emptyFn,snapRelativeToEventStartDate:false,trackMouseOver:false,readRowHeightFromPreset:true,eventBorderWidth:1,getOrientation:function(){return this.getMode.apply(this,arguments)},getMode:function(){return this.mode},isHorizontal:function(){return this.getMode()==="horizontal"},isVertical:function(){return this.getMode()==="vertical"},isCalendar:function(){return this.getMode()==="calendar"},cellBorderWidth:1,cellTopBorderWidth:1,cellBottomBorderWidth:1,renderers:null,_initializeTimelinePanel:function(){this.mode=this.mode||this.orientation||"horizontal";if(this.mode==="calendar"){this.oldViewPreset=this.viewPreset;this.viewPreset=this.calendarViewPreset}var f=this.viewPreset;if(typeof f==="string"){f=Sch.preset.Manager.getPreset(this.viewPreset)}if(!f){throw"You must define a valid view preset object. See Sch.preset.Manager class for reference"}this.initializeZooming();this.renderers=[];if(this.readRowHeightFromPreset){this.readRowHeightFromPreset=!this.rowHeight}if(!(this.timeAxis instanceof Sch.data.TimeAxis)){this.timeAxis=Ext.create(Ext.applyIf(this.timeAxis||{},{xclass:"Sch.data.TimeAxis",autoAdjust:this.autoAdjustTimeAxis,mode:this.mode==="calendar"?"calendar":"plain"}))}if(!this.timeAxisViewModel||!(this.timeAxisViewModel instanceof Sch.view.model.TimeAxis)){var e=Ext.apply({mode:this.mode,snapToIncrement:this.snapToIncrement,forceFit:this.forceFit,timeAxis:this.timeAxis,eventStore:this.getEventStore(),viewPreset:this.viewPreset},this.timeAxisViewModel||{});this.timeAxisViewModel=new Sch.view.model.TimeAxis(e)}this.timeAxisViewModel.on("update",this.onTimeAxisViewModelUpdate,this);this.timeAxisViewModel.refCount++;this.on("destroy",this.onPanelDestroyed,this);var d;switch(this.mode){case"horizontal":d=["sch-horizontal"];break;case"vertical":d=["sch-vertical","sch-vertical-resource"];break;case"calendar":d=["sch-vertical","sch-calendar"];break}this.addCls([].concat.apply(["sch-timelinepanel"],d))},onTimeAxisViewModelUpdate:function(){var b=this.getSchedulingView();if(b&&b.viewReady){b.refreshKeepingScroll();this.fireEvent("viewchange",this)}},onPanelDestroyed:function(){var b=this.timeAxisViewModel;b.un("update",this.onTimeAxisViewModelUpdate,this);b.refCount--;if(b.refCount<=0){b.destroy()}},getSchedulingView:function(){throw"Abstract method call"},setReadOnly:function(b){this.getSchedulingView().setReadOnly(b)},isReadOnly:function(){return this.getSchedulingView().isReadOnly()},switchViewPreset:function(){this.setViewPreset.apply(this,arguments)},setViewPreset:function(j,r,o,m,q){var n=this.timeAxis;if(this.fireEvent("beforeviewchange",this,j,r,o)!==false){var k=this.getMode()==="horizontal";if(typeof j==="string"){this.viewPreset=j;j=Sch.preset.Manager.getPreset(j)}if(!j){throw"View preset not found"}if(!(m&&n.isConfigured)){var p={weekStartDay:this.weekStartDay!==undefined?this.weekStartDay:(this.L?this.L("weekStartDay"):1),startTime:this.startTime,endTime:this.endTime};if(m){if(n.getCount()===0||r){p.start=r||new Date()}}else{p.start=r||n.getStart()}p.end=o;n.consumeViewPreset(j);n.reconfigure(p,true);this.timeAxisViewModel.reconfigure({viewPreset:this.viewPreset,headerConfig:j.headerConfig,columnLinesFor:j.columnLinesFor||"middle",rowHeightHorizontal:this.readRowHeightFromPreset?j.rowHeight:(this.rowHeight||this.timeAxisViewModel.getViewRowHeight()),tickWidth:k?j.timeColumnWidth:j.timeRowHeight||j.timeColumnWidth||60,timeColumnWidth:j.timeColumnWidth,rowHeightVertical:j.timeRowHeight||j.timeColumnWidth||60,timeAxisColumnWidth:j.timeAxisColumnWidth,resourceColumnWidth:this.resourceColumnWidth||j.resourceColumnWidth||100})}var l=this.getSchedulingView();l.setDisplayDateFormat(j.displayDateFormat);if(this.getMode()==="vertical"){l.setColumnWidth(this.resourceColumnWidth||j.resourceColumnWidth||100,true)}if(!q){if(k){l.scrollHorizontallyTo(0)}else{l.scrollVerticallyTo(0)}}}},getViewPreset:function(){return this.viewPreset},getStart:function(){return this.getStartDate()},getStartDate:function(){return this.timeAxis.getStart()},getEnd:function(){return this.getEndDate()},getEndDate:function(){return this.timeAxis.getEnd()},setTimeColumnWidth:function(c,d){this.timeAxisViewModel.setTickWidth(c,d)},getTimeColumnWidth:function(){return this.timeAxisViewModel.getTickWidth()},getRowHeight:function(){return this.timeAxisViewModel.getViewRowHeight()},shiftNext:function(b){this.suspendLayouts&&this.suspendLayouts();this.timeAxis.shiftNext(b);this.suspendLayouts&&this.resumeLayouts(true)},shiftPrevious:function(b){this.suspendLayouts&&this.suspendLayouts();this.timeAxis.shiftPrevious(b);this.suspendLayouts&&this.resumeLayouts(true)},goToNow:function(){this.setTimeSpan(new Date())},setTimeSpan:function(c,d){if(this.timeAxis){this.timeAxis.setTimeSpan(c,d)}},setStart:function(b){this.setStartDate(b)},setEnd:function(b){this.setEndDate(b)},setStartDate:function(b){this.setTimeSpan(b)},setEndDate:function(b){this.setTimeSpan(null,b)},getTimeAxis:function(){return this.timeAxis},scrollToDate:function(h,e){var f=this.getSchedulingView();var g=f.getCoordinateFromDate(h,true);this.scrollToCoordinate(g,h,e,false)},scrollToDateCentered:function(j,f){var g=this.getSchedulingView();var h=0;if(g.isHorizontal()){h=g.getBox().width/2}else{h=g.getBox().height/2}var i=Math.round(g.getCoordinateFromDate(j,true)-h);this.scrollToCoordinate(i,j,f,true)},scrollToCoordinate:function(j,l,m,n){var h=this.getSchedulingView();var k=this;if(j<0&&!h.isCalendar()){if(this.infiniteScroll){h.shiftToDate(l,n)}else{var i=(this.timeAxis.getEnd()-this.timeAxis.getStart())/2;this.setTimeSpan(new Date(l.getTime()-i),new Date(l.getTime()+i));if(n){k.scrollToDateCentered(l,m)}else{k.scrollToDate(l,m)}}return}if(this.mode==="horizontal"){h.scrollHorizontallyTo(j,m)}else{h.scrollVerticallyTo(j,m)}},getViewportCenterDate:function(){return this.getSchedulingView().getViewportCenterDate()},addCls:function(){throw"Abstract method call"},removeCls:function(){throw"Abstract method call"},registerRenderer:function(c,d){this.renderers.push({fn:c,scope:d})},deregisterRenderer:function(c,d){Ext.each(this.renderers,function(b,a){if(c===b){Ext.Array.removeAt(this.renderers,a);return false}})},getCrudManager:function(){return this.crudManager},setCrudManager:function(b){this.crudManager=b}});Ext.define("Sch.view.Horizontal",{view:null,constructor:function(b){Ext.apply(this,b)},translateToScheduleCoordinate:function(d){var c=this.view;if(c.rtl){return c.getHorizontalTimeAxisColumn().getEl().getRight()-d}return d-c.getEl().getX()+c.getScroll().left},translateToPageCoordinate:function(d){var c=this.view;return d+c.getEl().getX()-c.getScroll().left},getDateFromXY:function(h,e,f){var g=h[0];if(!f){g=this.translateToScheduleCoordinate(g)}return this.view.timeAxisViewModel.getDateFromPosition(g,e)},getEventRenderData:function(t){var o=t.getStartDate(),p=t.getEndDate()||o,m=this.view,r=m.timeAxis.getStart(),l=m.timeAxis.getEnd(),n=Math,q=m.getXFromDate(Sch.util.Date.max(o,r)),k=m.getXFromDate(Sch.util.Date.min(p,l)),s={event:t};if(this.view.rtl){s.right=n.min(q,k)}else{s.left=n.min(q,k)}s.width=n.max(1,n.abs(k-q))-m.eventBorderWidth;if(m.managedEventSizing){s.top=n.max(0,(m.barMargin-((Ext.isIE&&!Ext.isStrict)?0:m.eventBorderWidth-m.cellTopBorderWidth)));s.height=m.timeAxisViewModel.rowHeightHorizontal-(2*m.barMargin)-m.eventBorderWidth}s.start=o;s.end=p;s.startsOutsideView=o<r;s.endsOutsideView=p>l;return s},getScheduleRegion:function(s,q){var n=this.view,o=s?Ext.fly(n.getRowNode(s)).getRegion():n.getTableRegion(),r=n.timeAxis.getStart(),l=n.timeAxis.getEnd(),u=n.getDateConstraints(s,q)||{start:r,end:l},t=this.translateToPageCoordinate(n.getXFromDate(Sch.util.Date.max(r,u.start))),m=this.translateToPageCoordinate(n.getXFromDate(Sch.util.Date.min(l,u.end))),p=o.top+n.barMargin,v=o.bottom-n.barMargin-n.eventBorderWidth;return new Ext.util.Region(p,Math.max(t,m),v,Math.min(t,m))},getResourceRegion:function(u,z,v){var r=this.view,A=r.getRowNode(u),y=Ext.fly(A).getOffsetsTo(r.getEl()),t=r.timeAxis.getStart(),p=r.timeAxis.getEnd(),B=z?Sch.util.Date.max(t,z):t,x=v?Sch.util.Date.min(p,v):p,w=r.getXFromDate(B),q=r.getXFromDate(x),s=y[1]+r.cellTopBorderWidth,D=y[1]+Ext.fly(A).getHeight()-r.cellBottomBorderWidth;if(!Ext.versions.touch){var C=r.getScroll();s+=C.top;D+=C.top}return new Ext.util.Region(s,Math.max(w,q),D,Math.min(w,q))},columnRenderer:function(t,l,q,p,m){var n=this.view;var u=n.getEventStore().filterEventsForResource(q,function(a){return n.timeAxis.isRangeInAxis(a)});if(u.length===0){return}var o=Ext.Array.map(u,function(a){return n.generateTplData(a,q,p)});if(n.dynamicRowHeight){var r=n.eventLayout.horizontal;var s=r.applyLayout(o,q,this.layoutEventVertically,this);var v=(s*n.timeAxisViewModel.rowHeightHorizontal)-((s-1)*n.barMargin);l.rowHeight=v}return n.eventTpl.apply(o)},layoutEventVertically:function(g,e){var f=this.view;var h=g===0?f.barMargin:(g*f.timeAxisViewModel.rowHeightHorizontal-(g-1)*f.barMargin);if(h>=f.cellBottomBorderWidth){h-=f.cellBottomBorderWidth}return h},resolveResource:function(h){var i=this,f=i.view,j,g;j=Ext.fly(h).is(f.eventSelector)&&h||Ext.fly(h).up(f.eventSelector,null,true);if(j){g=f.getResourceRecordFromDomId(j.id)}else{h=f.findRowByChild(h);g=h&&f.getRecordForRowNode(h)||null}return g},getTimeSpanRegion:function(i,k,l){var o=this.view,p=o.getXFromDate(i),n=k?o.getXFromDate(k):p,j,m;m=o.getTableRegion();if(l){j=Math.max(m?m.bottom-m.top:0,o.getEl().dom.clientHeight)}else{j=m?m.bottom-m.top:0}return new Ext.util.Region(0,Math.max(p,n),j,Math.min(p,n))},getStartEndDatesFromRegion:function(j,m,n){var h=this.view;var k=h.rtl;var i=h.getDateFromCoordinate(k?j.right:j.left,m),l=h.getDateFromCoordinate(k?j.left:j.right,m);if(i&&l||n&&(i||l)){return{start:i,end:l}}return null},onEventAdd:function(i,j){var k=this.view,s={},z,y,l,x,v,r,w,t,u;for(r=0,w=j.length;r<w;r++){z=j[r];y=z.getStartDate();l=z.getEndDate();if(y&&l&&k.timeAxis.timeSpanInAxis(y,l)){x=j[r].getResources(k.getEventStore());for(t=0,u=x.length;t<u;t++){v=x[t];s[v.getId()]=v}}}Ext.Object.each(s,function(a,b){k.repaintEventsForResource(b)})},onEventRemove:function(l,h){var k=this,i=k.view,m=i.getEventStore(),j,n;j=Ext.Array.unique(Ext.Array.reduce(h,function(b,a){return b.concat(m.getResourcesForEvent(a))},[]));n=Ext.Array.reduce(h,function(b,a){return b.concat(i.getElementsFromEventRecord(a,null,null,true))},[]);n=new Ext.CompositeElementLite(n);n.fadeOut({callback:function(a){Ext.Array.forEach(j,function(b){if(i&&!i.isDestroyed){i.store.indexOf(b)>=0&&i.repaintEventsForResource(b)}})}})},onEventUpdate:function(s,r){var o=r.previous||{};var m=this.view;var p=m.timeAxis;var v=r.getStartDate();var n=r.getEndDate();var u=o.StartDate||v;var q=o.EndDate||n;var l=u&&q&&p.timeSpanInAxis(u,q);var t;if(r.resourceIdField in o&&l){t=s.getResourceStore().getById(o[r.resourceIdField]);t&&m.repaintEventsForResource(t,true)}if((v&&n&&p.timeSpanInAxis(v,n))||l){Ext.Array.each(r.getResources(),function(a){m.repaintEventsForResource(a,true)})}},setColumnWidth:function(f,d){var e=this.view;e.getTimeAxisViewModel().setViewColumnWidth(f,d)},getVisibleDateRange:function(){var l=this.view;if(!l.getEl()){return null}var m=l.getTableRegion(),n=l.timeAxis.getStart(),j=l.timeAxis.getEnd(),k=l.getWidth();if((m.right-m.left)<k){return{startDate:n,endDate:j}}var h=l.getScroll();var i={startDate:l.getDateFromCoordinate(h.left,null,true),endDate:l.getDateFromCoordinate(h.left+k,null,true)||l.timeAxis.getEnd()};if(!i.endDate){i.endDate=l.timeAxis.getEnd()}return i},getItemBox:function(d){var c=this;return Ext.Array.map(d.getResources(),function(a){return c.getResourceEventBox(d,a)})},isRowVisible:function(e){var h=Ext.isFunction(e.isVisible)&&!e.isVisible();if(!h&&this.view.groupingFeature&&!this.view.groupingFeature.disabled){var f=this.view.resourceStore.getGroups();if(f){var g=f.getByKey(e.get(this.view.resourceStore.groupField));h=g&&!this.view.groupingFeature.isExpanded(g)}}return !h},getResourceEventBox:function(P,O){var M=Sch.util.Date,y=this,J=null,L=y.view.timeAxis.getStart(),N=y.view.timeAxis.getEnd(),B=P.getStartDate(),I=P.getEndDate(),E,G,z,A,K,R,Q,H,D,U,V,T,C,S,F;if(B&&I&&M.intersectSpans(B,I,L,N)&&this.isRowVisible(O)){A=y.view.getRowNode(O);if(A){if(y.view.managedEventSizing){E=y.view.eventLayout.horizontal;G=Ext.Array.map(O.getEvents(),y.getEventRenderData,y);E.applyLayout(G,O);z=Ext.Array.findBy(G,function(a){return a.event==P});if(z){R=Ext.fly(A).getOffsetsTo(y.view.getNodeContainer())[1];J={rendered:true,start:(z.hasOwnProperty("left")?z.left:z.right),end:(z.hasOwnProperty("left")?z.left:z.right)+z.width,top:R+z.top,bottom:R+z.top+z.height}}}else{D=y.view.getElementsFromEventRecord(P,P!==O&&O);if(D.length){U=D[0];V=U.getOffsetsTo(y.view.getEl()),T=U.getBox();J={rendered:true,start:V[0],end:V[0]+T.width,top:V[1],bottom:V[1]+T.height}}}}else{J={rendered:false,start:y.view.getXFromDate(M.max(B,L)),end:y.view.getXFromDate(M.min(I,N))};C=y.view.all.startIndex;F=y.view.getRecord(y.view.getNode(C));Q=y.view.getRowHeight();if(O.isAbove(F)){J.top=-2*Q;J.relPos="before"}else{S=y.view.all.endIndex;J.top=(S-C+1)*Q;J.relPos="after"}J.bottom=J.top+Q}if(J){J=y.adjustItemBox(P,J)}}return J},adjustItemBox:function(d,c){return c},getConnectorStartSide:function(b){return"left"},getConnectorEndSide:function(b){return"right"}});Ext.define("Sch.mixin.AbstractTimelineView",{selectedEventCls:"sch-event-selected",readOnly:false,horizontalViewClass:"Sch.view.Horizontal",timeCellCls:"sch-timetd",timeCellSelector:".sch-timetd",eventBorderWidth:1,timeAxis:null,timeAxisViewModel:null,eventPrefix:null,rowHeight:null,orientation:"horizontal",mode:"horizontal",horizontal:null,vertical:null,panel:null,displayDateFormat:null,el:null,constructor:function(b){if(b&&b.orientation){b.mode=this.mode=b.orientation}this.callParent([b])},_initializeTimelineView:function(){if(this.horizontalViewClass){this.horizontal=Ext.create(this.horizontalViewClass,{view:this})}if(this.verticalViewClass){this.vertical=Ext.create(this.verticalViewClass,{view:this})}if(this.calendarViewClass){this.calendar=Ext.create(this.calendarViewClass,{view:this})}this.eventPrefix=(this.eventPrefix||this.getId())+"-"},getTimeAxisViewModel:function(){return this.timeAxisViewModel},getFormattedDate:function(b){return Ext.Date.format(b,this.getDisplayDateFormat())},getFormattedEndDate:function(f,e){var d=this.getDisplayDateFormat();if(f.getHours()===0&&f.getMinutes()===0&&(!e||!(f.getYear()===e.getYear()&&f.getMonth()===e.getMonth()&&f.getDate()===e.getDate()))&&!Sch.util.Date.hourInfoRe.test(d.replace(Sch.util.Date.stripEscapeRe,""))){f=Sch.util.Date.add(f,Sch.util.Date.DAY,-1)}return Ext.Date.format(f,d)},getDisplayDateFormat:function(){return this.displayDateFormat},setDisplayDateFormat:function(b){this.displayDateFormat=b},fitColumns:function(c){if(this.mode==="horizontal"){this.getTimeAxisViewModel().fitToAvailableWidth(c)}else{var d=Math.floor((this.panel.getWidth()-Ext.getScrollbarSize().width-1)/this.headerCt.getColumnCount());this.setColumnWidth(d,c)}},getElementFromEventRecord:function(e,g){var h=this,f;f=h.getElementsFromEventRecord(e,g);if(f.length===0){f=null}else{if(f.length==1){f=f[0]}else{if(h.mode=="calendar"){f=f[0]}else{Ext.Error.raise("The method getElementFromEventRecord() is deprecated, it can't handle the situation when several DOM elements correspond to a single event record, please use getElementsFromEventRecord() method instead!")}}}return f},getElementsFromEventRecord:function(h,j,l,g){var k=this,i;g=g||false;if(j&&(l!==null&&l!==undefined)){i="[id^="+k.eventPrefix+h.internalId+"-"+j.internalId+"-"+l+"]"}else{if(j){i="[id^="+k.eventPrefix+h.internalId+"-"+j.internalId+"-]"}else{i="[id^="+k.eventPrefix+h.internalId+"-]"}}return k.getEl().query(i,g)},getStartEndDatesFromRegion:function(f,d,e){return this[this.mode].getStartEndDatesFromRegion(f,d,e)},getTimeResolution:function(){return this.timeAxis.getResolution()},setTimeResolution:function(c,d){this.timeAxis.setResolution(c,d);if(this.getTimeAxisViewModel().snapToIncrement){this.refreshKeepingScroll()}},getEventIdFromDomNodeId:function(b){return b.substring(this.eventPrefix.length).split("-")[0]},getResourceIdFromDomNodeId:function(b){return b.substring(this.eventPrefix.length).split("-")[1]},getDateFromDomEvent:function(c,d){return this.getDateFromXY(c.getXY(),d)},getSnapPixelAmount:function(){return this.getTimeAxisViewModel().getSnapPixelAmount()},setSnapEnabled:function(b){this.getTimeAxisViewModel().setSnapToIncrement(b)},setReadOnly:function(b){this.readOnly=b;this[b?"addCls":"removeCls"](this._cmpCls+"-readonly")},isReadOnly:function(){return this.readOnly},setOrientation:function(){this.setMode.apply(this,arguments)},setMode:function(b){this.mode=b;this.timeAxisViewModel.mode=b},getOrientation:function(){return this.getMode.apply(this,arguments)},getMode:function(){return this.mode},isHorizontal:function(){return this.getMode()==="horizontal"},isVertical:function(){return this.getMode()==="vertical"},isCalendar:function(){return this.getMode()==="calendar"},getDateFromXY:function(f,d,e){return this[this.mode].getDateFromXY(f,d,e)},getDateFromCoordinate:function(f,d,e){if(!e){f=this[this.mode].translateToScheduleCoordinate(f)}return this.timeAxisViewModel.getDateFromPosition(f,d)},getDateFromX:function(d,c){return this.getDateFromCoordinate(d,c)},getDateFromY:function(c,d){return this.getDateFromCoordinate(c,d)},getCoordinateFromDate:function(e,d){var f=this.timeAxisViewModel.getPositionFromDate(e);if(d===false){f=this[this.mode].translateToPageCoordinate(f)}return Math.round(f)},getXFromDate:function(d,c){return this.getCoordinateFromDate(d,c)},getYFromDate:function(d,c){return this.getCoordinateFromDate(d,c)},getTimeSpanDistance:function(d,c){return this.timeAxisViewModel.getDistanceBetweenDates(d,c)},getTimeSpanRegion:function(d,c){return this[this.mode].getTimeSpanRegion(d,c)},getScheduleRegion:function(c,d){return this[this.mode].getScheduleRegion(c,d)},getTableRegion:function(){throw"Abstract method call"},getRowNode:function(b){throw"Abstract method call"},getRecordForRowNode:function(b){throw"Abstract method call"},getVisibleDateRange:function(){return this[this.mode].getVisibleDateRange()},setColumnWidth:function(c,d){this[this.mode].setColumnWidth(c,d)},findRowByChild:function(b){throw"Abstract method call"},setBarMargin:function(c,d){this.barMargin=c;if(!d){this.refreshKeepingScroll()}},getRowHeight:function(){return this.timeAxisViewModel.getViewRowHeight()},setRowHeight:function(d,c){this.timeAxisViewModel.setViewRowHeight(d,c)},refreshKeepingScroll:function(){throw"Abstract method call"},scrollVerticallyTo:function(c,d){throw"Abstract method call"},scrollHorizontallyTo:function(d,c){throw"Abstract method call"},getVerticalScroll:function(){throw"Abstract method call"},getHorizontalScroll:function(){throw"Abstract method call"},getEl:Ext.emptyFn,getScroll:function(){throw"Abstract method call"},getOuterEl:function(){return this.getEl()},getRowContainerEl:function(){return this.getEl()},getScheduleCell:function(c,d){return this.getCellByPosition({row:c,column:d})},getScrollEventSource:function(){return this.getEl()},getViewportHeight:function(){return this.getEl().getHeight()},getViewportWidth:function(){return this.getEl().getWidth()},getViewportCenterDate:function(){var d=this.getScroll(),c;if(this.getMode()==="vertical"){c=[0,d.top+this.getViewportHeight()/2]}else{c=[d.left+this.getViewportWidth()/2,0]}return this.getDateFromXY(c,null,true)},getDateConstraints:Ext.emptyFn,getItemBox:function(b){return this[this.mode].getItemBox(b)},getConnectorStartSide:function(b){return this[this.mode].getConnectorStartSide(b)},getConnectorEndSide:function(b){return this[this.mode].getConnectorEndSide(b)}});Ext.apply(Sch,{VERSION:"%VERSION%"});Ext.define("Sch.mixin.FilterableTreeView",{prevBlockRefresh:null,initTreeFiltering:function(){var b=function(){var a=this.store;this.mon(a,"nodestore-datachange-start",this.onFilterChangeStart,this);this.mon(a,"nodestore-datachange-end",this.onFilterChangeEnd,this);if(!a.allowExpandCollapseWhileFiltered){this.mon(a,"filter-clear",this.onFilterCleared,this);this.mon(a,"filter-set",this.onFilterSet,this)}};if(this.rendered){b.call(this)}else{this.on("beforerender",b,this,{single:true})}},onFilterChangeStart:function(){this.prevBlockRefresh=this.blockRefresh;this.blockRefresh=true;Ext.suspendLayouts()},onFilterChangeEnd:function(){Ext.resumeLayouts(true);this.blockRefresh=this.prevBlockRefresh},onFilterCleared:function(){delete this.toggle;var b=this.getEl();if(b){b.removeCls("sch-tree-filtered")}},onFilterSet:function(){this.toggle=function(){};var b=this.getEl();if(b){b.addCls("sch-tree-filtered")}}});Ext.define("Sch.mixin.GridViewCanvas",{extend:Ext.Mixin,mixinConfig:{before:{afterRender:"afterRender"}},secondaryCanvasEl:null,secondaryCanvasCls:"sch-secondary-canvas",secondaryCanvasLayerCls:"sch-secondary-canvas-layer",itemsCanvasEl:null,itemsCanvasCls:"sch-item-canvas",itemsCanvasLayerCls:"sch-item-canvas-layer",isSecondaryCanvasAvailable:function(d){var c=this;return c.rendered&&!c.isDestroyed&&c.getTargetEl()&&(d===undefined||c.secondaryCanvasEl&&c.itemsCanvasEl[d]&&!Ext.isGarbage(c.secondaryCanvasEl[d]))},getSecondaryCanvasEl:function(f,h){var j=this,g=j.secondaryCanvasEl,i=g;if(!g||Ext.isGarbage(g)){i=g=j.secondaryCanvasEl=j.getTargetEl().insertFirst({cls:j.secondaryCanvasCls})}if(arguments.length>0){f=f||0;i=g[f]||Ext.dom.Query.selectNode('[data-sch-secondary-canvas-layer="'+f+'"]',g.dom);if(!i||Ext.isGarbage(i.dom)){i=g.createChild((Ext.isFunction(h)?h():h)||{tag:"div"});i.set({"data-sch-secondary-canvas-layer":f});i.setStyle("zIndex",f);i.addCls(j.secondaryCanvasLayerCls);g[f]=i}}return i},isItemCanvasAvailable:function(d){var c=this;return c.rendered&&!c.isDestroyed&&c.getNodeContainer()&&(d===undefined||c.itemsCanvasEl&&c.itemsCanvasEl[d]&&!Ext.isGarbage(c.itemsCanvasEl[d]))},getItemCanvasEl:function(f,h){var j=this,g=j.itemsCanvasEl,i=g;if(!g||!g.dom||Ext.isGarbage(g.dom)){i=g=j.itemsCanvasEl=Ext.fly(j.getNodeContainer()).insertFirst({cls:j.itemsCanvasCls})}if(arguments.length>0){f=f||0;i=g[f]||Ext.dom.Query.selectNode('[data-sch-secondary-canvas-layer="'+f+'"]',g.dom);if(!i||!i.dom||Ext.isGarbage(i.dom)){i=g.createChild((Ext.isFunction(h)?h():h)||{tag:"div"});i.set({"data-sch-secondary-canvas-layer":f});i.setStyle("zIndex",f);i.addCls(j.itemsCanvasLayerCls);g[f]=i}}return i},afterRender:function(){var c=this.getSecondaryCanvasEl();if(c.getStyle("position").toLowerCase()!=="absolute"){var d=Ext.Msg||window;d.alert("ERROR: The CSS file for the Bryntum component has not been loaded.")}}});Ext.define("Sch.mixin.PartnerTimelinePanel",{extend:Ext.Mixin,setupPartnerTimelinePanel:function(f){var h=this.partnerTimelinePanel;var g=h.lockedGrid;var i=this.lockedGrid;g.mon(i,"resize",this.onLockedGridResize,g);i.mon(g,"resize",this.onLockedGridResize,i);var j=h.isVisible()?h.lockedGrid.getWidth():h.lockedGrid.width;if(g.getCollapsed()){this.mon(g,"viewready",function(a){i.setWidth(a.getWidth())})}else{i.setWidth(j)}this.on("afterlayout",function(){if(g.getCollapsed()){i.collapse()}else{i.expand();i.setWidth(j)}},this,{single:true});g.on({collapse:this.onPartnerCollapseExpand,expand:this.onPartnerCollapseExpand,scope:this});i.on({collapse:this.onPartnerCollapseExpand,expand:this.onPartnerCollapseExpand,scope:h});this.setupScrollSync();h.mon(this,"beforezoomchange",this.onBeforeZoomChange,this);h.mon(this,"viewchange",this.onViewChange,this);this.mon(h,"beforezoomchange",this.onBeforeZoomChange,this);this.mon(h,"viewchange",this.onViewChange,this)},onLockedGridResize:function(c,d){this.setWidth(d)},onPartnerCollapseExpand:function(b){if(b.getCollapsed()){this.lockedGrid.collapse()}else{this.lockedGrid.expand()}},setupScrollSync:function(){var j=this.partnerTimelinePanel.getSchedulingView(),h=j.getScrollable(),l=this.getSchedulingView(),i=l.getScrollable(),m,k=Ext.Function.createBuffered(function(){m=null},300);var n=function(c,a){var d=c===i?i:h;var b=c===i?h:i;if(!m){m=d}k();if(b!==m){b.component.headerCt.scrollTo(a);b.scrollTo(a)}};j.mon(i,"scroll",n);l.mon(h,"scroll",n)},onViewChange:function(b){if(b===this){this.partnerTimelinePanel.viewPreset=this.viewPreset=this.timeAxisViewModel.viewPreset}},onBeforeZoomChange:function(){var f=this.partnerTimelinePanel;var d=f.getSchedulingView().getScrollable(),e=d.suspendPartnerSync;d.suspendPartnerSync=Ext.emptyFn;d.on("scrollend",function(){d.suspendPartnerSync=e},null,{single:true})}});Ext.define("Sch.patches.NavigationModel6_0_2",{extend:Sch.util.Patch,target:"Ext.grid.NavigationModel",minVersion:"6.0.2",overrides:{focusPosition:function(f){var i=this,j,h,g;i.item=i.cell=null;if(f&&f.record&&f.column){j=f.view;if(f.rowElement){h=i.item=f.rowElement}else{h=j.getRowByRecord(f.record)}if(h){i.cell=f.cellElement||Ext.fly(h).down(f.column.getCellSelector(),true);if(i.cell){i.cell=new Ext.dom.Fly(i.cell);j.lastFocused=i.lastFocused=i.position.clone();g=j.getScrollable();if(g&&!j.mixins["Sch.mixin.TimelineView"]){g.scrollIntoView(i.cell)}i.focusItem(i.cell);j.focusEl=i.cell}else{i.position.setAll();i.record=i.column=i.recordIndex=i.columnIndex=null}}else{h=j.dataSource.indexOf(f.record);i.position.setAll();i.record=i.column=i.recordIndex=i.columnIndex=null;if(h!==-1&&j.bufferedRenderer){i.lastKeyEvent=null;j.bufferedRenderer.scrollTo(h,false,i.afterBufferedScrollTo,i)}}}}}});Ext.define("Sch.patches.TouchScroll",{extend:Sch.util.Patch,target:"Ext.scroll.TouchScroller",minVersion:"5.1.0",overrides:{privates:{onEvent:function(c){var d=this;if(!d[d.listenerMap[c.type]]){return}return this.callParent(arguments)}}}});Ext.define("Sch.patches.View",{extend:Sch.util.Patch,target:"Ext.view.View",minVersion:"5.1.0",overrides:{handleEvent:function(h){var i=this,j=i.keyEventRe.test(h.type),g=i.getNavigationModel();h.view=i;if(j){h.item=h.getTarget(i.itemSelector);h.record=g.getRecord(h.item)}if(!h.item){var e=i.editingPlugin&&i.editingPlugin.getActiveEditor&&i.editingPlugin.getActiveEditor();if(!(e&&e.getEl().contains(h.getTarget()))){h.item=h.getTarget(i.itemSelector)}}if(h.item&&!h.record){h.record=i.getRecord(h.item)}if(i.processUIEvent(h)!==false){i.processSpecialEvent(h)}if(j&&!Ext.fly(h.target).isInputField()){if(h.getKey()===h.SPACE||h.isNavKeyPress(true)){h.preventDefault()}}h.view=null}}});Ext.define("Sch.patches.Scroller",{extend:Sch.util.Patch,target:"Ext.scroll.Scroller",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{privates:{restoreState:function(){var d=this,e=d.getScrollElement(),f;if(e){f=e.dom;if(d.trackingScrollTop!==undefined){d.restoring=true;Ext.defer(function(){d.restoring=false},50);f.scrollTop=d.trackingScrollTop;f.scrollLeft=d.trackingScrollLeft}}}}}});Ext.define("Sch.patches.Queue",{extend:Sch.util.Patch,target:"Ext.util.Queue",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{add:function(h,f){var j=this,g=j.getKey(h),i;if(!(i=j.map[g])){++j.length;j.items.push(h);j.map[g]=h}else{if(f){j.map[g]=h;j.items[Ext.Array.indexOf(j.items,i)]=h}}return h}}});Ext.define("Sch.patches.LayoutContext",{extend:Sch.util.Patch,target:"Ext.layout.Context",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{queueFlush:function(c,d){this.flushQueue.add(c,d)}}});Ext.define("Sch.patches.TableLayout",{extend:Sch.util.Patch,target:"Ext.view.TableLayout",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{calculate:function(E){var w=this,K=E.context,v=E.lockingPartnerContext,y=E.headerContext,A=E.ownerCtContext,N=w.owner,L=y.getProp("columnsChanged"),I=E.state,C,H,M,D,B=N.body.dom,z,F,G,u,x,J;if(!N.all.getCount()&&(!B||!N.body.child("table"))){E.setProp("viewOverflowY",false);w.callParent([E]);return}if(L===undefined){w.done=false;return}if(L){if(!(C=I.columnFlusher)){K.queueFlush(I.columnFlusher=C={ownerContext:E,columnsChanged:L,layout:w,id:w.columnFlusherId,flush:w.flushColumnWidths},true)}if(!C.flushed){w.done=false;return}}if(E.doSyncRowHeights){if(!(D=I.rowHeightFlusher)){if(!(M=I.rowHeights)){I.rowHeights=M=E.rowHeightSynchronizer;w.owner.syncRowHeightMeasure(M);E.setProp("rowHeights",M)}if(!(H=v.getProp("rowHeights"))){w.done=false;return}K.queueFlush(I.rowHeightFlusher=D={ownerContext:E,synchronizer:M,otherSynchronizer:H,layout:w,id:w.rowHeightFlusherId,flush:w.flushRowHeights},true)}if(!D.flushed){w.done=false;return}}w.callParent([E]);if(!E.heightModel.shrinkWrap){G=false;if(!A.heightModel.shrinkWrap){F=A.target.layout.getContainerSize(A);if(!F.gotHeight){w.done=false;return}z=B.offsetHeight;G=z>F.height}E.setProp("viewOverflowY",G)}if(w.done&&Ext.getScrollbarSize().height){if(v&&N.isLockedView){u=N.lockingPartner;x=N.scrollFlags.x&&E.headerContext.state.boxPlan.tooNarrow;J=u.scrollFlags.x&&v.headerContext.state.boxPlan.tooNarrow;if(x!==J){if(J){v.setProp("overflowX",true);E.setProp("overflowX","scroll")}else{E.setProp("overflowX",true);v.setProp("overflowX","scroll")}}else{E.setProp("overflowX",J);v.setProp("overflowX",x)}E.setProp("overflowY","scroll")}else{if(!N.isAutoTree){E.setProp("overflowX",!!E.headerContext.state.boxPlan.tooNarrow)}}}},beginLayout:function(k){var m=this,i=m.owner,l=i.ownerGrid,n=i.lockingPartner,j=n&&n.grid.isVisible()&&!n.grid.collapsed,h=k.context;k.doSyncRowHeights=j&&(l.syncRowHeight||l.syncRowHeightOnNextLayout);if(!m.columnFlusherId){m.columnFlusherId=m.id+"-columns";m.rowHeightFlusherId=m.id+"-rows"}if(m.owner.bufferedRenderer){m.owner.bufferedRenderer.beforeTableLayout(k)}m.callSuper([k]);if(j&&n.componentLayout.isRunning()){if(!k.lockingPartnerContext){(k.lockingPartnerContext=h.getCmp(n)).lockingPartnerContext=k}if(k.doSyncRowHeights){k.rowHeightSynchronizer=m.owner.syncRowHeightBegin()}}(k.headerContext=h.getCmp(m.headerCt)).viewContext=k}}});Ext.define("Sch.patches.ColumnLayout",{extend:Sch.util.Patch,target:"Ext.grid.ColumnLayout",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{calculate:function(C){var r=this,F=r.owner.grid,w=C.viewContext,E=C.state,D=C.context,x,t,i,v,z,s,u,A,y,B;r.callSuper([C]);if(F&&E.parallelDone){x=w.lockingPartnerContext;if(x){t=x.target.ownerCt;if(!t.isVisible()||t.collapsed){x=null}}i=F.ownerGrid;if(i.forceFit&&!E.reflexed){if(r.convertWidthsToFlexes(C)){r.cacheFlexes(C);r.done=false;C.invalidate({state:{reflexed:true,scrollbarAdjustment:r.getScrollbarAdjustment(C)}});return}}if((v=E.columnsChanged)===undefined){z=C.target.getVisibleGridColumns();v=false;for(u=0,s=z.length;u<s;u++){A=D.getCmp(z[u]);if(!A.lastBox||A.props.width!==A.lastBox.width){(v||(v=[]))[u]=A}}E.columnsChanged=v;C.setProp("columnsChanged",v)}if(C.manageScrollbar){y=r.getScrollbarAdjustment(C);if(y){B=w.getProp("viewOverflowY");if(B===undefined){r.done=false;return}if(!B){if(x){x.invalidate();x.headerContext.invalidate()}w.invalidate();C.invalidate({state:{scrollbarAdjustment:0}})}}}}}}});Ext.define("Sch.patches.ToolTip",{extend:Sch.util.Patch,target:"Ext.tip.ToolTip",minVersion:"5.1.0",overrides:{setTarget:function(g){var e=this,f=Ext.get(g),h;if(e.target){h=Ext.get(e.target);e.mun(h,{mouseover:e.onTargetOver,tap:e.onTargetOver,mouseout:e.onTargetOut,mousemove:e.onMouseMove,scope:e})}e.target=f;if(f){e.mon(f,{mouseover:e.onTargetOver,tap:e.onTargetOver,mouseout:e.onTargetOut,mousemove:e.onMouseMove,scope:e})}if(e.anchor){e.anchorTarget=e.target}}}});Ext.define("Sch.mixin.TimelineView",{extend:Sch.mixin.AbstractTimelineView,tip:null,overScheduledEventClass:"sch-event-hover",ScheduleBarEvents:["mousedown","mouseup","click","dblclick","longpress","contextmenu"],ResourceRowEvents:["keydown","keyup"],preventOverCls:false,hoveredEventNode:null,_initializeTimelineView:function(){this.callParent(arguments);this.on("destroy",this._onDestroy,this);this.on("afterrender",this._onAfterRender,this);this.panel.on("viewready",this._onViewReady,this);this.setMode(this.mode);this.enableBubble("columnwidthchange");this.addCls("sch-timelineview");if(this.readOnly){this.addCls(this._cmpCls+"-readonly")}this.addCls(this._cmpCls);if(this.eventAnimations){this.addCls("sch-animations-enabled")}},handleScheduleBarEvent:function(c,d){this.fireEvent(this.scheduledEventName+c.type,this,this.resolveEventRecord(d),c)},handleResourceRowEvent:function(d,c){this.fireEvent(this.scheduledEventName+d.type,this,this.resolveEventRecordFromResourceRow(c),d)},_onDestroy:function(){if(this.tip){this.tip.destroy()}},_onViewReady:function(){if(this.touchScroll){this.getSecondaryCanvasEl().insertBefore(this.getNodeContainer())}},_onAfterRender:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}if(this.tooltipTpl){if(typeof this.tooltipTpl==="string"){this.tooltipTpl=new Ext.XTemplate(this.tooltipTpl)}this.el.on("mousemove",this.setupTooltip,this,{single:true})}var f=this.bufferedRenderer;if(f){this.patchBufferedRenderingPlugin(f);this.patchBufferedRenderingPlugin(this.lockingPartner.bufferedRenderer)}this.on("bufferedrefresh",this.onBufferedRefresh,this,{buffer:10});this.setupTimeCellEvents();var d={delegate:this.eventSelector,scope:this};var e={delegate:this.rowSelector,scope:this};Ext.Array.each(this.ScheduleBarEvents,function(a){d[a]=this.handleScheduleBarEvent},this);Ext.Array.each(this.ResourceRowEvents,function(a){e[a]=this.handleResourceRowEvent},this);this.el.on(d);this.el.on(e)},patchBufferedRenderingPlugin:function(f){var d=this;var e=f.setBodyTop;f.setBodyTop=function(c,b){var a=e.apply(this,arguments);d.fireEvent("bufferedrefresh",this);return a}},onBufferedRefresh:function(){var i=this,j=i.body.dom,g,h,l,k;if(j){h=j.style;g=i.getSecondaryCanvasEl().dom;if(Ext.isIE9m){g.style.top=h.top}else{l=h.transform||h.msTransform||h.webkitTransform;if(l){k=/\(-?\d+px,\s*(-?\d+px),\s*(-?\d+)px\)/.exec(l);if(k&&k.length>0){g.style.top=k[1]}else{g.style.top=h.top}}}}},setMouseOverEnabled:function(b){this[b?"mon":"mun"](this.el,{mouseover:this.onEventMouseOver,mouseout:this.onEventMouseOut,delegate:this.eventSelector,scope:this})},onEventMouseOver:function(f,e){if(e!==this.hoveredEventNode&&!this.preventOverCls){this.hoveredEventNode=e;Ext.fly(e).addCls(this.overScheduledEventClass);var d=this.resolveEventRecord(e);if(d){this.fireEvent("eventmouseenter",this,d,f)}}},onEventMouseOut:function(c,d){if(this.hoveredEventNode){if(!c.within(this.hoveredEventNode,true,true)){Ext.fly(this.hoveredEventNode).removeCls(this.overScheduledEventClass);this.fireEvent("eventmouseleave",this,this.resolveEventRecord(this.hoveredEventNode),c);this.hoveredEventNode=null}}},highlightItem:function(c){if(c){var d=this;d.clearHighlight();d.highlightedItem=c;Ext.fly(c).addCls(d.overItemCls)}},setupTooltip:function(){var c=this,d=Ext.apply({delegate:c.eventSelector,target:c.el,anchor:"b",rtl:c.rtl,show:function(){Ext.ToolTip.prototype.show.apply(this,arguments);if(this.triggerElement&&c.getMode()==="horizontal"){var a=Ext.fly(this.triggerElement).getBox();var g=Ext.dom.Element.getViewportWidth();var h=Math.min(Math.max(this.targetXY[0]-10,0),g-this.getWidth()-10);var b=a.top-this.getHeight()-10;this.setY(b<0?a.bottom+10:b);this.setX(h)}}},c.tipCfg);c.tip=new Ext.ToolTip(d);c.tip.on({beforeshow:function(i){if(!i.triggerElement||!i.triggerElement.id){return false}var b=Ext.all("window[modal=true]{isVisible()}");var k=Ext.Array.findBy(b,function(e){return this!==e&&!this.isDescendantOf(e)},this);if(k){return false}var l=this.resolveEventRecord(i.triggerElement);if(!l||this.fireEvent("beforetooltipshow",this,l)===false){return false}var a=this.getDataForTooltipTpl(l,i.triggerElement),j;if(!a){return false}j=this.tooltipTpl.apply(a);if(!j){return false}i.update(j)},scope:this});if(Ext.supports.Touch){c.el.un({touchmove:c.setupTooltip,mousemove:c.setupTooltip,scope:c})}},getHorizontalTimeAxisColumn:function(){if(!this.timeAxisColumn){this.timeAxisColumn=this.headerCt.down("timeaxiscolumn");if(this.timeAxisColumn){this.timeAxisColumn.on("destroy",function(){this.timeAxisColumn=null},this)}}return this.timeAxisColumn},getDataForTooltipTpl:function(d,c){return Ext.apply({_record:d},d.data)},refreshKeepingScroll:function(){Ext.suspendLayouts();this.saveScrollState();this.refreshView();Ext.resumeLayouts(true);if(this.scrollState.left!==0||this.scrollState.top!==0||this.infiniteScroll){this.restoreScrollState()}},setupTimeCellEvents:function(){this.mon(this.el,{click:this.handleScheduleEvent,dblclick:this.handleScheduleEvent,contextmenu:this.handleScheduleEvent,pinch:this.handleScheduleEvent,pinchstart:this.handleScheduleEvent,pinchend:this.handleScheduleEvent,scope:this})},getTableRegion:function(){var b=this.el.down("."+Ext.baseCSSPrefix+"grid-item-container");return(b||this.el).getRegion()},getRowNode:function(b){return this.getNodeByRecord(b)},findRowByChild:function(b){return this.findItemByChild(b)},getRecordForRowNode:function(b){return this.getRecord(b)},refreshKeepingResourceScroll:function(){var b=this.getScroll();this.refreshView();if(this.getMode()==="horizontal"){this.scrollVerticallyTo(b.top)}else{this.scrollHorizontallyTo(b.left)}},scrollHorizontallyTo:function(d,c){this.scrollTo(d,null,c)},scrollVerticallyTo:function(c,d){this.scrollTo(null,c,d)},getVerticalScroll:function(){return this.getScrollY()},getHorizontalScroll:function(){return this.getScrollX()},getScroll:function(){var b=this;return{top:b.getScrollY(),left:b.getScrollX()}},handleScheduleEvent:function(){},scrollElementIntoView:function(Q,A,M,O,T,N,R){var x=this,B=Q.dom,H=Ext.getDom(x.getEl()),K=Q.getOffsetsTo(H),S=x.getScroll(),P=K[0]+S.left,G=K[1]+S.top,J=G+B.offsetHeight,z=P+B.offsetWidth,F=H.clientHeight,L=parseInt(S.top,10),y=parseInt(S.left,10),E=L+F,I=y+H.clientWidth,C,D;T=T===null||T===undefined?20:T;if(B.offsetHeight>F||G<L){D=G-T}else{if(J>E){D=J-F+T}}if(A!==false&&B.offsetWidth>H.clientWidth||P<y){C=P-T}else{if(A!==false&&z>I){C=z-H.clientWidth+T}}M=M===true&&{}||M;O=O===true&&{}||O;R=R||x;if(M&&O){M.listeners=Ext.apply(M.listeners||{},{afteranimate:function(){O.listeners=Ext.apply(O.listeners||{},{afteranimate:function(){N&&N.call(R);N=null}});Ext.fly(B).highlight(null,O)}})}else{if(M){M.listeners=Ext.apply(M.listeners,{afteranimate:function(){N&&N.call(R);N=null}})}else{if(O){O.listeners=Ext.apply(O.listeners||{},{afteranimate:function(){N&&N.call(R);N=null}})}}}D!==undefined&&x.setScrollY(D,M);C!==undefined&&x.setScrollX(C,M);!M&&O&&Ext.fly(B).highlight(null,O);!M&&!O&&N&&N.call(R)},disableViewScroller:function(c){var d=this.getScrollable();if(d){d.setDisabled(c)}}});Ext.define("Sch.view.TimelineGridView",{extend:Ext.grid.View,mixins:[Sch.mixin.TimelineView],infiniteScroll:false,bufferCoef:5,bufferThreshold:0.2,cachedScrollLeftDate:null,boxIsReady:false,ignoreNextHorizontalScroll:false,constructor:function(b){this.callParent(arguments);if(this.infiniteScroll){this.on("boxready",this.setupInfiniteScroll,this)}if(this.timeAxisViewModel){this.relayEvents(this.timeAxisViewModel,["columnwidthchange"])}},setupInfiniteScroll:function(){var g=this.panel.ownerCt;this.cachedScrollLeftDate=g.startDate||this.timeAxis.getStart();if(Ext.getVersion().isLessThan("6.0.1")&&Ext.supports.Touch&&Ext.os.is.Windows){var f=this.panel.headerCt.getScrollable();var e=this.getScrollable();f.onIdle&&Ext.GlobalEvents.un("idle",f.onIdle,f);e.onIdle&&Ext.GlobalEvents.un("idle",e.onIdle,e)}var h=this;g.calculateOptimalDateRange=function(d,j,a,c){if(c){return c}var b=Sch.preset.Manager.getPreset(a.preset);return h.calculateInfiniteScrollingDateRange(d,b.getBottomHeader().unit,a.increment,a.width)};this.bindInfiniteScrollListeners()},bindInfiniteScrollListeners:function(){this.getScrollable().on("scroll",this.onHorizontalScroll,this)},unbindInfiniteScrollListeners:function(){this.getScrollable().un("scroll",this.onHorizontalScroll,this);this.infiniteScroll=false},onHorizontalScroll:function(l,j,k){if(this.ignoreNextHorizontalScroll||this.cachedScrollLeftDate){this.ignoreNextHorizontalScroll=false;return}var m=Ext.getScrollbarSize(),n=this.getWidth(),h=this.getScrollable().getMaxPosition().x+n-m.width,i=n*this.bufferThreshold*this.bufferCoef;if((h-j-n<i)||j<i){this.shiftToDate(this.getDateFromCoordinate(j,null,true));this.el.stopAnimation()}},refresh:function(){this.callParent(arguments);if(this.infiniteScroll&&!this.scrollStateSaved&&this.boxIsReady){this.restoreScrollLeftDate()}},onResize:function(h,f,e,g){this.boxIsReady=true;this.callParent(arguments);if(this.infiniteScroll&&h>0&&h!==e){this.shiftToDate(this.cachedScrollLeftDate||this.getVisibleDateRange().startDate,this.cachedScrollCentered)}},restoreScrollLeftDate:function(){if(this.cachedScrollLeftDate&&this.boxIsReady){this.ignoreNextHorizontalScroll=true;this.scrollToDate(this.cachedScrollLeftDate);this.cachedScrollLeftDate=null}},scrollToDate:function(d){this.cachedScrollLeftDate=d;if(this.cachedScrollCentered){this.panel.ownerCt.scrollToDateCentered(d)}else{this.panel.ownerCt.scrollToDate(d)}var c=this.getScrollX();this.panel.scrollLeftPos=c;this.headerCt.setScrollX(c)},saveScrollState:function(){this.scrollStateSaved=this.boxIsReady;this.callParent(arguments)},restoreScrollState:function(){this.scrollStateSaved=false;if(this.infiniteScroll&&this.cachedScrollLeftDate){this.restoreScrollLeftDate();this.setScrollY(this.scrollState.top);return}this.callParent(arguments)},calculateInfiniteScrollingDateRange:function(k,n,i,j){var m=this.timeAxis;var o=this.getWidth();j=j||this.timeAxisViewModel.getTickWidth();i=i||m.increment||1;n=n||m.unit;var l=Sch.util.Date;var p=Math.ceil(o*this.bufferCoef/j);return{start:m.floorDate(l.add(k,n,-p*i),false,n,i),end:m.ceilDate(l.add(k,n,Math.ceil((o/j+p)*i)),false,n,i)}},shiftToDate:function(f,d){var e=this.calculateInfiniteScrollingDateRange(f);this.cachedScrollLeftDate=f;this.cachedScrollCentered=d;this.timeAxis.setTimeSpan(e.start,e.end)},destroy:function(){if(this.infiniteScroll&&this.rendered){this.unbindInfiniteScrollListeners()}this.callParent(arguments)}});Ext.define("Sch.patches.DragDropManager",{extend:Sch.util.Patch,minVersion:"6.0.0",applyFn:function(){Ext.override(Ext.dd.DragDropManager,{fireEvents:function(a,K){var H=this,I=Ext.supports.Touch,P=H.dragCurrent,e=H.currentPoint,E=e.x,F=e.y,G=[],O=[],M=[],U=[],J=[],b=[],V=I?document.documentElement.clientWidth/window.innerWidth:1,R,Q,L,T,C,i,D,N;if(!P||P.isLocked()){return}N=!(P.deltaX<0||P.deltaY<0);if(I||(!H.notifyOccluded&&(!Ext.supports.CSSPointerEvents||Ext.isIE10m||Ext.isOpera)&&N)){R=P.getDragEl();if(N){R.style.visibility="hidden"}var S=Ext.getBody().getScroll();a.target=document.elementFromPoint(E-S.left/V,F-S.top/V);if(N){R.style.visibility="visible"}}for(C in H.dragOvers){Q=H.dragOvers[C];delete H.dragOvers[C];if(!H.isTypeOfDD(Q)||Q.destroyed){continue}if(H.notifyOccluded){if(!this.isOverTarget(e,Q,H.mode)){M.push(Q)}}else{if(!a.within(Q.getEl())){M.push(Q)}}O[C]=true}for(D in P.groups){if("string"!==typeof D){continue}for(C in H.ids[D]){Q=H.ids[D][C];if(H.isTypeOfDD(Q)&&(L=Q.getEl())&&(Q.isTarget)&&(!Q.isLocked())&&(Ext.fly(L).isVisible(true))&&((Q!==P)||(P.ignoreSelf===false))){if(H.notifyOccluded){if((Q.zIndex=H.getZIndex(L))!==-1){T=true}G.push(Q)}else{if(a.within(Q.getEl())){G.push(Q);break}}}}}if(T){Ext.Array.sort(G,H.byZIndex)}for(C=0,i=G.length;C<i;C++){Q=G[C];if(H.isOverTarget(e,Q,H.mode)){if(K){J.push(Q)}else{if(!O[Q.id]){b.push(Q)}else{U.push(Q)}H.dragOvers[Q.id]=Q}if(!H.notifyOccluded){break}}}if(H.mode){if(M.length){P.b4DragOut(a,M);P.onDragOut(a,M)}if(b.length){P.onDragEnter(a,b)}if(U.length){P.b4DragOver(a,U);P.onDragOver(a,U)}if(J.length){P.b4DragDrop(a,J);P.onDragDrop(a,J)}}else{for(C=0,i=M.length;C<i;++C){P.b4DragOut(a,M[C].id);P.onDragOut(a,M[C].id)}for(C=0,i=b.length;C<i;++C){P.onDragEnter(a,b[C].id)}for(C=0,i=U.length;C<i;++C){P.b4DragOver(a,U[C].id);P.onDragOver(a,U[C].id)}for(C=0,i=J.length;C<i;++C){P.b4DragDrop(a,J[C].id);P.onDragDrop(a,J[C].id)}}if(K&&!J.length){P.onInvalidDrop(a)}}});var c=Ext.dd.ScrollManager;var d=Ext.dd.DragDropManager;d.fireEvents=Ext.Function.createSequence(d.fireEvents,c.onFire,c);d.stopDrag=Ext.Function.createSequence(d.stopDrag,c.onStop,c)}});Ext.define("Sch.patches.NavigationModel",{extend:Sch.util.Patch,target:"Ext.grid.NavigationModel",minVersion:"6.0.0",overrides:{setPosition:function(h,m,k,i,j){var l=this;if(Ext.isIE&&k&&(k.getKey()===k.PAGE_DOWN||k.getKey()===k.PAGE_UP)){var n=l.lastFocused;if(k.view.isLockedView&&n&&k.view.getVisibleColumnManager().indexOf(n.column)===-1){k.view=k.view.lockingPartner}}if(Ext.getVersion().equals("6.0.1.250")){l.patchedSetPosition.apply(this,arguments)}else{return l.callParent(arguments)}},patchedSetPosition:function(I,u,x,G,z){var t=this,B,w,A,v,F,C,J,E,D,s=I==null&&u==null,y=t.record==null&&t.recordIndex==null&&t.item==null;if(I&&I.isCellContext){B=I.view}else{if(x&&x.view){B=x.view}else{if(t.lastFocused){B=t.lastFocused.view}else{B=t.view}}}B.getFocusTask().cancel();if(B.destroyed||!B.refreshCounter||!B.ownerCt||s&&y||!B.all.getCount()){return}A=B.getSelectionModel();v=B.dataSource;F=B.getVisibleColumnManager();if(I&&I.isCellContext){E=I.record;C=I.rowIdx;J=Math.min(I.colIdx,F.getColumns().length-1);D=F.getColumns()[J];if(v.indexOf(E)===-1){w=B.getScrollable();t.recordIndex=-1;if(w.getPosition().y>=w.getMaxPosition().y-B.all.last(true).offsetHeight){I.rowIdx--}C=Math.min(I.rowIdx,v.getCount()-1);E=v.getAt(C)}}else{if(s){E=C=null}else{if(u==null){u=t.lastFocused?t.lastFocused.column:0}if(typeof I==="number"){C=Math.max(Math.min(I,v.getCount()-1),0);E=v.getAt(I)}else{if(I.isEntity){E=I;C=v.indexOf(E)}else{if(I.tagName){E=B.getRecord(I);C=v.indexOf(E);if(C===-1){E=null}}else{if(y){return}s=true;E=C=null}}}}if(E){if(C===-1){t.recordIndex=-1;E=v.getAt(0);C=0;u=null}if(u==null){if(!(D=t.column)){J=0;D=F.getColumns()[0]}}else{if(typeof u==="number"){D=F.getColumns()[u];J=u}else{D=u;J=F.indexOf(u)}}}else{s=true;D=J=null}}if(B.actionableMode&&!s){var H=new Ext.grid.CellContext(B).setPosition(E,D);t.focusPosition(H);return B.ownerGrid.setActionableMode(false,H)}if(C===t.recordIndex&&J===t.columnIndex&&B===t.position.view){return t.focusPosition(t.position)}if(t.cell){t.cell.removeCls(t.focusCls)}t.previousRecordIndex=t.recordIndex;t.previousRecord=t.record;t.previousItem=t.item;t.previousCell=t.cell;t.previousColumn=t.column;t.previousColumnIndex=t.columnIndex;t.previousPosition=t.position.clone();t.selectionStart=A.selectionStart;t.position.setAll(B,t.recordIndex=C,t.columnIndex=J,t.record=E,t.column=D);if(s){t.item=t.cell=null}else{t.focusPosition(t.position,z)}if(!G){A.fireEvent("focuschange",A,t.previousRecord,t.record);B.fireEvent("rowfocus",t.record,t.item,t.recordIndex);B.fireEvent("cellfocus",t.record,t.cell,t.position)}if(x&&!z&&t.cell!==t.previousCell){t.fireNavigateEvent(x)}}}});Ext.define("Sch.view.Calendar",{view:null,constructor:function(b){Ext.apply(this,b)},getColumnsBy:function(f,h){var i=this.view.panel.headerCt.getGridColumns();var g=[];for(var j=0;j<i.length;j++){if(f.call(this,i[j])){if(h!==true){g.push(i[j])}else{g.push({column:i[j],index:j})}}}return g},getColumnsForDateRange:function(d,c){return this.getColumnsBy(function(a){return !(d.getEndDate()<=a.start||d.getStartDate()>=a.end)},c)},getColumnEvents:function(c){var d=[];this.view.getEventStore().each(function(a){if(!(a.getEndDate()<=c.start||a.getStartDate()>=c.end)){d.push(a)}});return d},getColumnsByResource:function(c,d){return this.getColumnsBy(function(a){return a.start==c.start},d)[0]},translateToScheduleCoordinate:function(c){var d=this.view;if(Ext.isArray(c)){return[c[0]-d.getEl().getX()+d.getScroll().left,c[1]-d.getEl().getY()+d.getScroll().top]}else{return c-d.getEl().getY()+d.getScroll().top}},translateToPageCoordinate:function(g){var e=this.view;var h=e.getEl(),f=e.getScroll();if(Ext.isArray(g)){return[g[0]+h.getX()-f.left,g[1]+h.getY()-f.top]}else{return g+h.getY()-f.top}},getDateFromXY:function(h,e,f){var g=h;if(!f){g=this.translateToScheduleCoordinate(g)}return this.view.timeAxisViewModel.getDateFromPosition(g,e)},getEventRenderData:function(z,y,s){var r=z.getStartDate(),t=z.getEndDate(),p=this.view,x=p.panel.headerCt.getGridColumns(),u=x[s].start,o=x[s].end,q=Math;var v=Math.floor(p.getCoordinateFromDate(Sch.util.Date.max(r,u)));var n=Math.floor(p.timeAxisViewModel.getPositionFromDate(Sch.util.Date.min(t,o),true));var w;if(n===0){n=p.getStore().getCount()*p.getRowHeight()}w={top:q.max(0,q.min(v,n)-p.eventBorderWidth),height:q.max(1,q.abs(v-n))};w.start=r;w.end=t;w.startsOutsideView=r<u;w.endsOutsideView=t>o;return w},getScheduleRegion:function(m,p){var i=this.view,k=m?this.getColumnsByResource(m).getRegion():i.getTableRegion(),j=this.translateToPageCoordinate(0),n=this.translateToPageCoordinate(i.getStore().getCount()*i.getRowHeight()),l=k.left+i.barMargin,o=k.right-i.barMargin;return new Ext.util.Region(Math.min(j,n),o,Math.max(j,n),l)},getCalendarColumnWidth:function(){return this.view.timeAxisViewModel.calendarColumnWidth},getResourceRegion:function(s,y,t){var q=this.view,v=q.getResourceStore().indexOf(s)*this.getCalendarColumnWidth(),r=q.timeAxis.getStart(),n=q.timeAxis.getEnd(),z=y?Sch.util.Date.max(r,y):r,w=t?Sch.util.Date.min(n,t):n,u=Math.max(0,q.getCoordinateFromDate(z)-q.cellTopBorderWidth),o=q.getCoordinateFromDate(w)-q.cellTopBorderWidth,x=v+q.cellBorderWidth,p=v+this.getCalendarColumnWidth()-q.cellBorderWidth;return new Ext.util.Region(Math.min(u,o),p,Math.max(u,o),x)},columnRenderer:function(u,i,r,q,l){var p=this.view;var v="";if(q===0){var o,w,s,t;o=[];w=this.getColumnEvents(i.column);for(s=0,t=w.length;s<t;s++){var x=w[s];o.push(p.generateTplData(x,x.getResources()[0]||r,l))}if(i.column.rendered&&this.getCalendarColumnWidth()!==i.column.getWidth()){this.setColumnWidth(i.column.getWidth(),true)}p.eventLayout.vertical.applyLayout(o,this.getCalendarColumnWidth()-(2*p.barMargin)-p.cellBorderWidth);v="&#160;"+p.eventTpl.apply(o)}if(l%2===1){i.tdCls=(i.tdCls||"")+" "+p.altColCls;i.cellCls=(i.cellCls||"")+" "+p.altColCls}return v},resolveResource:function(i){var g=this.view;i=Ext.fly(i).is(g.timeCellSelector)?i:Ext.fly(i).up(g.timeCellSelector);if(i){var h=i.dom?i.dom:i;var f=0;if(Ext.isIE8m){h=h.previousSibling;while(h){if(h.nodeType===1){f++}h=h.previousSibling}}else{f=Ext.Array.indexOf(Array.prototype.slice.call(h.parentNode.children),h)}if(f>=0){var j=g.panel.headerCt.getGridColumns()[f];return{start:j.start,end:j.end}}}},onEventUpdate:function(e,h){this.renderSingle(h);var f=this.view;var g=f.getEventSelectionModel();g.forEachEventRelatedSelection(h,function(a){f.onEventBarSelect(a)})},onEventAdd:function(d,f){var e=this.view;if(f.length===1){this.renderSingle(f[0])}else{e.repaintAllEvents()}},onEventRemove:function(d,f){var e=this.view;if(f.length===1){Ext.Array.each(e.getElementsFromEventRecord(f[0]),function(a){Ext.fly(a).destroy()});this.relayoutRenderedEvents(f[0])}else{e.repaintAllEvents()}},relayoutRenderedEvents:function(d){var f=this,e=f.getColumnsForDateRange(d,true);Ext.Array.each(e,function(a){f.repaintEventsForColumn(a.column,a.index)})},renderSingle:function(l){var i=this.view;Ext.Array.each(i.getElementsFromEventRecord(l),function(a){Ext.fly(a).destroy()});var j=l.getResources()[0]||i.getResourceStore().first();var m=l.previous||{};var h=Sch.util.Date;var k=new Sch.model.Range({StartDate:h.min(m.StartDate||l.getStartDate(),l.getStartDate()),EndDate:h.max(m.EndDate||l.getEndDate(),l.getEndDate())});var n=this.getColumnsForDateRange(k);Ext.Array.each(n,function(a){var b=a.getIndex();var c=this.getColumnEvents(a);var d=Ext.Array.map(c,function(e){if(e===l){return i.generateTplData(l,j,b)}else{return{start:e.getStartDate()<a.start?a.start:e.getStartDate(),end:e.getEndDate()>a.end?a.end:e.getEndDate(),event:e}}});i.eventLayout.vertical.applyLayout(d,a.getWidth()-(2*i.barMargin)-i.cellBorderWidth);Ext.Array.each(d,function(g){if(g.event===l){var e=i.getScheduleCell(0,b);if(e){if(!Ext.versions.touch){e=Ext.fly(e).first()}i.eventTpl.append(e,[g])}}else{var f=i.getElementsFromEventRecord(g.event,g.event.getResource(),b)[0];f.setStyle({left:g.left+"px",width:Math.max(g.width,0)+"px"})}})},this)},repaintEventsForColumn:function(x,r){var q=this;var i=q.getColumnEvents(x);var l=q.view;var u=[],t,w,B,y,z,v;for(t=0,w=i.length;t<w;t++){B=i[t];y=l.getElementsFromEventRecord(B)[0];if(!y){return}var s=y.id.split("-");s.pop();z=B.getStartDate();v=B.getEndDate();u.push({start:z<x.start?x.start:z,end:v>x.end?x.end:v,event:B,id:s.join("-")})}l.eventLayout.vertical.applyLayout(u,x.getWidth()-(2*l.barMargin)-l.cellBorderWidth);var A=l.getNode(0);for(t=0;t<u.length;t++){B=u[t];y=Ext.DomQuery.selectNode("td:nth-child("+(r+1)+") [id^="+B.id+"-]",A);y&&Ext.fly(y).setStyle({left:B.left+"px",width:Math.max(B.width,0)+"px"})}},getTimeSpanRegion:function(r,o){var m=this.view,p=m.getCoordinateFromDate(r),l=o?m.getCoordinateFromDate(o,true,true):p;var q=this.getColumnsBy(function(a){return a.start<=r&&a.end>r})[0];var n=this.getColumnsBy(function(a){return a.start<o&&a.end>=o})[0];if(!q||!n){return new Ext.util.Region(-1,0,-1,0)}var j=this.translateToScheduleCoordinate([q.getX(),0]);var k=this.translateToScheduleCoordinate([n?n.getRegion().right:q.getWidth()+j[0],0]);return new Ext.util.Region(Math.min(p,l),k[0],Math.max(p,l),j[0])},getStartEndDatesFromRegion:function(h,e){var f=this.view.getDateFromCoordinate([h.left,h.top],e),g=this.view.getDateFromCoordinate([h.left,h.bottom],e);if(f&&g){return{start:Sch.util.Date.min(f,g),end:Sch.util.Date.max(f,g)}}else{return null}},setColumnWidth:function(f,d){var e=this.view;e.calendarColumnWidth=f;e.getTimeAxisViewModel().setViewColumnWidth(f,d)},getVisibleDateRange:function(){var j=this.view;if(!j.rendered){return null}var l=j.getScroll(),g=j.getHeight(),k=j.getTableRegion(),i=j.timeAxis.getEnd();if(k.bottom-k.top<g){var h=j.timeAxis.getStart();return{startDate:h,endDate:i}}return{startDate:j.getDateFromCoordinate(l.top,null,true),endDate:j.getDateFromCoordinate(l.top+g,null,true)||i}},getItemBox:function(b){return null},getConnectorStartSide:function(b){return"top"},getConnectorEndSide:function(b){return"bottom"}});Ext.define("Sch.mixin.SchedulerView",{extend:Sch.mixin.AbstractSchedulerView,mixins:[Sch.mixin.Localizable],eventResizeHandles:"end",dndValidatorFn:Ext.emptyFn,resizeValidatorFn:Ext.emptyFn,createValidatorFn:Ext.emptyFn,calendarViewClass:"Sch.view.Calendar",lockedGridDependsOnSchedule:null,_initializeSchedulerView:function(){this.callParent(arguments);this.on({destroy:this._destroy,afterrender:this._afterRender,itemupdate:this.onRowUpdated,scope:this});if(Ext.getVersion().isGreaterThan("5.1.1")){this.on("itemadd",function(a){var d=this.all.item(this.all.endIndex-a.length);if(d){d.dom.style.height=""}})}var b=this;if(!this.eventPrefix){throw"eventPrefix missing"}this.on({resourcestorechange:this.clearRowHeightCache,assignmentstorechange:this.clearRowHeightCache,eventstorechange:this.clearRowHeightCache,scope:this})},inheritables:function(){return{loadingText:this.L("loadingText"),overItemCls:"",trackOver:false,selectedItemCls:"",setReadOnly:function(b){if(this.dragCreator){this.dragCreator.setDisabled(b)}this.callParent(arguments)},repaintEventsForResource:function(n,p){var o=this,l=o.getMode(),m=l==="horizontal",j=m?o.indexOf(n):0;if(m){o.eventLayout.horizontal.clearCache(n)}if(j>=0){Ext.suspendLayouts();if(m){o.refreshNode(n);if(o.lockedGridDependsOnSchedule){o.lockingPartner.refreshNode(n)}}else{o.refreshNode(j);o.lockingPartner.refreshNode(j)}Ext.resumeLayouts();if(p){var k=o.getEventSelectionModel();var i=o.getEventStore().getEventsForResource(n);Ext.Array.each(i,function(a){k.forEachEventRelatedSelection(a,function(b){o.onEventBarSelect(b,true)})})}}},repaintAllEvents:function(){if(this.mode==="horizontal"){this.refreshView()}else{this.refreshNode(0)}},handleScheduleEvent:function(o){var t=o.getTarget("."+this.eventCls,3),l=!t&&o.getTarget("."+this.timeCellCls,3);if(l){var e=this.getDateFromDomEvent(o,"floor");var m=this.findRowByChild(l);var p=this.indexOf(m);var s;if(this.mode=="horizontal"){s=this.getRecordForRowNode(m)}else{var r=o.getTarget(this.timeCellSelector,5);if(r){var n=typeof r.cellIndex=="number"?r.cellIndex:r.getAttribute("data-cellIndex");var q=this.headerCt.getGridColumns()[n];s=q&&q.model}}if(o.type.indexOf("pinch")>=0){this.fireEvent("schedule"+o.type,this,o)}else{this.fireEvent("schedule"+o.type,this,e,p,s,o)}}},onEventDataRefresh:function(){this.clearRowHeightCache();this.callParent(arguments)},onUnbindStore:function(b){b.un({refresh:this.clearRowHeightCache,clear:this.clearRowHeightCache,load:this.clearRowHeightCache,scope:this});this.callParent(arguments)},bindStore:function(b){b&&b.on({refresh:this.clearRowHeightCache,clear:this.clearRowHeightCache,load:this.clearRowHeightCache,scope:this});this.callParent(arguments)},refreshKeepingScroll:function(){this.lockingPartner.saveScrollState();this.lockingPartner.refreshView();this.callParent(arguments);this.lockingPartner.restoreScrollState()}}},getEventSelectionModel:function(){var e=this,h=e.eventSelModel,f=e.eventSelModelType,g;if(h&&h.events){return h}if(!h){h={}}if(!f&&e.getEventStore().getAssignmentStore()){f="assignmentmodel"}else{if(!f){f="eventmodel"}}g="SINGLE";if(e.simpleSelect){g="SIMPLE"}else{if(e.multiSelect){g="MULTI"}}Ext.applyIf(h,{allowDeselect:e.allowDeselect,mode:g});if(!h.events){h=e.eventSelModel=Ext.create("selection."+f,h)}if(e.disableSelection){h.locked=true}return h},_afterRender:function(){this.setEventStore(this.eventStore,true);this.getEventSelectionModel().bindToView(this);this.setupEventListeners();this.configureFunctionality();var b=this.headerCt.resizer;if(b){b.doResize=Ext.Function.createSequence(b.doResize,this.afterHeaderResized,this)}this.on("itemupdate",function(){this.hoveredEventNode=null})},_destroy:function(){this.setEventStore(null)},clearRowHeightCache:function(){if(this.mode==="horizontal"){this.eventLayout.horizontal.clearCache()}},configureFunctionality:function(){var b=this.validatorFnScope||this;if(this.eventResizeHandles!=="none"&&Sch.feature.ResizeZone){this.resizePlug=new Sch.feature.ResizeZone(Ext.applyIf({schedulerView:this,validatorFn:function(g,h,a,f){return(this.allowOverlap||this.isDateRangeAvailable(a,f,h,g))&&this.resizeValidatorFn.apply(b,arguments)},validatorFnScope:this},this.resizeConfig||{}))}if(this.enableEventDragDrop!==false&&Sch.feature.DragDrop){this.dragdropPlug=new Sch.feature.DragDrop(this,{validatorFn:function(h,a,g,f){return(this.allowOverlap||this.isDateRangeAvailable(g,Sch.util.Date.add(g,Sch.util.Date.MILLI,f),h[0],a))&&this.dndValidatorFn.apply(b,arguments)},validatorFnScope:this,dragConfig:this.dragConfig||{}})}if(this.enableDragCreation!==false&&Sch.feature.DragCreator){this.dragCreator=new Sch.feature.DragCreator(Ext.applyIf({schedulerView:this,disabled:this.readOnly,validatorFn:function(f,a,e){return(this.allowOverlap||this.isDateRangeAvailable(a,e,null,f))&&this.createValidatorFn.apply(b,arguments)},validatorFnScope:this},this.createConfig||{}))}},onBeforeDragDrop:function(e,f,d){return !this.readOnly&&!d.getTarget().className.match("sch-resizable-handle")},onDragDropStart:function(){if(this.dragCreator){this.dragCreator.setDisabled(true)}if(this.tip){this.tip.hide();this.tip.disable()}if(this.overScheduledEventClass){this.setMouseOverEnabled(false)}this.hoveredEventNode=null},onDragDropEnd:function(){if(this.dragCreator){this.dragCreator.setDisabled(false)}if(this.tip){this.tip.enable()}if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}},onBeforeDragCreate:function(e,h,f,g){return !this.readOnly&&!g.ctrlKey},onDragCreateStart:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(false)}if(this.tip){this.tip.hide();this.tip.disable()}this.disableViewScroller(true)},onDragCreateEnd:function(e,f,h){if(!this.getEventEditor()){var g=h?[h]:[];if(this.fireEvent("beforeeventadd",this,f,g)!==false){this.onEventCreated(f);this.getEventStore().append(f);if(this.getMode()!="calendar"){f.assign(h)}}this.dragCreator.getProxy().hide()}if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}},onEventCreated:function(b){},onAfterDragCreate:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}if(this.tip){this.tip.enable()}this.disableViewScroller(false)},onBeforeResize:function(){return !this.readOnly},onResizeStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}if(this.dragCreator){this.dragCreator.setDisabled(true)}this.disableViewScroller(true)},onResizeEnd:function(){if(this.tip){this.tip.enable()}if(this.dragCreator){this.dragCreator.setDisabled(false)}this.disableViewScroller(false)},setupEventListeners:function(){this.on({beforeeventdrag:this.onBeforeDragDrop,eventdragstart:this.onDragDropStart,aftereventdrop:this.onDragDropEnd,beforedragcreate:this.onBeforeDragCreate,dragcreatestart:this.onDragCreateStart,dragcreateend:this.onDragCreateEnd,afterdragcreate:this.onAfterDragCreate,beforeeventresize:this.onBeforeResize,eventresizestart:this.onResizeStart,eventresizeend:this.onResizeEnd,scope:this})},afterHeaderResized:function(){var c=this.headerCt.resizer;if(c&&this.getMode()!=="horizontal"){if(this.panel.forceFit){this.setColumnWidth(c.origWidth)}else{var d=c.dragHd.getWidth();this.setColumnWidth(d)}}},columnRenderer:function(h,j,g,i,f){return this[this.mode].columnRenderer(h,j,g,i,f)},onRowUpdated:function(f){var d=this,e;if(d.getMode()==="horizontal"&&d.hasListener("eventrepaint")){Ext.Array.each(f.getEvents(),function(a){e=d.getElementsFromEventRecord(a,f,null,true);Ext.Array.each(e,function(b){d.fireEvent("eventrepaint",d,a,b)})})}},scrollResourceEventIntoView:function(u,s,r,w,z,o,n){var p=this,q=s.getStartDate(),t=s.getEndDate(),x,y;var v=function(){y=p.getElementsFromEventRecord(s,u,r);y=y.length&&y[0]||null;p.scrollElementIntoView(y,true,z,w,null,o,n)};if(p.getResourceStore().isTreeStore){u.bubble(function(a){a.expand()})}if(!p.timeAxis.dateInAxis(q)||!p.timeAxis.dateInAxis(t)){x=p.timeAxis.getEnd()-p.timeAxis.getStart();p.timeAxis.setTimeSpan(new Date(q.valueOf()-x/2),new Date(t.getTime()+x/2));p.up("panel").scrollTask.cancel()}if(this.getOrientation()==="horizontal"){p.up("timelinegrid,timelinetree").ensureVisible(u,{callback:function(){if(this.isLocked===false){v()}}})}else{v()}}});Ext.define("Sch.view.SchedulerGridView",{extend:Sch.view.TimelineGridView,mixins:[Sch.mixin.SchedulerView,Sch.mixin.GridViewCanvas,Sch.mixin.Localizable],alias:"widget.schedulergridview"},function(){this.override(Sch.mixin.SchedulerView.prototype.inheritables()||{})});Ext.define("Sch.selection.EventModel",{extend:Ext.selection.Model,alias:"selection.eventmodel",deselectOnContainerClick:true,selectedOnMouseDown:null,bindToView:function(d){var c=this;c.view=d;c.bindStore(d.getEventStore());d.on({eventclick:c.onEventClick,eventmousedown:c.onEventMouseDown,itemmousedown:c.onItemMouseDown,refresh:function(){c.refresh()},destroy:function(){c.bindStore(null)},scope:c})},bindStore:function(b){if(this.getStore()){this.mun(this.getStore(),"load",this.onEventStoreLoad,this)}if(b){this.mon(b,"load",this.onEventStoreLoad,this)}this.callParent(arguments)},onEventStoreLoad:function(){this.deselectAll()},onEventMouseDown:function(d,e,f){this.selectedOnMouseDown=null;if(!this.isSelected(e)){this.selectedOnMouseDown=e;this.selectWithEvent(e,f)}},onEventClick:function(d,e,f){if(!this.selectedOnMouseDown){this.selectWithEvent(e,f)}},onItemMouseDown:function(d,j,a,b,c){if(this.deselectOnContainerClick&&!c.getTarget(this.view.eventSelector)){this.deselectAll()}},onSelectChange:function(o,q,i,r){var m=this,l=m.view,k=m.store,n=q?"select":"deselect",p=0;if((i||m.fireEvent("before"+n,m,o))!==false&&r()!==false){if(q){l.onEventBarSelect(o,i)}else{l.onEventBarDeselect(o,i)}if(!i){m.fireEvent(n,m,o)}}},selectRange:Ext.emptyFn,selectNode:function(h,g,f){var e=this.view.resolveEventRecord(h);if(e){this.select(e,g,f)}},deselectNode:function(h,g,f){var e=this.view.resolveEventRecord(h);if(e){this.deselect(e,f)}},getFirstSelectedEventForResource:function(i){var l=this.getSelection(),j=null,g,h,k;for(g=0,h=l.length;!j&&g<h;++g){k=l[g];if(k.isAssignedTo(i)){j=k}}return j},getDraggableSelections:function(){return Ext.Array.filter(this.getSelection(),function(b){return b.isDraggable()})},forEachEventRelatedSelection:function(d,c){this.isSelected(d)&&c(d)}});Ext.define("Sch.selection.AssignmentModel",{extend:Sch.selection.EventModel,alias:"selection.assignmentmodel",assignmentStoreDetacher:null,destroy:function(){var b=this;Ext.destroyMembers(b,"assignmentStoreDetacher");b.callParent()},onBindStore:function(e){this.callParent(arguments);var f=e.getAssignmentStore();if(f){var d=this;d.assignmentStoreDetacher&&d.assignmentStoreDetacher.destroy();d.assignmentStoreDetacher=f.on({remove:d.onAssignmentStoreRemove,clear:d.onAssignmentStoreClear,refresh:d.onAssignmentStoreRefresh,scope:d,destroyable:true})}},selectWithEvent:function(e,j){var l=this,i=l.view,m=i.resolveResource(j.getTarget()),k,n;if(m){k=i.getEventStore().getAssignmentStore();n=k.getAssignmentForEventAndResource(e,m);if(n){l.callParent([n,j])}}},getFirstSelectedEventForResource:function(i){var l=this.getSelection(),j=null,g,h,k;for(g=0,h=l.length;!j&&g<h;++g){k=l[g];if(k.getEvent().isAssignedTo(i)){j=k;break}}return j},getDraggableSelections:function(){return Ext.Array.filter(this.getSelection(),function(b){return b.getEvent().isDraggable()})},forEachEventRelatedSelection:function(d,c){Ext.Array.each(this.getSelection(),function(a){a.getEvent()===d&&c(a)})},onAssignmentStoreRemove:function(c,d){this.deselect(d,true)},onAssignmentStoreClear:function(b){this.clearSelections()},onAssignmentStoreRefresh:function(b){this.clearSelections()}});Ext.define("Sch.mixin.SchedulerPanel",{extend:Sch.mixin.AbstractSchedulerPanel,eventSelModelType:null,eventSelModel:null,enableEventDragDrop:true,enableDragCreation:true,dragConfig:null,calendarColumnClass:"Sch.column.Day",componentCls:"sch-schedulerpanel",lockedGridDependsOnSchedule:true,verticalListeners:null,horizontalLockedWidth:null,inheritables:function(){return{variableRowHeight:true,initComponent:function(){var e=this.normalViewConfig=this.normalViewConfig||{};this._initializeSchedulerPanel();this.verticalListeners={clear:this.refreshResourceColumns,datachanged:this.refreshResourceColumns,update:this.refreshResourceColumns,load:this.refreshResourceColumns,scope:this};this.calendarListeners={reconfigure:this.refreshCalendarColumns,priority:1,scope:this};this.normalGridListeners={columnresize:this.onCalendarColumnResize,scope:this};Ext.apply(e,{eventStore:this.eventStore,resourceStore:this.resourceStore,dependencyStore:this.dependencyStore,eventBarTextField:this.eventBarTextField||this.getEventStore().getModel().prototype.nameField});Ext.Array.each(["barMargin","eventBodyTemplate","eventTpl","allowOverlap","dragConfig","eventBarIconClsField","onEventCreated","constrainDragToResource","snapRelativeToEventStartDate","eventSelModelType","eventSelModel","simpleSelect","multiSelect","allowDeselect","lockedGridDependsOnSchedule"],function(a){if(a in this){e[a]=this[a]}},this);this.callParent(arguments);if(this.mode==="vertical"){this.mon(this.resourceStore,this.verticalListeners)}var g=this.lockedGrid.getView();var h=this.getSchedulingView();g.on("resize",this.onLockedViewResize,this);this.registerRenderer(h.columnRenderer,h);if(this.resourceZones){var f=Ext.StoreManager.lookup(this.resourceZones);f.setResourceStore(this.resourceStore);this.resourceZonesPlug=new Sch.plugin.ResourceZones(Ext.apply({store:f},this.resourceZonesConfig));this.resourceZonesPlug.init(this)}h.on("columnwidthchange",this.onColWidthChange,this);this.relayEvents(h,["eventclick","eventlongpress","eventmousedown","eventmouseup","eventdblclick","eventcontextmenu","eventmouseenter","eventmouseleave","eventkeydown","eventkeyup","beforeeventresize","eventresizestart","eventpartialresize","beforeeventresizefinalize","eventresizeend","beforeeventdrag","eventdragstart","eventdrag","beforeeventdropfinalize","eventdrop","aftereventdrop","beforedragcreate","dragcreatestart","beforedragcreatefinalize","dragcreateend","afterdragcreate","beforeeventadd"]);if(!this.syncRowHeight){this.enableRowHeightInjection(g,h)}},applyViewSettings:function(h,e){this.callParent(arguments);var g=this.getSchedulingView(),f;e=e||!this.rendered;if(this.orientation==="vertical"){f=h.timeColumnWidth||60;g.setColumnWidth(h.resourceColumnWidth||100,true);g.setRowHeight(f,true)}},afterRender:function(){this.callParent(arguments);if(this.mode==="vertical"){this.onLockedViewResize(null,null,this.lockedGrid.getView().getHeight())}else{if(this.mode==="calendar"){this.mon(this.timeAxis,this.calendarListeners);this.normalGrid.on(this.normalGridListeners)}}this.getSchedulingView().on({eventdragstart:this.doSuspendLayouts,aftereventdrop:this.doResumeLayouts,eventresizestart:this.doSuspendLayouts,eventresizeend:this.doResumeLayouts,scope:this});if(this.lockedGridDependsOnSchedule){this.getSchedulingView().on("itemupdate",this.onNormalViewItemUpdate,this)}this.relayEvents(this.getEventSelectionModel(),["selectionchange","deselect","select"],"event")},getTimeSpanDefiningStore:function(){return this.eventStore},destroy:function(){var b=this;b.destroyStores&&Ext.destroyMembers(b,"eventStore","resourceStore","assignmentStore","dependencyStore");b.callParent(arguments)}}},doSuspendLayouts:function(){var b=this.getSchedulingView();b.infiniteScroll&&b.timeAxis.on({beginreconfigure:this.onBeginReconfigure,endreconfigure:this.onEndReconfigure,scope:this});this.lockedGrid.suspendLayouts();this.normalGrid.suspendLayouts()},doResumeLayouts:function(){var b=this.getSchedulingView();b.infiniteScroll&&b.timeAxis.un({beginreconfigure:this.onBeginReconfigure,endreconfigure:this.onEndReconfigure,scope:this});this.lockedGrid.resumeLayouts();this.normalGrid.resumeLayouts()},onBeginReconfigure:function(){this.normalGrid.resumeLayouts()},onEndReconfigure:function(){this.normalGrid.suspendLayouts()},onColWidthChange:function(c,d){switch(this.getMode()){case"vertical":this.resourceColumnWidth=d;this.refreshResourceColumns();break;case"calendar":this.calendarColumnWidth=d;this.refreshCalendarColumns();break}},enableRowHeightInjection:function(j,h){var f=this;var i=new Ext.XTemplate("{%","this.processCellValues(values);","this.nextTpl.applyOut(values, out, parent);","%}",{priority:1,processCellValues:function(e){if(h.mode==="horizontal"){var d=1;if(h.dynamicRowHeight){var a=e.record;var b=h.eventLayout.horizontal;d=b.getNumberOfBands(a,function(){return h.getEventStore().filterEventsForResource(a,h.timeAxis.isRangeInAxis,h.timeAxis)})}var c=(d*f.getRowHeight())-((d-1)*h.barMargin)-h.cellTopBorderWidth-h.cellBottomBorderWidth;e.style=(e.style||"")+";height:"+c+"px;"}}});j.addCellTpl(i);Ext.Array.each(j.getColumnManager().getColumns(),function(a){a.hasCustomRenderer=true});var g=this.getView().getStoreListeners();g=Ext.apply({},g);g.scope=this.getView();this.store.un(g);this.store.on(g)},getEventSelectionModel:function(){return this.getSchedulingView().getEventSelectionModel()},refreshResourceColumns:function(){var b=this.resourceColumnWidth||this.timeAxisViewModel.resourceColumnWidth;this.reconfigure(this.verticalColumns.concat(this.createResourceColumns(b)))},onCalendarColumnResize:function(f,d,e){if(e!==this.timeAxisViewModel.calendarColumnWidth){this.timeAxisViewModel.setViewColumnWidth(e,true)}this.getSchedulingView().calendar.repaintEventsForColumn(d,f.columnManager.indexOf(d))},refreshCalendarColumns:function(){var c=this.createCalendarRows();var d=this.createCalendarColumns();this.reconfigure(c,this.calendarColumns.concat(d))},setOrientation:function(){this.setMode.apply(this,arguments)},setMode:function(o,r){if(!this.normalGrid){this.on("afterrender",function(){this.setMode(o,true)});return}if(o===this.mode&&!r){return}switch(o){case"horizontal":this.addCls("sch-horizontal");this.removeCls(["sch-vertical","sch-calendar","sch-vertical-resource"]);break;case"vertical":this.addCls(["sch-vertical-resource","sch-vertical"]);this.removeCls(["sch-calendar","sch-horizontal"]);break;case"calendar":this.addCls(["sch-calendar","sch-vertical"]);this.removeCls(["sch-vertical-resource","sch-horizontal"]);break}this.mode=o;var k=this,n=function(){return false},l=k.normalGrid,j=k.lockedGrid.getView(),m=k.getSchedulingView(),p=l.headerCt;j.on("beforerefresh",n);m.on("beforerefresh",n);m.blockRefresh=j.blockRefresh=true;Ext.suspendLayouts();m.setMode(o);p.removeAll(true);if(o!=="calendar"){k.timeAxis.setMode("plain");k.mun(k.timeAxis,k.calendarListeners);if(k._oldViewPreset){k.setViewPreset.apply(k,k._oldViewPreset);delete k._oldViewPreset}}else{k._oldViewPreset=[k.viewPreset,k.timeAxis.getStart(),k.timeAxis.getEnd()];k.timeAxis.setMode("calendar");k.setViewPreset(k.calendarViewPreset);k.mon(k.timeAxis,k.calendarListeners)}if(o==="horizontal"){k.mun(k.resourceStore,k.verticalListeners);k.normalGrid.un(k.normalGridListeners);m.setRowHeight(k.rowHeight||k.timeAxisViewModel.rowHeightHorizontal,true);k.reconfigure(k.resourceStore,k.horizontalColumns);if(this.horizontalLockedWidth!==null){this.lockedGrid.setWidth(this.horizontalLockedWidth)}}else{if(o==="calendar"){k.mun(k.resourceStore,k.verticalListeners);k.normalGrid.on(k.normalGridListeners);k.refreshCalendarColumns();m.setRowHeight(k.rowHeight||k.timeAxisViewModel.rowHeightVertical,true);m.setColumnWidth(k.timeAxisViewModel.calendarColumnWidth||100,true)}else{k.normalGrid.un(k.normalGridListeners);var q=0;this.horizontalLockedWidth=this.lockedGrid.getWidth();k.mon(k.resourceStore,k.verticalListeners);k.reconfigure(k.timeAxis,k.verticalColumns.concat(k.createResourceColumns(k.resourceColumnWidth||k.timeAxisViewModel.resourceColumnWidth)));Ext.Array.each(k.lockedGrid.query("gridcolumn"),function(a){q+=a.rendered?a.getWidth():a.width||100});m.setColumnWidth(k.timeAxisViewModel.resourceColumnWidth||100,true);k.lockedGrid.setWidth(q)}}j.un("beforerefresh",n);m.un("beforerefresh",n);m.blockRefresh=j.blockRefresh=false;k.refreshViews(false);Ext.resumeLayouts(true);this.fireEvent("modechange",this,o);this.fireEvent("orientationchange",this,o)},createCalendarRows:function(){var d=this;var c=d.timeAxis.getRowTicks();d.timeAxisViewModel.calendarRowsAmount=c.length;return new Ext.data.Store({model:"Sch.model.TimeAxisTick",data:c})},createCalendarColumns:function(){var d=this;var f=d.timeAxis.headerConfig.middle;var e=[];d.timeAxis.forEachAuxInterval(f.splitUnit,null,function(a,h,c){a.setHours(this.startTime);h=new Date(a);h.setHours(this.endTime);var b={xclass:d.calendarColumnClass,renderer:d.mainRenderer,scope:d,start:a,end:h};if(f.renderer){b.text=f.renderer.call(f.scope||d,a,h,b,c,d.getEventStore())}else{b.text=Ext.Date.format(a,f.dateFormat)}e.push(b)});return e},setRowHeight:function(d,c){c=c||!this.lockedGrid;this.timeAxisViewModel.setViewRowHeight(d,c)},onNormalViewItemUpdate:function(f,e,g){if(this.lockedGridDependsOnSchedule){var h=this.lockedGrid.getView();h.suspendEvents();h.refreshNode(h.indexOf(f));if(this.syncRowHeight){this.syncRowHeights()}h.resumeEvents()}},onLockedViewResize:function(h,e,f){var g=this.getMode();if(g==="vertical"||g==="calendar"){this.timeAxisViewModel.update(f-21)}}});Ext.define("Sch.patches.TableView",{extend:Sch.util.Patch,target:"Ext.view.Table",minVersion:"6.0.1",maxVersion:"6.0.1.9999",overrides:{suspendCellEditing:function(e){var f=e,d=f.activeEditor;if(d&&d.editing){f.suspendedEditor=d;f.suspendEvents();d.suspendEvents();d.cancelEdit(true);d.resumeEvents();f.resumeEvents()}},resumeCellEditing:function(j,f){var h=j,i=h.activeEditor=h.suspendedEditor,g;if(i){h.suspendEvents();i.suspendEvents();g=h.activateCell(f,true,true);i.field&&i.field.focus(false,true);i.resumeEvents();h.resumeEvents()}return g},suspendActionableMode:function(){var h=this,f=h.grid.actionables,g=f.length,i;for(i=0;i<g;i++){var j=f[i];if(Ext.grid.plugin.CellEditing&&j instanceof Ext.grid.plugin.CellEditing){h.suspendCellEditing(j)}}},resumeActionableMode:function(n){var j=this,m=j.grid.actionables,h=m.length,k,i;j.toggleChildrenTabbability(false);for(k=0;k<h;k++){var l=m[k];if(!i&&Ext.grid.plugin.CellEditing&&l instanceof Ext.grid.plugin.CellEditing){i=j.resumeCellEditing(l,n)}}if(!i){j.activateCell(n)}},saveFocusState:function(){var m=this,l=m.dataSource,r=m.actionableMode,p=m.getNavigationModel(),o=r?m.actionPosition:p.getPosition(true),q=Ext.Element.getActiveElement(true),j=o&&o.view===m&&o.getCell(),n,k;if(j&&j.contains(q)){o=o.clone();q.suspendFocusEvents();if(r){m.suspendActionableMode()}else{p.setPosition()}q.resumeFocusEvents();return function(){if(l.getCount()){n=Math.min(o.rowIdx,m.all.getCount()-1);k=Math.min(o.colIdx,m.getVisibleColumnManager().getColumns().length-1);o=new Ext.grid.CellContext(m).setPosition(l.contains(o.record)?o.record:n,k);if(r){m.resumeActionableMode(o)}else{p.setPosition(o,null,null,null,true)}}else{o.column.focus()}}}return Ext.emptyFn},activateCell:function(){return true},onFocusEnter:function(b){if(!Ext.fly(b.target).hasCls("sch-event")){this.callParent(arguments)}}}});Ext.define("Sch.patches.TableView_6_0_2",{extend:Sch.util.Patch,target:"Ext.view.Table",minVersion:"6.0.2",overrides:{handleUpdate:function(au,W,ab,af,i,R){ab=ab||Ext.data.Model.EDIT;var ao=this,M=ao.store.indexOf(W),O=ao.rowTpl,Z=ao.markDirty,ad=ao.dirtyCls,X=ab!==Ext.data.Model.EDIT,ac=[],aj=ao.variableRowHeight,av=0,V=ao.ownerCt,ag=ao.cellFly||(ao.self.prototype.cellFly=new Ext.dom.Fly()),S,ar,at,aq,aw,ah,N,Q,ap,T,am,P,ai,ae,ak,U,aa,Y,an,al;if(ao.viewReady){S=ao.getNodeByRecord(W);if(S){if(W.isCollapsedPlaceholder){Ext.fly(S).syncContent(ao.createRowElement(W,ao.indexOfRow(W)));return}Q=ao.overItemCls;ap=ao.ownerCt.getVisibleColumnManager().getColumns();if(R){ac=ap;av=1}else{for(P=0,am=ap.length;P<am;P++){T=ap[P];if(T.preventUpdate){ae=Ext.fly(S).down(T.getCellSelector(),true);if(ae&&!X&&Z){ag.attach(ae);if(W.isModified(T.dataIndex)){ag.addCls(ad)}else{ag.removeCls(ad)}}}else{ai=ao.shouldUpdateCell(W,T,af);if(ai){av=av|ai;ac[ac.length]=T;aj=aj||T.variableRowHeight}}}}ao.fireEvent("beforeitemupdate",W,M,S,ac);if(ao.getRowClass||!ao.getRowFromItem(S)||(av&1)||(S.tBodies[0].childNodes.length>1)){an=S._extData;at=ao.createRowElement(W,ao.indexOfRow(W),ac);if(Ext.fly(S,"_internal").hasCls(Q)){Ext.fly(at).addCls(Q)}if(Ext.isIE9m&&S.mergeAttributes){S.mergeAttributes(at,true)}else{aq=at.attributes;aw=aq.length;for(N=0;N<aw;N++){ah=aq[N].name;if(ah!=="id"){S.setAttribute(ah,aq[N].value)}}}if(an){an.isSynchronized=false}if(ap.length&&(ar=ao.getRow(S))){ao.updateColumns(ar,Ext.fly(at).down(ao.rowSelector,true),ac)}while(O){if(O.syncContent){if(O.syncContent(S,at,af?ac:null)===false){break}}O=O.nextTpl}}else{for(P=0,am=ac.length;P<am;P++){T=ac[P];ak=T.dataIndex;U=W.get(ak);ae=Ext.fly(S).down(T.getCellSelector(),true);ag.attach(ae);if(!X&&Z){if(W.isModified(T.dataIndex)){ag.addCls(ad)}else{ag.removeCls(ad)}}aa=T.usingDefaultRenderer;Y=aa?T:T.scope;if(T.updater){Ext.callback(T.updater,Y,[ae,U,W,ao,ao.dataSource],0,T,V)}else{if(T.renderer){U=Ext.callback(T.renderer,Y,[U,null,W,0,0,ao.dataSource,ao],0,T,V)}al=U==null||U==="";U=al?T.emptyCellText:U;if(T.producesHTML||al){ag.down(ao.innerSelector,true).innerHTML=U}else{ag.down(ao.innerSelector,true).childNodes[0].data=U}}if(ao.highlightClass){Ext.fly(ae).addCls(ao.highlightClass);if(!ao.changedCells){ao.self.prototype.changedCells=[];ao.prototype.clearChangedTask=new Ext.util.DelayedTask(ao.clearChangedCells,ao.prototype);ao.clearChangedTask.delay(ao.unhighlightDelay)}ao.changedCells.push({cell:ae,cls:ao.highlightClass,expires:Ext.Date.now()+1000})}}}if(X&&Z&&!W.dirty){Ext.fly(S,"_internal").select("."+ad).removeCls(ad)}if(aj){Ext.suspendLayouts()}ao.fireEvent("itemupdate",W,M,S);if(aj){ao.ownerGrid.updateLayout();Ext.resumeLayouts(true)}}}},privates:{setActionableMode:function(q,s){var o=this,x=o.getNavigationModel(),v,n=o.grid.actionables,r=n.length,u,t,w,i=false,p;if(o.actionableMode===q){if(!q||s.isEqual(o.actionPosition)){return false}}if(q){if(s&&(s.view===o||(s.view===(p=o.lockingPartner)&&p.actionableMode))){i=o.activateCell(s)}return i}else{v=Ext.fly(Ext.Element.getActiveElement());if(o.el.contains(v)){t=(o.actionPosition&&o.actionPosition.record)||o.getRecord(v);w=o.getHeaderByCell(v.findParent(o.getCellSelector()));if(!s){s=new Ext.grid.CellContext(o).setPosition(t||0,w||0)}o._leavingActionableMode=true;s.getCell().focus();o._leavingActionableMode=false;v=Ext.fly(Ext.Element.getActiveElement());if(!(o.el.contains(v)&&v.is(o.getCellSelector()))){s=null}}for(u=0;u<r;u++){if(n[u].deactivate){n[u].deactivate()}}if(o.actionRow){o.actionRow.saveTabbableState({skipSelf:true,includeSaved:false})}if(o.destroyed){return false}o.actionableMode=o.ownerGrid.actionableMode=false;o.actionPosition=x.actionPosition=o.actionRow=null;if(s){x.setPosition(s)}}}},saveFocusState:function(){var m=this,l=m.dataSource,r=m.actionableMode,p=m.getNavigationModel(),o=r?m.actionPosition:p.getPosition(true),q=Ext.Element.getActiveElement(true),j=o&&o.view===m&&o.getCell(),n,k;if(j&&j.contains(q)){o=o.clone();q.suspendFocusEvents();if(r){m.suspendActionableMode()}else{p.setPosition()}q.resumeFocusEvents();return function(){if(l.getCount()){n=Math.min(o.rowIdx,m.all.getCount()-1);k=Math.min(o.colIdx,m.getVisibleColumnManager().getColumns().length-1);o=new Ext.grid.CellContext(m).setPosition(l.contains(o.record)?o.record:n,k);if(r&&!m._leavingActionableMode){m.resumeActionableMode(o)}else{p.setPosition(o,null,null,null,true)}}else{o.column.focus()}}}return Ext.emptyFn}}});Ext.define("Sch.patches.TablePanel",{extend:Sch.util.Patch,target:"Ext.panel.Table",applyFn:function(){var b={};if(Ext.getVersion().equals("6.0.1.250")){b.ensureVisible=function(a,d){if(d&&d.column&&this.getVisibleColumnManager().indexOf(d.column)===-1){return}this.callParent(arguments)}}Ext.ClassManager.get(this.target).override(b)}});Ext.define("Sch.patches.BufferedRenderer",{extend:Sch.util.Patch,target:"Ext.grid.plugin.BufferedRenderer",minVersion:"6.0.2",overrides:{onRangeFetched:function(J,V,X,Y,H){var K=this,L=K.view,R=L.el,N=L.all,M=0,G=K.variableRowHeight,P=(L.lockingPartner&&!H&&!K.doNotMirror)&&L.lockingPartner.bufferedRenderer,W,E,I,F,D,Q,O,i,Z,aa,U,S,C,ab;if(L.destroyed){return}if(J){if(!H){K.scrollTop=K.view.getScrollY()}}else{J=K.store.getRange(V,X);if(!J){return}}W=Ext.Element.getActiveElement();I=R.contains(W);E=V*K.rowHeight;if(V<N.startIndex&&X>N.endIndex){C=N.startIndex-V;L.clearViewEl(true);D=L.doAdd(J,V);L.fireEvent("itemadd",J,V,D);for(F=0;F<C;F++){M-=D[F].offsetHeight}Q=K.bodyTop+M}else{i=K.teleported||V>N.endIndex||X<N.startIndex;if(i){L.clearViewEl(true);K.teleported=false}if(!N.getCount()){D=L.doAdd(J,V);L.fireEvent("itemadd",J,V,D);Q=E;if(i&&G){ab=K.scrollTop<K.position?K.leadingBufferZone:K.trailingBufferZone;var T=Math.min(N.startIndex+ab-1,N.endIndex);Q=Math.max(K.scrollTop-N.item(T,true).offsetTop,0)}}else{if(X>N.endIndex){S=Math.max(V-N.startIndex,0);if(G){M=N.item(N.startIndex+S,true).offsetTop}D=N.scroll(Ext.Array.slice(J,N.endIndex+1-V),1,S);if(G){Q=K.bodyTop+M}else{Q=E}}else{S=Math.max(N.endIndex-X,0);Z=N.startIndex;D=N.scroll(Ext.Array.slice(J,0,N.startIndex-V),-1,S);if(G){Q=K.bodyTop-N.item(Z,true).offsetTop;if(!N.startIndex){if(Q){L.setScrollY(K.position=(K.scrollTop-=Q));Q=0}}else{if(Q<0){M=N.startIndex*K.rowHeight;L.setScrollY(K.position=(K.scrollTop+=M));Q=K.bodyTop+M}}}else{Q=E}}}K.position=K.scrollTop}if(I&&!R.contains(W)){U=L.actionableMode?L.actionPosition:L.lastFocused;if(U&&U.column){L.onFocusLeave({});if(U.column.focusable){O=U.column}else{O=U.column.el.findTabbableElements()[0]}if(!O){O=L.el}O.focus()}}Q=Math.max(Math.floor(Q),0);if(L.positionBody){K.setBodyTop(Q)}if(D&&P&&!P.disabled){P.scrollTop=P.position=K.scrollTop;if(P.view.ownerCt.isVisible()){aa=P.onRangeFetched(J,V,X,Y,true);if(L.ownerGrid.syncRowHeight||(P.variableRowHeight!==G)){K.syncRowHeights(D,aa)}}if(P.bodyTop!==Q){P.setBodyTop(Q)}P.view.setScrollY(K.scrollTop)}if(L.getVisibleColumnManager().getColumns().length&&N.getCount()!==Math.min(K.store.getCount(),K.viewSize)){Ext.raise("rendered block refreshed at "+N.getCount()+" rows while BufferedRenderer view size is "+K.viewSize)}return D},doRefreshView:function(B,t,C,r){var v=this,u=v.view,s=u.all,x=s.startIndex,z=s.endIndex,w,y,G=s.getCount(),D,H=t!==s.startIndex,E,F,A;u.refreshing=v.refreshing=true;if(u.refreshCounter){if(u.hasListeners.beforerefresh&&u.fireEvent("beforerefresh",u)===false){return u.refreshNeeded=u.refreshing=v.refreshing=false}A=u.saveFocusState();u.clearViewEl(true);u.refreshCounter++;if(B.length){D=u.doAdd(B,t);if(H){w=s.item(x,true);y=s.item(z,true);if(w){F=-w.offsetTop}else{if(y){F=s.last(true).offsetTop-y.offsetTop}}if(F){v.bodyTop=Math.max(v.bodyTop+F,0);v.scrollTop=v.bodyTop?v.scrollTop+F:0}else{v.bodyTop=E=t*v.rowHeight;v.scrollTop=Math.max(E-v.rowHeight*(E<v.bodyTop?v.leadingBufferZone:v.trailingBufferZone,0))}}}else{if(v.scrollTop){v.bodyTop=v.scrollTop=0}u.addEmptyText()}if(H){v.setBodyTop(v.bodyTop);u.suspendEvent("scroll");u.setScrollY(v.position=v.scrollTop);u.resumeEvent("scroll")}v.refreshSize();u.refreshSize(s.getCount()!==G);u.fireEvent("refresh",u,B);A();u.headerCt.setSortState()}else{u.refresh()}if(!(u.ownerGrid.mixins["Sch.mixin.TimelinePanel"])&&u.getVisibleColumnManager().getColumns().length&&s.getCount()!==Math.min(v.store.getCount(),v.viewSize)){Ext.raise("rendered block refreshed at "+s.getCount()+" rows while BufferedRenderer view size is "+v.viewSize)}u.refreshNeeded=u.refreshing=v.refreshing=false}}});Ext.define("Sch.patches.CellContext",{extend:Sch.util.Patch,target:"Ext.grid.CellContext",minVersion:"6.0.0",applyFn:function(){var b={setAll:function(l,k,j,a,h){var i=this;if(h&&j==-1&&l!==i.view){l=i.view;j=l.getVisibleColumnManager().indexOf(h)}return this.callParent(arguments)}};if(Ext.getVersion().isGreaterThanOrEqual("6.0.1")){b.setPosition=function(d,a){d=d||0;a=a||0;return this.callParent(arguments)}}Ext.override(Ext.grid.CellContext,b)}});Ext.define("Sch.patches.RowSynchronizer",{extend:Sch.util.Patch,target:"Ext.grid.locking.RowSynchronizer",minVersion:"6.0.0",maxVersion:"6.0.1",overrides:{finish:function(b){if(!b){return}return this.callParent(arguments)}}});Ext.define("Sch.patches.Explorer",{extend:Sch.util.Patch,minVersion:"6.0.0",maxVersion:"6.0.1",applyFn:function(){if(Ext.isIE9m){Ext.util.CSS.createStyleSheet("."+Ext.baseCSSPrefix+"column-header-trigger { z-index: 10; }")}}});Ext.define("Sch.mixin.TimelinePanel",{extend:Sch.mixin.AbstractTimelinePanel,mixins:[Sch.mixin.Zoomable,Sch.mixin.PartnerTimelinePanel],destroyStores:false,bufferCoef:5,bufferThreshold:0.2,infiniteScroll:false,showCrudManagerMask:true,highlightWeekends:false,showTodayLine:false,calendar:null,waitingForAutoTimeSpan:false,columnLinesFeature:null,renderWaitListener:null,schedulePinchThreshold:30,pinchStartDistanceX:null,pinchStartDistanceY:null,pinchDistanceX:null,pinchDistanceY:null,horizontalColumns:null,verticalColumns:null,calendarColumns:null,forceDefineTimeSpanByStore:false,workingTimePlugin:null,split:true,viewRefreshRequested:null,tipCfg:{cls:"sch-tip",showDelay:400,hideDelay:0,autoHide:true,anchor:"b"},inheritables:function(){return{columnLines:true,enableLocking:true,lockable:true,stateEvents:["viewchange"],syncRowHeight:false,cellTopBorderWidth:0,initComponent:function(){if(this.partnerTimelinePanel){if(typeof this.partnerTimelinePanel==="string"){this.partnerTimelinePanel=Ext.getCmp(this.partnerTimelinePanel)}this.timeAxisViewModel=this.partnerTimelinePanel.timeAxisViewModel;this.timeAxis=this.partnerTimelinePanel.getTimeAxis();this.startDate=this.timeAxis.getStart();this.endDate=this.timeAxis.getEnd()}this._initializeTimelinePanel();this.configureChildGrids();this.forceFit=false;this.configureColumns();var i=this.normalViewConfig=this.normalViewConfig||{};var h=this.getId();Ext.apply(this.normalViewConfig,{id:h+"-timelineview",eventPrefix:this.autoGenId?null:h,timeAxisViewModel:this.timeAxisViewModel,eventBorderWidth:this.eventBorderWidth,timeAxis:this.timeAxis,readOnly:this.readOnly,mode:this.mode,rtl:this.rtl,cellBorderWidth:this.cellBorderWidth,cellTopBorderWidth:this.cellTopBorderWidth,cellBottomBorderWidth:this.cellBottomBorderWidth,infiniteScroll:this.infiniteScroll,bufferCoef:this.bufferCoef,bufferThreshold:this.bufferThreshold});Ext.Array.each(["eventRendererScope","eventRenderer","dndValidatorFn","resizeValidatorFn","createValidatorFn","tooltipTpl","validatorFnScope","eventResizeHandles","enableEventDragDrop","enableDragCreation","resizeConfig","createConfig","tipCfg","getDateConstraints"],function(a){if(a in this){i[a]=this[a]}},this);this.callParent(arguments);if(this.rtl){this.lockedGrid.view.addCls("sch-locked-column-fixer");this.addCls("sch-rtl")}else{this.addCls("sch-ltr")}var g=this.plugins=[].concat(this.plugins||[]);if(this.highlightWeekends){this.workingTimePlugin=Ext.create("Sch.plugin.NonWorkingTime",{calendar:this.calendar});g.push(this.workingTimePlugin);this.addCls("sch-timelinepanel-highlightweekends")}if(this.showTodayLine){this.todayLinePlugin=new Sch.plugin.CurrentTimeLine();g.push(this.todayLinePlugin)}this.patchNavigationModel(this);if(Ext.supports.Touch){this.timeAxisViewModel.on("update",this.refreshHeaderContainerScrollable,this)}this.setViewPreset(this.viewPreset,this.startDate||this.timeAxis.getStart(),this.endDate||this.timeAxis.getEnd(),true);if(!this.startDate){var f=this.getTimeSpanDefiningStore();if(f.isTreeStore?f.getRoot().childNodes.length:f.getCount()){this.applyStartEndDatesFromStore()}else{if(f.isLoading()||this.forceDefineTimeSpanByStore){this.bindAutoTimeSpanListeners()}}}var j=this.columnLines;if(j){this.columnLinesFeature=new Sch.feature.ColumnLines(Ext.isObject(j)?j:undefined);this.columnLinesFeature.init(this);this.columnLines=true}this.relayEvents(this.getSchedulingView(),["beforetooltipshow","scheduleclick","scheduledblclick","schedulecontextmenu","schedulepinch","schedulepinchstart","schedulepinchend"]);this.on("zoomchange",function(){this.normalGrid.scrollTask.cancel()});if(this.crudManager){if(!this.crudManager.autoSync&&this.showCrudManagerMask){this.mon(this.crudManager,{beforesend:this.beforeCrudOperationStart,synccanceled:this.onCrudOperationComplete,loadcanceled:this.onCrudOperationComplete,load:this.onCrudOperationComplete,sync:this.onCrudOperationComplete,requestfail:this.onCrudOperationComplete,scope:this});if(this.crudManager.isLoading()){this.beforeCrudOperationStart(this.crudManager,null,"load")}}this.mon(this.crudManager,{beforeloadapply:this.onCrudBeforeLoad,load:this.onCrudLoad,scope:this})}this.afterInitComponent()},refreshHeaderContainerScrollable:function(){var c=this.getSchedulingView().headerCt.getScrollable();if(!c){return}if(Ext.getVersion().isLessThan("6.0.1")){var d=c.isConfiguring;c.isConfiguring=true;c.doRefresh();c.refreshAxes();c.isConfiguring=d}else{c.doRefresh()}},getState:function(){var d=this,c=d.callParent(arguments);Ext.apply(c,{viewPreset:d.viewPreset,startDate:d.getStart(),endDate:d.getEnd(),zoomMinLevel:d.zoomMinLevel,zoomMaxLevel:d.zoomMaxLevel,currentZoomLevel:d.currentZoomLevel});return c},applyState:function(c){var d=this;d.callParent(arguments);if(c&&c.viewPreset){d.setViewPreset(c.viewPreset,c.startDate,c.endDate)}if(c&&c.currentZoomLevel){d.zoomToLevel(c.currentZoomLevel)}},setTimeSpan:function(){this.callParent(arguments);if(this.waitingForAutoTimeSpan){this.unbindAutoTimeSpanListeners(false);this.getView().refresh()}if(!this.normalGrid.getView().viewReady){this.getView().refresh()}},onBoxReady:function(){var b=this;b.callParent(arguments);if(b.partnerTimelinePanel){if(b.partnerTimelinePanel.rendered){b.setupPartnerTimelinePanel(b.partnerTimelinePanel)}else{b.partnerTimelinePanel.on("boxready",b.setupPartnerTimelinePanel,b)}}b.normalGrid.on({collapse:b.onNormalGridCollapse,expand:b.onNormalGridExpand,scope:b});b.lockedGrid.on({collapse:b.onLockedGridCollapse,expand:b.onLockedGridExpand,scope:b});b.lockedGrid.on({itemdblclick:b.onLockedGridItemDblClick,scope:b});if(Ext.supports.Touch){this.getSchedulingView().on({schedulepinchstart:this.onSchedulePinchStart,schedulepinch:this.onSchedulePinch,schedulepinchend:this.onSchedulePinchEnd,scope:this})}}}},scrollToDate:function(h,e){var f=this.getSchedulingView();if(f.isCalendar()){var g=f.calendar.getColumnsBy(function(a){return a.start<=h&&a.end>h})[0];if(g){f.scrollHorizontallyTo(g.getLocalX());f.scrollVerticallyTo(f.getCoordinateFromDate(h,true))}}else{return this.callParent(arguments)}},scrollToDateCentered:function(j,k){var l=this.getSchedulingView();if(l.isCalendar()){var i=l.calendar.getColumnsBy(function(a){return a.start<=j&&a.end>j})[0];if(i){var g=l.getBox().width/2;var h=l.getBox().height/2;l.scrollHorizontallyTo(Math.max(i.getLocalX()-g,0));l.scrollVerticallyTo(Math.max(l.getCoordinateFromDate(j,true)-h,0))}}else{return this.callParent(arguments)}},bindAutoTimeSpanListeners:function(){var b=this.getTimeSpanDefiningStore();this.waitingForAutoTimeSpan=true;this.suspendViewsRefresh();this.mon(b,"load",this.applyStartEndDatesFromStore,this);if(b.isTreeStore){this.mon(b,"rootchange",this.applyStartEndDatesFromStore,this);this.mon(b,"nodeappend",this.applyStartEndDatesAfterTreeAppend,this)}else{this.mon(b,"add",this.applyStartEndDatesFromStore,this)}},refreshStopper:function(b){this.viewRefreshRequested=this.viewRefreshRequested||{};this.viewRefreshRequested[b.isLockedView?"locked":"normal"]=true;return false},suspendViewsRefresh:function(){var d=this.normalGrid.view;var c=this.lockedGrid.view;d.on("beforerefresh",this.refreshStopper,this);c.on("beforerefresh",this.refreshStopper,this);d.blockRefresh=true;c.blockRefresh=true},resumeViewsRefresh:function(e){e=e!==false;var h=this.normalGrid.view;var g=this.lockedGrid.view;h.un("beforerefresh",this.refreshStopper,this);g.un("beforerefresh",this.refreshStopper,this);h.blockRefresh=false;g.blockRefresh=false;var f=this.viewRefreshRequested||{};f.locked=f.locked||g.refreshNeeded;f.normal=f.normal||h.refreshNeeded;if(e){if(f.locked&&f.normal){Ext.suspendLayouts();this.getView().relayFn("refreshView");Ext.resumeLayouts(true)}else{if(f.locked){g.refreshView()}else{if(f.normal){h.refreshView()}}}}this.viewRefreshRequested=null},getTimeSpanDefiningStore:function(){throw"Abstract method called"},unbindAutoTimeSpanListeners:function(c){this.waitingForAutoTimeSpan=false;var d=this.getTimeSpanDefiningStore();this.resumeViewsRefresh(c);d.un("load",this.applyStartEndDatesFromStore,this);if(d.isTreeStore){d.un("rootchange",this.applyStartEndDatesFromStore,this);d.un("nodeappend",this.applyStartEndDatesAfterTreeAppend,this)}else{d.un("add",this.applyStartEndDatesFromStore,this)}},applyStartEndDatesAfterTreeAppend:function(){var b=this.getTimeSpanDefiningStore();if(!b.isSettingRoot&&!b.__loading){this.applyStartEndDatesFromStore()}},applyStartEndDatesFromStore:function(){var d=this.getTimeSpanDefiningStore();var c=d.getTotalTimeSpan();if(c.end&&c.start&&c.end-c.start===0){c.start=Sch.util.Date.add(c.start,this.timeAxis.mainUnit,-1);c.end=Sch.util.Date.add(c.end,this.timeAxis.mainUnit,1)}this.setTimeSpan(c.start||new Date(),c.end)},onLockedGridItemDblClick:function(f,g,j,h,i){if(this.mode==="vertical"&&g){this.fireEvent("timeheaderdblclick",this,g.get("start"),g.get("end"),h,i)}},getSchedulingView:function(){return this.normalGrid&&this.normalGrid.view},getHorizontalTimeAxisColumn:function(){return this.getSchedulingView().getHorizontalTimeAxisColumn()},configureColumns:function(){var e=this.columns||[];if(e.items){e=e.items.slice()}else{e=this.columns=e.slice()}var f=[];var d=[];Ext.Array.each(e,function(a){if(a.position==="right"||a.locked===false){if(!Ext.isNumber(a.width)){Ext.Error.raise('"Right" columns must have a fixed width')}a.locked=false;d.push(a)}else{a.locked=true;f.push(a)}a.lockable=false});if(e.length===0){this.split=false}Ext.Array.erase(e,0,e.length);Ext.Array.insert(e,0,f.concat(Ext.Array.findBy(d,function(a){return a.xtype==="timeaxiscolumn"})?[]:{xtype:"timeaxiscolumn",timeAxisViewModel:this.timeAxisViewModel,trackHeaderOver:this.trackHeaderOver,renderer:this.mainRenderer,variableRowHeight:this.variableRowHeight,scope:this}).concat(d));this.horizontalColumns=e.slice();this.verticalColumns=this.verticalColumns||[Ext.apply({xtype:"verticaltimeaxis"},this.timeAxisColumnCfg||{})];Ext.Array.each(this.verticalColumns,function(a){Ext.apply(a,{timeAxis:this.timeAxis,timeAxisViewModel:this.timeAxisViewModel,cellTopBorderWidth:this.cellTopBorderWidth,cellBottomBorderWidth:this.cellBottomBorderWidth})},this);this.calendarColumns=[Ext.apply({xtype:"verticaltimeaxis",width:60,timeAxis:this.timeAxis,timeAxisViewModel:this.timeAxisViewModel,cellTopBorderWidth:this.cellTopBorderWidth,cellBottomBorderWidth:this.cellBottomBorderWidth},this.calendarTimeAxisCfg||{})];if(this.mode==="vertical"){this.columns=this.verticalColumns.concat(this.createResourceColumns(this.resourceColumnWidth||this.timeAxisViewModel.resourceColumnWidth));this.store=this.timeAxis}else{if(this.mode==="calendar"){this.columns=[];this.store=null;this.on("afterrender",this.refreshCalendarColumns,this)}}},mainRenderer:function(u,i,p,n,m){var t=this.renderers,s=this.mode==="horizontal"||this.mode==="calendar"?p:this.getResourceStore().getAt(m),v="&nbsp;";i.rowHeight=null;for(var r=0;r<t.length;r++){v+=t[r].fn.call(t[r].scope||this,u,i,s,n,m)||""}if(this.variableRowHeight){var o=this.getSchedulingView();var q=this.getRowHeight();i.style="height:"+((i.rowHeight||q)-o.cellTopBorderWidth-o.cellBottomBorderWidth)+"px"}return v},onNormalGridCollapse:function(){var b=this;if(!b.normalGrid.reExpander){b.normalGrid.reExpander=b.normalGrid.placeholder}if(!b.lockedGrid.rendered){b.lockedGrid.on("render",b.onNormalGridCollapse,b,{delay:1})}else{b.lockedGrid.savedWidth=b.lockedGrid.getWidth();if(b.lockedGrid.collapsed){b.lockedGrid.expand()}b.lockedGrid.setWidth(b.getWidth()-b.normalGrid.getPlaceholder().getWidth());b.addCls("sch-normalgrid-collapsed")}},onNormalGridExpand:function(){this.removeCls("sch-normalgrid-collapsed")},onLockedGridCollapse:function(){var b=this;if(b.normalGrid.collapsed){b.normalGrid.expand()}},onLockedGridExpand:function(){if(this.lockedGrid.savedWidth){this.lockedGrid.setWidth(this.lockedGrid.savedWidth)}},beforeCrudOperationStart:function(e,f,d){if(this.rendered){this.setLoading({msg:d==="load"?this.L("loadingText"):this.L("savingText")})}else{Ext.destroy(this.renderWaitListener);this.renderWaitListener=this.on("render",Ext.Function.bind(this.beforeCrudOperationStart,this,Array.prototype.slice.apply(arguments)),this,{delay:1,destroyable:true})}},onCrudBeforeLoad:function(){this.suspendViewsRefresh()},onCrudLoad:function(){this.resumeViewsRefresh()},onCrudOperationComplete:function(){Ext.destroy(this.renderWaitListener);this.setLoading(false)},onSchedulePinchStart:function(d,c){this.pinchStartDistanceX=Math.abs(c.touches[0].pageX-c.touches[1].pageX);this.pinchStartDistanceY=Math.abs(c.touches[0].pageY-c.touches[1].pageY)},onSchedulePinch:function(d,c){this.pinchDistanceX=Math.abs(c.touches[0].pageX-c.touches[1].pageX);this.pinchDistanceY=Math.abs(c.touches[0].pageY-c.touches[1].pageY)},onSchedulePinchEnd:function(h){var j=this.pinchDistanceX;var k=this.pinchDistanceY;var i=this.getMode()[0]==="h";if(Math.abs(j-this.pinchStartDistanceX)>this.schedulePinchThreshold){var l=Math.abs(j/this.pinchStartDistanceX);if(i){l>1?this.zoomIn():this.zoomOut()}else{this.timeAxisViewModel.setViewColumnWidth(l*this.timeAxisViewModel.resourceColumnWidth)}}if(Math.abs(k-this.pinchStartDistanceY)>this.schedulePinchThreshold){var g=Math.abs(k/this.pinchStartDistanceY);h.setRowHeight(h.getRowHeight()*g)}this.pinchStartDistanceX=this.pinchStartDistanceY=this.pinchDistanceX=this.pinchDistanceY=null},patchNavigationModel:function(f){f.getView().getNavigationModel().focusItem=function(a){a.addCls(this.focusCls);if(((Ext.isIE||Ext.isEdge)&&!a.hasCls("sch-timetd"))||(!(Ext.isIE||Ext.isEdge)&&f.getOrientation()==="horizontal")){a.focus()}};var d=f.lockedGrid.getView();var e=f.normalGrid.getView();d.on("rowclick",function(c,h,b,a){if(e.lastFocused){e.lastFocused.rowIdx=a;e.lastFocused.record=h}else{if(Ext.isIE){e.lastFocused=this.lastFocused}}});e.on("rowclick",function(c,h,b,a){if(d.lastFocused){d.lastFocused.rowIdx=a;d.lastFocused.record=h}else{if(Ext.isIE){d.lastFocused=this.lastFocused}}})},configureChildGrids:function(){var e=this;e.lockedGridConfig=Ext.apply({},e.lockedGridConfig||{});e.normalGridConfig=Ext.apply({},e.schedulerConfig||e.normalGridConfig||{});var f=e.lockedGridConfig,d=e.normalGridConfig;if(e.lockedXType){f.xtype=e.lockedXType}if(e.normalXType){d.xtype=e.normalXType}Ext.applyIf(f,{useArrows:true,animCollapse:false,collapseDirection:"left",trackMouseOver:false});Ext.applyIf(d,{viewType:e.viewType,enableColumnMove:false,enableColumnResize:false,enableColumnHide:false,trackMouseOver:false,collapseDirection:"right",collapseMode:"placeholder",animCollapse:false});if(e.mode==="vertical"){f.store=d.store=e.timeAxis}if(f.width){e.syncLockedWidth=Ext.emptyFn;f.scroll=Ext.supports.Touch?"both":"horizontal";f.scrollerOwner=true}},afterInitComponent:function(){var i=this;var j=i.lockedGrid.getView();var f=i.normalGrid.getView();var g=Ext.data.TreeStore&&i.store instanceof Ext.data.TreeStore;if(i.normalGrid.collapsed){i.normalGrid.collapsed=false;f.on("boxready",function(){i.normalGrid.collapse()},i,{delay:10})}if(i.lockedGrid.collapsed){i.lockedGrid.collapsed=false;j.on("boxready",function(){i.lockedGrid.collapse()},i,{delay:10});if(j.bufferedRenderer){j.bufferedRenderer.disabled=true}}if(Ext.getScrollbarSize().width===0){j.addCls("sch-ganttpanel-force-locked-scroll")}if(g){this.setupLockableFilterableTree()}this.on("afterrender",function(){var a=this.lockedGrid.headerCt.showMenuBy;this.lockedGrid.headerCt.showMenuBy=function(){a.apply(this,arguments);i.showMenuBy.apply(this,arguments)}});var h=this.child("splitter");if(h){h.addCls("sch-timelinepanel-splitter")}},setupLockableFilterableTree:function(){var f=this;var d=f.lockedGrid.getView();var e=Sch.mixin.FilterableTreeView.prototype;d.initTreeFiltering=e.initTreeFiltering;d.onFilterChangeStart=e.onFilterChangeStart;d.onFilterChangeEnd=e.onFilterChangeEnd;d.onFilterCleared=e.onFilterCleared;d.onFilterSet=e.onFilterSet;d.initTreeFiltering()},showMenuBy:function(g,i){var j=this.getMenu(),l=j.down("#unlockItem"),k=j.down("#lockItem"),h=l.prev();h.hide();l.hide();k.hide()},zoomToFit:function(e){e=Ext.apply({adjustStart:1,adjustEnd:1},e);var d=this.getEventStore();var f=this.getEventStore().getTotalTimeSpan();if(this.zoomToSpan(f,e)===null){this.getSchedulingView().fitColumns()}},refreshViews:function(g){if(!this.rendered){return}var j=false;var l=function(){j=true};var i=this.normalGrid.getView();var k=this.lockedGrid.getView(),h={left:k.getScrollX(),top:k.getScrollY()};i.on("refresh",l);k.refreshView();i.un("refresh",l);if(g!==false){!j&&this.getSchedulingView().refreshKeepingScroll();k.setScrollX(h.left);k.setScrollY(h.top)}else{if(!j){this.getSchedulingView().refreshView()}}}},function(){var d="6.0.0";Ext.apply(Sch,{VERSION:"%VERSION%"});if(Ext.versions.extjs.isLessThan(d)){var c=console;c&&c.log("The Ext JS version you are using needs to be updated to at least "+d)}});Ext.define("Sch.panel.TimelineGridPanel",{extend:Ext.grid.Panel,mixins:[Sch.mixin.Localizable,Sch.mixin.TimelinePanel],alias:["widget.timelinegrid"],subGridXType:"gridpanel",isTimelineGridPanel:true,initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeTimelineView()}},function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})});Ext.define("Sch.view.dependency.Mixin",{extend:Ext.Mixin,mixinConfig:{after:{initComponent:"initComponent",destroy:"destroy"}},dependencyViewConfig:null,dependencyView:null,dependencyViewRelayDetacher:null,initComponent:function(){var b=this;b.on("viewready",function(){b.setupDependencyView(b.getDependencyViewConfig(),b.getSchedulingView())})},getDependencyViewConfig:function(){return this.dependencyViewConfig},setDependencyViewConfig:function(d){var c=this;if(c.dependencyViewConfig!==d){c.dependencyViewConfig=d;if(c.dependencyView){if(d&&"type" in d&&d.type!==c.dependencyView.type){c.setupDependencyView(d,c.getSchedulingView())}else{c.dependencyView.setConfig(d)}}}},hasDependencyView:function(){return !!this.dependencyView},getDependencyView:function(){return this.dependencyView},createDependencyView:function(d,c){return Sch.view.dependency.View.create(Ext.applyIf({primaryView:c},d))},destroy:function(){Ext.destroyMembers(this,"dependencyViewRelayDetacher","dependencyView")},setupDependencyView:function(e,f){var d=this;Ext.destroy(d.dependencyView);d.dependencyView=d.createDependencyView(e,f);d.setupDependencyViewRelay();d.fireEvent("dependencyviewready",d,d.dependencyView);if(d.dependencyView.canDrawDependencies()){d.dependencyView.scheduleAllDependenciesRendering()}},setupDependencyViewRelay:function(){var b=this;Ext.destroy(b.dependencyViewRelayDetacher);b.dependencyViewRelayDetacher=b.relayEvents(b.getDependencyView(),["dependencyclick","dependencydblclick","dependencycontextmenu","dependencymouseover","dependencymouseout"])}});Ext.define("Sch.panel.SchedulerGrid",{extend:Sch.panel.TimelineGridPanel,mixins:[Sch.mixin.SchedulerPanel,Sch.view.dependency.Mixin],alias:["widget.schedulergrid","widget.schedulerpanel"],alternateClassName:"Sch.SchedulerPanel",viewType:"schedulergridview",initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeSchedulerView()}},function(){this.override(Sch.mixin.SchedulerPanel.prototype.inheritables()||{})});Ext.define("Sch.patches.TreeNavigationModel",{extend:Sch.util.Patch,target:"Ext.tree.NavigationModel",minVersion:"6.0.0",maxVersion:"6.0.2",overrides:{onAsterisk:function(){if(!this.view.ownerCt.expandAll){this.view.lockingPartner.ownerCt.expandAll();return}this.callParent(arguments)}}});Ext.define("Sch.panel.TimelineTreePanel",{extend:Ext.tree.Panel,mixins:[Sch.mixin.Localizable,Sch.mixin.TimelinePanel],alias:["widget.timelinetree"],useArrows:true,rootVisible:false,lockedXType:"treepanel",isTimelineTreePanel:true,initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeTimelineView()}},function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})});Ext.define("Sch.panel.SchedulerTree",{extend:Sch.panel.TimelineTreePanel,mixins:[Sch.mixin.SchedulerPanel,Sch.view.dependency.Mixin],alias:["widget.schedulertree"],viewType:"schedulergridview",setOrientation:function(){return this.setMode.apply(this,arguments)},setMode:function(b){if(b!=="horizontal"){Ext.Error.raise("Sch.panel.SchedulerTree only support horizontal mode")}},initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeSchedulerView()}},function(){this.override(Sch.mixin.SchedulerPanel.prototype.inheritables()||{})});Ext.define("Sch.patches.CellEditing",{extend:Sch.util.Patch,target:"Ext.grid.plugin.CellEditing",maxVersion:"6.0.2",overrides:{activateCell:function(e){var f=this.callParent(arguments);if(!!f){var d=this.getEditor(e.record,e.column);if(d){d.el.skipGarbageCollection=true;d.el.select("*").each(function(a){Ext.get(a).skipGarbageCollection=true})}}return f}}});Ext.define("Sch.patches.CellEditor",{extend:Sch.util.Patch,target:"Ext.grid.CellEditor",minVersion:"6.0.2",overrides:{onEditComplete:function(e,f){var g=this,h=Ext.Element.getActiveElement();g.editing=false;g.boundEl=g.context.getCell();if(g.boundEl){g.restoreCell();if(g.boundEl.contains(h)&&g.boundEl.dom!==h){g.boundEl.focus()}}if(!e){g.cacheElement()}g.superclass.onEditComplete.apply(g,arguments);if(f){g.editingPlugin.cancelEdit(g)}else{g.editingPlugin.onEditComplete(g,g.getValue(),g.startValue)}}}});Ext.define("Sch.plugin.CurrentTimeLine",{extend:Sch.plugin.Lines,alias:"plugin.scheduler_currenttimeline",mixins:[Sch.mixin.Localizable],updateInterval:60000,showHeaderElements:true,autoUpdate:true,expandToFitView:true,timer:null,init:function(f){if(Ext.getVersion("touch")){this.showHeaderElements=false}var d=new Ext.data.JsonStore({fields:["Date","Cls","Text"],data:[{Date:new Date(),Cls:"sch-todayLine",Text:this.L("tooltipText")}]});var e=d.first();if(this.autoUpdate){this.timer=setInterval(function(){e.set("Date",new Date())},this.updateInterval)}this.store=d;this.callParent(arguments)},destroy:function(){if(this.timer){clearInterval(this.timer);this.timer=null}if(this.store.autoDestroy){this.store.destroy()}this.callParent(arguments)}});Ext.define("Sch.plugin.exporter.AbstractExporter",{extend:Ext.util.Observable,mixins:[Sch.mixin.Localizable],pageHeaderHeight:41,pageFooterHeight:41,bufferedHeightMargin:25,isExporter:true,paperWidth:0,paperHeight:0,printHeight:0,lockedRowsHeight:0,normalRowsHeight:0,iterateTimeout:10,tableSelector:undefined,currentPage:undefined,headerTplDataFn:null,footerTplDataFn:null,headerTplDataFnScope:null,footerTplDataFnScope:null,config:{exporterId:"abstractexporter",name:"",translateURLsToAbsolute:true,expandAllBeforeExport:false,headerTpl:'<div class="sch-export-header" style="height:{height}px; width:{width}px"><h2>{pageNo}/{totalPages}</h2></div>',tpl:'<!DOCTYPE html><html class="'+Ext.baseCSSPrefix+'border-box {htmlClasses}"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><title>{title}</title>{styles}</head><body class="'+Ext.baseCSSPrefix+'webkit sch-export {bodyClasses}">{header}<div class="{componentClasses}" style="height:{bodyHeight}px; width:{totalWidth}px; position: relative !important">{HTML}</div>{footer}</body></html>',footerTpl:'<div class="sch-export-header" style="height:{height}px; width:{width}px"><h2>{pageNo}/{totalPages}</h2></div>',rowVisibilityThreshold:0.6},callbacks:undefined,error:undefined,extractedPages:undefined,numberOfPages:0,firstExportedRowOffset:0,secondaryCanvasOffset:0,constructor:function(d){var c=this;d=d||{};c.callParent(arguments);delete d.getUserHeaderTplData;delete d.getUserFooterTplData;c.initConfig(d);if(!d.tableSelector){c.tableSelector="."+Ext.baseCSSPrefix+"grid-item-container"}if(!d.name){c.setName(c.L("name"))}},setHeaderTpl:function(b){this.headerTpl=this.getTplInstance(b)},getHeaderTpl:function(){return this.headerTpl},setTpl:function(b){this.tpl=this.getTplInstance(b)},getTpl:function(){return this.tpl},setFooterTpl:function(b){this.footerTpl=this.getTplInstance(b)},getFooterTpl:function(){return this.footerTpl},getTplInstance:function(b){return(b&&!b.isTemplate)?new Ext.XTemplate(b,{disableFormats:true}):b},getBodyClasses:function(){var c=new RegExp(Ext.baseCSSPrefix+"ie\\d?|"+Ext.baseCSSPrefix+"gecko","g"),d=document.body.className.replace(c,"");if(Ext.isIE){d+=" sch-ie-export"}return d},getComponentClasses:function(){return this.getComponent().el.dom.className},setComponent:function(d){var c=this;c.component=d;c.view=d.getSchedulingView();c.normalGrid=d.normalGrid;c.lockedGrid=d.lockedGrid;c.normalView=d.normalGrid.view;c.lockedView=d.lockedGrid.view;c.lockedBodySelector="#"+c.lockedView.getId();c.normalBodySelector="#"+c.normalView.getId();c.lockedHeader=c.lockedGrid.headerCt;c.normalHeader=c.normalGrid.headerCt;c.headerHeight=c.normalHeader.getHeight();c.printHeight=Math.floor(c.paperHeight)-c.headerHeight-(c.exportConfig.showHeader?c.pageHeaderHeight:0)-(c.exportConfig.showFooter?c.pageFooterHeight:0);c.saveComponentState(d)},getComponent:function(){return this.component},setPaperSize:function(e,d){var f=this;if(d==="landscape"){f.paperWidth=e.height;f.paperHeight=e.width}else{f.paperWidth=e.width;f.paperHeight=e.height}},getPaperFormat:function(){return this.exportConfig.format},isBuffered:function(){return !!this.getBufferedRenderer()},getBufferedRenderer:function(){return this.view.bufferedRenderer},setComponentRange:function(o){var l=this,p=l.getComponent();if(o.range!=="complete"){var i=l.view,j,m;switch(o.range){case"date":j=new Date(o.dateFrom);m=new Date(o.dateTo);if(Sch.util.Date.getDurationInDays(j,m)<1){m=Sch.util.Date.add(m,Sch.util.Date.DAY,1)}break;case"current":var k=i.getVisibleDateRange();j=k.startDate;m=k.endDate||i.timeAxis.getEnd();break;case"completedata":var n=p.getEventStore().getTotalTimeSpan();j=n.start;m=n.end;break}if(j&&m){p.setTimeSpan(j,m)}}l.ticks=p.timeAxis.getTicks();if(o.rowsRange=="visible"){o.rowsRange=l.findVisibleRowsRange()}else{o.rowsRange=null}},getStylesheets:function(){var f=this.getTranslateURLsToAbsolute(),d=Ext.getDoc().select('link[rel="stylesheet"]'),e="";d.each(function(b){var a=b.dom.cloneNode(true);f&&a.setAttribute("href",b.dom.href);e+=a.outerHTML});return e},forEachTimeSpanPlugin:function(p,m,n){if(Sch.feature&&Sch.feature.AbstractTimeSpan){var k=this;var i=(p.plugins||[]).concat(p.normalGrid.plugins||[]).concat(p.columnLinesFeature||[]);for(var o=0,j=i.length;o<j;o++){var l=i[o];if(l instanceof Sch.feature.AbstractTimeSpan){m.call(n||k,l)}}}},setCellSize:function(c){var d=this;d.timeColumnWidth=c[0];if(d.timeColumnWidth){this.getComponent().setTimeColumnWidth(d.timeColumnWidth)}if(c.length>1){d.view.setRowHeight(c[1])}},findVisibleRowsRange:function(){var m=this,k=m.lockedView.all,i=k.startIndex,n=k.endIndex;var l=false,p=-1,r=-1;for(var o=i;o<=n;o++){var q=k.item(o,true);if(m.isRowVisible(q,m.lockedBox)){if(!l){p=o;l=true}r=o}else{if(l){break}}}return[p,r]},prepareComponent:function(d,e){var f=this;d=d||f.getComponent();f.suspendInfiniteScroll(d);f.forEachTimeSpanPlugin(d,function(a){a._renderDelay=a.renderDelay;a.renderDelay=0});d.getSchedulingView().timeAxisViewModel.suppressFit=true;d.timeAxis.autoAdjust=false;d.normalGrid.expand();d.lockedGrid.expand();f.lockedBox=f.lockedView.getBox();f.normalBox=f.normalView.getBox();f.setComponentRange(e);e.cellSize&&f.setCellSize(e.cellSize);e.beforeExport&&e.beforeExport(d,f.ticks);f.prepareColumns(e.columns);if(f.expandAllBeforeExport&&d.expandAll){d.expandAll()}f.fitComponentIntoPage();f.view.timeAxisViewModel.setTickWidth(f.view.timeAxisViewModel.getTickWidth());if(f.isBuffered()&&Ext.isIE8){f.normalView.bufferedRenderer.variableRowHeight=false;f.lockedView.bufferedRenderer.variableRowHeight=false}},prepareColumns:function(d){var c=this;if(d){c.lockedGrid.headerCt.items.each(function(a){if(Ext.Array.contains(d,a)){a.show()}else{a.hide()}})}},restoreComponent:function(d){var c=this;d=d||c.getComponent();c.forEachTimeSpanPlugin(d,function(a){a.renderDelay=a._renderDelay;delete a._renderDelay});c.restoreComponentState(d);c.restoreInfiniteScroll(d);c.exportConfig.afterExport&&c.exportConfig.afterExport(d)},saveComponentState:function(m){m=m||this.getComponent();var n=this,l=m.getSchedulingView(),o=m.normalGrid,r=m.lockedGrid;var q=[];r.headerCt.items.each(function(a){q.push({column:a,visible:!a.isHidden()})});var k=l.timeAxisViewModel;var j=k.originalTickWidth;var p=k.getTickWidth();k.setTickWidth(p,true);n.restoreSettings={width:m.getWidth(),height:m.getHeight(),rowHeight:k.getViewRowHeight(),originalTickWidth:j,columnWidth:p,startDate:m.getStart(),endDate:m.getEnd(),normalWidth:o.getWidth(),normalLeft:o.getEl().getStyle("left"),lockedWidth:r.getWidth(),lockedCollapse:r.collapsed,normalCollapse:o.collapsed,columns:q,autoAdjust:m.timeAxis.autoAdjust,suppressFit:k.suppressFit,startIndex:l.all.startIndex,lockedScrollX:n.lockedView.getScrollX(),normalScrollX:l.getScrollX(),scrollY:l.getScrollY()}},restoreComponentState:function(h){var g=this;h=h||g.getComponent();var e=g.restoreSettings,f=h.getSchedulingView();h.timeAxis.autoAdjust=e.autoAdjust;h.normalGrid.show();h.setWidth(e.width);h.setHeight(e.height);h.setTimeSpan(e.startDate,e.endDate);h.setTimeColumnWidth(e.columnWidth,true);f.setRowHeight(e.rowHeight);Ext.Array.each(e.columns,function(a){a.column.setVisible(a.visible)});h.lockedGrid.show();h.normalGrid.setWidth(e.normalWidth);h.normalGrid.getEl().setStyle("left",e.normalLeft);h.lockedGrid.setWidth(e.lockedWidth);f.timeAxisViewModel.suppressFit=e.suppressFit;f.timeAxisViewModel.setTickWidth(e.columnWidth);f.timeAxisViewModel.originalTickWidth=e.originalTickWidth;if(e.lockedCollapse){h.lockedGrid.collapse()}if(e.normalCollapse){h.normalGrid.collapse()}g.restoreComponentScroll(e);if(g.getBufferedRenderer()){if(Ext.isIE8){g.normalView.bufferedRenderer.variableRowHeight=true;g.lockedView.bufferedRenderer.variableRowHeight=true}}},restoreComponentScroll:function(d){var c=this;c.lockedView.setScrollX(d.lockedScrollX);c.normalView.scrollTo(d.normalScrollX,d.scrollY)},extractPages:function(f,g,h,j){var i=this;i.enableGarbageCollector=Ext.enableGarbageCollector;Ext.enableGarbageCollector=false;Ext.dom.GarbageCollector.pause();i.exportConfig=g;i.normalRows=[];i.lockedRows=[];i.extractedPages=[];i.numberOfPages=0;i.lockedRowsHeight=0;i.normalRowsHeight=0;i.firstExportedRowOffset=0;i.secondaryCanvasOffset=0;i.setPaperSize(g.pageSize,g.orientation);i.setComponent(f,g);i.prepareComponent(f,g);i.callbacks={success:h,scope:j||i};setTimeout(function(){i.collectRows(i.onRowsCollected,i,g)},1)},onPagesExtracted:function(d){var c=this;c.restoreComponent();c.submitPages(d)},submitPages:function(e){var f=this,d=f.callbacks;d.success.call(d.scope,f.renderPages(e));Ext.enableGarbageCollector=f.enableGarbageCollector;Ext.dom.GarbageCollector.resume()},getCurrentPage:function(){return this.currentPage},setCurrentPage:function(b){this.currentPage=b},getExpectedNumberOfPages:function(){throw"Sch.plugin.exporter.AbstractExporter: [getExpectedNumberOfPages] Abstract method called."},commitPage:function(f){var e=this;e.numberOfPages++;var g=e.preparePageToCommit(f);e.fireEvent("beforecommitpage",e,g,e.numberOfPages,e.getExpectedNumberOfPages());var h=Ext.apply({html:g.dom.innerHTML,number:e.numberOfPages},f);e.extractedPages.push(h);e.fireEvent("commitpage",e,h,e.numberOfPages,e.getExpectedNumberOfPages())},collectLockedRow:function(g,h){var e=Ext.fly(g).getHeight();this.lockedRowsHeight+=e;var f={height:e,row:g.cloneNode(true),record:this.lockedView.getRecord(h)};this.lockedRows.push(f);return f},collectNormalRow:function(g,h){var e=Ext.fly(g).getHeight();this.normalRowsHeight+=e;var f={height:e,row:g.cloneNode(true),record:this.normalView.getRecord(h)};this.normalRows.push(f);return f},onRowsCollected:function(){throw"Sch.plugin.exporter.AbstractExporter: [onRowsCollected] Abstract method called."},iterateAsync:function(h,e){var g=this;e=e||g;var f=function(){var a=arguments;var b=setInterval(function(){clearInterval(b);h.apply(e,[].concat.apply([f],a))},g.iterateTimeout)};f.apply(g,Ext.Array.slice(arguments,2))},callAsync:function(f,d){d=d||this;var e=setInterval(function(){clearInterval(e);f.apply(d,Ext.Array.slice(arguments,2))},this.iterateTimeout)},collectRows:function(i,l,h){var k=this,j=0;var g=k.isBuffered();if(h.rowsRange){j=h.rowsRange[0];g=!(h.rowsRange[0]>=k.view.all.startIndex&&h.rowsRange[1]<=k.view.all.endIndex)}if(g){setTimeout(function(){k.scrollTo(j,function(){j&&k.initFirstExportedRowOffset(j);k.iterateAsync(k.collectRowsStep,k,j,i,l,h)})},1)}else{j&&k.initFirstExportedRowOffset(j);setTimeout(function(){k.collectRowsStep(null,j,i,l,h)},1)}},initFirstExportedRowOffset:function(b){this.firstExportedRowOffset=this.view.el.getScrollTop()-this.view.el.getTop()+Ext.fly(this.view.getNode(b)).getTop()},isRowVisible:function(m,i){var h=Ext.fly(m),k=h.getTop(),l=h.getHeight(),j=k+l,n=(1-this.getRowVisibilityThreshold())*l;return k+n>i.top&&j-n<i.bottom},collectRowsStep:function(y,r,q,i,D){var s=this,z=s.normalView.all.endIndex,v=s.component.store.getCount(),B=D.rowsRange,u=s.normalView.all.slice(r),C=s.lockedView.all.slice(r),A=0;var x;if(B){x=B[1]}var t=false;for(var w=r;A<u.length;A++){if(w>x){t=true;break}C[A]&&s.collectLockedRow(C[A],w,D);s.collectNormalRow(u[A],w,D);w++}s.fireEvent("collectrows",s,r,w,v);if(!t&&s.isBuffered()){if(z+1<v){s.callAsync(function(){s.scrollTo(z+1,function(){y(z+1,q,i,D)})})}else{s.callAsync(function(){s.scrollTo(0,function(){q.call(i||s,s.lockedRows,s.normalRows)})})}}else{q.call(i||s,s.lockedRows,s.normalRows)}},renderPages:function(g){var i=this;g=g||i.extractedPages;for(var j=0,f=g.length;j<f;j++){var h=g[j];h.html=i.applyPageTpl(h)}return g},applyPageTpl:function(d){var c=this;return c.getTpl().apply(c.getPageTplData(d))},applyHeaderTpl:function(f){var j=this,h=j.getHeaderTpl();if(j.exportConfig.showHeader&&h){var g=j.headerTplDataFn;var i=g&&g.call(j.headerTplDataFnScope||j,f);return h.apply(Ext.apply(j.getHeaderTplData(f),i))}return""},applyFooterTpl:function(f){var j=this,h=j.getFooterTpl();if(j.exportConfig.showFooter&&h){var g=j.footerTplDataFn;var i=g&&g.call(j.footerTplDataFnScope||j,f);return h.apply(Ext.apply(j.getFooterTplData(f),i))}return""},getHeaderTplData:function(d){var c=this;return{width:c.paperWidth,height:c.pageHeaderHeight,totalPages:c.numberOfPages,pageNo:d.number}},getFooterTplData:function(d){var c=this;return{width:c.paperWidth,height:c.pageFooterHeight,totalPages:c.numberOfPages,pageNo:d.number}},getPageTplData:function(d){var c=this;return{bodyClasses:c.getBodyClasses(),bodyHeight:c.printHeight+c.headerHeight,componentClasses:c.getComponentClasses(),styles:c.getStylesheets(),showHeader:c.exportConfig.showHeader,showFooter:c.exportConfig.showFooter,header:c.applyHeaderTpl(d),HTML:d.html,footer:c.applyFooterTpl(d),totalWidth:c.paperWidth,pageNo:d.number,totalPages:c.numberOfPages,title:d.number+" of "+c.numberOfPages}},fitComponentIntoPage:Ext.emptyFn,getLockedGridBody:function(b){b=b||this.getCurrentPage();return b.down(this.lockedBodySelector+" "+this.tableSelector,true)},getNormalGridBody:function(b){b=b||this.getCurrentPage();return b.down(this.normalBodySelector+" "+this.tableSelector,true)},emptyLockedGrid:function(b){Ext.fly(this.getLockedGridBody(b)).select(this.lockedView.getItemSelector()).remove()},fillGrids:function(j,f,h,g){var i=this;i.fillLockedGrid(j,h,g);i.fillNormalGrid(f,h,g)},fillLockedGrid:function(h,g,f){var e=this;if(!f){e.emptyLockedGrid()}e.appendRows(e.getLockedGridBody(),h||e.lockedRows,g)},fillNormalGrid:function(h,g,f){var e=this;if(!f){e.emptyNormalGrid()}e.appendRows(e.getNormalGridBody(),h||e.normalRows,g)},appendRows:function(i,j,h){for(var f=0,g=j.length;f<g;f++){i.appendChild(h?j[f].row.cloneNode(true):j[f].row)}},emptyNormalGrid:function(b){Ext.fly(this.getNormalGridBody(b)).select(this.normalView.getItemSelector()).remove()},getRowHeight:function(){return this.view.timeAxisViewModel.getViewRowHeight()},getTotalSize:function(){return{width:this.getTotalWidth(),height:this.getTotalHeight()}},getTotalHeight:function(){var c=this,d;if(c.isBuffered()){d=c.bufferedHeightMargin+c.normalRowsHeight}else{d=c.lockedView.getEl().down(c.tableSelector).getHeight()}return c.headerHeight+d},getTotalWidth:function(){return this.getLockedGridWidth()+this.normalGrid.body.down(this.tableSelector).getWidth()},getLockedGridWidth:function(){return this.lockedHeader.getEl().first().getWidth()},getNormalGridWidth:function(){return this.normalHeader.getEl().first().getWidth()},preparePageToCommit:function(){var q=this.getCurrentPage(),s=this.component,y=s.lockedGrid,u=s.normalGrid,t=q.down(".sch-secondary-canvas",true);q.select(".sch-remove").remove();var z=function(a){return q.down("#"+a,true)},o=function(a){if(a){a.style.width="100%"}},w=function(a){if(a){a.style.height="100%"}};var B=q.down(this.normalBodySelector,true);B.style.top="0px";var r=q.down(this.lockedBodySelector,true);r.style.top="0px";var p;if(p=this.getLockedGridBody()){if(Ext.isIE9m){p.style.top=""}else{p.style.transform=""}}var v;if(v=this.getNormalGridBody()){if(Ext.isIE9m){v.style.top=""}else{v.style.transform=""}}if(t){t.style.top=this.secondaryCanvasOffset+"px";Ext.fly(t).select(".sch-column-line").setHeight(this.normalRowsHeight)}var x=[z(s.id+"-targetEl"),z(s.id+"-innerCt"),z(y.id),z(y.body.id),z(y.view.el.id)];Ext.Array.each(x,w);o(x[0]);o(x[1]);if(!Ext.isIE){o(z(u.headerCt.id))}else{var A=z(u.headerCt.id);if(A){A.style.width=""}}Ext.Array.each([z(u.id),z(u.body.id),z(u.getView().id)],function(a){if(a){a.style.height=a.style.width="100%"}});return q},startPage:function(d){var e=this;var f=(d||e.getComponent().body).dom.cloneNode(true);f.id="";e.setCurrentPage(Ext.get(f))},scrollTo:function(g,h,j){var i=this;if(i.component.ensureVisible){var f=i.component.store.getAt(g);i.component.ensureVisible(f,{callback:function(){if(h&&this.isLocked===false){h.apply(j||i)}},select:false,focus:false,animate:false})}else{i.lockedView.bufferedRenderer.scrollTo(g,false,function(){i.normalView.bufferedRenderer.scrollTo(g,false,h,j||i)})}},removeNode:function(d){if(d&&d.parentNode){d.parentNode.removeChild(d)}else{if(d.elements){for(var e=0;e<d.elements.length;e++){var f=d.elements[e];f.parentNode.removeChild(f)}}}},restoreInfiniteScroll:function(c){var d=c.getSchedulingView();if(c.infiniteScroll&&d.rendered){c.timeAxis.setTimeSpan(this._oldStart,this._oldEnd);d.setScrollX(this._oldScrollX);d.bindInfiniteScrollListeners()}},suspendInfiniteScroll:function(d){var e=d.getSchedulingView();if(d.infiniteScroll&&e.rendered){e.unbindInfiniteScrollListeners();this._oldStart=d.timeAxis.getStart();this._oldEnd=d.timeAxis.getEnd();this._oldScrollX=e.getScrollX();var f=d.getEventStore().getTotalTimeSpan();d.setTimeSpan(f.start,f.end)}}});Ext.define("Sch.plugin.exporter.mixin.DependencyPainter",{extend:Ext.Mixin,mixinConfig:{after:{setComponent:"initDependencyPainter",collectNormalRow:"collectRowBoxes"},before:{onRowsCollected:"renderDependencies"}},eventBoxes:null,dependencyPainter:null,dependenciesHtml:"",initDependencyPainter:function(){var c=this,d=c.getComponent().getDependencyView();if(d){c.dependencyPainter=d.clonePainter();Ext.override(c.dependencyPainter,{exporter:c,getItemBox:c.getItemBox})}c.depView=d;c.eventBoxes={}},collectRowBoxes:function(h,f){var e=this,g=e.normalRows[e.normalRows.length-1];if(e.depView&&e.depView.getDependencyStore()){e.fillRecordRelatedBoxes(g.record)}},fillRecordRelatedBoxes:function(o){var n=this,m=n.normalView,j=n.depView.painter,t=n.depView.getDependencyStore();var i=o.getEvents();for(var r=0;r<i.length;r++){var s=i[r];if(t.getEventDependencies(s).length){var p=j.getItemBox(m,s);for(var q=0;q<p.length;q++){p[q].top+=m.bufferedRenderer.bodyTop;p[q].bottom+=m.bufferedRenderer.bodyTop;p[q].rendered=true}n.eventBoxes[s.internalId]=p}}},renderDependencies:function(){var c=this,d=c.depView;if(d&&d.getDependencyStore()){if(d.getDrawDependencies()){c.dependenciesHtml=c.dependencyPainter.generatePaintMarkup(d.getPrimaryView(),d.getDependencyStore().getRange())}else{c.dependenciesHtml=""}}},getItemBox:function(g,f){var h=this,e=h.exporter.eventBoxes[f.internalId];return e||this.callParent(arguments)}});Ext.define("Sch.plugin.exporter.SinglePage",{extend:Sch.plugin.exporter.AbstractExporter,mixins:[Sch.plugin.exporter.mixin.DependencyPainter],config:{exporterId:"singlepage"},getExpectedNumberOfPages:function(){return 1},getPaperFormat:function(){var h=this,j=h.getTotalSize(),f=h.exportConfig.DPI,i=Ext.Number.toFixed(j.width/f,1),g=Ext.Number.toFixed(j.height/f,1);return i+"in*"+g+"in"},onRowsCollected:function(){var b=this;b.startPage();b.fillGrids();b.commitPage();b.onPagesExtracted()},getPageTplData:function(){var c=this,d=c.getTotalSize();return Ext.apply(c.callParent(arguments),{bodyHeight:d.height,totalWidth:d.width})},getHeaderTplData:function(d){var c=this;return Ext.apply(c.callParent(arguments),{width:c.getTotalWidth(),height:c.pageHeaderHeight})},getFooterTplData:function(d){var c=this;return Ext.apply(c.callParent(arguments),{width:c.getTotalWidth(),height:c.pageHeaderHeight})},fitComponentIntoPage:function(){var d=this,c=d.lockedGrid;c.setWidth(c.headerCt.getEl().first().getWidth())},preparePageToCommit:function(){var p=this,n=p.callParent(arguments),q=n.select(".sch-secondary-canvas").first(),u=q.select(".sch-zone"),m=q.select(".sch-column-line"),o=p.getTotalHeight();q.setTop(0);u.setHeight(o);m.setHeight(o);var t=n.selectNode(".sch-dependencyview-ct");if(t){t.innerHTML=p.dependenciesHtml;t.style.top="0px";t.style.left="0px";t.style.visibility="visible"}var r=p.component.normalGrid,s=r.el.down(p.tableSelector).getWidth(),w=r.getView().id,v=n.select("#"+w).first().dom;v.style.width=s+"px";var x=n.selectNode("."+Ext.baseCSSPrefix+"splitter");if(x){x.style.height="100%"}return n}});Ext.define("Sch.plugin.exporter.MultiPage",{extend:Sch.plugin.exporter.AbstractExporter,mixins:[Sch.plugin.exporter.mixin.DependencyPainter],config:{exporterId:"multipage"},rowPageIndex:0,columnPageIndex:0,pagesPerColumn:0,depsTopOffset:0,onRowsCollected:function(d,e){var f=this;f.depsTopOffset=-f.firstExportedRowOffset;f.rowPageIndex=0;f.columnPageIndex=0;f.pagesPerColumn=0;f.buildPageFrames(function(){f.buildPages(f.onPagesExtracted,f,d,e)})},buildPages:function(i,l,g,h){var k=this,j=k.pageFrames[0];k.startPage(j,true);this.iterateAsync(k.rowIteratorStep,k,{rowIndex:0,pageFrame:j,rowsHeight:0,leftHeight:this.printHeight,lockeds:[],normals:[],lockedRows:g,normalRows:h,callback:i,scope:l||k})},rowIteratorStep:function(r,x){var o=this,n=x.rowIndex,w=x.lockedRows,q=x.normalRows,p=x.leftHeight,u=x.lockeds,m=x.normals,v=true;if(n<q.length){var s=w[n],t=q[n];if(t.height<=p){u.push(s);m.push(t);x.leftHeight-=t.height;x.rowsHeight+=t.height;v=false}else{o.fillGrids(u,m,x.pageFrame);o.commitPage({rowsHeight:x.rowsHeight});o.startPage(x.pageFrame);x.lockeds=[s];x.normals=[t];x.leftHeight=o.printHeight-t.height;x.rowsHeight=t.height}x.rowIndex++}else{if(o.columnPageIndex<o.pageFrames.length){o.fillGrids(u,m,x.pageFrame);o.commitPage({rowsHeight:x.rowsHeight});x.pageFrame=o.pageFrames[o.columnPageIndex];o.startPage(x.pageFrame,true);x.leftHeight=o.printHeight;x.rowsHeight=0;x.lockeds=[];x.normals=[];x.rowIndex=0}else{o.fillGrids(u,m,x.pageFrame);o.commitPage({rowsHeight:x.rowsHeight});x.callback.call(x.scope);return}}if(v){r(x)}else{o.rowIteratorStep(r,x)}},fillGrids:function(j,k,i){var l=this,g=l.lockedColumnPages[l.columnPageIndex-1],h=!g||(g&&g.leftWidth);if(g){l.fillLockedGrid(j,true);l.removeHiddenLockedColumns(g)}if(h){l.fillNormalGrid(k,true);l.removeInvisibleEvents(-i.normalGridOffset,-i.normalGridOffset+i.normalGridWidth)}},buildPageFrame:function(m,s){var o=this,k=o.lockedColumnPages[m];if(k){o.lockedGrid.setWidth(o.showLockedColumns(k.start,k.end)+(k.startOffset||0));if(k.leftWidth){o.normalGrid.show()}else{o.normalGrid.hide()}}else{o.lockedGrid.setWidth(0);o.lockedGrid.hide();o.normalGrid.show()}var t=o.getComponent().body.dom.cloneNode(true);t.id="";t=Ext.get(t);t.normalGridOffset=s;t.lockedGridOffset=k&&k.startOffset||0;t.normalGridWidth=o.normalGrid.getWidth();t.lockedGridWidth=o.lockedGrid.getWidth();t.down(o.lockedBodySelector,true).style.position="";t.down("#"+o.lockedView.id,true).style.overflow="visible";if(!o.normalGrid.hidden){var l=t.select(o.normalBodySelector).first();l.dom.style.position="";l.dom.style.top="0px";var q=o.getNormalGridBody(t);var r=t.down("#"+o.normalView.headerCt.id,true);var p=t.down(".sch-secondary-canvas",true);var n=t.down("#"+o.normalView.id,true);q.style.left=s+"px";r.style.left=s+"px";r.style.overflow="visible";p.style.left=s+"px";n.style.overflow="visible"}return t},buildPageFrames:function(h,j){var i=this;j=j||i;i.lockedColumnPages=i.calculateLockedColumnPages();var g=Math.ceil(i.getTotalWidth()/i.paperWidth),f=i.pageFrames=[];i.iterateAsync(function(b,c,a){if(c>=g){h.call(j,f);return}f.push(i.buildPageFrame(c,a));var d=i.lockedColumnPages[c];if(d){a-=d.leftWidth||0}else{a-=i.paperWidth}b(c+1,a)},i,0,0)},startPage:function(f,e){var d=this;if(e){d.depsTopOffset=-d.firstExportedRowOffset;if(d.columnPageIndex==1){d.pagesPerColumn=d.extractedPages.length}d.rowPageIndex=0;d.columnPageIndex++;d.secondaryCanvasOffset=d.firstExportedRowOffset}d.rowPageIndex++;d.callParent(arguments);d.emptyNormalGrid();d.emptyLockedGrid()},commitPage:function(d){var c=this;c.callParent([Ext.apply({row:c.rowPageIndex,column:c.columnPageIndex},d)]);c.secondaryCanvasOffset-=d.rowsHeight;c.depsTopOffset-=d.rowsHeight},getExpectedPagesPerColumn:function(){return this.pagesPerColumn||Math.ceil((this.normalRowsHeight||this.component.store.count()*this.component.getRowHeight())/this.printHeight)},getExpectedColumnsNumber:function(){return this.pageFrames?this.pageFrames.length:Math.ceil((this.lockedGrid.getWidth()+this.ticks.length*this.view.timeAxisViewModel.getTickWidth())/this.paperWidth)},getExpectedNumberOfPages:function(){return this.getExpectedColumnsNumber()*this.getExpectedPagesPerColumn()},calculateLockedColumnPages:function(){var k=this,i=[],p=k.lockedColumns,n=k.paperWidth,l;for(var m=0,o=p.length;m<o;m++){var q=p[m],r=q.width;l=l||{start:m,end:m};n-=r;if(n<0){i.push(l);if(n){l={start:m,end:m}}n=k.paperWidth-r+n}else{l.end=m}}if(l){l.leftWidth=n;i.push(l)}return i},getPageTplData:function(b){return Ext.apply(this.callParent(arguments),{title:b.number+" of "+this.numberOfPages+" (column: "+b.column+", row: "+b.row+")"})},showLockedColumns:function(l,j){var k=this,h=k.lockedColumns,m=0;l=l||0;j=j||h.length-1;for(var i=0;i<h.length;i++){var n=h[i];if(i>=l&&i<=j){n.column.show();m+=n.width}else{n.column.hide()}}return m},removeInvisibleEvents:function(g,f){var h=this,j=h.getNormalGridBody(),i=h.normalView.eventSelector;Ext.Array.each(Ext.fly(j).select(i).elements,function(b){var a=parseInt(b.style.left,10),c=a+parseInt(b.style.width,10);if(c<g||a>f){h.removeNode(b)}})},removeHiddenLockedColumns:function(s){var l=this,m=l.getCurrentPage(),t=l.getLockedGridBody();for(var o=0;o<l.lockedColumns.length;o++){var r=l.lockedColumns[o].column;if(o<s.start||o>s.end){var q="#"+r.getId();var n=m.select(q);l.removeNode(n);var p=r.getCellSelector();var i=Ext.fly(t).select(p);l.removeNode(i)}}},fitComponentIntoPage:function(){var c=this,d=c.getComponent();d.setWidth(c.paperWidth)},prepareComponent:function(e,f){var g=this,h=g.lockedColumns=[];g.callParent(arguments);g.lockedGrid.headerCt.items.each(function(a){if(!a.hidden){h.push({column:a,width:a.getWidth()})}})},restoreComponentState:function(){this.callParent(arguments);this.showLockedColumns()},preparePageToCommit:function(){var m=this,k=m.callParent(arguments),l=k.down("."+Ext.baseCSSPrefix+"splitter",true),i=k.selectNode(".sch-dependencyview-ct"),n=m.pageFrames[m.columnPageIndex-1];if(l){if(n.lockedHidden){l.style.display="none";k.down("."+Ext.baseCSSPrefix+"grid-inner-normal",true).style.left=0}else{Ext.fly(l).setHeight("100%")}}if(!n.normalHidden){if(i){i.innerHTML=m.dependenciesHtml;i.style.top=m.depsTopOffset+"px";i.style.visibility="visible"}var p=k.selectNode("#"+m.normalView.id);if(p){var j=m.normalGrid.el.down(m.tableSelector).getWidth();p.style.width=j+"px";p.style.overflow="hidden"}}if(!n.lockedHidden){var o=k.selectNode("#"+m.lockedView.id);if(o){o.style.overflow="hidden"}}return k}});Ext.define("Sch.plugin.exporter.MultiPageVertical",{extend:Sch.plugin.exporter.AbstractExporter,mixins:[Sch.plugin.exporter.mixin.DependencyPainter],config:{exporterId:"multipagevertical"},minRowHeight:20,minAverageColumnWidth:100,visibleColumns:null,visibleColumnsWidth:0,depsTopOffset:0,onRowsCollected:function(d,e){var f=this;f.depsTopOffset=-f.firstExportedRowOffset;f.iterateAsync(function(p,c){if(c===e.length){f.onPagesExtracted();return}var o=c,q=f.printHeight,a=0,s=[],b=[],t=false,n,r;f.startPage();while(!t&&o<e.length){n=e[o];r=d[o];q-=n.height;if(q>0){a+=n.height;r&&s.push(r);b.push(n);o++}else{t=true}}f.fillGrids(s,b);f.commitPage({rowIndex:o,rowsHeight:a});f.secondaryCanvasOffset-=a;p(o)},f,0)},startPage:function(){var c=this;c.callParent(arguments);var d=c.getCurrentPage().select("#"+c.lockedView.id).first();d.dom.style.overflow="visible"},commitPage:function(d){var c=this;c.callParent(arguments);if(c.depView&&c.depView.getDependencyStore()){c.depsTopOffset-=d.rowsHeight}},getExpectedNumberOfPages:function(){return Math.ceil(this.normalRowsHeight/this.printHeight)},prepareColumns:function(d){this.callParent(arguments);var f=this,e=f.visibleColumns=[];f.visibleColumnsWidth=0;f.lockedGrid.headerCt.items.each(function(a){if(!a.hidden){e.push({column:a,width:a.getWidth()});f.visibleColumnsWidth+=a.getWidth()}})},fitComponentIntoPage:function(){var q=this,p=q.getComponent(),o=p.getSchedulingView(),r=p.normalGrid,w=p.lockedGrid,t=q.getTotalWidth(),n=q.ticks,u=q.timeColumnWidth||o.timeAxisViewModel.getTickWidth();var v=Math.floor((q.visibleColumnsWidth/t)*q.paperWidth);var x=q.visibleColumns.length,y=x*q.minAverageColumnWidth;y=y>q.paperWidth/2?Math.floor(q.paperWidth/2):y;v=y>v?y:v;var z=q.paperWidth-v;var s=z/n.length;q.setRowHeight((s/u)*q.getRowHeight());p.setWidth(q.paperWidth);r.setWidth(z);w.setWidth(v);q.fitLockedColumnWidth(v);p.setTimeColumnWidth(s)},setRowHeight:function(c){var d=this;d.view.setRowHeight(c<d.minRowHeight?d.minRowHeight:c)},fitLockedColumnWidth:function(j){var k=this,p=this.visibleColumns;var l=j/k.visibleColumnsWidth;if(p.length){for(var o=0;o<p.length;o++){var m=p[o],i=m.width,n=Math.floor(i*l);m.column.setWidth(n)}this._restoreColumnWidth=true}},restoreComponentState:function(j){var h=this;j=j||h.getComponent();if(this._restoreColumnWidth){var f=this.visibleColumns;for(var i=0;i<f.length;i++){var g=f[i];g.column.setWidth(g.width)}}this.callParent(arguments)},preparePageToCommit:function(){var l=this,j=l.callParent(arguments),h=j.selectNode(".sch-dependencyview-ct");if(h){h.innerHTML=l.dependenciesHtml;h.style.top=l.depsTopOffset+"px";h.style.left="0px";h.style.visibility="visible"}var i=l.normalGrid.el.down(l.tableSelector).getWidth();var n=j.selectNode("#"+l.normalView.id);n.style.width=i+"px";n.style.overflow="hidden";var m=j.selectNode("#"+l.lockedView.id);m.style.overflow="hidden";var k=j.selectNode("."+Ext.baseCSSPrefix+"splitter");if(k){k.style.height="100%"}return j}});Ext.define("Sch.widget.ResizePicker",{extend:Ext.Panel,alias:"widget.dualrangepicker",width:200,height:200,border:true,collapsible:false,bodyStyle:"position:absolute; margin:5px",verticalCfg:{height:120,value:24,increment:2,minValue:20,maxValue:80,reverse:true,disabled:true},horizontalCfg:{width:120,value:100,minValue:25,increment:5,maxValue:200,disable:true},initComponent:function(){var b=this;b.horizontalCfg.value=b.dialogConfig.columnWidth;b.verticalCfg.value=b.dialogConfig.rowHeight;b.verticalCfg.disabled=b.dialogConfig.scrollerDisabled||false;b.dockedItems=[b.vertical=new Ext.slider.Single(Ext.apply({dock:"left",style:"margin-top:10px",vertical:true,stateful:b.dialogConfig.stateful,stateId:"exporter_resize_vertical",stateEvents:["change"],listeners:{change:b.onSliderChange,changecomplete:b.onSliderChangeComplete,scope:b}},b.verticalCfg)),b.horizontal=new Ext.slider.Single(Ext.apply({dock:"top",style:"margin-left:28px",stateful:b.dialogConfig.stateful,stateId:"exporter_resize_horizontal",stateEvents:["change"],listeners:{change:b.onSliderChange,changecomplete:b.onSliderChangeComplete,scope:b}},b.horizontalCfg))];b.callParent(arguments)},afterRender:function(){var c=this;c.addCls("sch-ux-range-picker");c.valueHandle=c.body.createChild({cls:"sch-ux-range-value",cn:{tag:"span"}});c.valueSpan=c.valueHandle.down("span");var d=new Ext.dd.DD(c.valueHandle);Ext.apply(d,{startDrag:function(){c.dragging=true;this.constrainTo(c.body)},onDrag:function(){c.updateValuesFromHandles()},endDrag:function(){c.updateValuesFromHandles();c.dragging=false}});c.setValues(c.getValues());c.callParent(arguments);c.body.on("click",c.onBodyClick,c)},onBodyClick:function(f,e){var d=[f.getXY()[0]-8-this.body.getX(),f.getXY()[1]-8-this.body.getY()];this.valueHandle.setLeft(Ext.Number.constrain(d[0],0,this.getAvailableWidth()));this.valueHandle.setTop(Ext.Number.constrain(d[1],0,this.getAvailableHeight()));this.updateValuesFromHandles();this.onSliderChangeComplete()},updateValuesFromHandles:function(){this.setValues(this.getValuesFromXY())},getAvailableWidth:function(){return this.body.getWidth()-18},getAvailableHeight:function(){return this.body.getHeight()-18},getValuesFromXY:function(i){i=i||[this.valueHandle.getLeft(true),this.valueHandle.getTop(true)];var j=i[0]/this.getAvailableWidth();var g=i[1]/this.getAvailableHeight();var h=Math.round((this.horizontalCfg.maxValue-this.horizontalCfg.minValue)*j);var f=Math.round((this.verticalCfg.maxValue-this.verticalCfg.minValue)*g)+this.verticalCfg.minValue;return[h+this.horizontalCfg.minValue,f]},getXYFromValues:function(k){var g=this.horizontalCfg.maxValue-this.horizontalCfg.minValue;var i=this.verticalCfg.maxValue-this.verticalCfg.minValue;var h=Math.round((k[0]-this.horizontalCfg.minValue)*this.getAvailableWidth()/g);var l=k[1]-this.verticalCfg.minValue;var j=Math.round(l*this.getAvailableHeight()/i);return[h,j]},updatePosition:function(){var d=this.getValues();var c=this.getXYFromValues(d);this.valueHandle.setLeft(Ext.Number.constrain(c[0],0,this.getAvailableWidth()));if(this.verticalCfg.disabled){this.valueHandle.setTop(this.dialogConfig.rowHeight)}else{this.valueHandle.setTop(Ext.Number.constrain(c[1],0,this.getAvailableHeight()))}this.positionValueText();this.setValueText(d)},positionValueText:function(){var d=this.valueHandle.getTop(true);var c=this.valueHandle.getLeft(true);this.valueSpan.setLeft(c>30?-30:10);this.valueSpan.setTop(d>10?-20:20)},setValueText:function(b){if(this.verticalCfg.disabled){b[1]=this.dialogConfig.rowHeight}this.valueSpan.update("["+b.toString()+"]")},setValues:function(b){this.horizontal.setValue(b[0]);if(this.verticalCfg.reverse){if(!this.verticalCfg.disabled){this.vertical.setValue(this.verticalCfg.maxValue+this.verticalCfg.minValue-b[1])}}else{if(!this.verticalCfg.disabled){this.vertical.setValue(b[1])}}if(!this.dragging){this.updatePosition()}this.positionValueText();this.setValueText(b)},getValues:function(){if(!this.verticalCfg.disabled){var b=this.vertical.getValue();if(this.verticalCfg.reverse){b=this.verticalCfg.maxValue-b+this.verticalCfg.minValue}return[this.horizontal.getValue(),b]}return[this.horizontal.getValue()]},onSliderChange:function(){this.fireEvent("change",this,this.getValues());if(!this.dragging){this.updatePosition()}},onSliderChangeComplete:function(){this.fireEvent("changecomplete",this,this.getValues())},afterLayout:function(){this.callParent(arguments);this.updatePosition()}});Ext.define("Sch.widget.ColumnPicker",{extend:Ext.form.field.ComboBox,multiSelect:true,valueField:"id",displayField:"name",forceSelection:true,editable:false,listConfig:{cls:"sch-columnpicker-list"},columns:null,columnEmptyText:null,columnEmptyRegExp:/&(nbsp|#160);/,initComponent:function(){this.store=new Ext.data.Store({proxy:"memory",fields:["id","name","column"],data:this.processColumns(this.columns)});this.callParent(arguments)},processColumns:function(f){var e=this,g=[],h=[];Ext.Array.each(f,function(a){g.push({id:a.id,name:e.getColumnTitle(a),column:a});if(!a.isHidden()){h.push(a.id)}});this.value=this.value||h;return g},getColumnTitle:function(d){var c=this;return d.text.match(c.columnEmptyRegExp)?c.columnEmptyText:d.text},getSelectedColumns:function(){var d=this,c=d.getValue();if(!Ext.isArray(c)){c=[c]}return Ext.Array.map(c,function(a){return d.store.getById(a).get("column")})}});Ext.define("Sch.widget.ExportDialogForm",{extend:Ext.form.Panel,mixins:[Sch.mixin.Localizable],alias:"widget.export_dialog_form",border:false,bodyPadding:"10 10 0 10",autoHeight:true,stateful:true,rangeField:null,resizerHolder:null,resizePicker:null,dateFromField:null,dateToField:null,datesHolder:null,columnPicker:null,rowsRangeField:null,exportersField:null,formatField:null,orientationField:null,dpiField:null,showHeaderField:null,showFooterField:null,dateRangeFormat:"",columnPickerConfig:null,dpiFieldConfig:null,dateRangeRestriction:true,rangeFieldConfig:null,rowsRangeFieldConfig:null,formatFieldConfig:null,orientationFieldConfig:null,exportersFieldConfig:null,showHeaderFieldConfig:null,showFooterFieldConfig:null,dateFromFieldConfig:null,dateToFieldConfig:null,showResizePicker:false,showColumnPicker:true,showDPIField:true,showShowHeaderField:true,showShowFooterField:false,showRowsRangeField:true,initComponent:function(){var b=this;b.fieldDefaults=Ext.apply({labelAlign:"left",labelWidth:120,anchor:"99%"},b.fieldDefaults);b.items=b.createFields();b.callParent(arguments);b.onRangeChange(b.rangeField,b.rangeField.getValue());b.onExporterChange(b.exportersField,b.exportersField.getValue())},isValid:function(){var b=this;if(b.rangeField.getValue()=="date"){return b.dateFromField.isValid()&&b.dateToField.isValid()}return true},getValues:function(j,l,k,g){var h=this.callParent(arguments);h.showHeader=!!h.showHeader;h.showFooter=!!h.showFooter;h.onlyVisibleRows=!!h.onlyVisibleRows;if(this.resizePicker&&this.rangeField.getValue()=="current"){var i=this.resizePicker.getValues();if(j){h+="&cellSize[0]="+i[0]+"&cellSize[1]="+i[1]}else{h.cellSize=i}}if(this.columnPicker){h.columns=this.columnPicker.getSelectedColumns()}return h},createFields:function(){var e=this,g='<table class="sch-fieldcontainer-label-wrap"><td width="1" class="sch-fieldcontainer-label">',h='<td><div class="sch-fieldcontainer-separator"></div></table>';if(e.showResizePicker){e.resizePicker=new Sch.widget.ResizePicker({dialogConfig:e,margin:"10 20"});e.resizerHolder=new Ext.form.FieldContainer({fieldLabel:e.scrollerDisabled?e.L("adjustCols"):e.L("adjustColsAndRows"),labelAlign:"top",hidden:true,labelSeparator:"",beforeLabelTextTpl:g,afterLabelTextTpl:h,layout:"vbox",defaults:{flex:1,allowBlank:false},items:[e.resizePicker]})}e.dateFromField=Ext.ComponentManager.create(Ext.apply(e.applyStateful({xtype:"datefield",fieldLabel:e.L("dateRangeFromText"),baseBodyCls:"sch-exportdialogform-date",name:"dateFrom",format:e.dateRangeFormat||Ext.Date.defaultFormat,allowBlank:false,maxValue:e.dateRangeRestriction&&e.endDate||null,minValue:e.dateRangeRestriction&&e.startDate||null,value:e.startDate}),e.dateFromFieldConfig));e.dateToField=Ext.ComponentManager.create(Ext.apply(e.applyStateful({xtype:"datefield",fieldLabel:e.L("dateRangeToText"),name:"dateTo",format:e.dateRangeFormat||Ext.Date.defaultFormat,baseBodyCls:"sch-exportdialogform-date",allowBlank:false,maxValue:e.dateRangeRestriction&&e.endDate||null,minValue:e.dateRangeRestriction&&e.startDate||null,value:e.endDate}),e.dateToFieldConfig));e.datesHolder=new Ext.form.FieldContainer({fieldLabel:e.L("specifyDateRange"),labelAlign:"top",hidden:true,labelSeparator:"",beforeLabelTextTpl:g,afterLabelTextTpl:h,layout:"vbox",defaults:{flex:1,allowBlank:false},items:[e.dateFromField,e.dateToField]});if(e.showColumnPicker){e.columnPicker=new Sch.widget.ColumnPicker(e.applyStateful(Ext.apply({fieldLabel:e.L("columnPickerLabel"),columnEmptyText:e.L("columnEmptyText"),cls:"sch-export-dialog-columns"},e.columnPickerConfig)))}if(e.showDPIField){e.dpiField=Ext.ComponentManager.create(Ext.apply(e.applyStateful({xtype:"numberfield",fieldLabel:e.L("dpiFieldLabel"),cls:"sch-export-dialog-dpi",minValue:65,name:"DPI",value:e.exportConfig.DPI,maxValue:200}),e.dpiFieldConfig))}if(e.showShowHeaderField){e.showHeaderField=Ext.ComponentManager.create(Ext.apply(e.applyStatefulFull({xtype:"checkbox",fieldLabel:e.L("showHeaderLabel"),cls:"sch-export-dialog-header",name:"showHeader",checked:!!e.exportConfig.showHeader,checkedValue:true,uncheckedValue:false}),e.showHeaderFieldConfig))}if(e.showShowFooterField){e.showFooterField=Ext.ComponentManager.create(Ext.apply(e.applyStatefulFull({xtype:"checkbox",fieldLabel:e.L("showFooterLabel"),cls:"sch-export-dialog-footer",name:"showFooter",checked:!!e.exportConfig.showFooter,checkedValue:true,uncheckedValue:false}),e.showFooterFieldConfig))}e.formatField=Ext.ComponentManager.create(Ext.apply(e.applyStateful({xtype:"combobox",fieldLabel:e.L("formatFieldLabel"),value:e.exportConfig.format,triggerAction:"all",forceSelection:true,editable:false,name:"format",queryMode:"local",store:e.pageFormats||["A5","A4","A3","Letter","Legal"]}),e.formatFieldConfig));e.orientationField=Ext.ComponentManager.create(Ext.apply(e.applyStateful({xtype:"combobox",fieldLabel:e.L("orientationFieldLabel"),value:e.exportConfig.orientation,triggerAction:"all",forceSelection:true,editable:false,name:"orientation",displayField:"name",valueField:"value",queryMode:"local",store:{fields:["name","value"],data:[{name:e.L("orientationPortraitText"),value:"portrait"},{name:e.L("orientationLandscapeText"),value:"landscape"}]}}),e.orientationFieldConfig));e.rangeField=Ext.ComponentManager.create(Ext.apply(e.applyStateful({xtype:"combobox",fieldLabel:e.L("rangeFieldLabel"),value:e.exportConfig.range,triggerAction:"all",cls:"sch-export-dialog-range",forceSelection:true,editable:false,name:"range",queryMode:"local",displayField:"name",valueField:"value",store:{fields:["name","value"],data:[{name:e.L("completeViewText"),value:"complete"},{name:e.L("completeDataText"),value:"completedata"},{name:e.L("dateRangeText"),value:"date"},{name:e.L("currentViewText"),value:"current"}]}}),e.rangeFieldConfig));e.mon(e.rangeField,"change",e.onRangeChange,e);e.exportersField=Ext.ComponentManager.create(Ext.apply(e.applyStateful({xtype:"combobox",fieldLabel:e.L("exportersFieldLabel"),value:e.defaultExporter,triggerAction:"all",cls:"sch-export-dialog-exporter",forceSelection:true,editable:false,name:"exporterId",queryMode:"local",displayField:"name",valueField:"value",store:{fields:["name","value"],data:Ext.Array.map(e.exporters,function(a){return{name:a.getName(),value:a.getExporterId()}})}}),e.exportersFieldConfig));e.mon(e.exportersField,"change",e.onExporterChange,e);if(e.showRowsRangeField){e.rowsRangeField=Ext.ComponentManager.create(Ext.apply(e.applyStateful({xtype:"combobox",fieldLabel:e.L("rowsRangeLabel"),value:e.exportConfig.rowsRange,triggerAction:"all",cls:"sch-export-dialog-rowsrange",forceSelection:true,editable:false,name:"rowsRange",queryMode:"local",displayField:"name",valueField:"value",store:{fields:["name","value"],data:[{name:e.L("allRowsLabel"),value:"all"},{name:e.L("visibleRowsLabel"),value:"visible"}]}}),e.rowsRangeFieldConfig))}var f=[];f.push(e.rangeField);if(e.resizerHolder){f.push(e.resizerHolder)}f.push(e.datesHolder);if(e.columnPicker){f.push(e.columnPicker)}if(e.rowsRangeField){f.push(e.rowsRangeField)}f.push(e.exportersField,e.formatField,e.orientationField);if(e.dpiField){f.push(e.dpiField)}if(e.showHeaderField){f.push(e.showHeaderField)}if(e.showFooterField){f.push(e.showFooterField)}return f},applyStateful:function(e){if(!this.stateful){return e}var d=this,f=d.stateId||"exporter";return Ext.applyIf(e,{stateful:true,stateId:f+"_"+e.name})},applyStatefulFull:function(d){if(!this.stateful){return d}var c=this;return Ext.apply(c.applyStateful(d),{stateEvents:["change"],applyState:c.applyFieldState,getState:c.getFieldState})},getFieldState:function(){return{value:this.getValue()}},applyFieldState:function(b){if("value" in b){this.setValue(b.value)}},onRangeChange:function(c,d){switch(d){case"complete":case"completedata":this.datesHolder.hide();this.resizerHolder&&this.resizerHolder.hide();break;case"date":this.datesHolder.show();this.resizerHolder&&this.resizerHolder.hide();break;case"current":this.datesHolder.hide();if(this.resizerHolder){this.resizerHolder.show();this.resizePicker.expand(true)}break}},onExporterChange:function(c,d){switch(d){case"singlepage":this.disableFields(true);break;default:this.disableFields(false)}},disableFields:function(c){var d=this;d.formatField.setDisabled(c);d.orientationField.setDisabled(c)}});Ext.define("Sch.widget.ExportDialog",{alternateClassName:"Sch.widget.PdfExportDialog",extend:Ext.window.Window,mixins:[Sch.mixin.Localizable],alias:"widget.exportdialog",width:450,cls:"sch-exportdialog",frame:false,layout:"fit",draggable:true,constrain:true,progressBar:null,buttonsPanel:null,buttonsPanelScope:null,form:null,defaultFormXType:"export_dialog_form",exportButtonConfig:null,cancelButtonConfig:null,formConfigs:"pageFormats,startDate,endDate,rowHeight,columnWidth,defaultExporter,exporters,dateRangeFormat,exportConfig,showColumnPicker,columnPickerConfig,showShowHeaderField,showShowFooterField,showResizePicker,stateful,stateId,dateRangeRestriction,showRowsRangeField,rowsRangeFieldConfig,rangeFieldConfig,formatFieldConfig,orientationFieldConfig,exportersFieldConfig",constructor:function(b){Ext.apply(this,b);this.title=this.title||this.L("title");this.callParent(arguments)},mapFormConfigs:function(){this.form=this.form||{};var j=this.form;var i=this.formConfigs.split(",");for(var f=0,h=i.length;f<h;f++){var g=i[f];if(this.hasOwnProperty(g)&&!j.hasOwnProperty(g)){j[g]=this[g]}}if(this.hasOwnProperty("showFooterField")&&!j.hasOwnProperty("showShowFooterField")){j.showShowFooterField=this.showFooterField}if(this.hasOwnProperty("showHeaderField")&&!j.hasOwnProperty("showShowHeaderField")){j.showShowHeaderField=this.showHeaderField}},initComponent:function(){var b=this;if(!b.form||!b.form.isForm){b.mapFormConfigs();b.form=b.buildForm()}Ext.apply(b,{items:{items:[b.form,b.progressBar||b.buildProgressBar()]},fbar:b.buildButtons(b.buttonsPanelScope||b)});b.callParent(arguments)},afterRender:function(){var b=this;if(b.form.resizePicker){b.relayEvents(b.form.resizePicker,["change","changecomplete","select"])}b.callParent(arguments)},buildButtons:function(c){var d=this;return[Ext.apply({xtype:"button",scale:"medium",itemId:"export",text:d.L("exportButtonText"),handler:d.onExportButtonPress,scope:c||d},d.exportButtonConfig),Ext.apply({xtype:"button",scale:"medium",itemId:"cancel",text:d.L("cancelButtonText"),handler:d.onCancelButtonPress,scope:c||d},d.cancelButtonConfig)]},onExportButtonPress:function(){if(this.form.isValid()){var c=this.form.getValues();this.beforeExport();var d=this.dateRangeFormat||Ext.Date.defaultFormat;if(c.dateFrom&&!Ext.isDate(c.dateFrom)){c.dateFrom=Ext.Date.parse(c.dateFrom,d)}if(c.dateTo&&!Ext.isDate(c.dateTo)){c.dateTo=Ext.Date.parse(c.dateTo,d)}this.doExportFn.call(this.doExportFnScope||this,c,this.onExportSuccess,this.onExportFailure)}},afterExport:function(){var b=this.down("#export");b&&b.enable();this.progressBar&&this.progressBar.hide()},beforeExport:function(){var b=this.down("#export");b&&b.disable();this.progressBar&&this.progressBar.show()},onExportSuccess:function(){this.afterExport()},onExportFailure:function(){this.afterExport()},onCancelButtonPress:function(){this.destroy()},buildForm:function(b){this.form=Ext.apply(this.form||{},b);return Ext.ComponentManager.create(this.form,this.defaultFormXType)},buildProgressBar:function(){return this.progressBar=new Ext.ProgressBar({text:this.L("progressBarText"),animate:true,hidden:true,margin:"4px 10px 10px 10px"})}});Ext.define("Sch.plugin.Export",{extend:Ext.util.Observable,alternateClassName:"Sch.plugin.PdfExport",alias:"plugin.scheduler_export",mixins:[Ext.AbstractPlugin,Sch.mixin.Localizable],lockableScope:"top",pageSizes:{A5:{width:5.8,height:8.3},A4:{width:8.3,height:11.7},A3:{width:11.7,height:16.5},Letter:{width:8.5,height:11},Legal:{width:8.5,height:14}},DPI:72,printServer:undefined,timeout:60000,headerTpl:null,headerTplDataFn:null,headerTplDataFnScope:null,tpl:null,footerTpl:null,footerTplDataFn:null,footerTplDataFnScope:null,exportDialogClassName:"Sch.widget.ExportDialog",exportDialogConfig:{},exporterConfig:null,exportConfig:{format:"A4",orientation:"portrait",range:"complete",rowsRange:"all",showHeader:true,showFooter:false},expandAllBeforeExport:false,translateURLsToAbsolute:true,openAfterExport:true,beforeExport:function(){},afterExport:function(){},fileFormat:"pdf",defaultExporter:"multipage",exporters:undefined,callbacks:undefined,currentAjaxRequest:undefined,hideExportDialogTimeout:1000,constructor:function(d){var c=this;d=d||{};c.exportersIndex={};if(d.exportDialogConfig){Ext.Object.each(this.exportConfig,function(g,h,a){var b=d.exportDialogConfig[g];if(b){a[g]=b}})}c.callParent([d]);c.setFileFormat(c.fileFormat);if(!c.exporters){c.exporters=c.buildExporters()}c.initExporters();c.bindExporters()},init:function(d){var c=this;d.showExportDialog=Ext.Function.bind(c.showExportDialog,c);d.doExport=Ext.Function.bind(c.doExport,c);c.scheduler=d},initExporters:function(){var f=this,d=f.exporters;for(var e=0;e<d.length;e++){if(!d[e].isExporter){d[e]=f.createExporter(d[e])}}},bindExporters:function(){var c=this.exporters;for(var d=0;d<c.length;d++){this.bindExporter(c[d])}},bindExporter:function(c){var d=this;d.mon(c,{commitpage:d.onPageCommit,collectrows:d.onRowCollected,scope:d})},unbindExporter:function(c){var d=this;d.mun(c,{commitpage:d.onPageCommit,collectrows:d.onRowCollected,scope:d})},buildExporters:function(){return["Sch.plugin.exporter.SinglePage","Sch.plugin.exporter.MultiPage","Sch.plugin.exporter.MultiPageVertical"]},getExporterConfig:function(h,e){var g=this;var f=Ext.apply({translateURLsToAbsolute:g.translateURLsToAbsolute,expandAllBeforeExport:g.expandAllBeforeExport,DPI:g.DPI},g.exporterConfig);if(g.headerTpl){f.headerTpl=g.headerTpl}if(g.headerTplDataFn){f.headerTplDataFn=g.headerTplDataFn;f.headerTplDataFnScope=g.headerTplDataFnScope}if(g.tpl){f.tpl=g.tpl}if(g.footerTpl){f.footerTpl=g.footerTpl}if(g.footerTplDataFn){f.footerTplDataFn=g.footerTplDataFn;f.footerTplDataFnScope=g.footerTplDataFnScope}return f},createExporter:function(e,f){var h=this,g=h.getExporterConfig(e,f);if(Ext.isObject(e)){return Ext.create(Ext.apply(g,e))}else{return Ext.create(e,Ext.apply(g,f))}},registerExporter:function(c,d){if(!(c instanceof Sch.plugin.exporter.AbstractExporter)){c=this.createExporter.apply(this,arguments)}this.exporters.push(c);this.bindExporter(c)},getExporter:function(c){if(!c){return}var d=this.exportersIndex[c];if(d){return d}d=this.exportersIndex[c]=Ext.Array.findBy(this.exporters,function(a){return a.getExporterId()==c});return d},getExporters:function(){return this.exporters},setFileFormat:function(b){this.fileFormat=b},showExportDialog:function(){var c=this,d=c.getActiveExportDialog();if(d){d.destroy()}c.setActiveExportDialog(c.buildExportDialog());d=c.getActiveExportDialog();d.on("destroy",c.onExportDialogDestroy,c);if(d.progressBar){d.mon(c,{updateprogressbar:c.onExportProgress,scope:c})}d.show()},buildExportDialog:function(){return Ext.create(this.exportDialogClassName,this.buildExportDialogConfig())},buildExportDialogConfig:function(){var c=this,d=c.scheduler.getSchedulingView();return Ext.apply({doExportFn:c.doExport,doExportFnScope:c,startDate:c.scheduler.getStart(),endDate:c.scheduler.getEnd(),rowHeight:d.timeAxisViewModel.getViewRowHeight(),columnWidth:d.timeAxisViewModel.getTickWidth(),defaultExporter:c.defaultExporter,exportConfig:Ext.apply(c.exportConfig,{DPI:c.DPI}),exporters:c.exporters,pageFormats:c.getPageFormats(),columnPickerConfig:{columns:c.scheduler.lockedGrid.query("gridcolumn[ignoreInExport!=true]")}},c.exportDialogConfig)},onExportDialogDestroy:function(){this.cancelExport();this.setActiveExportDialog()},onExportProgress:function(h,e){var f=this.getActiveExportDialog(),g=f&&f.progressBar;if(g){g.updateProgress(h);if(typeof e=="string"){g.updateText(e)}}},showError:function(b){Ext.Msg.alert("",b||this.L("generalError"))},getPageFormats:function(){var d=this.pageSizes,c=[];Ext.Object.each(d,function(b,a){c.push({width:a.width,height:a.height,name:b})});return Ext.Array.map(c.sort(function(a,b){return a.width-b.width}),function(a){return a.name})},getExportConfig:function(d){var f=this;var e=Ext.apply({fileFormat:f.fileFormat,exporterId:f.defaultExporter,beforeExport:Ext.Function.bind(f.beforeExport,f),afterExport:Ext.Function.bind(f.afterExport,f)},d,f.exportConfig);e.DPI=e.DPI||f.DPI;e.pageSize=Ext.apply({},f.pageSizes[e.format]);e.pageSize.width*=e.DPI;e.pageSize.height*=e.DPI;return e},doExport:function(o,k,j,n){var m=this,p=m.scheduler,i=m.getExportConfig(o);m.callbacks={success:k,failure:j,scope:n||m};var l=m.exporter=m.getExporter(i.exporterId);if(m.fireEvent("beforeexport",p,l,i)!==false){m.myBeforeExport();m.exporter.extractPages(p,i,function(a){m.onPagesExtracted(a,p,l,i)},m)}},cancelExport:function(){if(this.currentAjaxRequest){Ext.Ajax.abort(this.currentAjaxRequest);this.currentAjaxRequest=null}Ext.getBody().unmask()},onPagesExtracted:function(f,h,g,e){this.fireEvent("updateprogressbar",0.8,this.L("requestingPrintServer"));this.doRequest(f,e)},onRowCollected:function(h,g,e,f){this.fireEvent("updateprogressbar",0.2*(e+1)/f,Ext.String.format(this.L("fetchingRows"),e+1,f))},onPageCommit:function(g,h,e,f){f=Math.max(e,f);this.fireEvent("updateprogressbar",0.2+0.6*e/f,Ext.String.format(this.L("builtPage"),e,f))},onExportSuccess:function(h){var i=this,k=i.getActiveExportDialog(),j=i.callbacks,l=j&&j.success,g=j&&j.scope||i;i.fireEvent("updateprogressbar",1);i.myAfterExport();l&&l.apply(g,arguments);setTimeout(function(){i.fireEvent("hidedialogwindow",h);k&&k.destroy()},i.hideExportDialogTimeout);if(i.openAfterExport){setTimeout(function(){window.open(h.url,"ExportedPanel")},0)}},onExportFailure:function(j,i){var k=this,h=this.getActiveExportDialog(),l=k.callbacks,m=l&&l.failure,n=l&&l.scope||k;m&&m.call(n,j);k.fireEvent("showdialogerror",h,j,i);k.showError(j);k.myAfterExport()},doRequest:function(r,q){var m=this,l=m.scheduler;if(!m.test&&!m.debug){if(m.printServer){var i={method:"POST",url:m.printServer,timeout:m.timeout,params:Ext.apply({html:{array:Ext.JSON.encode(r)},startDate:l.getStartDate(),endDate:l.getEndDate(),format:m.exporter.getPaperFormat(),orientation:q.orientation,range:q.range,fileFormat:m.fileFormat},this.getParameters()),success:m.onRequestSuccess,failure:m.onRequestFailure,scope:m};Ext.apply(i,this.getAjaxConfig(i));this.currentAjaxRequest=Ext.Ajax.request(i)}else{m.onExportFailure("Print server URL is not defined, please specify printServer config")}}else{if(m.debug){var p=r||[];for(var n=0,o=p.length;n<o;n++){var k=window.open();k.document.write(p[n].html);k.document.close()}}m.onExportSuccess(m.testResponse||{success:true,url:"foo",htmlArray:r})}},onRequestSuccess:function(e){this.currentAjaxRequest=null;var h=this,f;try{f=Ext.JSON.decode(e.responseText)}catch(g){h.onExportFailure("Wrong server response received");return}if(f.success){h.onExportSuccess(f)}else{h.onExportFailure(f.msg,f)}},onRequestFailure:function(e){this.currentAjaxRequest=null;var d=this,f=e.status===200?e.responseText:e.statusText;d.onExportFailure(f,e)},getParameters:function(){return{}},getAjaxConfig:function(b){return{}},getActiveExportDialog:function(){return this.win},setActiveExportDialog:function(b){this.win=b},myBeforeExport:function(){this.fireEvent("exportstart",this);var e=Ext.getBody().mask();e.addCls("sch-export-mask");var d=this.getActiveExportDialog(),f=d&&d.progressBar;if(f){f.show()}},myAfterExport:function(){this.fireEvent("afterexport",this);Ext.getBody().unmask()},destroy:function(){this.callParent(arguments);if(this.getActiveExportDialog()){this.getActiveExportDialog().destroy()}}});Ext.define("Sch.plugin.NonWorkingTime",{extend:Sch.plugin.Zones,alias:"plugin.scheduler_nonworkingtime",alternateClassName:"Gnt.feature.WorkingTime",expandToFitView:true,calendar:{type:"calendar"},timeAxis:null,init:function(b){this.calendar=this.calendar&&Ext.StoreMgr.lookup(this.calendar);if(!this.calendar){Ext.Error.raise("Required attribute 'calendar' missed during initialization of 'Sch.plugin.NonWorkingTime'")}this.bindCalendar(this.calendar);this.store=new Ext.data.Store({model:"Sch.model.Range",autoDestroy:true});this.timeAxis=b.getTimeAxis();this.callParent(arguments);b.on("viewchange",this.onViewChange,this);this.onViewChange()},bindCalendar:function(c){var d={datachanged:this.refresh,update:this.refresh,scope:this,delay:1};if(this.calendar){this.calendar.un(d)}if(c){c.on(d)}this.calendar=c},onViewChange:function(){var b=Sch.util.Date;if(b.compareUnits(this.timeAxis.unit,b.WEEK)>0){this.setDisabled(true)}else{this.setDisabled(false);this.refresh()}},refresh:function(){this.store.removeAll(true);this.store.add(this.calendar.getHolidaysRanges(this.timeAxis.getStart(),this.timeAxis.getEnd(),true))},destroy:function(){this.bindCalendar(null);this.callParent(arguments)}});Ext.define("Sch.plugin.Pan",{extend:Ext.AbstractPlugin,alias:"plugin.scheduler_pan",lockableScope:"top",enableVerticalPan:true,statics:{KEY_SHIFT:1,KEY_CTRL:2,KEY_ALT:4,KEY_ALL:7},disableOnKey:0,constructor:function(b){Ext.apply(this,b)},init:function(b){this.view=b.getSchedulingView();this.view.on("afterrender",this.onRender,this)},onRender:function(b){this.view.el.on("mousedown",this.onMouseDown,this)},onMouseDown:function(g,h){if(g.event.touches&&g.event.touches.length>0){return}var e=this.self,f=this.disableOnKey;if((g.shiftKey&&(f&e.KEY_SHIFT))||(g.ctrlKey&&(f&e.KEY_CTRL))||(g.altKey&&(f&e.KEY_ALT))){return}if(g.getTarget(this.view.timeCellSelector,10)&&!g.getTarget(this.view.timeCellSelector+" > div > *")){this.mouseX=g.getX();this.mouseY=g.getY();Ext.getBody().on("mousemove",this.onMouseMove,this);Ext.getDoc().on("mouseup",this.onMouseUp,this);if(Ext.isIE||Ext.isGecko){Ext.getBody().on("mouseenter",this.onMouseUp,this)}g.stopEvent()}},onMouseMove:function(i){if(this.disabled){return}i.stopEvent();var g=i.getX();var h=i.getY();var e=0,j=this.mouseX-g;if(this.enableVerticalPan){e=this.mouseY-h}this.mouseX=g;this.mouseY=h;this.view.scrollBy(j,e,false);this.view.headerCt.getScrollable().scrollBy(j,e,false)},onMouseUp:function(b){Ext.getBody().un("mousemove",this.onMouseMove,this);Ext.getDoc().un("mouseup",this.onMouseUp,this);if(Ext.isIE||Ext.isGecko){Ext.getBody().un("mouseenter",this.onMouseUp,this)}}});Ext.define("Sch.plugin.Printable",{extend:Sch.plugin.Export,alternateClassName:["Sch.plugin.Print"],alias:["plugin.scheduler_printable","plugin.scheduler_print"],docType:"<!DOCTYPE HTML>",beforePrint:function(){},afterPrint:function(){},exportDialogConfig:{showDPIField:true},removeSecondaryCanvas:false,wrapHeaders:false,autoPrintAndClose:true,mainTpl:'{docType}<html class="'+Ext.baseCSSPrefix+'border-box {htmlClasses}"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><title>{title}</title>{styles}</head><body class="sch-print-body {bodyClasses}"><div class="sch-print-ct" style="width:{totalWidth}px"><tpl for="pages">{html}</tpl></div><script type="text/javascript">{setupScript}<\/script></body></html>',pageTpl:'{header}<div class="{componentClasses}" style="height:{bodyHeight}px; width:{totalWidth}px; position: relative !important">{HTML}</div>{footer}<div style="page-break-after:always;"></div>',setupScriptTpl:"window.onload = function(){ document._loaded  = true;if ({autoPrintAndClose}) {window.print();if (!{isChrome}) window.close();}}",openAfterExport:false,DPI:72,fakeBackgroundColor:false,doRequest:function(){},constructor:function(b){Ext.apply(this,b);if(!this.mainTpl.isTemplate){this.mainTpl=new Ext.XTemplate(this.mainTpl)}this.callParent(arguments);this.exportDialogConfig=Ext.applyIf({l10n:{title:this.L("dialogTitle"),exportButtonText:this.L("exportButtonText")}},this.exportDialogConfig)},init:function(b){this.callParent(arguments);b.print=Ext.Function.bind(this.print,this)},getExporterConfig:function(h,e){var g=this,f=g.callParent(arguments);return Ext.apply(f,{tpl:g.pageTpl})},getExportConfig:function(d){var f=this,e=f.callParent(arguments);return Ext.apply(e,{beforeExport:Ext.Function.bind(f.beforePrint,f),afterExport:Ext.Function.bind(f.afterPrint,f)})},buildExporters:function(){return["Sch.plugin.exporter.MultiPage","Sch.plugin.exporter.MultiPageVertical"]},onPagesExtracted:function(f,h,g,e){this.fireEvent("updateprogressbar",0.8,this.L("requestingPrintServer"));this.printPages(f,h,g,e)},print:function(){this.showExportDialog()},onBeforePageCommit:function(x,w,q,p){var s=this.scheduler,u=s.lockedGrid,t=s.normalGrid,v=function(a){return w.select("#"+a).first()};var z=w.select(x.normalBodySelector).first(),n=v(t.headerCt.id),r=w.select(x.lockedBodySelector).first(),y=v(u.headerCt.id);z.addCls(["sch-print-normal-rows-ct",this.fakeBackgroundColor?" sch-print-fake-background":""]);r.addCls("sch-print-locked-rows-ct");if(this.removeSecondaryCanvas){w.select(".sch-secondary-canvas").remove()}if(this.fakeBackgroundColor){var o=z.select(".sch-event");o.each(function(a){a.setStyle("border-right-width",a.dom.style.width)})}n.addCls("sch-print-normalheader");y.addCls("sch-print-lockedheader");if(this.wrapHeaders){n.wrap('<div class="sch-print-header-wrap"></div>');y.wrap('<div class="sch-print-header-wrap"></div>')}},prepareMainTplData:function(b){return b},printPages:function(i,o,l,p){if(!this.mainTpl||!this.mainTpl.isTemplate){this.mainTpl=new Ext.XTemplate(this.mainTpl,{compiled:true,disableFormats:true})}var m=l.getStylesheets(),j=document.body;var n=this.mainTpl.apply(this.prepareMainTplData({docType:this.docType,htmlClasses:j.parentNode.className,bodyClasses:j.className,title:o.title||"",styles:m,totalWidth:l.paperWidth,setupScript:this.setupScriptTpl.replace("{autoPrintAndClose}",this.autoPrintAndClose).replace("{isChrome}",Ext.isChrome),pages:i}));var k=window.open("","printgrid");if(!k||!k.document){return false}this.printWindow=k;k.document.write(n);k.document.close();this.onExportSuccess({success:true,url:"foo",htmlArray:[n]})},bindExporter:function(c){var d=this;d.callParent(arguments);d.mon(c,{beforecommitpage:d.onBeforePageCommit,scope:d})},unbindExporter:function(c){var d=this;d.callParent(arguments);d.mun(c,{beforecommitpage:d.onBeforePageCommit,scope:d})}});Ext.define("Sch.plugin.TreeCellEditing",{extend:Ext.grid.plugin.CellEditing,alias:"plugin.scheduler_treecellediting",lockableScope:"locked",editorsStarted:0,init:function(){this.on("beforeedit",this.onMyBeforeEdit,this);this.callParent(arguments)},activateCell:function(e){var d=this.callParent(arguments);if(d){var f=this.getEditor(e.record,e.column);if(!f._cancelEdit){f._cancelEdit=f.cancelEdit;f.cancelEdit=this.myCancelEdit}this.fireEvent("editingstart",this,f)}return d},checkReadOnly:function(){var b=this.getCmp();if(b){if(!b.isTimelineTreePanel&&!b.isTimelineGridPanel){b=b.up("tablepanel")}return !b.isReadOnly()}},onEditComplete:function(e,g,f){var h=this;if(e.field.applyChanges){if(g!==f){e.field.applyChanges(e.field.task||h.context.record)}return h.callParent([e,g,g])}else{return h.callParent([e,g,f])}},myCancelEdit:function(){var e=this,g=e.field;if(g&&g.applyChanges){var h=g.instantUpdate;g.instantUpdate=true;var f=e._cancelEdit.apply(this,arguments);g.instantUpdate=h;return f}else{return e._cancelEdit.apply(this,arguments)}},onMyBeforeEdit:function(d,e){var f=e.column.getEditor();if(f&&f.setTask){f.setTask(e.record);e._valueFromTaskField=f.getValue()}return this.checkReadOnly()},setEditingContext:function(b){if(b.hasOwnProperty("_valueFromTaskField")){b.value=b.originalValue=b._valueFromTaskField;delete b._valueFromTaskField}this.callParent(arguments)}});Ext.define("Sch.template.Dependency",{extend:Ext.XTemplate,disableFormats:true,rtl:null,text:'<tpl if="startArrow"><div style="__SIDE__:{startArrow.side}px;top:{startArrow.top}px" class="sch-dependency sch-dependency-arrow sch-dependency-start-arrow sch-dependency-arrow-{startArrow.dir} {[ this.getSuffixedCls(values.cls, "-arrow") ]} {[ values.isHighlighted ? "sch-dependency-selected" : "" ]}" <tpl if="dependencyId">data-sch-dependency-id="{[values.dependencyId]}"</tpl>></div></tpl><tpl for="segments"><div class="sch-dependency sch-dependency-line sch-dependency-line-{dir} {[ parent.isHighlighted ? "sch-dependency-selected" : "" ]} {[ this.getSuffixedCls(parent.cls, "-line") ]}" style="__SIDE__:{side}px;top:{top}px;<tpl if="width !== null && width !== undefined">width:{width}px;</tpl><tpl if="height !== null && height !== undefined">height:{height}px</tpl>" <tpl if="parent.dependencyId">data-sch-dependency-id="{parent.dependencyId}"</tpl>></div></tpl><tpl if="endArrow"><div style="__SIDE__:{endArrow.side}px;top:{endArrow.top}px" class="sch-dependency sch-dependency-arrow sch-dependency-end-arrow sch-dependency-arrow-{endArrow.dir} {[ this.getSuffixedCls(values.cls, "-arrow") ]} {[ values.isHighlighted ? "sch-dependency-selected" : "" ]}" <tpl if="dependencyId">data-sch-dependency-id="{dependencyId}"</tpl>></div></tpl>',constructor:function(b){Ext.apply(this,b);this.text=this.text.replace(/__SIDE__/g,this.rtl?"right":"left");this.callParent([this.text])},getSuffixedCls:function(d,f){var e="";if(d&&d.indexOf(" ")!=-1){e=d.replace(/^\s*(.*)\s*$/,"$1").split(/\s+/).join(f+" ")+f}else{if(d){e=d+f}}return e}});Ext.define("Sch.util.RectangularPathFinder",{alias:"schpathfinder.rectangular",mixins:[Ext.mixin.Factoryable],config:{startSide:"right",startArrowSize:8,startArrowMargin:6,startShift:0,endSide:"left",endArrowSize:8,endArrowMargin:6,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null},constructor:function(d){var c=this;c.callParent([d]);c.initConfig(d)},findPath:function(Y){var C=this,P=Ext.applyIf(Y,C.getConfig()),W=P.startBox,I=P.endBox,M=P.startShift,N=P.endShift,S=P.startSide,B=P.endSide,L=P.startArrowSize,Z=P.endArrowSize,H=P.startArrowMargin,aa=P.endArrowMargin,Q=P.horizontalMargin,D=P.verticalMargin,U=P.otherBoxes,F,T,J,E,K,X,V,R,ab,O,G;S=C.normalizeSide(S);B=C.normalizeSide(B);F=C.getConnectionCoordinatesFromBoxSideShift(W,S,M);T=C.getConnectionCoordinatesFromBoxSideShift(I,B,N);V=C.calcGridBaseBoxFromBoxAndDrawParams(W,S,L,H,Q,D);R=C.calcGridBaseBoxFromBoxAndDrawParams(I,B,Z,aa,Q,D);U=U&&Ext.Array.map(U,function(a){return C.calcGridBaseBoxFromBoxAndDrawParams(a,false,0,0,Q,D)});J=C.getConnectionCoordinatesFromBoxSideShift(V,S,M);E=C.getConnectionCoordinatesFromBoxSideShift(R,B,N);ab=C.buildPathGrid(V,R,J,E,S,B,U);K=C.convertDecartPointToGridPoint(ab,J);X=C.convertDecartPointToGridPoint(ab,E);O=C.findPathOnGrid(ab,K,X,S,B);if(O){O=C.prependPathWithArrowStaffSegment(O,F,L,S);O=C.appendPathWithArrowStaffSegment(O,T,Z,B);O=C.optimizePath(O)}return O},getConnectionCoordinatesFromBoxSideShift:function(h,e,f){var g;switch(e){case"left":g={x:h.start,y:(h.top+h.bottom)/2+f};break;case"right":g={x:h.end,y:(h.top+h.bottom)/2+f};break;case"top":g={x:(h.start+h.end)/2+f,y:h.top};break;case"bottom":g={x:(h.start+h.end)/2+f,y:h.bottom};break}return g},calcGridBaseBoxFromBoxAndDrawParams:function(k,n,m,j,h,i){var l;switch(n){case"left":l={start:k.start-Math.max(m+j,h),end:k.end+h,top:k.top-i,bottom:k.bottom+i};break;case"right":l={start:k.start-h,end:k.end+Math.max(m+j,h),top:k.top-i,bottom:k.bottom+i};break;case"top":l={start:k.start-h,end:k.end+h,top:k.top-Math.max(m+j,i),bottom:k.bottom+i};break;case"bottom":l={start:k.start-h,end:k.end+h,top:k.top-i,bottom:k.bottom+Math.max(m+j,i)};break;default:l={start:k.start-h,end:k.end+h,top:k.top-i,bottom:k.bottom+i}}return l},buildPathGrid:function(R,H,z,y,O,w,M){var L,C,K,I,P,Q,x,G,E,N,J,A,D,B={},F=[];L=[R.start,(O=="left"||O=="right")?(R.start+R.end)/2:z.x,R.end,H.start,(w=="left"||w=="right")?(H.start+H.end)/2:y.x,H.end];C=[R.top,(O=="top"||O=="bottom")?(R.top+R.bottom)/2:z.y,R.bottom,H.top,(w=="top"||w=="bottom")?(H.top+H.bottom)/2:y.y,H.bottom];if(M){Ext.Array.forEach(M,function(a){L.push(a.start,(a.start+a.end)/2,a.end);C.push(a.top,(a.top+a.bottom)/2,a.bottom)})}L=Ext.Array.unique(Ext.Array.sort(L,Ext.Array.numericSortFn));C=Ext.Array.unique(Ext.Array.sort(C,Ext.Array.numericSortFn));for(Q=0,G=C.length;Q<G;++Q){B[Q]=B[Q]||{};K=C[Q];for(P=0,x=L.length;P<x;++P){I=L[P];A=((I<=R.start||I>=R.end||K<=R.top||K>=R.bottom)&&(I<=H.start||I>=H.end||K<=H.top||K>=H.bottom));if(M){for(E=0,N=M.length;A&&E<N;++E){J=M[E];A=(I<=J.start||I>=J.end||K<=J.top||K>=J.bottom)}}D={distance:Math.pow(2,53)-1,permitted:A,x:I,y:K,ix:P,iy:Q};B[Q][P]=D;F.push(D)}}return{width:L.length,height:C.length,xs:L,ys:C,points:B,linearPoints:F}},convertDecartPointToGridPoint:function(h,e){var f=Ext.Array.indexOf(h.xs,e.x),g=Ext.Array.indexOf(h.ys,e.y);return h.points[g][f]},findPathOnGrid:function(n,j,h,i,k){var m=this,l=false;if(j.permitted&&h.permitted){n=m.waveForward(n,j,0);l=m.collectPath(n,h,k)}return l},getGridPointNeighbors:function(l,m,j){var n=m.ix,h=m.iy,i=[],k;if(h<l.height-1){k=l.points[h+1][n];(!j||j(k))&&i.push(k)}if(h>0){k=l.points[h-1][n];(!j||j(k))&&i.push(k)}if(n<l.width-1){k=l.points[h][n+1];(!j||j(k))&&i.push(k)}if(n>0){k=l.points[h][n-1];(!j||j(k))&&i.push(k)}return i},waveForward:function(w,t,u){var p=this,i,s,r,n,x,v,o,q;t.distance=u;i=p.getGridPointNeighbors(w,t,function(a){return a.permitted&&(a.distance>u+1)});for(s=0,r=i.length;s<r;++s){n=i[s];n.distance=u+1}for(s=0,r=i.length;s<r;++s){n=i[s];p.waveForward(w,n,u+1)}return w},collectPath:function(t,s,n){var p=this,r=true,l,m,o,q,k=[];while(r&&s.distance){l=p.getGridPointNeighbors(t,s,function(a){return a.permitted&&(a.distance==s.distance-1)});r=l.length>0;if(r){l=Ext.Array.sort(l,function(b,c){var d,e;d=b.ix-s.ix;e=b.iy-s.iy;var f=(((n=="left"||n=="right")&&e===0)||((n=="top"||n=="bottom")&&d===0))?-1:1;d=c.ix-s.ix;e=c.iy-s.iy;var a=(((n=="left"||n=="right")&&e===0)||((n=="top"||n=="bottom")&&d===0))?-1:1;if(f>a){return 1}else{if(f<a){return -1}else{if(f==a){return b.y>c.y?-1:1}}}});m=l[0];k.push({x1:m.x,y1:m.y,x2:s.x,y2:s.y});o=m.ix-s.ix;q=m.iy-s.iy;switch(true){case !q&&o>0:n="left";break;case !q&&o<0:n="right";break;case !o&&q>0:n="top";break;case !o&&q<0:n="bottom";break}s=m}}return r&&k.reverse()||false},prependPathWithArrowStaffSegment:function(j,l,i,h){var g,k;if(j.length>0){k=j[0];g={x2:k.x1,y2:k.y1};switch(h){case"left":g.x1=l.x-i;g.y1=k.y1;break;case"right":g.x1=l.x+i;g.y1=k.y1;break;case"top":g.x1=k.x1;g.y1=l.y-i;break;case"bottom":g.x1=k.x1;g.y1=l.y+i;break}j.unshift(g)}return j},appendPathWithArrowStaffSegment:function(j,l,h,i){var k,g;if(j.length>0){g=j[j.length-1];k={x1:g.x2,y1:g.y2};switch(i){case"left":k.x2=l.x-h;k.y2=g.y2;break;case"right":k.x2=l.x+h;k.y2=g.y2;break;case"top":k.x2=g.x2;k.y2=l.y-h;break;case"bottom":k.x2=g.x2;k.y2=l.y+h;break}j.push(k)}return j},optimizePath:function(g){var f=[],e,h;if(g.length>0){e=g.shift();f.push(e);while(g.length>0){h=g.shift();if(e.x1==h.x1&&e.y1==h.y1&&e.x2==h.x2&&e.y2==h.y2){e=h}else{if((e.y1-e.y2===0)&&(h.y1-h.y2===0)){e.x2=h.x2}else{if((e.x1-e.x2===0)&&(h.x1-h.x2===0)){e.y2=h.y2}else{f.push(h);e=h}}}}}return f},normalizeSide:function(b){return this.self.sideToSide[b]||b},statics:{sideToSide:{l:"left",r:"right",t:"top",b:"bottom"}}});Ext.define("Sch.view.dependency.Painter",{alias:"schdependencypainter.default",mixins:[Ext.mixin.Factoryable],config:{selectedCls:"sch-dependency-selected",cls:"",rtl:false,lineTpl:null,canvasCls:null,pathFinderConfig:null,realLineThickness:null},pathFinder:null,dependencyIdAttr:"data-sch-dependency-id",constructor:function(d){var c=this;c.initConfig(d);c.pathFinder=c.createPathFinder(c.getPathFinderConfig());if(!c.getLineTpl()){c.setLineTpl(new Sch.template.Dependency({rtl:c.getRtl()}))}},clone:function(){var b=this;return new b.self(b.getConfig())},applyLineTpl:function(b){return b instanceof Ext.XTemplate?b:new Ext.XTemplate(b)},updatePathFinderConfig:function(d){var c=this;if(c.pathFinder){if(d&&"type" in d&&d.type!==c.pathFinder.type){Ext.destroy(c.pathFinder);c.pathFinder=c.createPathFinder(d)}else{c.pathFinder.setConfig(d)}}},createPathFinder:function(b){return Sch.util.RectangularPathFinder.create(b)},getCanvasSpecification:function(){return{tag:"div",role:"presentation",cls:this.getCanvasCls()}},paint:function(j,m,k,h){var l=this,i=l.generatePaintMarkup(j,k);m=Ext.fly(m);if(h){var n=document.createElement("div");n.innerHTML=i;m.syncContent(n)}else{m.insertHtml("beforeEnd",i)}},generatePaintMarkup:function(g,h){var e=this,f=e.getLineDefsForDependencies(g,h);if(!Ext.isArray(f)){f=[f]}return Ext.Array.map(f,function(a){var b=e.getLineTplData(a);return b&&e.getLineTpl().apply(b)||""}).join("")},isDependencyElement:function(d){var c=this;d=Ext.fly(d);return d.is(".sch-dependency")||d.is(".sch-dependency-arrow")},getElementsForDependency:function(f,h){var g=Ext.dom.Query,e=this;if(h&&!Ext.isArray(h)){h=[h]}return new Ext.dom.CompositeElementLite(Ext.Array.reduce(h||[],function(b,a){return b.concat(g.select("["+e.dependencyIdAttr+'="'+a.internalId+'"]',Ext.getDom(f)))},[]))},getDependencyElements:function(c){var d=Ext.getDom(c);return new Ext.dom.CompositeElementLite(d&&d.childNodes||[])},getElementDependencyInternalId:function(b){return Ext.fly(b).getAttribute(this.dependencyIdAttr)},highlightDependency:function(h,e,f){var g=this;g.getElementsForDependency(h,e).addCls(f||g.getSelectedCls())},unhighlightDependency:function(h,e,f){var g=this;g.getElementsForDependency(h,e).removeCls(f||g.getSelectedCls())},getSelectedDependencyElements:function(d){var c=this;return Ext.fly(d).select("."+c.getSelectedCls())},clearSelectedDependencies:function(d){var c=this;c.getDependencyElements(d).removeCls(c.getSelectedCls())},getLineTplData:function(r){var o=this,m,p,l,n,i;r=Ext.apply({},r,o.getConfig());i=o.pathFinder.findPath(r);if(i){if(!r.startBox.rendered&&!r.endBox.rendered){for(var q=i.length-1;q>=0;q--){var k=i[q];if(k.x1===k.x2){i=[k];r.startArrowSize=r.endArrowSize=0;break}}}m=o.getRtl();p=o.getRealLineThickness();l=i.length&&i[0];n=i.length&&i[i.length-1];i={cls:r.cls||"",dependencyId:r.dependencyId||"",isHighlighted:r.isHighlighted,segments:Ext.Array.map(i,function(a){var b=o.getSegmentDir(a),c;if(b=="horizontal"){c={width:Math.abs(a.x1-a.x2)+1,height:p,top:Math.min(a.y1,a.y2),side:Math.min(a.x1,a.x2),dir:b}}else{c={height:Math.abs(a.y1-a.y2)+1,width:p,top:Math.min(a.y1,a.y2),side:Math.min(a.x1,a.x2),dir:b}}return c}),startArrow:r.startArrowSize&&{side:l.x1,top:l.y1,dir:o.convertSideToDir(r.startSide,m)},endArrow:r.endArrowSize&&{side:n.x2,top:n.y2,dir:o.convertSideToDir(r.endSide,m)},realLineThickness:o.getRealLineThickness()}}return i},getLineDefsForDependencies:function(j,k){var l=Ext.Array,m=this,i=j.getId(),n={},h;if(!Ext.isArray(k)){k=[k]}return l.reduce(k||[],function(f,c){var b=c.getSourceEvent(),a=c.getTargetEvent(),e,d;if(b&&a&&b.isScheduled()&&a.isScheduled()){h=b.internalId;if(!n[h]){e=m.getItemBox(j,b)||[];if(!Ext.isArray(e)){e=[e]}n[h]=e}else{e=n[h]}h=a.internalId;if(!n[h]){d=m.getItemBox(j,a)||[];if(!Ext.isArray(d)){d=[d]}n[h]=d}else{d=n[h]}f=l.reduce(e,function(r,g,q){return l.reduce(d,function(t,p,o){if(g&&p&&(g.rendered||p.rendered||g.relPos!=p.relPos)){t.push(m.createLineDef(j,c,b,a,g,p,null))}return t},r)},f)}return f},[])},getItemBox:function(c,d){return c.getItemBox(d)},createLineDef:function(T,J,I,C,ab,Q,S){var G=J.self.Type,D=this,U=J.getType(),M=0,N=D.pathFinder.getHorizontalMargin(),E=D.pathFinder.getVerticalMargin(),W=J.getBidirectional(),F=W?D.pathFinder.getStartArrowMargin():0,L=W?D.pathFinder.getStartArrowSize():0,aa=D.pathFinder.getEndArrowMargin(),Y=D.pathFinder.getEndArrowSize(),P,B;switch(true){case U==G.StartToEnd:P=T.getConnectorStartSide(I);B=T.getConnectorEndSide(C);break;case U==G.StartToStart:P=T.getConnectorStartSide(I);B=T.getConnectorStartSide(C);break;case U==G.EndToStart:P=T.getConnectorEndSide(I);B=T.getConnectorStartSide(C);break;case U==G.EndToEnd:P=T.getConnectorEndSide(I);B=T.getConnectorEndSide(C);break;default:throw"Invalid dependency type: "+J.getType()}if(ab.top===Q.top){F=aa=0;if(Math.abs(ab.end-Q.start)<(Y+L)){L=Y=0}}switch(true){case (P=="left"||P=="right")&&(B=="left"||B=="right"):E=2;N=5;break;case (P=="top"||P=="bottom")&&(B=="top"||B=="bottom"):E=7;N=2}var V=Number.MAX_VALUE;var O={from:ab.start+(ab.end-ab.start)/2,to:Q.start+(Q.end-Q.start)/2};var X={from:ab.top+(ab.bottom-ab.top)/2,to:Q.top+(Q.bottom-Q.top)/2};if((P==="top"&&B==="bottom"||P==="bottom"&&B==="top")&&O.from===O.to){V=Math.abs(ab[P]-Q[B])}else{if((P==="left"&&B==="right"||P==="right"&&B==="left")&&X.from===X.to){var R=P==="left"?"start":"end";var K=B==="left"?"start":"end";if(T.rtl){R=R==="start"?"end":"start";K=K==="start"?"end":"start"}var H=ab[R];var Z=Q[K];V=Math.abs(H-Z)}}if(V<(Y*aa)*2){F=aa=0;if(V<=Y*2){L=Y=0}}return{startBox:ab,startSide:P,startArrowSize:L,startArrowMargin:F,endBox:Q,endSide:B,endArrowSize:Y,endArrowMargin:aa,verticalMargin:E,horizontalMargin:N,otherBoxes:S,dependencyId:J.internalId,cls:J.getCls(),isHighlighted:J.isHighlighted}},convertSideToDir:function(d,c){return this.self.sideToDir[d+(c&&"-rtl"||"")]},getSegmentDir:function(c){var d="vertical";if(c.y1===c.y2){d="horizontal"}return d},inheritableStatics:{sideToDir:{left:"right",right:"left",top:"down",bottom:"up","left-rtl":"left","right-rtl":"right","top-rtl":"down","bottom-rtl":"up"}}});Ext.define("Sch.view.dependency.View",{alias:"schdependencyview.base",mixins:[Ext.mixin.Factoryable,Ext.mixin.Observable],config:{primaryView:null,dependencyStore:null,drawDependencies:true,painterConfig:{canvasCls:"sch-dependencyview-ct"},canvasLayer:0,overCls:null},renderTimer:null,painter:null,primaryViewDetacher:null,primaryViewLockableDetacher:null,primaryViewElDetacher:null,dependencyStoreDetacher:null,constructor:function(d){var c=this;c.callParent([d]);c.mixins.observable.constructor.call(c,d);c.initConfig(d);c.painter=c.createPainter(Ext.apply({},{rtl:c.getPrimaryView().rtl},c.getPainterConfig()));if(c.canDrawDependencies()){c.startDrawDependencies()}},destroy:function(){this.stopDrawDependencies()},destroyDetachers:function(){var b=this;Ext.destroyMembers(this,["primaryViewDetacher","primaryViewLockableDetacher","primaryViewElDetacher","dependencyStoreDetacher"])},destroyDependencyCanvas:function(){var b=this;if(b.isDependencyCanvasPresent()){Ext.destroy(b.getDependencyCanvas())}},canDrawDependencies:function(e,f,g){var h=this;return !!(h.painter&&(e||h.getDrawDependencies())&&(f||h.isDependencyCanvasAvailable())&&(g||h.getDependencyStore()))},startDrawDependencies:function(){var e=this,h=e.getPrimaryView(),f=e.getDependencyStore(),g;e.primaryViewDetacher=h.on(Ext.applyIf({destroyable:true},e.getPrimaryViewListeners()));e.primaryViewElDetacher=h.getEl().on(Ext.applyIf({destroyable:true},e.getPrimaryViewElListeners()));g=h.grid.ownerLockable&&h.grid.ownerLockable.getView();if(h!=g){e.primaryViewLockableDetacher=g.on(Ext.applyIf({destroyable:true},e.getPriviewViewLockableListeners()))}e.dependencyStoreDetacher=f.on(Ext.applyIf({destroyable:true},e.getDependencyStoreListeners()));e.scheduleAllDependenciesRendering()},stopDrawDependencies:function(){var b=this;b.destroyDetachers();b.destroyDependencyCanvas()},updatePrimaryView:function(g,f){var e=this,h;if(f){e.stopDrawDependencies()}if(g){if(!e.getDependencyStore()&&g.getEventStore()){e.setDependencyStore(g.getEventStore().getDependencyStore())}if(e.canDrawDependencies()){e.startDrawDependencies()}}},applyDependencyStore:function(b){return b&&Ext.StoreMgr.lookup(b)},updateDependencyStore:function(e,f){var d=this;if(f){d.stopDrawDependencies()}if(e&&d.canDrawDependencies()){d.startDrawDependencies()}},updateDrawDependencies:function(f,e){var d=this;if(f&&d.canDrawDependencies(true)){d.startDrawDependencies()}else{if(!f){d.stopDrawDependencies()}}},applyPainterConfig:function(b){return Ext.isObject(b)?Ext.apply({},b):b},updatePainterConfig:function(d){var c=this;if(c.painter){if(d){d=Ext.apply({},{rtl:c.getPrimaryView().rtl},d)}if(d&&"type" in d&&d.type!==c.painter.type){Ext.destroy(c.painter);c.painter=c.createPainter(d)}else{c.painter.setConfig(d)}c.destroyDependencyCanvas();if(c.canDrawDependencies()){c.scheduleAllDependenciesRendering()}}},updateCanvasLayer:function(d){var c=this;c.destroyDependencyCanvas();if(c.canDrawDependencies()){c.scheduleAllDependenciesRendering()}},getPrimaryViewListeners:function(){var b=this;return{itemadd:b.onPrimaryViewItemAdd,itemremove:b.onPrimaryViewItemRemove,itemupdate:b.onPrimaryViewItemUpdate,refresh:b.onPrimaryViewRefresh,bufferedrefresh:b.onPrimaryViewRefresh,expandbody:b.onPrimaryViewRowExpand,collapsebody:b.onPrimaryViewRowCollapse,eventrepaint:b.onPrimaryViewEventRepaint,scope:b}},getPriviewViewLockableListeners:function(){var b=this;return{expandbody:b.onPrimaryViewRowExpand,collapsebody:b.onPrimaryViewRowCollapse,scope:b}},getPrimaryViewElListeners:function(){var b=this;return{dblclick:b.onPrimaryViewDependencyElPointerEvent,click:b.onPrimaryViewDependencyElPointerEvent,contextmenu:b.onPrimaryViewDependencyElPointerEvent,mouseover:b.onPrimaryViewDependencyElPointerEvent,mouseout:b.onPrimaryViewDependencyElPointerEvent,delegate:".sch-dependency",scope:b}},getDependencyStoreListeners:function(){var b=this;return{add:b.onDependencyStoreAdd,remove:b.onDependencyStoreRemove,update:b.onDependencyStoreUpdate,refresh:b.onDependencyStoreRefresh,clear:b.onDependencyStoreClear,scope:b}},createPainter:function(b){return Sch.view.dependency.Painter.create(b)},clonePainter:function(){var b=this;return b.painter&&b.painter.clone()||null},isDependencyCanvasAvailable:function(){var b=this.getPrimaryView();return b&&b.isItemCanvasAvailable()},isDependencyCanvasPresent:function(){var d=this,c=d.getPrimaryView();return c&&c.isItemCanvasAvailable(d.getCanvasLayer())},getDependencyCanvas:function(){var b=this;return b.getPrimaryView().getItemCanvasEl(b.getCanvasLayer(),b.painter.getCanvasSpecification())},isDependencyRenderingScheduled:function(){return !!this.renderTimer},scheduleAllDependenciesRendering:function(){var c=this,d;if(!c.isDependencyRenderingScheduled()&&c.canDrawDependencies()){d=c.getPrimaryView().up("{isHidden()}");if(d){c.renderTimer=true;d.on("show",function(){c.renderTimer=null;c.renderAllDependencies()},c,{single:true})}else{c.renderTimer=setTimeout(function(){c.renderTimer=null;c.renderAllDependencies()})}}},renderAllDependencies:function(){var d=this,c;if(d.canDrawDependencies()){c=d.getDependencyCanvas();d.renderDependencies(d.getDependencyStore().getRange(),true);d.fireEvent("refresh",d)}},renderDependencies:function(f,e){var d=this;if(d.canDrawDependencies()){d.painter.paint(d.getPrimaryView(),d.getDependencyCanvas(),f||[],e)}},updateDependencies:function(c){var d=this;d.clearDependencies(c);d.renderDependencies(c,false)},clearDependencies:function(c){var d=this;if(d.canDrawDependencies()&&d.isDependencyCanvasPresent()){Ext.destroy(d.getElementsForDependency(c))}},clearAllDependencies:function(){this.renderDependencies([],true)},getElementsForDependency:function(f){var d=this,e=false;if(d.canDrawDependencies()&&d.isDependencyCanvasPresent()){e=d.painter.getElementsForDependency(d.getDependencyCanvas(),f)}return e},getDependencyForElement:function(j){var h=this,f=h.getDependencyStore(),g=null,i;if(f){i=h.painter.getElementDependencyInternalId(j);g=f.getByInternalId(i)}return g},getDependencyElements:function(){var f=this,e=false,d;if(f.canDrawDependencies()&&f.isDependencyCanvasPresent()){e=f.painter.getDependencyElements(f.getDependencyCanvas())}return e},highlightDependency:function(d,e){var f=this;if(f.canDrawDependencies()&&f.isDependencyCanvasPresent()){if(!(d instanceof Ext.data.Model)){d=f.getDependencyStore().getById(d)}if(d){f.painter.highlightDependency(f.getDependencyCanvas(),d,e);d.isHighlighted=true}}},unhighlightDependency:function(d,e){var f=this;if(f.canDrawDependencies()&&f.isDependencyCanvasPresent()){if(!(d instanceof Ext.data.Model)){d=f.getDependencyStore().getById(d)}if(d){f.painter.unhighlightDependency(f.getDependencyCanvas(),d,e);d.isHighlighted=false}}},getSelectedDependencyElements:function(){var c=this,d=false;if(c.canDrawDependencies()&&c.isDependencyCanvasPresent()){d=c.painter.getSelectedDependencyElements(c.getDependencyCanvas())}return d},clearSelectedDependencies:function(){var b=this;if(b.canDrawDependencies()&&b.isDependencyCanvasPresent()){b.painter.clearSelectedDependencies(b.getDependencyCanvas());b.getDependencyStore().each(function(a){a.isHighlighted=false})}},onPrimaryViewItemAdd:function(){this.scheduleAllDependenciesRendering()},onPrimaryViewItemRemove:function(){this.scheduleAllDependenciesRendering()},onPrimaryViewItemUpdate:function(e,d,f){this.scheduleAllDependenciesRendering()},onPrimaryViewRefresh:function(){this.scheduleAllDependenciesRendering()},onPrimaryViewRowExpand:function(){this.scheduleAllDependenciesRendering()},onPrimaryViewRowCollapse:function(){this.scheduleAllDependenciesRendering()},onPrimaryViewEventRepaint:function(d,e,f){this.scheduleAllDependenciesRendering()},onPrimaryViewDependencyElPointerEvent:function(k,h,m){var l=this,i,n;i=l.painter.getElementDependencyInternalId(h);n=l.getDependencyStore().getByInternalId(i);if(n){var j=this.getOverCls();l.fireEvent("dependency"+k.type,l,n,k,h);if(j){if(k.type==="mouseover"){this.highlightDependency(n,j)}else{if(k.type==="mouseout"){this.unhighlightDependency(n,j)}}}}},onDependencyStoreAdd:function(d,c){this.renderDependencies(c)},onDependencyStoreRemove:function(d,c){this.clearDependencies(c)},onDependencyStoreUpdate:function(d,c){this.updateDependencies(c)},onDependencyStoreRefresh:function(b){this.scheduleAllDependenciesRendering()},onDependencyStoreClear:function(b){this.scheduleAllDependenciesRendering()}});Ext.define("Gnt.locale.En",{extend:Sch.locale.Locale,singleton:true,l10n:{"Gnt.util.DurationParser":{unitsRegex:{MILLI:/^ms$|^mil/i,SECOND:/^s$|^sec/i,MINUTE:/^m$|^min/i,HOUR:/^h$|^hr$|^hour/i,DAY:/^d$|^day/i,WEEK:/^w$|^wk|^week/i,MONTH:/^mo|^mnt/i,QUARTER:/^q$|^quar|^qrt/i,YEAR:/^y$|^yr|^year/i}},"Gnt.util.DependencyParser":{typeText:{SS:"SS",SF:"SF",FS:"FS",FF:"FF"}},"Gnt.panel.Timeline":{start:"Start",end:"End"},"Gnt.field.ShowInTimeline":{yes:"Yes",no:"No"},"Gnt.column.ShowInTimeline":{text:"Show in timeline"},"Gnt.field.ConstraintType":{none:"None",invalidText:"Invalid value"},"Gnt.field.Duration":{invalidText:"Invalid value"},"Gnt.field.Effort":{invalidText:"Invalid value"},"Gnt.field.Percent":{invalidText:"Invalid value"},"Gnt.field.SchedulingMode":{Normal:"Normal",FixedDuration:"Fixed duration",EffortDriven:"Effort driven",DynamicAssignment:"Dynamic assignment",invalidText:"Invalid value"},"Gnt.feature.DependencyDragDrop":{fromText:"From",toText:"To",startText:"Start",endText:"End"},"Gnt.template.Deadline":{deadline:"Deadline"},"Gnt.column.DeadlineDate":{text:"Deadline"},"Gnt.Tooltip":{startText:"Starts: ",endText:"Ends: ",durationText:"Duration: "},"Gnt.plugin.TaskContextMenu":{taskInformation:"Task information...",projectInformation:"Project information...",newTaskText:"New task",deleteTask:"Delete task(s)",editLeftLabel:"Edit left label",editRightLabel:"Edit right label",add:"Add...",deleteDependency:"Delete dependency...",addTaskAbove:"Task above",addTaskBelow:"Task below",addMilestone:"Milestone",addSubtask:"Sub-task",addSuccessor:"Successor",addPredecessor:"Predecessor",convertToMilestone:"Convert to milestone",convertToRegular:"Convert to regular task",splitTask:"Split task"},"Gnt.plugin.DependencyEditor":{fromText:"From",toText:"To",typeText:"Type",lagText:"Lag",endToStartText:"Finish-To-Start",startToStartText:"Start-To-Start",endToEndText:"Finish-To-Finish",startToEndText:"Start-To-Finish",okButtonText:"Ok",cancelButtonText:"Cancel",deleteButtonText:"Delete"},"Gnt.widget.calendar.Calendar":{dayOverrideNameHeaderText:"Name",overrideName:"Name",startDate:"Start Date",endDate:"End Date",error:"Error",dateText:"Date",addText:"Add",editText:"Edit",removeText:"Remove",workingDayText:"Working day",weekendsText:"Weekends",overriddenDayText:"Overridden day",overriddenWeekText:"Overridden week",workingTimeText:"Working time",nonworkingTimeText:"Non-working time",dayOverridesText:"Day overrides",weekOverridesText:"Week overrides",okText:"OK",cancelText:"Cancel",parentCalendarText:"Parent calendar",noParentText:"No parent",selectParentText:"Select parent",newDayName:"[Without name]",calendarNameText:"Calendar name",tplTexts:{tplWorkingHours:"Working hours for",tplIsNonWorking:"is non-working",tplOverride:"override",tplInCalendar:"in calendar",tplDayInCalendar:"standard day in calendar",tplBasedOn:"Based on"},overrideErrorText:"There is already an override for this day",overrideDateError:"There is already a week override on this date: {0}",startAfterEndError:"Start date should be less than end date",weeksIntersectError:"Week overrides should not intersect"},"Gnt.widget.calendar.AvailabilityGrid":{startText:"Start",endText:"End",addText:"Add",removeText:"Remove",error:"Error"},"Gnt.widget.calendar.DayEditor":{workingTimeText:"Working time",nonworkingTimeText:"Non-working time"},"Gnt.widget.calendar.WeekEditor":{defaultTimeText:"Default time",workingTimeText:"Working time",nonworkingTimeText:"Non-working time",error:"Error",noOverrideError:"Week override contains only 'default' days - can't save it"},"Gnt.widget.calendar.ResourceCalendarGrid":{name:"Name",calendar:"Calendar"},"Gnt.widget.calendar.CalendarWindow":{ok:"Ok",cancel:"Cancel"},"Gnt.widget.calendar.CalendarManager":{addText:"Add",removeText:"Remove",add_child:"Add child",add_node:"Add calendar",add_sibling:"Add sibling",remove:"Remove",calendarName:"Calendar",confirm_action:"Confirm action",confirm_message:"Calendar has unsaved changes. Would you like to save your changes?"},"Gnt.widget.calendar.CalendarManagerWindow":{title:"Calendar manager",ok:"Apply changes",cancel:"Close",confirm_action:"Confirm action",confirm_message:"Calendar has unsaved changes. Would you like to save your changes?"},"Gnt.field.Assignment":{cancelText:"Cancel",closeText:"Save and Close"},"Gnt.column.AssignmentUnits":{text:"Units"},"Gnt.column.Duration":{text:"Duration"},"Gnt.column.Effort":{text:"Effort"},"Gnt.column.EndDate":{text:"Finish"},"Gnt.column.PercentDone":{text:"% Done"},"Gnt.column.ResourceAssignment":{text:"Assigned Resources"},"Gnt.column.ResourceName":{text:"Resource Name"},"Gnt.column.Rollup":{text:"Rollup task",no:"No",yes:"Yes"},"Gnt.field.ManuallyScheduled":{yes:"Yes",no:"No"},"Gnt.field.ReadOnly":{yes:"Yes",no:"No"},"Gnt.column.ManuallyScheduled":{text:"Manual mode"},"Gnt.column.SchedulingMode":{text:"Mode"},"Gnt.column.Predecessor":{text:"Predecessors"},"Gnt.column.Successor":{text:"Successors"},"Gnt.column.StartDate":{text:"Start"},"Gnt.column.WBS":{text:"WBS"},"Gnt.column.Sequence":{text:"#"},"Gnt.column.Calendar":{text:"Calendar"},"Gnt.column.ReadOnly":{text:"Read Only"},"Gnt.column.Text1":{text:"Text1"},"Gnt.column.Text2":{text:"Text2"},"Gnt.column.Text3":{text:"Text3"},"Gnt.column.Text4":{text:"Text4"},"Gnt.column.Text5":{text:"Text5"},"Gnt.column.Text6":{text:"Text6"},"Gnt.column.Text7":{text:"Text7"},"Gnt.column.Text8":{text:"Text8"},"Gnt.column.Text9":{text:"Text9"},"Gnt.column.Text10":{text:"Text10"},"Gnt.column.Number1":{text:"Number1"},"Gnt.column.Number2":{text:"Number2"},"Gnt.column.Number3":{text:"Number3"},"Gnt.column.Number4":{text:"Number4"},"Gnt.column.Number5":{text:"Number5"},"Gnt.column.Number6":{text:"Number6"},"Gnt.column.Number7":{text:"Number7"},"Gnt.column.Number8":{text:"Number8"},"Gnt.column.Number9":{text:"Number9"},"Gnt.column.Number10":{text:"Number10"},"Gnt.column.ClientName":{text:"Client"},"Gnt.column.ResponsiblePersonName":{text:"Responsible"},"Gnt.column.Priority":{text:"Priority"},"Gnt.column.Completed":{text:"Completed"},"Gnt.column.CreatedDate":{text:"Entry Date"},"Gnt.column.ReshowDate":{text:"Reshow Date"},"Gnt.column.LateFinish":{text:"End Late"},"Gnt.column.LateStart":{text:"Begin Late"},"Gnt.column.EarlyStart":{text:"Begin Early"},"Gnt.column.EndProg":{text:"End Prog"},"Gnt.column.ActualStart":{text:"Begin Actual"},"Gnt.column.ActualEnd":{text:"End Actual"},"Gnt.widget.taskeditor.ProjectForm":{projectText:"Project",nameText:"Name",datesText:"Dates",startText:"Start",finishText:"Finish",calendarText:"Calendar",readOnlyText:"Read Only",allowDependenciesText:"Allow cross-project dependencies"},"Gnt.widget.taskeditor.TaskForm":{taskNameText:"Name",durationText:"Duration",datesText:"Dates",baselineText:"Baseline",startText:"Start",finishText:"Finish",percentDoneText:"Percent Complete",baselineStartText:"Start",baselineFinishText:"Finish",baselinePercentDoneText:"Percent Complete",effortText:"Effort",invalidEffortText:"Invalid effort value",calendarText:"Calendar",manuallyScheduledText:"Manually Scheduled",schedulingModeText:"Scheduling Mode",rollupText:"Rollup",wbsCodeText:"WBS code","Constraint Type":"Constraint Type","Constraint Date":"Constraint Date",readOnlyText:"Read Only"},"Gnt.widget.DependencyGrid":{idText:"ID",snText:"SN",taskText:"Task Name",blankTaskText:"Please select task",invalidDependencyText:"Invalid dependency",parentChildDependencyText:"Dependency between child and parent found",duplicatingDependencyText:"Duplicate dependency found",transitiveDependencyText:"Transitive dependency",cyclicDependencyText:"Cyclic dependency",typeText:"Type",lagText:"Lag",clsText:"CSS class",endToStartText:"Finish-To-Start",startToStartText:"Start-To-Start",endToEndText:"Finish-To-Finish",startToEndText:"Start-To-Finish",predecessorsText:"Predecessors",successorsText:"Successors"},"Gnt.widget.AssignmentEditGrid":{confirmAddResourceTitle:"Confirm",confirmAddResourceText:"Resource &quot;{0}&quot; not found in list. Would you like to add it?",noValueText:"Please select resource to assign",noResourceText:"No resource &quot;{0}&quot; found in the list"},"Gnt.widget.taskeditor.TaskEditor":{generalText:"General",resourcesText:"Resources",addDependencyText:"Add new",dropDependencyText:"Remove",notesText:"Notes",advancedText:"Advanced",addAssignmentText:"Add new",dropAssignmentText:"Remove"},"Gnt.widget.taskeditor.ProjectEditor":{generalText:"General",descriptionText:"Description"},"Gnt.plugin.taskeditor.BaseEditor":{title:"Task Information",alertCaption:"Information",alertText:"Please correct marked errors to save changes",okText:"Ok",cancelText:"Cancel"},"Gnt.plugin.taskeditor.ProjectEditor":{title:"Project Information"},"Gnt.field.EndDate":{endBeforeStartText:"End date is before start date"},"Gnt.column.Note":{text:"Note"},"Gnt.column.AddNew":{text:"Add new column..."},"Gnt.column.EarlyStartDate":{text:"Early Start"},"Gnt.column.EarlyEndDate":{text:"Early Finish"},"Gnt.column.LateStartDate":{text:"Late Start"},"Gnt.column.LateEndDate":{text:"Late Finish"},"Gnt.field.Calendar":{calendarNotApplicable:"Task calendar has no overlapping with assigned resources calendars",invalidText:"Invalid value"},"Gnt.column.Slack":{text:"Slack"},"Gnt.column.Name":{text:"Task Name"},"Gnt.column.BaselineStartDate":{text:"Baseline Start Date"},"Gnt.column.BaselineEndDate":{text:"Baseline End Date"},"Gnt.column.Milestone":{text:"Milestone"},"Gnt.field.Milestone":{yes:"Yes",no:"No"},"Gnt.field.Dependency":{invalidFormatText:"Invalid dependency format",invalidDependencyText:"Invalid dependency found, please make sure you have no cyclic paths between your tasks",invalidDependencyType:"Invalid dependency type {0}. Allowed values are: {1}."},"Gnt.constraint.Base":{name:"A constraint","Remove the constraint":"Remove the constraint","Cancel the change and do nothing":"Cancel the change and do nothing"},"Gnt.constraint.FinishNoEarlierThan":{name:"Finish no earlier than","Move the task to finish on {0}":"Move the task to finish on {0}"},"Gnt.constraint.FinishNoLaterThan":{name:"Finish no later than","Move the task to finish on {0}":"Move the task to finish on {0}"},"Gnt.constraint.MustFinishOn":{name:"Must finish on","Move the task to finish on {0}":"Move the task to finish on {0}"},"Gnt.constraint.MustStartOn":{name:"Must start on","Move the task to start at {0}":"Move the task to start at {0}"},"Gnt.constraint.StartNoEarlierThan":{name:"Start no earlier than","Move the task to start at {0}":"Move the task to start at {0}"},"Gnt.constraint.StartNoLaterThan":{name:"Start no later than","Move the task to start at {0}":"Move the task to start at {0}"},"Gnt.column.ConstraintDate":{text:"Constraint date"},"Gnt.column.ConstraintType":{text:"Constraint"},"Gnt.widget.ConstraintResolutionForm":{dateFormat:"m/d/Y",OK:"OK",Cancel:"Cancel","Resolution options":"Resolution options","Don't ask again":"Don't ask again","Task {0} violates constraint {1}":'Task "{0}" violates constraint {1}',"Task {0} violates constraint {1} {2}":'Task "{0}" violates constraint {1} {2}'},"Gnt.widget.ConstraintResolutionWindow":{"Constraint violation":"Constraint violation"},"Gnt.panel.ResourceHistogram":{resourceText:"Resource"}},apply:function(b){Sch.locale.En.apply(b);this.callParent(arguments)}});Ext.define("Gnt.mixin.Localizable",{extend:Sch.mixin.Localizable});Ext.define("Gnt.Tooltip",{extend:Ext.ToolTip,alias:"widget.gantt_task_tooltip",mixins:[Gnt.mixin.Localizable],mode:"startend",autoHide:false,anchor:"b-tl",maskOnDisable:false,template:null,gantt:null,initComponent:function(){this.rtl=this.gantt.rtl;this.startLabel=this.L("startText");this.endLabel=this.L("endText");this.durationLabel=this.L("durationText");if(!this.template){this.template=new Ext.Template('<div class="sch-timetipwrap {cls}"><table cellpadding="0" cellspacing="0"><tpl if="value1"><tr><td class="sch-gantt-tip-desc">{label1}</td><td class="sch-gantt-tip-value">{value1}</td></tr></tpl><tr><td class="sch-gantt-tip-desc">{label2}</td><td class="sch-gantt-tip-value">{value2}</td></tr></table></div>').compile()}this.callParent(arguments);this.update(this.template.apply({value1:"",value2:""}));this.addCls("gnt-tooltip")},updateContent:function(h,f,i,g){var j;if(this.mode==="duration"){j=this.getDurationContent(h,f,i,g)}else{j=this.getStartEndContent(h,f,i,g)}this.update(j)},getStartEndContent:function(k,i,m,j){var p=this.gantt,n=k&&p.getFormattedDate(k),o;if(k){if(i-k>0){o=p.getFormattedEndDate(i,k)}else{o=n}}else{o=p.getFormattedEndDate(i)}var l={cls:m?"sch-tip-ok":"sch-tip-notok",label2:this.endLabel,value2:o,task:j};if(k){l.label1=this.startLabel;l.value1=k&&p.getFormattedDate(k)}return this.template.apply(l)},getDurationContent:function(i,g,k,h){var l=h.getDurationUnit()||Sch.util.Date.DAY;var j=h.calculateDuration(i,g,l);return this.template.apply({cls:k?"sch-tip-ok":"sch-tip-notok",label1:this.startLabel,value1:this.gantt.getFormattedDate(i),label2:this.endLabel,value2:parseFloat(Ext.Number.toFixed(j,1))+" "+Sch.util.Date.getReadableNameOfUnit(l,j>1),task:h})},show:function(d,c){if(d&&(d.dom||d.className)){this.setTarget(d)}this.callParent([]);if(c!==undefined){this.setX(c)}}});Ext.define("Gnt.column.AddNew",{extend:Ext.grid.column.Column,alias:["widget.addnewcolumn","widget.ganttcolumn.addnew"],mixins:[Gnt.mixin.Localizable],text:"",width:100,resizable:false,menuDisabled:true,sortable:false,draggable:false,colEditor:null,colEditorStore:null,layout:"fit",ignoreInAddMenu:true,ignoreInExport:true,ignoreExport:true,columnList:null,initComponent:function(){this.addCls("gnt-addnewcolumn");this.items=this.getColEditor();this.callParent(arguments)},getGantt:function(){if(!this.gantt){this.gantt=this.up("ganttpanel")}return this.gantt},getColEditor:function(){var c=this,d;if(!c.colEditor){d=c.colEditor=new Ext.form.field.ComboBox({itemId:"addNewEditor",displayField:"text",valueField:"clsName",hideTrigger:true,queryMode:"local",multiSelect:false,value:this.L("text"),listConfig:{itemId:"addNewEditorComboList",minWidth:150},store:c.getColEditorStore(),pickerAlign:"tl-bl",listeners:{focus:c.onInputFocus,blur:c.onFieldBlur,select:c.onSelect,scope:c}});if(Ext.isIE8m){d.on("resize",function(b,h,j,i,a){b.inputEl.setStyle("line-height",+j+"px");b.setValue(b.getValue()+" ")})}}return c.colEditor},onFieldBlur:function(g,h){var f=g.getPicker();var e=f.el&&f.el.dom;if(!h.relatedTarget||h.relatedTarget!==e){this.resetField()}},resetField:function(){this.getColEditor().setValue(this.L("text"));this.getColEditor().collapse()},getColEditorStore:function(){var b=this;if(!b.colEditorStore){b.columnList=b.columnList||Gnt.column.AddNew.buildDefaultColumnList();b.colEditorStore=new Ext.data.Store({fields:["text","clsName","config"],data:b.columnList,sorters:[{property:"text",direction:"ASC"}]})}return b.colEditorStore},onInputFocus:function(b){b.setValue();b.expand()},onSelect:function(c,d){this.resetField();this.getColEditor().blur();this.addColumn(Ext.isArray(d)?d[0]:d)},addColumn:function(h){var l=this;var j=h;var i=l.up("headercontainer");var k=j.get("text");var n=j.get("config")||{};var m=j.get("clsName")||n.xclass||"Ext.grid.column.Column";Ext.require(m,function(){var b=Ext.ClassManager.get(m);var a=Ext.create(Ext.applyIf(n,{xclass:m,text:k,dataIndex:l.getGantt().taskStore.model.prototype[b.prototype.fieldProperty]}));i.insert(i.items.indexOf(l),a)})},destroy:function(){this.colEditorStore&&this.colEditorStore.destroy();this.callParent(arguments)},statics:{buildDefaultColumnList:function(){var b=[];Ext.Array.each(Ext.ClassManager.getNamesByExpression("widget.ganttcolumn.*"),function(d){var a=Ext.ClassManager.get(d);if(a&&!a.prototype.ignoreInAddMenu){b.push({clsName:d,text:a.prototype.localize?a.prototype.localize("text"):a.prototype.text})}});return b.sort(function(a,e){return a.text>e.text?1:-1})}}});Ext.define("Gnt.field.Percent",{extend:Ext.form.field.Number,alias:"widget.percentfield",mixins:[Gnt.mixin.Localizable],alternateClassName:"Gnt.widget.PercentField",disableKeyFilter:false,minValue:0,maxValue:100,allowExponential:false,baseChars:"0123456789%",constructor:function(){this.callParent(arguments);this.invalidText=this.L("invalidText")},valueToRaw:function(b){if(Ext.isNumber(b)){return parseFloat(Ext.Number.toFixed(b,this.decimalPrecision))+"%"}return""},getErrors:function(c){var d=this.parseValue(c);if(d===null){if(c!==null&&c!==""){return[this.invalidText]}else{d=""}}return this.callParent([d])}});Ext.define("Gnt.column.AssignmentUnits",{extend:Ext.grid.column.Number,mixins:[Gnt.mixin.Localizable],alias:"widget.assignmentunitscolumn",dataIndex:"Units",format:"0 %",align:"left",editor:{xtype:"percentfield",minValue:0,step:10,selectOnFocus:Ext.isIE?false:true},constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.scope=this;this.callParent(arguments)},renderer:function(d,f,e){if(d){return Ext.util.Format.number(d,this.format)}}});Ext.define("Gnt.field.mixin.TaskField",{extend:Ext.Mixin,taskField:"",fieldProperty:"",getTaskValueMethod:"",setTaskValueMethod:"",isTaskField:true,task:null,taskStore:null,suppressTaskUpdate:0,highlightTaskUpdates:true,highlightColor:"#009900",lastHighlight:0,instantUpdate:true,originalInstantUpdate:null,mixinConfig:{before:{constructor:"beforeConstructed",destroy:"beforeDestroyed"},after:{constructor:"afterConstructed"}},beforeConstructed:function(){this.setSuppressTaskUpdate(true)},afterConstructed:function(){this.taskField=this.taskField||this.fieldProperty;this.task&&this.setTask(this.task);this.setSuppressTaskUpdate(false)},setInstantUpdate:function(b){this.instantUpdate=b},beforeDestroyed:function(){this.destroyTaskListener()},setTask:function(b){if(!b){return}this.destroyTaskListener();this.updateReadOnly(b);this.task=b;b.on("taskupdated",this.onTaskUpdateProcess,this);if(!b.getCalendar(true)&&!b.getTaskStore(true)){b.taskStore=b.getTaskStore(true)||this.taskStore;if(!b.taskStore){throw"Configuration issue: Gnt.data.taskStore instance should be provided."}if(!b.getCalendar(true)&&!b.taskStore.getCalendar()){throw"Configuration issue: Gnt.data.Calendar instance should be provided."}}this.setSuppressTaskUpdate(true);this.onSetTask(b);this.setSuppressTaskUpdate(false)},onSetTask:function(b){b=b||this.task;this.setValue(this.getTaskValue(b))},setSuppressTaskUpdate:function(b){b?this.suppressTaskUpdate++:this.suppressTaskUpdate--},getSuppressTaskUpdate:function(){return this.suppressTaskUpdate},updateReadOnly:function(b){if(!this.disabled&&!this.forceReadOnly){if(this.editable===false){if(!b.isEditable(b[this.taskField])){this.setReadOnly(true)}else{if(this.inputEl){this.setReadOnly(false);this.inputEl.dom.readOnly=true}}}else{this.setReadOnly(!b.isEditable(b[this.taskField]))}}},onTaskUpdateProcess:function(g,i){if(i!==this){var j=this.getValue();this.updateReadOnly(g);this.setSuppressTaskUpdate(true);if(this.onTaskUpdate){this.onTaskUpdate(g,i)}else{this.onSetTask(g)}this.setSuppressTaskUpdate(false);if(this.highlightTaskUpdates){var h=this.getValue(),f=Ext.isDate(j);if(f&&(j-h!==0)||(!f&&String(j)!==String(h))){this.highlightField()}}}},highlightField:function(d,c){if(this.rendered&&(new Date()-this.lastHighlight>1000)){this.lastHighlight=new Date();this.inputEl.highlight(d||this.highlightColor,c||{attr:"color"})}},destroyTaskListener:function(){if(this.task){this.task.un("taskupdated",this.onTaskUpdateProcess,this)}},callTaskMethod:function(e,f,d){e=e||this.task;return e&&e[f].apply(e,d)},getTaskValue:function(b){return this.callTaskMethod(b,this.getTaskValueMethod,Ext.Array.slice(arguments,1))},setTaskValue:function(b){if(b.propagating){return}return this.callTaskMethod(b,this.setTaskValueMethod,Ext.Array.slice(arguments,1))},applyChanges:function(b){b=b||this.task;this.setTaskValue(b,this.getValue());b.fireEvent("taskupdated",b,this)}});Ext.define("Gnt.field.Date",{extend:Ext.form.field.Date,mixins:[Gnt.field.mixin.TaskField,Gnt.mixin.Localizable],adjustMilestones:true,keepDuration:false,reAssertValue:true,keepTime:true,onExpand:function(){var b=this.valueToVisible(this.getValue());this._expanding=false;if(!this.isValid()){b=this.getRawValue();if(b){b=Ext.Date.parse(b,this.format)}}this.picker.setValue(Ext.isDate(b)?b:new Date())},applyKeptTimeToValue:function(b){if(this.keepTime&&!Ext.Date.formatContainsHourInfo(this.format)){this.applyTimeToValue(b,this.getTaskValue())}return b},applyTimeToValue:function(d,c){c=c||this.getTaskValue();if(Ext.isDate(d)&&c){d.setHours(c.getHours());d.setMinutes(c.getMinutes())}return d},onSelect:function(l,h){var k=this;if(this.keepTime||Ext.Date.formatContainsHourInfo(this.format)){k.applyTimeToValue(h,this.getTaskValue())}var g=k.getValue();var i=this.visibleToValue(h);var j=Ext.Date.format(h,this.format);if(g!=i){if(this.getErrors(j).length>0){k.setRawValue(j);k.collapse();k.validate()}else{k.setValue(i,true);k.fireEvent("select",k,i);if(Ext.getVersion().isGreaterThan("6.0.1")){k.onTabOut(l)}else{k.inputEl.focus();k.collapse()}}}},setValue:function(h,e){if(this._expanding){return}this.callParent([h]);var f=this.task;if(!this.readOnly&&(e||this.instantUpdate)&&!this.getSuppressTaskUpdate()&&f&&f.taskStore&&h){this.applyChanges();if(this.reAssertValue){var g=this.getTaskValue();if(g-this.getValue()!==0){this.callParent([g])}}f.fireEvent("taskupdated",f,this)}},rawToValue:function(c){if(!c){return null}var d=this.applyKeptTimeToValue(this.parseDate(c));return this.visibleToValue(d)||c||null},valueToRaw:function(b){if(!b){return b}return Ext.Date.format(this.valueToVisible(b),this.format)},getValue:function(){return Ext.isEmpty(this.value)?null:this.value},visibleToValue:function(){throw"Abstract visibleToValue method called"},valueToVisible:function(){throw"Abstract valueToVisible method called"},checkChange:function(){if(!this.suspendCheckChange){var f=this,d=f.rawToValue((f.inputEl?f.inputEl.getValue():Ext.valueFrom(f.rawValue,""))),e=f.lastValue;if(!f.isEqual(d,e)&&!f.isDestroyed){f.lastValue=d;f.fireEvent("change",f,d,e);f.onChange(d,e)}}},assertValue:function(){var l=this,k=l.rawValue,i=l.getRawValue(),h=l.getValue(),j=l.rawToValue(i),g=l.focusTask;if(g){g.cancel()}if((k!=i)||(j-h!==0)){if(!l.validateOnBlur||l.isValid()){l.setValue(j,true)}}},applyChanges:function(d){d=d||this.task;var c=d.getTaskStore(true)||this.taskStore;if(this.value){this.setTaskValue(d,this.value,this.keepDuration,c.skipWeekendsDuringDragDrop)}else{this.setTaskValue(d,null)}},expand:function(){this._expanding=true;this.callParent(arguments)},beforeBlur:function(){this.assertValue()}});Ext.define("Gnt.field.EndDate",{extend:Gnt.field.Date,alias:"widget.enddatefield",taskField:"endDateField",getTaskValueMethod:"getEndDate",setTaskValueMethod:"setEndDate",validateStartDate:true,valueToVisible:function(c,d){d=d||this.task;return d.getDisplayEndDate(this.format,this.adjustMilestones,c,true)},visibleToValue:function(b){if(b&&this.task){if(!Ext.Date.formatContainsHourInfo(this.format)&&b-Ext.Date.clearTime(b,true)===0){b=this.task.getCalendar().getCalendarDay(b).getAvailabilityEndFor(b)||Sch.util.Date.add(b,Sch.util.Date.DAY,1)}}else{b=null}return b},isValidAgainstStartDate:function(b){return !this.task||!b||b>=this.task.getStartDate()},getErrors:function(d){var c=this.callParent(arguments);if(c&&c.length){return c}if(this.validateStartDate){if(!this.isValidAgainstStartDate(this.rawToValue(d))){return[this.L("endBeforeStartText")]}}return[]}});Ext.define("Gnt.column.mixin.TaskFieldColumn",{extend:Ext.Mixin,mixins:[Gnt.mixin.Localizable],instantUpdate:false,field:null,fieldProperty:"",fieldConfigs:"instantUpdate,fieldProperty",defaultEditor:"textfield",useRenderer:true,mixinConfig:{after:{initComponent:"afterInitComponent",onRender:"_beforeRender"},afterIf:{applyColumnCls:"applyColumnCls"}},_beforeRender:function(){var b=this.getEditor&&this.getEditor();if(b&&b.setInstantUpdate){b.originalInstantUpdate=b.instantUpdate;b.setInstantUpdate(false)}},initTaskFieldColumn:function(b){this.text=this.config.text||this.L("text");this.initColumnEditor(b);this.scope=this.scope||this;if(this.useRenderer){this.renderer=this.renderer||this.taskFieldRenderer}this.on("added",this.onColumnAdded,this)},applyColumnCls:function(d,f,e){if(!e.isEditable(this.dataIndex)){f.tdCls=(f.tdCls||"")+" sch-column-readonly"}},afterInitComponent:function(){this.hasCustomRenderer=true},initColumnEditor:function(d){var f=this.editor;if(f){if("string"==typeof f){f={xtype:f}}if(!f.isInstance){if(!f.xtype&&!f.xclass){f.xtype=this.defaultEditor}var e=Ext.copyTo(Ext.apply({},d),this,this.fieldConfigs,true);this.editor=Ext.ComponentManager.create(Ext.apply(e,f))}this.field=this.editor}},onColumnAdded:function(){var d=this.up("[taskStore]");var c=d.taskStore;if(!this.dataIndex){this.dataIndex=c.model.prototype[this.fieldProperty]}if(this.onReadOnlySet){this.mon(d,"setreadonly",this.onReadOnlySet,this)}},getValueToRender:function(e,g,f){var h=this.field;return h&&h.valueToVisible&&h.valueToVisible(e,f)||e},taskFieldRenderer:function(h,g,e){var f=Ext.util.Format.htmlEncode(this.getValueToRender.apply(this,arguments));this.applyColumnCls(h,g,e);return f},afterClassMixedIn:function(f){var j=this.prototype,g=j.mixinConfig,h=g&&g.beforeIf,i=g&&g.afterIf;h&&Ext.Object.each(h,function(b,a){if(b in f.prototype){f.addMember(b,function(){if(j[a].apply(this,arguments)!==false){return this.callParent(arguments)}})}else{f.addMember(b,function(){j[a].apply(this,arguments)})}});i&&Ext.Object.each(i,function(b,a){if(b in f.prototype){f.addMember(b,function(){this.callParent(arguments);j[a].apply(this,arguments)})}else{f.addMember(b,function(){j[a].apply(this,arguments)})}})}});Ext.define("Gnt.column.EndDate",{extend:Ext.grid.column.Date,alias:["widget.enddatecolumn","widget.ganttcolumn.enddate"],mixins:[Gnt.column.mixin.TaskFieldColumn],width:100,align:"left",editorFormat:null,adjustMilestones:true,validateStartDate:true,keepDuration:false,fieldProperty:"endDateField",fieldConfigs:["instantUpdate","adjustMilestones","keepDuration","validateStartDate","fieldProperty"],editor:"enddatefield",defaultEditor:"enddatefield",initComponent:function(){this.initTaskFieldColumn({format:this.editorFormat||this.format||Ext.Date.defaultFormat});this.callParent(arguments)},getValueToRender:function(d,f,e){return d&&Ext.Date.format(this.field.valueToVisible(d,e),this.format)||""},putRawData:function(c,d){if(c&&!(c instanceof Date)){c=Ext.Date.parse(c,this.format)}if(c&&d.getStartDate()&&d.getStartDate()>c){d.setDuration(0)}d.setEndDate(c,d.isMilestone(),false)}});Ext.define("Gnt.field.BaselineEndDate",{extend:Gnt.field.EndDate,alias:"widget.baselineenddatefield",taskField:"baselineEndDateField",getTaskValueMethod:"getBaselineEndDate",setTaskValueMethod:"setBaselineEndDate",isValidAgainstStartDate:function(b){return !this.task||!b||b>=this.task.getBaselineStartDate()},applyChanges:function(d,c){d=d||this.task;this.setTaskValue(d,this.value||null);if(!c){d.fireEvent("taskupdated",d,this)}}});Ext.define("Gnt.column.BaselineEndDate",{extend:Gnt.column.EndDate,alias:["widget.baselineenddatecolumn","widget.ganttcolumn.baselineenddate"],width:100,fieldProperty:"baselineEndDateField",fieldConfigs:["instantUpdate","adjustMilestones","keepDuration","validateStartDate","fieldProperty"],editor:"baselineenddatefield",defaultEditor:"baselineenddatefield",putRawData:function(c,d){if(c&&!(c instanceof Date)){c=Ext.Date.parse(c,this.format)}d.setBaselineEndDate(c)}});Ext.define("Gnt.field.StartDate",{extend:Gnt.field.Date,alias:"widget.startdatefield",keepDuration:true,taskField:"startDateField",getTaskValueMethod:"getStartDate",setTaskValueMethod:"setStartDate",isBaseline:false,valueToVisible:function(c,d){d=d||this.task;return d.getDisplayStartDate(this.format,this.adjustMilestones,c,true,this.isBaseline)},visibleToValue:function(f){var d=this.task;if(d&&f){var e=!Ext.isDate(this.lastValue)||this.lastValue-Ext.Date.clearTime(this.lastValue,true)===0;if(this.adjustMilestones&&d.isMilestone(this.isBaseline)&&f-Ext.Date.clearTime(f,true)===0&&e){f=d.getCalendar().getCalendarDay(f).getAvailabilityEndFor(f)||f}}return f}});Ext.define("Gnt.column.StartDate",{extend:Ext.grid.column.Date,alias:["widget.startdatecolumn","widget.ganttcolumn.startdate"],mixins:[Gnt.column.mixin.TaskFieldColumn],width:100,align:"left",editorFormat:null,adjustMilestones:true,keepDuration:true,fieldProperty:"startDateField",fieldConfigs:["instantUpdate","adjustMilestones","keepDuration","fieldProperty"],editor:"startdatefield",defaultEditor:"startdatefield",initComponent:function(){this.initTaskFieldColumn({format:this.editorFormat||this.format||Ext.Date.defaultFormat});this.callParent(arguments)},getValueToRender:function(d,f,e){return d&&Ext.Date.format(this.field.valueToVisible(d,e),this.format)||""},putRawData:function(c,d){if(c&&!(c instanceof Date)){c=Ext.Date.parse(c,this.format)}d.setStartDate(c)}});Ext.define("Gnt.field.BaselineStartDate",{extend:Gnt.field.StartDate,alias:"widget.baselinestartdatefield",taskField:"baselineStartDateField",getTaskValueMethod:"getBaselineStartDate",setTaskValueMethod:"setBaselineStartDate",isBaseline:true,applyChanges:function(d,c){d=d||this.task;this.setTaskValue(d,this.value);if(!c){d.fireEvent("taskupdated",d,this)}}});Ext.define("Gnt.column.BaselineStartDate",{extend:Gnt.column.StartDate,alias:["widget.baselinestartdatecolumn","widget.ganttcolumn.baselinestartdate"],width:100,fieldProperty:"baselineStartDateField",fieldConfigs:["instantUpdate","adjustMilestones","fieldProperty"],editor:"baselinestartdatefield",defaultEditor:"baselinestartdatefield",putRawData:function(c,d){if(c&&!(c instanceof Date)){c=Ext.Date.parse(c,this.format)}d.setBaselineStartDate(c)}});Ext.define("Gnt.model.Calendar",{extend:Sch.model.Customizable,idProperty:"Id",calendar:null,nameField:"Name",daysPerMonthField:"DaysPerMonth",daysPerWeekField:"DaysPerWeek",hoursPerDayField:"HoursPerDay",weekendsAreWorkdaysField:"WeekendsAreWorkdays",weekendFirstDayField:"WeekendFirstDay",weekendSecondDayField:"WeekendSecondDay",defaultAvailabilityField:"DefaultAvailability",daysField:"Days",calendarClassField:"CalendarClass",phantomIdField:"PhantomId",phantomParentIdField:"PhantomParentId",customizableFields:[{name:"Name"},{name:"DaysPerMonth",type:"number"},{name:"DaysPerWeek",type:"number"},{name:"HoursPerDay",type:"number"},{name:"WeekendsAreWorkdays",type:"boolean"},{name:"WeekendFirstDay",type:"integer"},{name:"WeekendSecondDay",type:"integer"},{name:"DefaultAvailability"},{name:"Days"},{name:"CalendarClass",defaultValue:"Gnt.data.Calendar"},{name:"PhantomId"},{name:"PhantomParentId"}],constructor:function(f,h,j){var g=f||j||{};var i=g.calendar||g.Days;f&&delete f.calendar;j&&delete j.calendar;this.rawConfig=Ext.apply({},f);this.callParent(arguments);this.setDays(i);this.data[this.phantomIdField]=this.getId()},get:function(b){if(b==="Days"){return this.getCalendar()||this.data[this.daysField]}else{return this.callParent(arguments)}},set:function(c,d){if(c==="Days"){if(d instanceof Gnt.data.Calendar){this.setCalendar(d)}else{this.data[this.daysField]=d}}else{return this.callParent(arguments)}},getCalendar:function(){return this.calendar},setCalendar:function(b){this.calendar=b},getCalendarConfig:function(){var k=this;var h={calendarId:k.getId(),parent:k.parentNode&&k.parentNode.getCalendar()};var m=["daysPerMonth","daysPerWeek","hoursPerDay","name","weekendFirstDay","weekendSecondDay","weekendsAreWorkdays","defaultAvailability"];for(var n=0,i=m.length;n<i;n++){var j=m[n];if(k[j+"Field"] in k.rawConfig){var l="get"+Ext.String.capitalize(j);h[j]=k[l]()}}return h},getModelConfig:function(f,d){var e={};if(!d){e.parentId=f.parent&&f.parent.calendarId;e.calendar=f}e[this.daysPerMonthField]=f.daysPerMonth;e[this.daysPerWeekField]=f.daysPerWeek;e[this.hoursPerDayField]=f.hoursPerDay;e[this.nameField]=f.name;e[this.weekendFirstDayField]=f.weekendFirstDay;e[this.weekendSecondDayField]=f.weekendSecondDay;if(f.hasOwnProperty("weekendsAreWorkdays")){e[this.weekendsAreWorkdaysField]=f.weekendsAreWorkdays}if(f.hasOwnProperty("defaultAvailability")){e[this.defaultAvailabilityField]=f.defaultAvailability}e[this.calendarClassField]=Ext.getClassName(f);return e},setCalendarManager:function(b){this.calendarManager=b},getCalendarManager:function(){return this.calendarManager},getParentCalendarClass:function(){var c=this.parentNode,d;while(c&&!d){d=c.getCalendarClass();c=c.parentNode}return d},fillDataFromPrototype:function(e){var f=e[this.calendarClassField]||this.treeStore&&this.treeStore.getCalendarClass()||this.getCalendarClass()||this.getParentCalendarClass()||this.getField(this.calendarClassField).getDefaultValue();if(f){if(!e[this.calendarClassField]){e[this.calendarClassField]=f}var g=e.children;if(g&&g.length){for(var h=0;h<g.length;h++){this.fillDataFromPrototype(g[h])}}}},prepareCalendarNode:function(b){if(b instanceof Gnt.data.Calendar){b=this.getModelConfig(b)}else{if(Ext.isObject(b)&&!(b instanceof Gnt.model.Calendar)){this.fillDataFromPrototype(b)}}b=this.createNode(b);if(this.phantom){if(this.getId()!==b.data[this.phantomParentIdField]){b.modified=b.modified||{};b.modified[this.phantomParentIdField]=b.data[this.phantomParentIdField];b.data[this.phantomParentIdField]=this.getId()}}return b}},function(){Ext.data.NodeInterface.decorate(this);this.override({insertBefore:function(b){b=this.prepareCalendarNode(b);return this.callParent(arguments)},appendChild:function(c){if(c instanceof Array){for(var d=0;d<c.length;d++){c[d]=this.prepareCalendarNode(c[d])}}else{c=this.prepareCalendarNode(c)}return this.callParent(arguments)}})});Ext.define("Gnt.model.CalendarDay",{extend:Sch.model.CalendarDay,customizableFields:[{name:"Cls",defaultValue:"gnt-holiday"}]});Ext.define("Gnt.data.Calendar",{extend:Sch.data.Calendar,model:"Gnt.model.CalendarDay",defaultNonWorkingTimeCssCls:"gnt-holiday"});Ext.define("Gnt.field.Calendar",{extend:Ext.form.field.ComboBox,mixins:[Gnt.field.mixin.TaskField,Gnt.mixin.Localizable],alias:"widget.calendarfield",alternateClassName:"Gnt.widget.CalendarField",taskField:"calendarIdField",getTaskValueMethod:"getCalendarId",setTaskValueMethod:"setCalendarId",pickerAlign:"tl-bl?",matchFieldWidth:true,editable:true,triggerAction:"all",valueField:"Id",displayField:"Name",queryMode:"local",forceSelection:true,allowBlank:true,initComponent:function(){var c=this,d=c.getInitialConfig();if(!d.store||c.store.isEmptyStore){c.store={xclass:"Ext.data.Store",autoDestroy:true,model:"Gnt.model.Calendar"}}if(!(c.store instanceof Ext.data.Store)){c.store=Ext.create(c.store)}c.callParent(arguments);c.updateCalendarsStore();c.mon(Ext.data.StoreManager,{add:function(b,f,a){if(f instanceof Gnt.data.Calendar){this.updateCalendarsStore()}},remove:function(b,f,a){if(f instanceof Gnt.data.Calendar){this.updateCalendarsStore()}},scope:c});c.on({show:function(){c.setReadOnly(c.readOnly)}});c.on("change",c.onFieldChange,c)},updateCalendarsStore:function(){this.store.loadData(this.getCalendarData())},setReadOnly:function(b){b=b||this.store.count()===0;this.callParent([b])},getCalendarData:function(){return Ext.Array.map(Gnt.data.Calendar.getAllCalendars(),function(b){return{Id:b.calendarId,Name:b.name||b.calendarId}})},onSetTask:function(){this.setReadOnly(this.readOnly);this.setValue(this.getTaskValue())},valueToVisible:function(h,f){var j=this,i=[];var g=this.findRecordByValue(h);if(g){i.push(g.data)}else{if(Ext.isDefined(j.valueNotFoundText)&&typeof j.valueNotFoundText=="string"){i.push(j.valueNotFoundText)}}return j.displayTpl.apply(i)},getValue:function(){return this.value||""},getErrors:function(d){if(d){var e=this.findRecordByDisplay(d);if(e){if(this.task&&!this.task.isCalendarApplicable(e.getId())){return[this.L("calendarNotApplicable")]}}}var f=this.callParent(arguments);if(f&&f.length){return f}if(!Ext.isEmpty(d)&&!(this.findRecordByDisplay(d)||this.findRecordByValue(d))){return[this.L("invalidText")]}else{return[]}},onFieldChange:function(c,d){this.setValue(d)},setValue:function(b){this.callParent([b]);if(undefined===b||null===b||""===b){this.value=""}if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){if(this.getTaskValue()!=this.value){this.applyChanges()}}},assertValue:function(){var b=this.getRawValue();if(!b&&this.value){this.setValue("")}else{this.callParent(arguments)}}});Ext.define("Gnt.column.Calendar",{extend:Ext.grid.column.Column,alias:["widget.calendarcolumn","widget.ganttcolumn.calendar"],mixins:[Gnt.column.mixin.TaskFieldColumn],width:100,align:"left",instantUpdate:true,store:null,fieldProperty:"calendarIdField",fieldConfigs:["instantUpdate","store","fieldProperty"],editor:"calendarfield",defaultEditor:"calendarfield",initComponent:function(){this.initTaskFieldColumn({format:this.editorFormat||this.format||Ext.Date.defaultFormat});this.callParent(arguments)},applyColumnCls:function(j,i,g,k,l,h){if(!j){i.tdCls=(i.tdCls||"")+" gnt-default"}},getValueToRender:function(j,i,g,k,l,h){j=j||(h.calendar?h.calendar.calendarId:"");return this.field.valueToVisible(j,g)||j}});Ext.define("Gnt.field.ConstraintDate",{extend:Gnt.field.Date,alias:"widget.constraintdatefield",taskField:"constraintDateField",getTaskValueMethod:"getConstraintDate",setTaskValueMethod:"setConstraintDate",reAssertValue:false,valueToVisible:function(i,g){g=g||this.task;var j=this,f=g&&g.getConstraintClass(),h=j.format||Ext.Date.defaultFormat;if(f){return f.getDisplayableConstraintDateForFormat(i,h,g)}else{return i}},visibleToValue:function(i){var j=this,h=j.format||Ext.Date.defaultFormat,g=j.task,f=g&&g.getConstraintClass();if(f&&!Ext.isEmpty(i)){i=f.adjustConstraintDateFromDisplayableWithFormat(i,h,g)}return i}});Ext.define("Gnt.column.ConstraintDate",{extend:Ext.grid.column.Date,alias:["widget.constraintdatecolumn","widget.ganttcolumn.constraintdate"],mixins:[Gnt.column.mixin.TaskFieldColumn],width:100,align:"left",fieldProperty:"constraintDateField",editor:"constraintdatefield",defaultEditor:"constraintdatefield",initComponent:function(){this.initTaskFieldColumn({format:this.editorFormat||this.format||Ext.Date.defaultFormat,taskField:this.fieldProperty});this.callParent(arguments)},getValueToRender:function(d,f,e){return d&&Ext.Date.format(this.field.valueToVisible(d,e),this.format)||""}});Ext.define("Gnt.field.ConstraintType",{extend:Ext.form.field.ComboBox,mixins:[Gnt.field.mixin.TaskField,Gnt.mixin.Localizable],alias:"widget.constrainttypefield",alternateClassName:"Gnt.widget.ConstraintType.Field",taskField:"constraintTypeField",getTaskValueMethod:"getConstraintType",setTaskValueMethod:"setConstraint",pickerAlign:"tl-bl?",matchFieldWidth:false,forceSelection:true,triggerAction:"all",initComponent:function(){var c=this;var d=c.L("none");c.store=c.store||Gnt.field.ConstraintType.buildDefaultConstraintTypeList(d);c.emptyText=c.emptyText||d;this.on("change",this.onFieldChange,this);c.callParent(arguments)},getErrors:function(d){var c=this.callParent(arguments);if(c&&c.length){return c}if(!Ext.isEmpty(d)&&!(this.findRecordByDisplay(d)||this.findRecordByValue(d))){return[this.L("invalidText")]}else{return[]}},valueToVisible:function(h,f){var j=this,i=[];var g=this.findRecordByValue(!Ext.isEmpty(h)?h:null);if(g){i.push(g.data)}else{if(Ext.isDefined(j.valueNotFoundText)){i.push(j.valueNotFoundText||"")}}return j.displayTpl.apply(i)},applyChanges:function(f){var h=this,g=h.getValue(),e;f=f||h.task;e=Gnt.constraint.Base.getConstraintClass(g);h.setTaskValue(f,g,e&&e.getInitialConstraintDate(f)||null);f.fireEvent("taskupdated",f,h)},findRecordByDisplay:function(b){if(!b){return this.store.first()}return this.callParent(arguments)},onFieldChange:function(f,d){var e=this;if(!e.getSuppressTaskUpdate()&&e.task&&(d||this.getRawValue()==e.L("none")||(!d&&!this.getRawValue()))){e.applyChanges()}},statics:{buildDefaultConstraintTypeList:function(c){var d=[];Ext.Array.each(Ext.ClassManager.getNamesByExpression("gntconstraint.*"),function(h){var b=Ext.ClassManager.get(h),g=b.alias[0],a=g.split(".").pop();b&&(d.push([a,b.L("name")]))});d=Ext.Array.sort(d,function(a,b){return a[1]>b[1]?1:-1});c&&d.unshift([null,c]);return d}}});Ext.define("Gnt.column.ConstraintType",{extend:Ext.grid.column.Column,mixins:[Gnt.column.mixin.TaskFieldColumn],alias:["widget.constrainttypecolumn","widget.ganttcolumn.constrainttype"],width:100,align:"left",data:null,fieldProperty:"constraintTypeField",editor:"constrainttypefield",defaultEditor:"constrainttypefield",initComponent:function(){this.initTaskFieldColumn({store:this.data,taskField:this.fieldProperty});this.callParent(arguments)},getValueToRender:function(d,f,e){return d&&this.field.valueToVisible(d,e)||""}});Ext.define("Gnt.field.DeadlineDate",{extend:Gnt.field.Date,alias:"widget.deadlinedatefield",taskField:"deadlineDateField",getTaskValueMethod:"getDeadlineDate",setTaskValueMethod:"setDeadlineDate",valueToVisible:function(c,d){d=d||this.task;return d.getDisplayEndDate(this.format,true,c,true)},visibleToValue:function(b){if(b&&b-Ext.Date.clearTime(b,true)===0){b=Sch.util.Date.add(b,Sch.util.Date.DAY,1)}return b}});Ext.define("Gnt.column.DeadlineDate",{extend:Ext.grid.column.Date,alias:["widget.deadlinecolumn","widget.ganttcolumn.deadline"],mixins:[Gnt.column.mixin.TaskFieldColumn],draggable:true,fieldProperty:"deadlineDateField",editor:"deadlinedatefield",initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(d,f,e){return d&&Ext.Date.format(this.field.valueToVisible(d,e),this.format)||""}});Ext.define("Gnt.util.DurationParser",{mixins:[Gnt.mixin.Localizable],parseNumberFn:null,durationRegex:null,allowDecimals:true,constructor:function(b){Ext.apply(this,b);if(this.unitsRegex){Ext.apply(this.l10n.unitsRegex,this.unitsRegex)}if(!this.durationRegex){this.durationRegex=this.allowDecimals?/^\s*([\-+]?\d+(?:[.,]\d*)?|[\-+]?(?:[.,]\d+))\s*(\w+)?/i:/^\s*([\-+]?\d+)(?![.,])\s*(\w+)?/i}},parse:function(j){var g=this.durationRegex.exec(j);if(j==null||!g){return null}var h=this.parseNumberFn(g[1]);var f=g[2];var i;if(f){Ext.iterate(this.L("unitsRegex"),function(b,a){if(a.test(f)){i=Sch.util.Date.getUnitByName(b);return false}});if(!i){return null}}return{value:h,unit:i}}});Ext.define("Gnt.util.DependencyParser",{mixins:[Gnt.mixin.Localizable],separator:/\s*;\s*/,parseNumberFn:null,dependencyRegex:null,types:null,constructor:function(f){Ext.apply(this,f);this.initTypes();var g=this.L("typeText");for(var e=0;e<this.types.length;e++){this.types[e]=(g[this.types[e]]||this.types[e])}var h="(-?\\d+)("+this.types.join("|")+")?([\\+\\-].*)?";this.dependencyRegex=this.dependencyRegex||new RegExp(h,"i");this.durationParser=new Gnt.util.DurationParser({parseNumberFn:this.parseNumberFn})},initTypes:function(){this.types=this.types||["SS","SF","FS","FF"]},parse:function(l){if(!l){return[]}var q=l.split(this.separator);var i=[];var r=this.dependencyRegex;for(var o=0;o<q.length;o++){var t=q[o];if(!t&&o==q.length-1){continue}var n=r.exec(t);var p={};if(!n){return null}p.taskId=parseInt(n[1],10);p.type=Ext.Array.indexOf(this.types,(n[2]||this.types[2]).toUpperCase());var m=n[3];if(m){var s=this.durationParser.parse(m);if(!s){return null}p.lag=s.value;p.lagUnit=s.unit||"d"}i.push(p)}return i}});Ext.define("Gnt.field.Dependency",{extend:Ext.form.field.Text,alternateClassName:"Gnt.widget.DependencyField",alias:"widget.dependencyfield",mixins:[Gnt.mixin.Localizable],type:"predecessors",separator:";",task:null,dependencyParser:null,dependencyParserConfig:null,useSequenceNumber:false,constructor:function(d){var c=this;Ext.apply(this,d);this.dependencyParser=new Gnt.util.DependencyParser(Ext.apply({parseNumberFn:function(){return Gnt.widget.DurationField.prototype.parseValue.apply(c,arguments)}},this.dependencyParserConfig));this.callParent(arguments);this.addCls("gnt-field-dependency")},isPredecessor:function(){return this.type==="predecessors"},setTask:function(b){this.task=b;this.setRawValue(this.getFieldDisplayValue(b))},getDependencies:function(){return this.dependencyParser.parse(this.getRawValue())},getTaskIdFromDependency:function(h){var e=this.task.getTaskStore(),g=h.taskId,f;if(this.useSequenceNumber){f=e.getBySequenceNumber(g);g=f&&f.getId()}return g},getErrors:function(z){if(!z){return[]}var F=this.dependencyParser.parse(z);if(!F){return[this.L("invalidFormatText")]}var D=this.getDependencies(),A=this.isPredecessor(),k=this.task,i=k.getTaskStore().dependencyStore,B=k[A?"predecessors":"successors"],C=this.dependencyParser.types,G=i.allowedDependencyTypes,E=i.model.Type,J;var j=[];for(var v=0;v<D.length;v++){var x=D[v];J=this.getTaskIdFromDependency(x);if(!J){return[this.L("invalidDependencyText")]}if(i.allowedDependencyTypes&&!i.isValidDependencyType(x.type)){var I="";for(var w=0,y=G.length;w<y;w++){I+=C[E[G[w]]]+","}return[Ext.String.format(this.L("invalidDependencyType"),C[x.type],I.substring(0,I.length-1))]}var H=new i.model();H.setSourceId(A?J:k.getId());H.setTargetId(A?k.getId():J);H.setType(x.type);H.setLag(x.lag,x.lagUnit);j.push(H)}for(v=0;v<j.length;v++){if(!i.isValidDependency(j[v],j,B)){return[this.L("invalidDependencyText")]}}return this.callParent([F.value])},getFieldDisplayValue:function(x){var q=this.isPredecessor(),n=q?x.getIncomingDependencies(true):x.getOutgoingDependencies(true),p=this.dependencyParser.types,t=Gnt.model.Dependency.Type.EndToStart,o=[],i;for(var u=0;u<n.length;u++){var r=n[u];i=q?r.getSourceTask():r.getTargetTask();if(i&&r.isValid(false)){var s=r.getType(),w=r.getLag(),v=r.getLagUnit();o.push(Ext.String.format("{0}{1}{2}{3}{4}",this.useSequenceNumber?i.getSequenceNumber():i.getId(),w||s!==t?p[s]:"",w>0?"+":"",w||"",w&&v!=="d"?v:""))}}return o.join(this.separator)},isDirty:function(p){p=p||this.task;if(!p){return false}var j=this.isPredecessor(),o=p.getTaskStore().dependencyStore,k=j?p.getIncomingDependencies():p.getOutgoingDependencies(),m=p.getId();for(var n=0,i=k.length;n<i;n++){if(k[n].dirty||k[n].phantom){return true}}if(o){var l=j?"getTargetId":"getSourceId";k=o.getRemovedRecords();for(n=0,i=k.length;n<i;n++){if(k[n][l]()==m){return true}}}return false},applyChanges:function(u){u=u||this.task;var n=u.getTaskStore().dependencyStore,r=this.getDependencies(),p=this.isPredecessor(),o=p?u.getIncomingDependencies(true):u.getOutgoingDependencies(true),v=[],s;var x=Ext.Array.map(r,function(a){return this.getTaskIdFromDependency(a)},this);for(s=0;s<o.length;s++){if(!Ext.Array.contains(x,o[s][p?"getSourceId":"getTargetId"]())){v.push(o[s])}}if(v.length>0){n.remove(v)}var i=[];for(s=0;s<r.length;s++){var t=r[s];var w=this.getTaskIdFromDependency(t);var q=n.getByTaskIds(w,u.getId());if(q){q.beginEdit();q.setType(t.type);q.setLag(t.lag,t.lagUnit);q.endEdit()}else{q=new n.model();q.setSourceId(p?w:u.getId());q.setTargetId(p?u.getId():w);q.setType(t.type);q.setLag(t.lag,t.lagUnit);i.push(q)}}if(i.length>0){n.add(i)}}});Ext.define("Gnt.column.Dependency",{extend:Ext.grid.column.Column,separator:";",type:"predecessors",field:null,useSequenceNumber:false,constructor:function(d){d=d||{};var c=d.editor;delete d.editor;Ext.apply(this,d);d.editor=c||Ext.create("Gnt.field.Dependency",{type:this.type,separator:this.separator,useSequenceNumber:this.useSequenceNumber});if(!(d.editor instanceof Gnt.widget.DependencyField)){d.editor=Ext.ComponentManager.create(d.editor,"dependencyfield")}d.field=d.editor;this.scope=this;this.callParent([d])},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},getContainingPanel:function(){if(!this.panel){this.panel=this.up("tablepanel")}return this.panel},setDirtyClass:function(f,d){var e=this.getContainingPanel().getView();if(e.markDirty&&this.field.isDirty(d)){f.tdCls=e.dirtyCls}},isEditable:function(c){var d=this.gantt||this.up("ganttpanel");if(c.isProject){return false}return !c.isProject&&(d&&d.allowParentTaskDependencies||c.isLeaf())},getRawData:function(d){var c;if(this.type==="predecessors"){c=d.getIncomingDependencies(true)}else{c=d.getOutgoingDependencies(true)}return Ext.Array.map(c,function(b){var a=b.copy(null).data;delete a[b.idProperty];return a})},renderer:function(d,f,e){if(!e.isEditable(this.dataIndex)||!this.isEditable(e)){f.tdCls=(f.tdCls||"")+" sch-column-readonly"}else{this.setDirtyClass(f,e)}return this.field.getFieldDisplayValue(e)}});Ext.define("Gnt.column.DragDrop",{extend:Ext.grid.column.Column,alias:["widget.dragdropcolumn","widget.ganttcolumn.dragdrop"],width:35,tdCls:"sch-gantt-column-dragdrop",cls:"sch-gantt-column-dragdrop-header",ignoreInAddMenu:true,ignoreExport:true,ignoreInExport:true,sortable:false,resizable:false,hideable:false,menuDisabled:true,draggable:false,align:"center",processEvent:function(b){return b!=="click"}});Ext.define("Gnt.field.trigger.DurationSpinner",{extend:Ext.form.trigger.Spinner,alias:"trigger.gantt_durationspinner",initEvents:function(){var g=this,f=g.isFieldEnabled,h=g.getStateEl(),e=g.el;h.addClsOnOver(g.overCls,f,g);h.addClsOnClick(g.clickCls,f,g);if(g.repeatClick){g.clickRepeater=new Ext.util.ClickRepeater(e,Ext.apply({preventDefault:true,handler:g.onClick,delay:Ext.isIE?1000:250,listeners:{mousedown:g.onClickRepeaterMouseDown,scope:g},scope:g},this.repeaterConfig))}else{g.field.mon(e,{click:g.onClick,mousedown:g.onMouseDown,scope:g})}},onClick:function(){var e=this,f=arguments,g=e.clickRepeater?f[1]:f[0],h=e.field;if(!h.readOnly&&!h.disabled){if(e.upEl.contains(g.target)){Ext.callback(e.upHandler,e.scope,[h,e,g],0,h)}else{if(e.downEl.contains(g.target)){Ext.callback(e.downHandler,e.scope,[h,e,g],0,h)}}}!Ext.isIE&&h.inputEl.focus()}});Ext.define("Gnt.field.Duration",{extend:Ext.form.field.Number,mixins:[Gnt.field.mixin.TaskField,Gnt.mixin.Localizable],alias:"widget.durationfield",alternateClassName:"Gnt.widget.DurationField",disableKeyFilter:true,allowExponential:false,minValue:0,durationUnit:"h",config:{triggers:{spinner:{type:"gantt_durationspinner",upHandler:"onSpinnerUpClick",downHandler:"onSpinnerDownClick",scope:"this"}}},useAbbreviation:false,getDurationUnitMethod:"getDurationUnit",setTaskValueMethod:"setDuration",getTaskValueMethod:"getDuration",taskField:"durationField",durationParser:null,durationParserConfig:null,constructor:function(d){var c=this;Ext.apply(this,d);this.durationParser=new Gnt.util.DurationParser(Ext.apply({parseNumberFn:function(){return c.parseValue.apply(c,arguments)},allowDecimals:this.decimalPrecision>0},this.durationParserConfig));this.callParent(arguments);this.invalidText=this.L("invalidText")},onSetTask:function(){this.durationUnit=this.task[this.getDurationUnitMethod]();var b=this.getTaskValueMethod?this.getTaskValue():this.task.get(this.task[this.taskField]);this.setValue(b);this.setSpinUpEnabled(b==null||b<this.maxValue,true);this.setSpinDownEnabled(b>this.minValue,true)},rawToValue:function(c){var d=this.parseDuration(c);if(!d){return null}this.durationUnit=d.unit;return d.value!=null?d.value:null},valueToVisible:function(h,g){if(Ext.isNumber(h)){var e=parseInt(h,10),f=Ext.Number.toFixed(h,this.decimalPrecision);return String(e==f?e:f).replace(".",this.decimalSeparator)+" "+Sch.util.Date[this.useAbbreviation?"getShortNameOfUnit":"getReadableNameOfUnit"](g||this.durationUnit,h!==1)}return""},valueToRaw:function(b){return this.valueToVisible(b,this.durationUnit,this.decimalPrecision,this.useAbbreviation)},parseDuration:function(d){if(d==null){return null}var c=this.durationParser.parse(d);if(!c){return null}c.unit=c.unit||this.durationUnit;return c},getDurationValue:function(){return this.parseDuration(this.getRawValue())},getErrors:function(c){var d;if(c){d=this.parseDuration(c);if(!d){return[this.L("invalidText")]}c=d.value}if(arguments.length>0&&c==null){c=""}return this.callParent(arguments)},checkChange:function(){if(!this.suspendCheckChange){var g=this,h=g.getDurationValue(),f=g.lastValue;var e=h&&!f||!h&&f||h&&f&&(h.value!=f.value||h.unit!=f.unit);if(e&&!g.isDestroyed){g.lastValue=h;g.fireEvent("change",g,h,f);g.onChange(h,f)}}},getValue:function(){return this.value},applyChanges:function(b){b=b||this.task;this.setTaskValue(b,this.getValue(),this.durationUnit);b.fireEvent("taskupdated",b,this)},setValue:function(d,e){var f=d;if(Ext.isObject(d)){this.durationUnit=d.unit;f=d.value}this.callParent([f]);if(!this.readOnly&&(e||this.instantUpdate)&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}},assertValue:function(){var i=this,g=i.getValue(),h=i.durationUnit,j=i.getDurationValue();if(this.isValid()){var f=!j&&g||j&&(j.value!=g||j.unit!=h);if(f){i.setValue(j,true)}}},beforeBlur:function(){this.assertValue()},onSpinUp:function(){var d=this;if(!d.readOnly){var c=d.getValue()||0;d.setSpinValue(Ext.Number.constrain(c+d.step,d.minValue,d.maxValue))}},onSpinDown:function(){var d=this;if(!d.readOnly){var c=d.getValue()||0;d.setSpinValue(Ext.Number.constrain(c-d.step,d.minValue,d.maxValue))}}});Ext.define("Gnt.column.Duration",{extend:Ext.grid.column.Column,alias:["widget.durationcolumn","widget.ganttcolumn.duration"],mixins:[Gnt.column.mixin.TaskFieldColumn],width:80,align:"left",decimalPrecision:2,useAbbreviation:false,instantUpdate:true,fieldProperty:"durationField",fieldConfigs:["instantUpdate","useAbbreviation","decimalPrecision","fieldProperty"],editor:"durationfield",defaultEditor:"durationfield",initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(d,f,e){if(!Ext.isNumber(d)){return""}return this.field.valueToVisible(d,e.getDurationUnit())},putRawData:function(c,d){d.setDuration(c)}});Ext.define("Gnt.column.EarlyEndDate",{extend:Ext.grid.column.Date,mixins:[Gnt.mixin.Localizable],alias:["widget.earlyenddatecolumn","widget.ganttcolumn.earlyenddate"],width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){f.tdCls=(f.tdCls||"")+" sch-column-readonly";return e.getDisplayEndDate(this.format,this.adjustMilestones,e.getEarlyEndDate())}});Ext.define("Gnt.column.EarlyStartDate",{extend:Ext.grid.column.Date,mixins:[Gnt.mixin.Localizable],alias:["widget.earlystartdatecolumn","widget.ganttcolumn.earlystartdate"],width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){f.tdCls=(f.tdCls||"")+" sch-column-readonly";return e.getDisplayStartDate(this.format,this.adjustMilestones,e.getEarlyStartDate())}});Ext.define("Gnt.field.Effort",{extend:Gnt.field.Duration,alias:"widget.effortfield",alternateClassName:"Gnt.widget.EffortField",mixins:[Gnt.mixin.Localizable],taskField:"effortField",getDurationUnitMethod:"getEffortUnit",setTaskValueMethod:"setEffort",getTaskValueMethod:"getEffort",applyChanges:function(b){b=b||this.task;this.setTaskValue(b,this.getValue()||null,this.durationUnit);b.fireEvent("taskupdated",b,this)}});Ext.define("Gnt.column.Effort",{extend:Gnt.column.Duration,alias:["widget.effortcolumn","widget.ganttcolumn.effort"],fieldProperty:"effortField",editor:"effortfield",defaultEditor:"effortfield",getValueToRender:function(d,f,e){if(!Ext.isNumber(d)){return""}return this.field.valueToVisible(d,e.getEffortUnit())},putRawData:function(c,d){d.setEffort(c)}});Ext.define("Gnt.column.LateEndDate",{extend:Ext.grid.column.Date,mixins:[Gnt.mixin.Localizable],alias:["widget.lateenddatecolumn","widget.ganttcolumn.lateenddate"],width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){f.tdCls=(f.tdCls||"")+" sch-column-readonly";return e.getDisplayEndDate(this.format,this.adjustMilestones,e.getLateEndDate())}});Ext.define("Gnt.column.LateStartDate",{extend:Ext.grid.column.Date,mixins:[Gnt.mixin.Localizable],alias:["widget.latestartdatecolumn","widget.ganttcolumn.latestartdate"],width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){f.tdCls=(f.tdCls||"")+" sch-column-readonly";return e.getDisplayStartDate(this.format,this.adjustMilestones,e.getLateStartDate())}});Ext.define("Gnt.field.ManuallyScheduled",{extend:Ext.form.field.Checkbox,mixins:[Gnt.field.mixin.TaskField,Gnt.mixin.Localizable],alias:"widget.manuallyscheduledfield",alternateClassName:["Gnt.widget.ManuallyScheduledField"],taskField:"manuallyScheduledField",setTaskValueMethod:"setManuallyScheduled",getTaskValueMethod:"isManuallyScheduled",valueToVisible:function(b){return b?this.L("yes"):this.L("no")},getValue:function(){return this.value},setValue:function(b){this.callParent([b]);if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}}});Ext.define("Gnt.column.ManuallyScheduled",{extend:Ext.grid.Column,alias:["widget.manuallyscheduledcolumn","widget.ganttcolumn.manuallyscheduledcolumn"],mixins:[Gnt.column.mixin.TaskFieldColumn],width:50,align:"center",instantUpdate:false,fieldProperty:"manuallyScheduledField",editor:"manuallyscheduledfield",defaultEditor:"manuallyscheduledfield",initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(d,f,e){return this.field.valueToVisible(e.isManuallyScheduled())}});Ext.define("Gnt.field.Milestone",{extend:Ext.form.field.ComboBox,mixins:[Gnt.field.mixin.TaskField,Gnt.mixin.Localizable],alias:"widget.milestonefield",instantUpdate:false,allowBlank:false,forceSelection:true,displayField:"text",valueField:"value",queryMode:"local",constructor:function(b){Ext.apply(this,b);this.store=new Ext.data.JsonStore({fields:["value","text"],autoDestroy:true,data:[{value:0,text:this.L("no")},{value:1,text:this.L("yes")}]});this.callParent(arguments);this.on("change",this.onFieldChange,this)},onSetTask:function(){this.setValue(this.task.isMilestone()?1:0)},valueToVisible:function(b){return b?this.L("yes"):this.L("no")},onFieldChange:function(c,d){if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){if(this.task.isMilestone()!=Boolean(this.value)){this.applyChanges()}}},getValue:function(){return this.value},applyChanges:function(b){b=b||this.task;if(this.getValue()){b.convertToMilestone()}else{b.convertToRegular()}b.fireEvent("taskupdated",b,this)}});Ext.define("Gnt.column.Milestone",{extend:Ext.grid.column.Column,alias:["widget.milestonecolumn","widget.ganttcolumn.milestone"],mixins:[Gnt.column.mixin.TaskFieldColumn],width:50,align:"center",editor:"milestonefield",defaultEditor:"milestonefield",initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(d,f,e){return this.field.valueToVisible(e.isMilestone())},applyColumnCls:function(d,f,e){if(!e.isEditable(e.durationField)&&!e.isEditable(e.endDateField)){f.tdCls=(f.tdCls||"")+" sch-column-readonly"}}});Ext.define("Gnt.column.Name",{extend:Ext.tree.Column,alias:["widget.namecolumn","widget.ganttcolumn.name"],mixins:[Gnt.column.mixin.TaskFieldColumn],draggable:true,fieldProperty:"nameField",editor:"textfield",initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},applyColumnCls:function(d,f,e){f.tdCls=(f.tdCls||"");if(e.isProject){f.tdCls+=" sch-gantt-project-name"}if(!e.isLeaf()){f.tdCls+=" sch-gantt-parent-cell"}}});Ext.define("Gnt.field.Note",{extend:Ext.form.field.Picker,alias:["widget.notefield","widget.noteeditor"],alternateClassName:"Gnt.widget.NoteField",mixins:[Gnt.field.mixin.TaskField,Gnt.mixin.Localizable],matchFieldWidth:false,editable:false,pickerConfig:null,previewFn:null,previewFnScope:null,taskField:"noteField",getTaskValueMethod:"getNote",setTaskValueMethod:"setNote",afterRender:function(){this.callParent(arguments);this.on("collapse",this.onPickerCollapse,this)},valueToVisible:function(b){if(this.previewFn){return this.previewFn.call(this.previewFnScope||this,b)}else{return Ext.util.Format.stripTags(b)}},createPicker:function(){var b=new Ext.form.field.HtmlEditor(Ext.apply({frame:true,shadow:false,floating:true,height:200,width:300,listeners:{change:this.onPickerChange,initialize:this.onPickerInit,scope:this}},this.pickerConfig||{}));return b},onPickerInit:function(b){b.win.focus=Ext.emptyFn},onPickerChange:function(d,c){this.setRawValue(this.valueToVisible(c))},getValue:function(){return this.getPicker().getValue()},setValue:function(b){this.callParent([this.valueToVisible(b)]);this.getPicker().setValue(b);if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}},onPickerCollapse:function(){this.setValue(this.getPicker().getValue())},onTriggerClick:function(){var b=this;if(!b.readOnly&&!b.disabled){if(b.isExpanded){b.collapse()}else{b.expand()}}}});Ext.define("Gnt.column.Note",{extend:Ext.grid.column.Column,mixins:[Gnt.column.mixin.TaskFieldColumn],alias:["widget.notecolumn","widget.ganttcolumn.note"],editor:"notefield",defaultEditor:"notefield",fieldProperty:"noteField",previewFn:null,previewFnScope:null,fieldConfigs:["instantUpdate","previewFn","previewFnScope","fieldProperty"],initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)}});Ext.define("Gnt.column.PercentDone",{extend:Ext.grid.column.Number,alias:["widget.percentdonecolumn","widget.ganttcolumn.percentdone"],mixins:[Gnt.column.mixin.TaskFieldColumn],width:50,format:"0",align:"center",editor:"percentfield",defaultEditor:"percentfield",fieldProperty:"percentDoneField",useRenderer:false,initComponent:function(){this.initTaskFieldColumn({decimalPrecision:0});this.callParent(arguments)}});Ext.define("Gnt.column.Predecessor",{extend:Gnt.column.Dependency,mixins:[Gnt.mixin.Localizable],alias:["widget.predecessorcolumn","widget.ganttcolumn.predecessor"],type:"predecessors",constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments)},putRawData:function(g,f){var e=f.getDependencyStore();var h=[];e.remove(f.getIncomingDependencies(true));Ext.isArray(g)&&Ext.Array.each(g,function(a){if(f.getTaskStore().getById(a[e.model.prototype.fromField])){var b=new e.model(a);b.setTargetId(f.getId());if(e.isValidDependency(b)){h.push(b)}}});e.add(h)}});Ext.define("Gnt.column.ReadOnly",{extend:Ext.grid.Column,alias:["widget.readonlycolumn","widget.ganttcolumn.readonly"],mixins:[Gnt.column.mixin.TaskFieldColumn],fieldProperty:"readOnlyField",defaultEditor:"readonlyfield",editor:"readonlyfield",initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(d,f,e){return this.field.valueToVisible(d)}});Ext.define("Gnt.column.ResourceName",{extend:Ext.grid.column.Column,alias:"widget.resourcenamecolumn",mixins:[Gnt.mixin.Localizable],flex:1,align:"left",constructor:function(b){b=b||{};this.text=b.text||this.L("text");Ext.apply(this,b);this.callParent(arguments)}});Ext.define("Gnt.widget.AssignmentGrid",{extend:Ext.grid.Panel,alias:"widget.assignmentgrid",assignmentStore:null,resourceStore:null,readOnly:false,cls:"gnt-assignmentgrid",taskId:null,cellEditing:null,sortResourcesFn:null,assignmentUnitsEditor:null,selModel:{selType:"checkboxmodel",mode:"MULTI",checkOnly:true},initComponent:function(d){var c=this;if(!this.readOnly){this.plugins=this.buildPlugins()}this.store=this.store||new Ext.data.Store({proxy:"memory",autoDestroy:true,model:this.assignmentStore.getModel()});this.columns=this.columns||this.buildColumns();this.sortResourcesFn=this.sortResourcesFn||function(a,b){var g=a.getUnits(),h=b.getUnits();if((!g&&!h)||(g&&h)){return a.getResource(c.resourceStore).getName()<b.getResource(c.resourceStore).getName()?-1:1}return g?-1:1};this.loadResources();this.mon(this.resourceStore,{datachanged:this.loadResources,scope:this});this.callParent(arguments);this.getSelectionModel().on({select:this.onSelect,deselect:this.onDeselect,scope:this})},onSelect:function(c,d){if((!this.cellEditing||!this.cellEditing.getActiveEditor())&&!d.getUnits()){d.setUnits(d.getField(d.unitsField).defaultValue)}},onDeselect:function(c,d){d.setUnits(0)},loadResources:function(){var f=this.assignmentStore.getModel().prototype.resourceIdField;var e=this.assignmentStore.getModel().prototype.unitsField;var d=Ext.Array.map(this.resourceStore.getRange(),function(b){var a={};a[f]=b.getId();a[e]="";return a});this.store.loadData(d)},buildPlugins:function(){var b=this.cellEditing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1});b.on("edit",this.onEditingDone,this);return[b]},hide:function(){this.cellEditing.cancelEdit();this.callParent(arguments)},onEditingDone:function(d,c){if(c.value){this.getSelectionModel().select(c.record,true)}else{this.getSelectionModel().deselect(c.record);c.record.reject()}},buildColumns:function(){return[{xtype:"resourcenamecolumn",resourceStore:this.resourceStore,renderer:function(h,f,g){var e=g.getResource(this.resourceStore);return Ext.String.htmlEncode(e&&e.getName()||h)}},{xtype:"assignmentunitscolumn"}]},setEditableFields:function(h){if(!this.assignmentUnitsEditor){var g=this.down("assignmentunitscolumn");this.assignmentUnitsEditor=g&&g.getEditor()}if(this.assignmentUnitsEditor){var e=this.assignmentStore&&this.assignmentStore.getTaskStore(),f=e&&e.getModelById(h);if(f){switch(f.getSchedulingMode()){case"DynamicAssignment":this.assignmentUnitsEditor.setReadOnly(true);break;default:this.assignmentUnitsEditor.setReadOnly(false)}}}},loadTaskAssignments:function(l){var i=this.store,q=this.getSelectionModel();this.taskId=l;q.deselectAll(true);for(var n=0,p=i.getCount();n<p;n++){var m=i.getAt(n);m.data[m.unitsField]=0;m.data[m.idProperty]=null;delete m.__id__}var o=this.assignmentStore.getAssignmentsForTask(l);Ext.Array.each(o,function(a){var c=i.findRecord(a.resourceIdField,a.getResourceId(),0,false,true,true);if(c){var b=Ext.apply({},a.data);delete b[a.idProperty];c.set(b);c.__id__=a.getId();q.select(c,true,true)}});if(Ext.isSafari){this.focus()}i.sort({sorterFn:this.sortResourcesFn});i.getSorters().removeAll();var k=this.getView();if(Ext.getVersion().equals("6.0.0.640")){k.navigationModel.setPosition(null)}var r=(new Ext.grid.CellContext(k)).setPosition(0,0);k.focusCell(r);this.setEditableFields(l)},saveTaskAssignments:function(){var g=this.assignmentStore,h=this.taskId;var i={};var j=[];this.getSelectionModel().selected.each(function(d){var e=d.getUnits();if(e>0){var a=d.__id__;if(a){var b=Ext.apply({},d.data);delete b[d.idProperty];i[a]=true;g.getModelById(a).set(b)}else{var c=d.copy();c.setTaskId(h);i[c.internalId]=true;j.push(c)}}});var f=[];g.each(function(a){if(a.getTaskId()==h&&!i[a.getId()||a.internalId]){f.push(a)}});g.fireEvent("beforetaskassignmentschange",g,h,j);g.suspendAutoSync();g.remove(f);g.add(j);g.resumeAutoSync();g.fireEvent("taskassignmentschanged",g,h,j);if(g.autoSync){g.sync()}},isDataChanged:function(){var b=this;return b.store&&b.store.getUpdatedRecords().length>0||b.store.getNewRecords().length>0||b.store.getRemovedRecords().length>0},isDataValid:function(){return this.store.findBy(function(b){return !b.isValid()})<0}});Ext.define("Gnt.patches.CheckboxModel",{extend:Sch.util.Patch,target:"Ext.selection.CheckboxModel",overrides:{renderer:function(k,n,h,j,l,m,i){return'<div class="'+Ext.baseCSSPrefix+'grid-row-checker" role="button" tabIndex="-1">&#160;</div>'}}});Ext.define("Gnt.patches.NavigationModel",{extend:Sch.util.Patch,target:"Ext.grid.NavigationModel",maxVersion:"6.0.2",overrides:{onCellMouseDown:function(m,l,n,o,j,p,q){var r=Ext.Component.fromElement(q.target,l),k;if(m.actionableMode&&(q.getTarget(null,null,true).isTabbable()||((k=Ext.ComponentManager.getActiveComponent())&&k.owns(q)))){return}if(q.pointerType!=="touch"){q.preventDefault();this.setPosition(q.position,null,q)}if(r&&r.isFocusable&&r.isFocusable()){m.setActionableMode(true,q.position);r.focus()}}}});Ext.define("Gnt.field.Assignment",{extend:Ext.form.field.Picker,alias:["widget.assignmentfield","widget.assignmenteditor"],alternateClassName:"Gnt.widget.AssignmentField",mixins:[Gnt.mixin.Localizable],matchFieldWidth:false,editable:false,task:null,assignmentStore:null,resourceStore:null,gridConfig:null,formatString:"{0} [{1}%]",expandPickerOnFocus:false,afterRender:function(){this.callParent(arguments);this.on("expand",this.onPickerExpand,this);if(this.expandPickerOnFocus){this.on("focus",function(){this.expand()},this,{delay:1})}},createPicker:function(){var b=new Gnt.widget.AssignmentGrid(Ext.apply({frame:true,floating:true,ownerCmp:this,height:200,width:300,resourceStore:this.task.getResourceStore(),assignmentStore:this.task.getAssignmentStore(),fbar:this.buildButtons()},this.gridConfig||{}));return b},buildButtons:function(){return["->",{text:this.L("closeText"),handler:function(){Ext.Function.defer(this.onSaveClick,Ext.isIE&&!Ext.isIE9?60:30,this)},scope:this},{text:this.L("cancelText"),handler:function(){this.collapse()},scope:this}]},setTask:function(b){this.task=b;this.setRawValue(this.getFieldDisplayValue(b))},onPickerExpand:function(){this.picker.loadTaskAssignments(this.task.getId())},onSaveClick:function(){var c=this.picker.getSelectionModel(),d=c.selected;this.collapse();this.fireEvent("select",this,d);this.picker.saveTaskAssignments()},isDirty:function(j){j=j||this.task;if(!j){return false}var h=this.picker&&this.picker.assignmentStore||j.getAssignmentStore(),f=j.getAssignments();for(var i=0,g=f.length;i<g;i++){if(f[i].dirty||f[i].phantom){return true}}if(h){f=h.getRemovedRecords();for(i=0,g=f.length;i<g;i++){if(f[i].getTaskId()==j.getId()){return true}}}return false},getFieldDisplayValue:function(c){c=c||this.task;var d=Ext.Array.map(c.getAssignments(),function(b){var a=Ext.String.format(this.formatString,b.getResourceName(),b.getUnits());return Ext.String.htmlEncode(a)},this);return d.join(", ")}});Ext.define("Gnt.column.ResourceAssignment",{extend:Ext.grid.column.Column,alias:["widget.resourceassignmentcolumn","widget.ganttcolumn.resourceassignment"],mixins:[Gnt.mixin.Localizable],tdCls:"sch-assignment-cell",showUnits:true,field:null,dirtyCls:null,constructor:function(d){d=d||{};this.text=d.text||this.L("text");var f=d.editor;var e=d.showUnits||this.showUnits;delete d.editor;d.editor=f||{};if(!(d.editor instanceof Ext.form.Field)){d.editor=Ext.ComponentManager.create(Ext.applyIf(d.editor,{expandPickerOnFocus:true,formatString:"{0}"+(e?" [{1}%]":"")}),"assignmentfield")}d.field=d.editor;this.callParent([d]);this.scope=this;if(this.field){this.field.on("collapse",function(){this.up("treepanel").getView().setActionableMode(false)},this)}},sorterFn:function(h,i){var g=this;var j=g.field.getFieldDisplayValue(h),f=g.field.getFieldDisplayValue(i);return j&&(j>f)?-1:1},afterRender:function(){var b=this.up("treepanel").getView();if(b.markDirty){this.dirtyCls=b.dirtyCls}this.callParent(arguments);this.setSorter(Ext.Function.bind(this.sorterFn,this))},getRawData:function(b){return Ext.Array.map(b.getAssignments(),function(d){var a=d.copy(null).data;delete a[d.idProperty];return a})},putRawData:function(h,f){var g=f.getAssignmentStore();var e=[];g.removeAssignmentsForTask(f);Ext.isArray(h)&&Ext.Array.each(h,function(a){if(f.getResourceStore().getById(a[g.model.prototype.resourceIdField])){a[g.model.prototype.taskIdField]=f.getId();e.push(a)}});g.add(e)},renderer:function(d,f,e){if(this.dirtyCls&&this.field.isDirty(e)){f.tdCls=this.dirtyCls}return this.field.getFieldDisplayValue(e)}});Ext.define("Gnt.column.Rollup",{extend:Ext.grid.Column,alias:["widget.rollupcolumn","widget.ganttcolumn.rollup"],mixins:[Gnt.column.mixin.TaskFieldColumn],fieldProperty:"rollupField",editor:"combobox",defaultEditor:"combobox",initComponent:function(){this.initTaskFieldColumn({store:[[false,this.L("no")],[true,this.L("yes")]]});this.callParent(arguments)},getValueToRender:function(d,f,e){return this.L(d?"yes":"no")}});Ext.define("Gnt.column.Scale",{extend:Ext.grid.column.Template,alias:"widget.scalecolumn",sortable:false,scalePoints:null,scaleStep:2,scaleLabelStep:4,scaleMin:0,scaleMax:24,width:40,scaleCellCls:"gnt-scalecolumn",tpl:'<div class="gnt-scalecolumn-wrap" style="height:{scaleHeight}px;"><tpl for="scalePoints"><tpl if="label !== \'\'"><span class="gnt-scalecolumn-label-line {cls}" style="bottom:{bottom}px"><span class="gnt-scalecolumn-label">{label}</span></span><tpl else><span class="gnt-scalecolumn-line {cls}" style="bottom:{bottom}px"></span></tpl></tpl></div>',initComponent:function(){this.tdCls=(this.tdCls||"")+" "+this.scaleCellCls;this.callParent(arguments)},onAdded:function(){this.callParent(arguments);this.setAvailableHeight(this.up("timelinegrid").rowHeight,true)},setAvailableHeight:function(d,c){this.availableHeight=d;if(!this.scalePoints){this.scaleStepHeight=this.availableHeight/(this.scaleMax-this.scaleMin+this.scaleStep);this.scalePoints=this.buildScalePoints()}else{if(c){this.scalePoints.sort(function(a,b){return a.value-b.value});this.scaleMin=this.scalePoints[0].value;this.scaleMax=this.scalePoints[this.scalePoints.length-1].value;this.scaleStep=(this.scaleMax-this.scaleMin)/10}this.scaleStepHeight=this.availableHeight/(this.scaleMax-this.scaleMin+this.scaleStep);this.updateScalePoints()}},defaultRenderer:function(h,g,f){var e={record:Ext.apply({},f.data,f.getAssociatedData()),scaleHeight:this.availableHeight,scalePoints:this.scalePoints};return this.tpl.apply(e)},buildScalePoints:function(){var n=this.scaleMin,m=n,r=this.scaleStep,o=this.scaleLabelStep,q=this.scaleStepHeight,s=this.availableHeight,t=this.scaleCellCls,l=t+"-min",k=[];var p=function(a,b,c){return{bottom:Math.round((a-n)*q),value:a,label:b!="undefined"?b:"",cls:c||""}};while(m<this.scaleMax){if(m>0){k.push(p(m,m%o||m===n?"":m,l))}l="";m+=r}k.push(p(this.scaleMax,this.scaleMax,t+"-max"));return k},updateScalePoints:function(){var d=this.scaleStepHeight,c=this.availableHeight;Ext.Array.each(this.scalePoints,function(a){a.bottom=Math.round(a.value*d)})}});Ext.define("Gnt.field.SchedulingMode",{extend:Ext.form.field.ComboBox,mixins:[Gnt.field.mixin.TaskField,Gnt.mixin.Localizable],alias:"widget.schedulingmodefield",alternateClassName:"Gnt.widget.SchedulingmodeField",taskField:"schedulingModeField",setTaskValueMethod:"setSchedulingMode",getTaskValueMethod:"getSchedulingMode",pickerAlign:"tl-bl?",matchFieldWidth:true,editable:false,forceSelection:true,triggerAction:"all",constructor:function(b){b=b||{};if(!b.store){this.initStore(b)}this.callParent([b]);this.on("change",this.onFieldChange,this)},initStore:function(d){var c=this;d.store=c.getDefaultSchedulingModes()},getDefaultSchedulingModes:function(){var b=this;return[["Normal",b.L("Normal")],["FixedDuration",b.L("FixedDuration")],["EffortDriven",b.L("EffortDriven")],["DynamicAssignment",b.L("DynamicAssignment")]]},valueToVisible:function(h,f){var j=this,i=[];var g=this.findRecordByValue(h);if(g){i.push(g.data)}else{if(Ext.isDefined(j.valueNotFoundText)){i.push(j.valueNotFoundText)}}return j.displayTpl.apply(i)},getErrors:function(d){var c=this.callParent(arguments);if(c&&c.length){return c}if(!Ext.isEmpty(d)&&!(this.findRecordByDisplay(d)||this.findRecordByValue(d))){return[this.L("invalidText")]}else{return[]}},getValue:function(){return this.value},onFieldChange:function(c,d){if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task&&this.value){this.applyChanges()}}});Ext.define("Gnt.column.SchedulingMode",{extend:Ext.grid.column.Column,mixins:[Gnt.column.mixin.TaskFieldColumn],alias:["widget.schedulingmodecolumn","widget.ganttcolumn.schedulingmode"],width:100,align:"left",data:null,fieldProperty:"schedulingModeField",editor:"schedulingmodefield",defaultEditor:"schedulingmodefield",instantUpdate:false,initComponent:function(){this.initTaskFieldColumn({store:this.data});this.callParent(arguments)}});Ext.define("Gnt.column.Sequence",{extend:Ext.grid.column.Column,alias:["widget.sequencecolumn","widget.ganttcolumn.sequence"],mixins:[Gnt.mixin.Localizable],width:40,align:"right",sortable:false,dataIndex:"index",constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments)},renderer:function(d,f,e){return e.getSequenceNumber()}});Ext.define("Gnt.column.ShowInTimeline",{extend:Ext.grid.column.Check,alias:["widget.showintimelinecolumn","widget.ganttcolumn.showintimeline"],mixins:[Gnt.column.mixin.TaskFieldColumn],fieldProperty:"showInTimelineField",initComponent:function(b){this.initTaskFieldColumn();this.callParent([b]);this.tdCls=(this.tdCls||"")+" gnt-showintimeline-cell"},onReadOnlySet:function(d,c){this.setDisabled(c)},taskFieldRenderer:function(){var b=this.defaultRenderer.apply(this,arguments);this.applyColumnCls.apply(this,arguments);return b}});Ext.define("Gnt.column.Slack",{extend:Ext.grid.column.Column,mixins:[Gnt.mixin.Localizable],alias:["widget.slackcolumn","widget.ganttcolumn.slack"],decimalPrecision:2,useAbbreviation:false,slackUnit:"d",width:100,align:"left",constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){f.tdCls=(f.tdCls||"")+" sch-column-readonly";d=e.getSlack();if(Ext.isNumber(d)){return parseFloat(Ext.Number.toFixed(d,this.decimalPrecision))+" "+Sch.util.Date[this.useAbbreviation?"getShortNameOfUnit":"getReadableNameOfUnit"](this.slackUnit,d!==1)}return""}});Ext.define("Gnt.column.Successor",{extend:Gnt.column.Dependency,mixins:[Gnt.mixin.Localizable],alias:["widget.successorcolumn","widget.ganttcolumn.successor"],type:"successors",constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments)},putRawData:function(g,f){var e=f.getDependencyStore();var h=[];e.remove(f.getOutgoingDependencies(true));Ext.isArray(g)&&Ext.Array.each(g,function(a){if(f.getTaskStore().getById(a[e.model.prototype.toField])){var b=new e.model(a);b.setSourceId(f.getId());if(e.isValidDependency(b)){h.push(b)}}});e.add(h)}});Ext.define("Gnt.column.WBS",{extend:Ext.grid.column.Column,alias:["widget.wbscolumn","widget.ganttcolumn.wbs"],mixins:[Gnt.mixin.Localizable],width:40,align:"left",sortable:false,hidden:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments)},renderer:function(d,f,e){return e.getWBSCode()}});Ext.define("Gnt.constraint.Base",{mixins:[Gnt.mixin.Localizable],isSatisfied:function(d,f,e){throw"Abstract method"},getResolution:function(i,h,g){var j=this,k=false;g=g||h.getConstraintDate();var l=function(){if(!k){k=true;i.apply(this,arguments)}};return{title:j.L("name"),task:h,date:g,resolutions:this.getResolutionOptions(l,h,g),getCancelActionOption:function(){return this.resolutions[0]},cancelAction:function(){return this.getCancelActionOption().resolve()},proceedAction:function(){l()},getResolution:function(a){return Ext.Array.findBy(this.resolutions,function(b){return b.id==a})}}},getResolutionOptions:function(i,l,k,g){k=k||l.getConstraintDate();var j=this;var h=[{id:"cancel",title:j.L("Cancel the change and do nothing"),resolve:function(){i(true)}}];j.hasThisConstraintApplied(l)&&h.push({id:"remove-constraint",title:j.L("Remove the constraint"),resolve:function(){l.setConstraintType("");i()}});return h},hasThisConstraintApplied:function(b){return b.getConstraintClass()===this},getInitialConstraintDate:function(b){return b.getConstraintDate()},getDisplayableConstraintDateForFormat:function(d,f,e){return d},adjustConstraintDateFromDisplayableWithFormat:function(d,f,e){return d},shiftToNearestValidConstraintDate:function(d,f,e){return d},statics:{getConstraintClass:function(c){var d=!Ext.isEmpty(c)&&Ext.ClassManager.getByAlias("gntconstraint."+c);return d||null}}});Ext.define("Gnt.constraint.AsLateAsPossible",{extend:Gnt.constraint.Base,singleton:true,isSatisfied:function(b){throw"Abstract method"}});Ext.define("Gnt.constraint.AsSoonAsPossible",{extend:Gnt.constraint.Base,singleton:true,isSatisfied:function(b){throw"Abstract method"}});Ext.define("Gnt.constraint.FinishNoEarlierThan",{extend:Gnt.constraint.Base,alias:"gntconstraint.finishnoearlierthan",singleton:true,isSatisfied:function(e,d){var f=e.getEndDate();d=d||e.getConstraintDate();return !d||!f||f>=d},getResolutionOptions:function(i,l,k,g){var j=this,h=j.callParent(arguments);k=k||l.getConstraintDate();h.push({id:"move-task",title:j.L("Move the task to finish on {0}"),resolve:function(){l.setEndDateWithoutPropagation(k,true);i()}});return h},getInitialConstraintDate:function(b){return b.getEndDate()},getDisplayableConstraintDateForFormat:function(d,f,e){if(d&&!Ext.Date.formatContainsHourInfo(f)&&(d-Ext.Date.clearTime(d,true)===0)){d=Sch.util.Date.add(d,Sch.util.Date.DAY,-1)}return d},adjustConstraintDateFromDisplayableWithFormat:function(d,f,e){if(d&&!Ext.Date.formatContainsHourInfo(f)&&(d-Ext.Date.clearTime(d,true)===0)){d=Sch.util.Date.add(d,Sch.util.Date.DAY,1)}return d}});Ext.define("Gnt.constraint.FinishNoLaterThan",{extend:Gnt.constraint.Base,alias:"gntconstraint.finishnolaterthan",singleton:true,isSatisfied:function(e,h,f){var g=e.getEndDate();h=h||e.getConstraintDate();return !h||!g||(Sch.util.Date.compareWithPrecision(g,h,f)!==1)},getResolutionOptions:function(i,l,k,g){var j=this,h=j.callParent(arguments);k=k||l.getConstraintDate();h.push({id:"move-task",title:j.L("Move the task to finish on {0}"),resolve:function(){l.setEndDateWithoutPropagation(k,true);i()}});return h},getInitialConstraintDate:function(b){return b.getEndDate()},getDisplayableConstraintDateForFormat:function(d,f,e){if(d&&!Ext.Date.formatContainsHourInfo(f)&&(d-Ext.Date.clearTime(d,true)===0)){d=Sch.util.Date.add(d,Sch.util.Date.DAY,-1)}return d},adjustConstraintDateFromDisplayableWithFormat:function(d,f,e){if(d&&!Ext.Date.formatContainsHourInfo(f)&&(d-Ext.Date.clearTime(d,true)===0)){d=Sch.util.Date.add(d,Sch.util.Date.DAY,1)}return d}});Ext.define("Gnt.constraint.MustFinishOn",{extend:Gnt.constraint.Base,alias:"gntconstraint.mustfinishon",singleton:true,isSatisfied:function(e,h,f){var g=e.getEndDate();h=h||e.getConstraintDate();return !h||!g||(Sch.util.Date.compareWithPrecision(g,h,f)===0)},getResolutionOptions:function(i,l,k,g){var j=this,h=j.callParent(arguments);k=k||l.getConstraintDate();h.push({id:"move-task",title:j.L("Move the task to finish on {0}"),resolve:function(){l.setEndDateWithoutPropagation(k,true);i()}});return h},getInitialConstraintDate:function(b){return b.getEndDate()},getDisplayableConstraintDateForFormat:function(d,f,e){if(d&&!Ext.Date.formatContainsHourInfo(f)&&(d-Ext.Date.clearTime(d,true)===0)){d=Sch.util.Date.add(d,Sch.util.Date.DAY,-1)}return d},adjustConstraintDateFromDisplayableWithFormat:function(d,f,e){if(d&&!Ext.Date.formatContainsHourInfo(f)&&(d-Ext.Date.clearTime(d,true)===0)){d=Sch.util.Date.add(d,Sch.util.Date.DAY,1)}return d}});Ext.define("Gnt.constraint.MustStartOn",{extend:Gnt.constraint.Base,alias:"gntconstraint.muststarton",singleton:true,isSatisfied:function(h,g,e){var f=h.getStartDate();g=g||h.getConstraintDate();return !g||!f||(Sch.util.Date.compareWithPrecision(f,g,e)===0)},getResolutionOptions:function(i,l,k,g){var j=this,h=j.callParent(arguments);k=k||l.getConstraintDate();h.push({id:"move-task",title:j.L("Move the task to start at {0}"),resolve:function(){l.setStartDateWithoutPropagation(k,true);i()}});return h},getInitialConstraintDate:function(b){return b.getStartDate()}});Ext.define("Gnt.constraint.StartNoEarlierThan",{extend:Gnt.constraint.Base,alias:"gntconstraint.startnoearlierthan",singleton:true,isSatisfied:function(h,g,e){var f=h.getStartDate();g=g||h.getConstraintDate();return !g||!f||(Sch.util.Date.compareWithPrecision(f,g,e)!==-1)},getResolutionOptions:function(i,l,k,g){var j=this,h=j.callParent(arguments);k=k||l.getConstraintDate();h.push({id:"move-task",title:j.L("Move the task to start at {0}"),resolve:function(){l.setStartDateWithoutPropagation(k,true);i()}});return h},getInitialConstraintDate:function(b){return b.getStartDate()}});Ext.define("Gnt.constraint.StartNoLaterThan",{extend:Gnt.constraint.Base,alias:"gntconstraint.startnolaterthan",singleton:true,isSatisfied:function(h,g,e){var f=h.getStartDate();g=g||h.getConstraintDate();return !g||!f||(Sch.util.Date.compareWithPrecision(f,g,e)!==1)},getResolutionOptions:function(i,l,k,g){var j=this,h=j.callParent(arguments);k=k||l.getConstraintDate();h.push({id:"move-task",title:j.L("Move the task to start at {0}"),resolve:function(){l.setStartDateWithoutPropagation(k,true);i()}});return h},getInitialConstraintDate:function(b){return b.getStartDate()}});Ext.define("Gnt.model.Assignment",{extend:Sch.model.Assignment,customizableFields:[{name:"TaskId"},{name:"Units",type:"float",defaultValue:100}],taskIdField:"TaskId",eventIdField:"TaskId",constructor:function(d,f){var e=this;e.eventIdField=e.taskIdField;e.callParent([d,f])},getEventId:function(){var b=this;return b.get(b.taskIdField)},setEventId:function(d){var c=this;return c.set(c.taskIdField,d)},unitsField:"Units",getTaskStore:function(){return this.store&&this.store.getTaskStore()||null},getEventStore:function(){return this.getTaskStore()},getUnits:function(){var b=this;return Math.max(0,b.get(b.unitsField))},setUnits:function(c){var d=this;d.set(d.unitsField,c)},getTask:function(d){var c=this;return c.getEvent(d)},getTaskName:function(c){var d=this.getTask(c);return d&&d.getName()||""},getEffort:function(h){var e=this,f=e.getTask(),g=0;f.forEachAvailabilityIntervalWithResources({startDate:f.getStartDate(),endDate:f.getEndDate(),resources:[e.getResource()]},function(b,c,d){var i,a;for(i in d){a=d[i].units}g+=(c-b)*a/100});return f.getProjectCalendar().convertMSDurationToUnit(g,h||f.getEffortUnit())},getEffortAtDate:function(p,j){var m=Sch.util.Date,k=this,r=k.getTask(),q=r&&r.getStartDate(),n=r&&r.getEndDate(),o=k.getResource(),l=0;if(r&&o&&q&&n){p=m.constrain(p,q,n);r.forEachAvailabilityIntervalWithResources({startDate:q,endDate:p,resources:[o]},function(e,a,d){var b=0;for(var c in d){b=d[c].units}l+=(a-e)*b/100});l=r.getCalendar().convertMSDurationToUnit(l,j||r.getEffortUnit())}return l}});Ext.define("Gnt.data.AssignmentStore",{extend:Sch.data.AssignmentStore,model:"Gnt.model.Assignment",alias:"store.gantt_assignmentstore",storeId:"assignments",attachToEventStore:Ext.emptyFn,attachToResourceStore:Ext.emptyFn,getTaskStore:function(){return this.getEventStore()},setTaskStore:function(b){return this.setEventStore(b)},mapAssignmentsForTask:function(e,d,f){return this.mapAssignmentsForEvent(e,d,f)},getAssignmentsForTask:function(b){return this.getAssignmentsForEvent(b)},removeAssignmentsForTask:function(b){return this.removeAssignmentsForEvent(b)},getResourcesForTask:function(b){return this.getResourcesForEvent(b)},getTasksForResource:function(b){return this.getEventsForResource(b)},assignTaskToResource:function(d,f,e){return this.assignEventToResource(d,f,function(a){a.setUnits(e);return a})},unassignTaskFromResource:function(d,c){return this.unassignEventFromResource(d,c)},isTaskAssignedToResource:function(e,f,d){return this.isEventAssignedToResource(e,f,d)},getAssignmentForTaskAndResource:function(d,c){return this.getAssignmentForEventAndResource(d,c)}});Ext.define("Gnt.data.CalendarManager",{extend:Ext.data.TreeStore,mixins:[Robo.data.Store,Sch.data.mixin.UniversalModelGetter],model:"Gnt.model.Calendar",alias:"store.calendarmanager",storeId:"calendars",calendarClass:"Gnt.data.Calendar",calendarConfig:null,projectCalendar:null,myListeners:null,proxy:"memory",constructor:function(c){this.callParent(arguments);this.myListeners=this.on({idchanged:this.onChangeId,rootchange:this.onNewRoot,nodeappend:this.onNewNode,nodeinsert:this.onNewNode,noderemove:this.onRemoveNode,destroyable:true,scope:this});var d=this.getRoot();if(d){this.bindCalendars(d)}else{this.setRoot({expanded:true})}},destroy:function(){this.myListeners.destroy();this.callParent(arguments)},onChangeId:function(h,k,i,l,g){if(!(k instanceof Gnt.model.Calendar)){return}var j=this.getCalendar(i||g);j.setCalendarId(l)},onNewNode:function(e,f){this.bindCalendars(f);if(f!==this.getRoot()){this.fixCalendarParent(f)}var d=this;f.cascadeBy(function(a){a.setCalendarManager(d)})},onNewRoot:function(b){this.onNewNode(null,b)},onRemoveNode:function(e,h,f){if(!f){var g=h.calendar;if(g){this.unbindCalendarEvents(g);if(!this.__loading){g.destroy();Ext.data.StoreManager.unregister(g)}h.setCalendarManager(null)}}},suspendCalendarsEvents:function(b){this.getRoot().cascadeBy(function(a){var c=a.getCalendar();if(c){c.suspendEvents(b)}},this)},resumeCalendarsEvents:function(){this.getRoot().cascadeBy(function(d){var c=d.getCalendar();if(c){c.resumeEvents()}},this)},getCalendarClass:function(){return this.calendarClass},getProjectCalendar:function(){return this.projectCalendar},setProjectCalendar:function(b){if(this.settingProjectCalendar){return}if(typeof b!=="object"){b=this.getCalendar(b)||Gnt.data.Calendar.getCalendar(b)}if(!b){return}this.settingProjectCalendar=true;this.projectCalendar=b;this.fireEvent("projectcalendarset",this,b);this.settingProjectCalendar=false},getCalendar:function(c){var d=this.getModelById(c);return d&&d.getCalendar()},getNodeByCalendar:function(c){if(!c){return this.getRoot()}var d=this.getModelById(c.calendarId);if(!d){this.getRoot().cascadeBy(function(b){var a=b.getCalendar();if(a===c){d=b;return false}},this)}return d},onParentChange:function(g,e,f){var h=this.getNodeByCalendar(g);if(h&&!h.syncingCalendarParent){this.fixNodeParent(h)}},bindCalendarEvents:function(b){this.relayEvents(b,["load"],"calendar");this.relayEvents(b,["add","update","remove","bulkremove"],"day");this.relayEvents(b,["calendarchange"]);b.on("parentchange",this.onParentChange,this);this.on({dayadd:this.onDayAdd,dayupdate:this.onDayUpdate,dayremove:this.onDayRemove,scope:this})},unbindCalendarEvents:function(b){this.un({dayadd:this.onDayAdd,dayupdate:this.onDayUpdate,dayremove:this.onDayRemove,scope:this});b&&b.un({parentchange:this.onParentChange,scope:this})},onDayAdd:function(c,d){this.getModelById(c.getCalendarId()).dirty=true},onDayUpdate:function(c,d){this.getModelById(c.getCalendarId()).dirty=true},onDayRemove:function(c,d){this.getModelById(c.getCalendarId()).dirty=true},fixCalendarParent:function(d){if(d.syncingCalendarParent){return}var e=d.parentNode.getCalendar(),f=d.getCalendar();if(e!==f.parent){d.syncingCalendarParent=true;f.setParent(e);d.syncingCalendarParent=false}},fixNodeParent:function(g){var f=g.parentNode.getCalendar(),e=g.getCalendar().parent;if(f!==e){var h=this.getNodeByCalendar(e);h&&h.appendChild(g)}},bindCalendar:function(h){if(!h||this.getRoot()===h){return}var l=h.getCalendar();var j=h.getDays();var k=h.getId()||h.internalId;j=Ext.isArray(j)&&j;if(!l||j){if(!l){l=Gnt.data.Calendar.getCalendar(k)}if(!l){var n=h.parentNode&&h.parentNode.getCalendar();var m=Ext.ClassManager.get(h.getCalendarClass()||this.calendarClass);var i=Ext.applyIf(h.getCalendarConfig(),{data:j,parent:n});l=Ext.create(m,Ext.apply(i,this.calendarConfig))}h.setCalendar(l);this.bindCalendarEvents(l)}else{if(!this.getCalendar(l.calendarId)){this.bindCalendarEvents(l)}}this.fireEvent("calendarbound",this,l,h)},unbindCalendar:function(d){if(!d||this.getRoot()===d){return}var c=d.getCalendar();if(!c){return}this.unbindCalendarEvents(c);this.fireEvent("calendarunbound",this,c,d)},bindCalendars:function(c){var d=this;if(c){Ext.Array.each([].concat(c),function(a){a.cascadeBy(d.bindCalendar,d)})}},unbindCalendars:function(c){var d=this;if(c){Ext.Array.each([].concat(c),function(a){a.cascadeBy(d.unbindCalendar,d)})}}});Ext.define("Gnt.data.CrudManager",{extend:Sch.crud.AbstractManager,mixins:[Sch.crud.encoder.Json,Sch.crud.transport.Ajax],calendarManager:null,taskStore:null,dependencyStore:null,resourceStore:null,assignmentStore:null,addRelatedStores:true,constructor:function(q){q=q||{};var r=q.calendarManager||this.calendarManager,m=q.taskStore||this.taskStore||new Gnt.data.TaskStore({proxy:"memory"}),n=q.assignmentStore||this.assignmentStore,l=q.resourceStore||this.resourceStore,t=q.dependencyStore||this.dependencyStore,k=[];if(m&&q.addRelatedStores!==false){var o=this.getTaskStoreInfo(m,q);r=r||o.calendarManager;n=n||o.assignmentStore;l=l||o.resourceStore;t=t||o.dependencyStore}if(r){this.mixins.observable.constructor.call(this,q);this.addCalendarManager(r,k)}if(l){k.push(l)}if(n){k.push(n)}if(t){k.push(t)}if(m){k.push(m)}if(k.length){var s=[];if(r){s.push(r)}if(l){s.push(l)}if(m){s.push(m)}if(n){s.push(n)}if(t){s.push(t)}if(s.length){q.syncApplySequence=(q.syncApplySequence||q.stores||[]).concat(s)}var p=q.stores||this.stores;if(p&&!Ext.isArray(p)){p=[p]}q.stores=(p||[]).concat(k)}this.callParent([q]);this.calendarManager=this.getStoreDescriptor(r);this.resourceStore=this.getStoreDescriptor(l);this.assignmentStore=this.getStoreDescriptor(n);this.dependencyStore=this.getStoreDescriptor(t);this.taskStore=this.getStoreDescriptor(m)},getTaskStoreInfo:function(l,m){if(!(l instanceof Ext.data.AbstractStore)){if(typeof l=="string"){l=Ext.data.StoreManager.get(l)}else{l=l.store}}var i={},h=m.calendarManager,j=m.assignmentStore,k=m.resourceStore,n=m.dependencyStore;if(!h){i.calendarManager=l.calendarManager}if(!j){i.assignmentStore=l.getAssignmentStore()}if(!k){i.resourceStore=l.getResourceStore()}if(!n){i.dependencyStore=l.getDependencyStore()}return i},addCalendarManager:function(j,g){var f,h;if(j instanceof Ext.data.AbstractStore){f=j;h={store:j}}else{if(typeof j=="object"){f=j.store;h=j}else{j=Ext.data.StoreManager.get(j);f=j;h={store:j}}}var i=(f.getModel&&f.getModel()||f.model).prototype;if(!h.stores){h.stores=[{storeId:i.daysField,idProperty:i.idProperty}]}this.calendarManager=h;f.on("load",this.onCalendarManagerLoad,this);this.mon(f,{dayadd:this.onStoreChange,dayupdate:this.onStoreChange,dayremove:this.onStoreChange,daybulkremove:this.onStoreChange,scope:this});g.push(h)},onCalendarManagerLoad:function(e){var g=e.getProjectCalendar(),h=g&&g.getCalendarId(),f=e.metaData&&e.metaData.projectCalendar;if(h!=f){e.setProjectCalendar(f)}},applyLoadResponse:function(){var b=this.getCalendarManager();b&&b.suspendCalendarsEvents();this.callParent(arguments);b&&b.resumeCalendarsEvents()},getCalendarManager:function(){return this.calendarManager&&this.calendarManager.store},getResourceStore:function(){return this.resourceStore&&this.resourceStore.store},getDependencyStore:function(){return this.dependencyStore&&this.dependencyStore.store},getAssignmentStore:function(){return this.assignmentStore&&this.assignmentStore.store},getTaskStore:function(){return this.taskStore&&this.taskStore.store},prepareUpdated:function(t,p,q){if(t[0] instanceof Gnt.model.Task){t=Ext.Array.filter(t,function(a){return !a.isRoot()});var i=this.callParent([t,p,q]);if(this.resetIdsBeforeSync){var s=t[0].segmentsField,v=Ext.ClassManager.get(t[0].segmentClassName).prototype,j=v.idProperty,o=v.phantomIdField;for(var w=0;w<i.length;w++){var r=i[w][s];if(r){for(var x=0;x<r.length;x++){var u=r[x];if(u[o]){delete u[j]}}}}}return i}return this.callParent(arguments)},prepareAdded:function(j){var i=this.callParent(arguments);if(this.resetIdsBeforeSync&&j[0] instanceof Gnt.model.Task){var n=j[0].segmentsField,l=Ext.ClassManager.get(j[0].segmentClassName).prototype.idProperty;for(var k=0;k<i.length;k++){var h=i[k][n];if(h){for(var m=0;m<h.length;m++){delete h[m][l]}}}}return i},applyChangesToTask:function(v,r){if(r.hasOwnProperty(v.segmentsField)){var w=v.getSegments(),s=v.segmentsField,p=w&&w[0].phantomIdField,j=w&&w[0].idProperty,t=r[s];if(w){if(t){for(var x=t.length-1;x>=0;x--){var q=t[x],i=q[p],z=q[j],u=null;for(var y=0;y<w.length;y++){u=w[y];if((u.get(p)==i)||(u.getId()==z)){this.applyChangesToRecord(u,q);break}}}}delete r[s]}}},applyChangesToRecord:function(d,f,e){if(d instanceof Gnt.model.Task){this.ignoreUpdates++;this.applyChangesToTask.apply(this,arguments);this.ignoreUpdates--}this.callParent(arguments)}});Ext.define("Gnt.model.Dependency",{extend:Sch.model.Dependency,customizableFields:[{name:"Lag",type:"number",defaultValue:0},{name:"LagUnit",type:"string",defaultValue:"d",convert:function(b){return b||"d"}}],lagField:"Lag",lagUnitField:"LagUnit",isHighlighted:false,getTaskStore:function(){return Ext.isFunction(this.store.getTaskStore)?this.store.getTaskStore():this.store.taskStore},getEventStore:function(){return this.getTaskStore()},getSourceTask:function(b){return this.getSourceEvent(b)},setSourceTask:function(b){return this.setSourceEvent(b)},getTargetTask:function(b){return this.getTargetEvent(b)},setTargetTask:function(b){return this.setTargetEvent(b)},setLag:function(e,f){var d=this;d.beginEdit();d.set(d.lagField,e);if(arguments.length>1){d.setLagUnit(f)}d.endEdit()},getLagUnit:function(){var b=this;return b.get(b.lagUnitField)||"d"},isValid:function(g){var j=this,k=j.callParent(arguments),i=j.getSourceId(),h=j.getTargetId(),l=j.getType();if(k&&g!==false&&j.store){k=j.store.isValidDependency(i,h,l,null,null,j)}return k}});Ext.define("Gnt.data.DependencyStore",{extend:Sch.data.DependencyStore,model:"Gnt.model.Dependency",alias:"store.gantt_dependencystore",taskStore:null,methodsCache:null,strictDependencyValidation:false,transitiveDependencyValidation:false,allowedDependencyTypes:null,allowParentTaskDependencies:true,constructor:function(d){var c=this;c.callParent([d]);c.init()},createEventDependencyCache:function(){return new Gnt.data.util.TaskDependencyCache(this)},init:function(){var b=this;b.methodsCache={};b.on({add:b.onDependencyAdd,update:b.onDependencyUpdate,remove:b.onDependencyRemove,priority:100,scope:b})},scheduleTask:function(e){var h=this.getTaskStore(),f=e.getStartDate(),g=e.getEndDate();if(!f||!g){e.beginEdit();if(!f){e.setStartDateWithoutPropagation(h.getProjectStartDate(),undefined!==e.getDuration())}if(!g){e.setDurationWithoutPropagation(1)}e.endEdit()}},scheduleLinkedTasks:function(c,d){this.scheduleTask(c);if(!d.getStartDate()&&!c.getTaskStore().cascadeChanges){d.alignByIncomingDependencies()}this.scheduleTask(d)},onDependencyAdd:function(d,c){Ext.Array.each(c,function(f){var a,b;a=f.getSourceTask();b=f.getTargetTask();if(a&&b&&!d.isUndoingOrRedoing()){d.scheduleLinkedTasks(a,b)}});d.resetMethodsCache()},onDependencyRemove:function(j,i,k,g){var l=this.getTaskStore();var h=[];Ext.Array.each(i,function(b){var a=b.getTargetTask(l);if(a&&!j.isUndoingOrRedoing()&&!a.isManuallyScheduled()&&a.isTaskStored()){h.push(a)}});j.resetMethodsCache();if(!j.isUndoingOrRedoing()){Ext.Array.each(h,function(a){a.adjustToCalendarWithoutPropagation()})}},onDependencyUpdate:function(k,q,p){var j,o,l,n,m,r;if(p!=Ext.data.Model.COMMIT){j=k.getTaskStore();o=q.previous;l=q.getSourceTask();n=q.getTargetTask();m=o&&q.fromField in o;r=o&&q.toField in o;if((m||r)&&l&&n&&!k.isUndoingOrRedoing()){k.scheduleLinkedTasks(l,n)}k.resetMethodsCache()}},reduceTaskDependencies:function(f,i,g,h,j){return this.reduceEventDependencies(f,i,g,h,j)},reduceTaskIncomingDependencies:function(e,h,f,g){return this.reduceEventIncomingDependencies(e,h,f,g)},reduceTaskOutgoingDependencies:function(e,h,f,g){return this.reduceEventOutgoingDependencies(e,h,f,g)},mapTaskDependencies:function(g,j,i,h,f){return this.mapEventDependencies(g,j,i,h,f)},mapTaskIncomingDependencies:function(f,e,h,g){return this.mapEventIncomingDependencies(f,e,h,g)},mapTaskOutgoingDependencies:function(f,e,h,g){return this.mapEventOutgoingDependencies(f,e,h,g)},getDependenciesForTask:function(b){return this.getEventDependencies(b,true)},getTaskDependencies:function(d,c){return this.getEventDependencies(d,c)},getIncomingDependenciesForTask:function(d,c){return this.getEventIncomingDependencies(d,true)},getTaskIncomingDependencies:function(d,c){return this.getEventIncomingDependencies(d,c)},getOutgoingDependenciesForTask:function(d,c){return this.getEventOutgoingDependencies(d,true)},getTaskOutgoingDependencies:function(d,c){return this.getEventOutgoingDependencies(d,c)},getTaskPredecessors:function(d,c){return this.getEventPredecessors(d,c)},getTaskSuccessors:function(d,c){return this.getEventSuccessors(d,c)},removeTaskDependencies:function(d,c){return this.removeEventDependencies(d,c)},removeTaskIncomingDependencies:function(d,c){return this.removeEventIncomingDependencies(d,c)},removeTaskOutgoingDependencies:function(d,c){return this.removeEventOutgoingDependencies(d,c)},getKeyByDeps:function(l,j,h){if(!l||!l.length){return""}var m="";for(var n=0,i=l.length;n<i;n++){var k=l[n];m+=(k.getSourceId&&k.getSourceId()||k[j])+":"+(k.getTargetId&&k.getTargetId()||k[h])+","}return m},buildCacheKey:function(m,l,p,n,r){var j=r.fromField||(r.fromField=this.model.prototype.fromField),o=r.toField||(r.toField=this.model.prototype.toField),q=r.ignoreDepKey,k=r.addDepKey;if(!r.hasOwnProperty("ignoreDepKey")){r.ignoreDepKey=q=p&&this.getKeyByDeps(p,j,o)||"";r.addDepKey=k=n&&this.getKeyByDeps(n,j,o)||""}return m+"-"+l+"-"+q+"-"+k},hasTransitiveDependency:function(G,K,J,z,L){L=L||{visitedTasks:{}};var I=this.buildCacheKey(G,K,J,z,L);var w=L.visitedTasks,y=L.extraSuccessors;if(this.isCachedResultAvailable("hasTransitiveDependency",I)){return this.methodsCache.hasTransitiveDependency[I]}var x=this,i=L.fromField,F=L.toField,v=this.getTaskById(G),A,C;if(w[G]){return false}w[G]=true;if(v){if(z&&!y){y=L.extraSuccessors={};for(A=0,C=z.length;A<C;A++){var H=z[A];var B=H.getSourceId&&H.getSourceId()||H[i];y[B]=y[B]||[];y[B].push(H)}}var D,E=v.successors;if(y&&y[G]){E=E.concat(y[G])}for(A=0,C=E.length;A<C;A++){D=E[A];var l=D.getTargetId&&D.getTargetId()||D[F];if((!J||Ext.Array.indexOf(J,D)==-1)&&(l===K||x.hasTransitiveDependency(l,K,J,z,L))){return this.setCachedResult("hasTransitiveDependency",I,true)}}}return this.setCachedResult("hasTransitiveDependency",I,false)},successorsHaveTransitiveDependency:function(l,i,p,m,s){s=s||{};var n=this.buildCacheKey(l,i,p,m,s);var r=i instanceof Gnt.model.Task?i:this.getTaskById(i);if(this.isCachedResultAvailable("successorsHaveTransitiveDependency",n)){return this.methodsCache.successorsHaveTransitiveDependency[n]}for(var o=0,q=r.successors.length;o<q;o++){var t=r.successors[o].getTargetId();if(this.hasTransitiveDependency(l,t,p,m)||this.predecessorsHaveTransitiveDependency(l,t,p,m)||this.successorsHaveTransitiveDependency(l,t,p,m,s)){return this.setCachedResult("successorsHaveTransitiveDependency",n,true)}}return this.setCachedResult("successorsHaveTransitiveDependency",n,false)},predecessorsHaveTransitiveDependency:function(l,i,q,m,t){t=t||{};var n=this.buildCacheKey(l,i,q,m,t);var s=l instanceof Gnt.model.Task?l:this.getTaskById(l);if(this.isCachedResultAvailable("predecessorsHaveTransitiveDependency",n)){return this.methodsCache.predecessorsHaveTransitiveDependency[n]}for(var o=0,r=s.predecessors.length;o<r;o++){var p=s.predecessors[o].getSourceId();if(this.hasTransitiveDependency(p,i,q,m)||this.successorsHaveTransitiveDependency(p,i,q,m)||this.predecessorsHaveTransitiveDependency(p,i,q,m,t)){return this.setCachedResult("predecessorsHaveTransitiveDependency",n,true)}}return this.setCachedResult("predecessorsHaveTransitiveDependency",n,false)},isPartOfTransitiveDependency:function(h,j,i,g){var f=h instanceof Gnt.model.Task?h:this.getTaskById(h);if(!f.predecessors.length&&!f.successors.length){return false}if(f.predecessors.length){return this.predecessorsHaveTransitiveDependency.apply(this,arguments)}else{return this.successorsHaveTransitiveDependency.apply(this,arguments)}},getCycle:function(t){t=t||{};Ext.applyIf(t,{ignoreTasks:{},visitedTasks:{},path:[],task:this.getAt(0).getSourceTask()});var o=t.visitedTasks,n=t.ignoreTasks,i=t.path,s=t.task,l=s.getId();if(n[l]){return}i.push(s);if(o[l]){return i}o[l]=true;var r=s.successors;for(var m=0,q=r.length;m<q;m++){t.task=r[m].getTargetTask();var p=this.getCycle(t);if(p){return p}}i.pop();delete o[l]},getCycles:function(){var f=this,e=[],d={};this.each(function(a){var b=f.getCycle({task:a.getSourceTask(),ignoreTasks:d});if(b){for(var c=0,h=b.length;c<h;c++){d[b[c]]=true}e.push(b)}});return e},resetMethodsCache:function(){this.methodsCache={}},isCachedResultAvailable:function(c,d){return this.methodsCache[c]&&this.methodsCache[c].hasOwnProperty(d)},getCachedResult:function(c,d){return this.methodsCache[c][d]},setCachedResult:function(f,e,d){this.methodsCache[f]=this.methodsCache[f]||{};this.methodsCache[f][e]=d;return d},getGroupTopTasks:function(l,k){var i=l.length,m=k.length,o=i,j=m,n,p;do{n=l[o];p=k[j];o--;j--}while(n==p&&o>=0&&j>=0);return[n,p]},groupsHasTransitiveDependency:function(S,X,W,F,Y){var K=Y||{targets:null,visitedTasks:{}};var I=this.getTaskStore().getRootNode(),R=false,l=this,N=this.getTaskById(S),M=this.getTaskById(X),i=K.visitedTasks,C=K.targets;if(!K.targetGroup){K.targetGroup=M.getTopParent(true)}var J=K.fromField||(K.fromField=this.model.prototype.fromField),Q=K.toField||(K.toField=this.model.prototype.toField),O=K.ignoreDepKey,Z=K.addDepKey;var E=this.getGroupTopTasks(N.getTopParent(true),K.targetGroup),P=E[0],U=E[1];if(P===N&&U===M&&N.isLeaf()&&M.isLeaf()){return this.hasTransitiveDependency(S,X,W)}if(!K.hasOwnProperty("ignoreDepKey")){K.ignoreDepKey=O=W&&this.getKeyByDeps(W,J,Q)||"";K.addDepKey=Z=F&&this.getKeyByDeps(F,J,Q)||""}var V=P.getId()+"-"+U.getId()+"-"+O+"-"+Z;if(this.isCachedResultAvailable("groupsHasTransitiveDependency",V)){return this.methodsCache.groupsHasTransitiveDependency[V]}if(U!==K.targetTopParent){K.targetTopParent=U;C=K.targets={};U.cascadeBy(function(a){C[a.getId()]=true})}var D=K.extraSuccessors;if(F&&!D){D=K.extraSuccessors={};for(var G=0,L=F.length;G<L;G++){var T=F[G];var H=T.getSourceId&&T.getSourceId()||T[J];D[H]=D[H]||[];D[H].push(T)}}P.cascadeBy(function(e){if(e!==I){var b=e.getId();if(i[b]){return false}i[b]=true;var a=e.successors;if(D&&D[b]){a=a.concat(D[b])}for(var c=0,f=a.length;c<f;c++){var d=a[c],g=d.getTargetId&&d.getTargetId()||d[Q];if((!W||Ext.Array.indexOf(W,d)==-1)&&(C[g]||l.groupsHasTransitiveDependency(g,X,W,F,K))){R=true;return false}}}});return this.setCachedResult("groupsHasTransitiveDependency",V,R)},getDependencyError:function(y,A,r,t,p,v){var x,s,w;var z=y instanceof Gnt.model.Dependency;if(z){x=y.getSourceId();s=this.getTaskById(x);t=A;p=r;if(t&&Ext.Array.contains(t,y)){t=t.slice();Ext.Array.remove(t,y)}r=y.getType();A=y.getTargetId();w=this.getTaskById(A);if(y.store){v=y}}else{x=y;s=this.getTaskById(x);w=this.getTaskById(A);if(r===undefined){var u=this.model.getField(this.model.prototype.typeField).defaultValue;r=u!==undefined?u:this.model.Type.EndToStart}}if(!v&&z&&!y.isValid()){return -1}else{if(!x||!A||x==A){return -1}}if(!s||!w){return -2}if(!this.isValidDependencyType(r)){return -10}if(s.contains(w)||w.contains(s)){return -9}var q;if(p||v){q=[];if(v){q.push(v)}if(p){q=q.concat(p)}}if(this.transitiveDependencyValidation){if(this.hasTransitiveDependency(x,A,q,t)){return -3}}else{if(this.areTasksLinkedForward(x,A,q,t)){return -3}}if(this.hasTransitiveDependency(A,x,q,t)){return -4}if(this.transitiveDependencyValidation&&this.isPartOfTransitiveDependency(x,A,q,t)){return -5}if(this.strictDependencyValidation){if(this.groupsHasTransitiveDependency(A,x,q,t)){return -7}if(this.transitiveDependencyValidation&&this.groupsHasTransitiveDependency(x,A,q,t)){return -8}}if(!this.allowParentTaskDependencies&&(!s.isLeaf()||!w.isLeaf())){return -11}if(w.isProject||s.isProject){return -12}var o=w.getProject(),B=s.getProject();if(o!=B){if(o&&!o.getAllowDependencies()||B&&!B.getAllowDependencies()){return -13}}return 0},isValidDependencyType:function(f){if(this.allowedDependencyTypes){var e=false,d=this.model;Ext.each(this.allowedDependencyTypes,function(a){if(d.Type[a]==f){e=true;return false}});return e}return true},isValidDependency:function(i,g,k,h,l,j){return !this.getDependencyError(i,g,k,h,l,j)},areTasksLinkedForward:function(G,z,t,y){var v=G instanceof Gnt.model.Task?G:this.getTaskById(G);var u=z instanceof Gnt.model.Task?z:this.getTaskById(z);if(!v||!u){return false}var B=this.model.prototype,H=B.fromField,A=B.toField;var x=v.getId()+"-"+u.getId()+"-"+(this.getKeyByDeps(t,H,A)||"")+"-"+(this.getKeyByDeps(y,H,A)||"");if(this.isCachedResultAvailable("areTasksLinkedForward",x)){return this.methodsCache.areTasksLinkedForward[x]}var E=v.successors,F=u.predecessors,w,C,D;for(C=0,D=E.length;C<D;C++){w=E[C];if((!t||!Ext.Array.contains(t,w))&&Ext.Array.contains(F,w)){return this.setCachedResult("areTasksLinkedForward",x,true)}}if(y){var i,l;for(C=0,D=y.length;C<D;C++){w=y[C];i=w.getSourceId&&w.getSourceId()||w[H];l=w.getTargetId&&w.getTargetId()||w[A];if(i==v.getId()&&l==u.getId()){return this.setCachedResult("areTasksLinkedForward",x,true)}}}return this.setCachedResult("areTasksLinkedForward",x,false)},areTasksLinked:function(g,h){var i=g instanceof Gnt.model.Task?g:this.getTaskById(g);var j=h instanceof Gnt.model.Task?h:this.getTaskById(h);if(!i||!j){return false}var f=i.getId()+"-"+j.getId();if(this.isCachedResultAvailable("areTasksLinked",f)){return this.methodsCache.areTasksLinked[f]}return this.setCachedResult("areTasksLinked",f,this.areTasksLinkedForward(i,j)||this.areTasksLinkedForward(j,i))},getByTaskIds:function(c,d){return this.getTasksLinkingDependency(c,d)},getDependencyForSourceAndTargetTasks:function(d,c){return this.getDependencyForSourceAndTargetEvents(d,c)},getTasksLinkingDependency:function(c,d){return this.getEventsLinkingDependency(c,d)},getTaskById:function(c){var d=this.getTaskStore();return d&&d.getModelById(c)||null},getSourceTask:function(d){var c=d instanceof Gnt.model.Dependency?d.getSourceId():d;return this.getTaskById(c)},getTargetTask:function(d){var c=d instanceof Gnt.model.Dependency?d.getTargetId():d;return this.getTaskById(c)},getTaskStore:function(){return this.getEventStore()},setTaskStore:function(d){var c=this;c.taskStore=d;c.setEventStore(d)}});Ext.define("Gnt.data.linearizator.CycleResolvers",function(r){function t(){return false}function q(){Ext.Error.raise("Can't linearize dependent tasks, there's a cycle in the dependency chain!")}function B(e,c){var a=w(e,c),f={},b=function(g,h){(f[g]||(f[g]=[])).push(h)};u(a,function d(g){if(g.prevSibling){g.foldedDeps=z(g.prevSibling.foldedDeps,g.foldedDeps,b)}if(!g.nextSibling&&g.parentNode){g.parentNode.foldedDeps=o(g.foldedDeps,g.parentNode.foldedDeps,b)}});x(c.fromById,f);return true}function w(g,a){var e,f=[],c={},d,b;for(d in g){if(g.hasOwnProperty(d)){b=c[d]=s(g[d].task,g,a);if(!g.hasOwnProperty(b.parentNode)){f.push(b)}}}for(d in c){if(c.hasOwnProperty(d)){c[d]=p(c[d],c)}}if(f.length==1){e=f[0]}else{e={parentNode:null,prevSibling:null,nextSibling:null,children:f,foldedDeps:{}}}return e}function s(d,b,a){var j=Ext.Object,n=a.fromById,F={},h=d.internalId,g,l,E,f,c,i,e,m,k;g=j.getKeys(n[h]);if(g.length){F[h]=g}else{F[h]={}}l=d.parentNode&&b.hasOwnProperty(d.parentNode.internalId)&&d.parentNode.internalId;c=d.childNodes||[];e=[];for(m=0,k=c.length;m<k;m++){i=c[m].internalId;if(b.hasOwnProperty(i)){e.push(i)}}f=d.previousSibling;while(f&&!b.hasOwnProperty(f.internalId)){f=f.previousSibling}f=f&&f.internalId;E=d.nextSibling;while(E&&!b.hasOwnProperty(E.internalId)){E=E.nextSibling}E=E&&E.internalId;return{parentNode:l,prevSibling:f,nextSibling:E,children:e,foldedDeps:F}}function p(a,d){var b,e,c=a.children;for(b=0,e=c.length;b<e;b++){c[b]=d[c[b]]}a.parentNode=(a.parentNode||a.parentNode===0)&&d[a.parentNode]||null;a.prevSibling=(a.prevSibling||a.prevSibling===0)&&d[a.prevSibling]||null;a.nextSibling=(a.nextSibling||a.nextSibling===0)&&d[a.nextSibling]||null;return a}function u(a,b){var c=a.children,d,e;for(d=0,e=c.length;d<e;d++){u(c[d],b)}b(a);return a}function z(f,g,d){var c=y(f,g),e=c.fromAtoB,h=c.fromBtoA,a=c.fromAtoBtotal,i=c.fromBtoAtotal,b={};if(a>0&&i>0){b=a<i?e:h}v(b,d);return A(f,g,b)}function o(c,g,a){var f=Ext.Object,d=y(c,g),b=d.fromAtoB,e=d.fromBtoA,h;h=f.merge({},b,e);v(h,a);return A(c,g,h)}function y(f,i){var k=Ext.Object,d=Ext.Array,g=k.getKeys(f),m=k.getKeys(i),c={},j={},b=0,a=0,n,l,e,h;for(n=0,l=g.length;n<l;++n){e=g[n];h=d.intersect(m,f[e]);if(h.length){c[e]=h;b+=h.length}}for(n=0,l=m.length;n<l;++n){e=m[n];h=d.intersect(g,i[e]);if(h.length){j[e]=h;a+=h.length}}return{fromAtoB:c,fromBtoA:j,fromAtoBtotal:b,fromBtoAtotal:a}}function v(e,c){var a,d,f,b;for(a in e){if(e.hasOwnProperty(a)){b=e[a];for(d=0,f=b.length;d<f;++d){c(a,b[d])}}}}function A(c,e,f){var d=Ext.Object,b=Ext.Array,g,a;g=d.merge({},c,e);for(a in f){if(f.hasOwnProperty(a)&&g.hasOwnProperty(a)){g[a]=b.difference(g[a],f[a])}}return g}function x(a,f){var d,b,e,c,g;for(d in f){if(f.hasOwnProperty(d)){b=f[d];for(c=0,g=b.length;c<g;++c){e=b[c];a[d][e][0]="green"}}}return a}return{singleton:true,none:t,exception:q,cut:B}});Ext.define("Gnt.data.Linearizator",function(x){var A={};function P(c,a,b){b=G(b);return N([].concat(c),a,b.tasksDepsCollectingFn,b.cycleSolverFn)}function N(d,a,g,c){var e=false,k=true,i,j,b,h,f;i=H();j=K();L(d,g,i,j);while(k){e=false;while(!e){e=true;k=false;for(b in i){if(i.hasOwnProperty(b)&&i[b].color!="green"){h=i[b].task;f=M(h,j);if(f!="red"){w(f,h,i,j);a(h,f,i,j);e=false}else{k=true}}}}if(k){k=c&&c(i,j)}}}function G(e){var b=E(e),a,d,c;c=A[b];if(!c){a=Gnt.data.linearizator.CycleResolvers[e.cycles||"none"];d=[];e.self&&(d.push(O));e.ancestors&&(d.push(J));e.descendants&&(d.push(y));e.successors&&(d.push(C));d=B(d);c={tasksDepsCollectingFn:d,cycleSolverFn:a};A[b]=c}return c}function E(a){var b=[],c;for(c in a){if(a.hasOwnProperty(c)){b.push(c,"=",String(a[c]))}}return b.join(";")}function B(a){return function(e,c,d){var b=[];Ext.Array.each(a,function(f){b=b.concat(f(e,c,d))});return b}}function L(c,d,a,b){Ext.Array.each(c,function(e){var f=d(e,a,b);if(f.length>0){L(f,d,a,b)}})}function O(b,c,e){var a=[],d=b.internalId;if(!c.hasOwnProperty(d)){c[d]={task:b,color:"red"};a=[b]}return a}function J(g,h,j){var i=[],e=j.downFromById,a=j.downToById,c=j.upFromById,b=j.upToById,m=g.internalId,f=g.parentNode,d=f&&f.internalId,l,k;if(f&&!h.hasOwnProperty(d)){h[d]={task:f,color:"red"};i.push(f)}if(f){l=["red"];k=["red"];!e[d]&&(e[d]={});!e[d][m]&&(e[d][m]=l);!a[m]&&(a[m]=l);!b[d]&&(b[d]={});!b[d][m]&&(b[d][m]=k);!c[m]&&(c[m]=k)}return i}function y(f,i,j){var h=[],e=j.downFromById,b=j.downToById,d=j.upFromById,c=j.upToById,g=!f.isRoot()&&f.childNodes,a=f.internalId;g&&Ext.Array.each(g,function(n){var k=n.internalId,m,l;if(!i.hasOwnProperty(k)){i[k]={task:n,color:"red"};h.push(n)}m=["red"];l=["red"];!e[a]&&(e[a]={});!e[a][k]&&(e[a][k]=m);!b[k]&&(b[k]=m);!c[a]&&(c[a]={});!c[a][k]&&(c[a][k]=l);!d[k]&&(d[k]=l)});return h}function C(h,b,f){var e=[],d=f.fromById,c=f.toById,g=h.getSuccessors(),a=h.internalId;Ext.Array.each(g,function(i){var j=i.internalId,k;if(!b.hasOwnProperty(j)){b[j]={task:i,color:"red"};e.push(i)}k=["red"];!d[a]&&(d[a]={});!d[a][j]&&(d[a][j]=k);!c[j]&&(c[j]={});!c[j][a]&&(c[j][a]=k)});return e}function H(){return{}}function K(){return{fromById:{},toById:{},downFromById:{},downToById:{},upFromById:{},upToById:{}}}function I(e,b){var a=b.toById[e.internalId],c=false,d;for(d in a){if(a.hasOwnProperty(d)&&a[d]&&a[d][0]=="red"){c=true;break}}return c}function Q(b,d){var a=d.fromById[b.internalId],c=false,e;for(e in a){if(a.hasOwnProperty(e)&&a[e]&&a[e][0]=="red"){c=true;break}}return c}function D(a,d){var c=d.downToById,b=a.internalId;return c[b]&&c[b][0]=="red"}function z(b,a){var d=a.downFromById[b.internalId],c=false,e;for(e in d){if(d.hasOwnProperty(e)&&d[e]&&d[e][0]=="red"){c=true;break}}return c}function R(b,d){var a=d.upToById[b.internalId],c=false,e;for(e in a){if(a.hasOwnProperty(e)&&a[e]&&a[e][0]=="red"){c=true;break}}return c}function F(a,d){var b=a.internalId,c=d.upToById;return c[b]&&c[b][0]=="red"}function M(a,c){var b="red";if(!I(a,c)&&!D(a,c)&&!R(a,c)){b="green"}else{if(!I(a,c)&&!D(a,c)&&z(a,c)){b="yellow"}else{b="red"}}return b}function w(f,h,i,a){var b=h.internalId,g=a.fromById[b],d=a.downFromById[b],c=a.upFromById[b],e;i[b].color=f;if(f=="green"){if(g){for(e in g){if(g.hasOwnProperty(e)){g[e][0]=f}}}if(d){for(e in d){if(d.hasOwnProperty(e)){d[e][0]=f}}}if(c){c[0]=f}}else{if(f=="yellow"){if(d){for(e in d){if(d.hasOwnProperty(e)){d[e][0]=f}}}}}}return{singleton:true,linearWalkBySpecification:P}});Ext.define("Gnt.model.Resource",{extend:Sch.model.Resource,customizableFields:["CalendarId"],calendarIdField:"CalendarId",normalized:false,calendarWaitingListener:null,getTaskStore:function(){return this.store.getTaskStore()},getEventStore:function(){return this.getTaskStore()},getTasks:function(){return this.getEvents()},getCalendar:function(d){var c=this;return d?c.getOwnCalendar():c.getOwnCalendar()||c.getProjectCalendar()},getOwnCalendar:function(){var b=this.getCalendarId();return b?Gnt.data.Calendar.getCalendar(b):null},getProjectCalendar:function(){return this.getTaskStore().getCalendar()},setCalendar:function(c){var d=c instanceof Gnt.data.Calendar;if(d&&!c.calendarId){throw new Error("Can't set calendar w/o `calendarId` property")}this.setCalendarId(d?c.calendarId:c)},setCalendarId:function(l,k){if(l instanceof Gnt.data.Calendar){l=l.calendarId}var g=this.getCalendarId();if(g!=l||k){if(this.calendarWaitingListener){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null}var h={calendarchange:this.onCalendarChange,scope:this};var i=this.calendar||Gnt.data.Calendar.getCalendar(g);this.calendar=null;i&&i.un(h);this.set(this.calendarIdField,l);var j=Gnt.data.Calendar.getCalendar(l);if(j){j.on(h);if(!k){this.onCalendarChange()}}else{this.calendarWaitingListener=Ext.data.StoreManager.on("add",function(c,a,b){j=Gnt.data.Calendar.getCalendar(l);if(j){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null;j.on(h);this.onCalendarChange()}},this,{destroyable:true})}}},onCalendarChange:function(){this.inOnCalendarChange=true;this.adjustToCalendar();this.inOnCalendarChange=false},adjustToCalendar:function(){this.getTaskStore()&&this.forEachTask(function(b){b.adjustToCalendar()})},assignTo:function(f,h,g){var e=f instanceof Gnt.model.Task?f:this.getTaskStore().getModelById(f);return e.assign(this,h,g)},unAssignFrom:function(e,f){var d=e instanceof Gnt.model.Task?e:this.getTaskStore().getModelById(e);return d.unAssign(this,f)},unassignFrom:function(){return this.unAssignFrom.apply(this,arguments)},forEachAssignment:function(q,i){var l=this,k=l.getTaskStore(),n=k&&k.getAssignmentStore(),r=n&&n.getAssignmentsForResource(l)||[],o,m,p;i=i||this;for(p=false,o=0,m=r.length;!p&&o<m;++o){p=(false===q.call(i,r[o]))}},forEachTask:function(r,i){var m=this,l=m.getTaskStore(),o=l&&l.getAssignmentStore(),t=o&&o.getAssignmentsForResource(m)||[],p,n,q,s;i=i||this;for(q=false,p=0,n=t.length;!q&&p<n;++p){s=t[p].getTask();s&&(q=(false===r.call(i,s)))}},collectAvailabilityIntervalPoints:function(o,t,l,m,r){for(var p=0,q=o.length;p<q;p++){var s=o[p];var n=s.startDate-0;var k=s.endDate-0;if(!m[n]){m[n]=[];r.push(n)}m[n].push(t);if(!m[k]){m[k]=[];r.push(k)}m[k].push(l)}},forEachAvailabilityIntervalWithTasks:function(ah,af,al){al=al||this;var ai=ah.startDate;var W=ah.endDate;var ae=ah.task;if(!ai||!W){throw"Both `startDate` and `endDate` are required for `forEachAvailabilityIntervalWithTasks`"}var ad=new Date(ai);var Q=ah.includeAllIntervals;var S=ah.includeResCalIntervals;var O=this.getCalendar();var V=[];var U=[];var ak=[];var j=[ai-0,W-0];var aa={};aa[ai-0]=[{type:"00-intervalStart"}];aa[W-0]=[{type:"00-intervalEnd"}];this.forEachAssignment(function(b){var a=b.getTask();if(!a||(ae&&a!==ae)){return}var d=a.getStartDate();var m=a.getEndDate();var e=a.getId();if(d>W||m<ai){return}U.push(a);ak.push(a.getOwnCalendar()||this.getCalendar());if(a.isSegmented()){for(var c=a.getSegments(),g=0,h=c.length;g<h;g++){var f=c[g];this.collectAvailabilityIntervalPoints([{startDate:f.getStartDate(),endDate:f.getEndDate()}],{type:"05-taskStart",assignment:b,taskId:e,units:b.getUnits()},{type:"04-taskEnd",taskId:e},aa,j)}}else{this.collectAvailabilityIntervalPoints([{startDate:d,endDate:m}],{type:"05-taskStart",assignment:b,taskId:e,units:b.getUnits()},{type:"04-taskEnd",taskId:e},aa,j)}V.push(b)});if(!U.length&&!Q&&!S){return}var ag=Sch.util.Date;var Y,P,aj,am={};while(ad<W){this.collectAvailabilityIntervalPoints(O.getAvailabilityIntervalsFor(ad),{type:"00-resourceAvailabilityStart"},{type:"01-resourceAvailabilityEnd"},aa,j);for(Y=0,P=ak.length;Y<P;Y++){aj=U[Y].getId();this.collectAvailabilityIntervalPoints(ak[Y].getAvailabilityIntervalsFor(ad),{type:"02-taskAvailabilityStart",taskId:aj},{type:"03-taskAvailabilityEnd",taskId:aj},aa,j)}ad=ag.getStartOfNextDay(ad)}j.sort(function(a,b){return a-b});var i=false,M=false,N={},an=0,Z=0;var T={};for(Y=0,P=j.length-1;Y<P;Y++){var ac=aa[j[Y]];ac.sort(function(a,b){return a.type<b.type?1:-1});for(var L=0,l=ac.length;L<l;L++){var R=ac[L];switch(R.type){case"00-resourceAvailabilityStart":M=true;break;case"01-resourceAvailabilityEnd":M=false;break;case"02-taskAvailabilityStart":an++;T[R.taskId]=true;break;case"03-taskAvailabilityEnd":an--;delete T[R.taskId];break;case"05-taskStart":N[R.taskId]=R;Z++;break;case"04-taskEnd":delete N[R.taskId];Z--;break;case"00-intervalStart":i=true;break;case"00-intervalEnd":return}}if(i&&(Q||S&&M||M&&an&&Z)){var X={inResourceCalendar:!!M,inTasksCalendar:!!an,inTask:Z,inTaskCalendarHash:Ext.apply({},T)};var k=j[Y];var ab=j[Y+1];if(k>W||ab<ai){continue}if(k<ai){k=ai-0}if(ab>W){ab=W-0}if(af.call(al,k,ab,N,X)===false){return false}}}},getAllocationInfo:function(d){var c=[];this.forEachAvailabilityIntervalWithTasks(d,function(u,t,y,i){var b=0,r=[],a={},w=0,z=[],v={},s=t-u,q=0;if(i.inResourceCalendar&&i.inTasksCalendar&&i.inTask){for(var x in y){if(i.inTaskCalendarHash[x]){q+=s*y[x].units*0.01;b+=y[x].units;a[x]=y[x].assignment;r.push(y[x].assignment)}w+=y[x].units;v[x]=y[x].assignment;z.push(y[x].assignment)}}c.push(Ext.apply({startDate:new Date(u),endDate:new Date(t),effectiveTotalAllocation:b,effectiveAssignmentsHash:a,effectiveAssignments:r,totalAllocationMS:q,totalAllocation:w,assignments:z,assignmentsHash:v},i))});return c},getUtilizationInfo:function(u,o,p,m){var l=this,r=0,q=false,v=false,n={},t={};if(arguments.length<3){p=m=100}var s=l.getAllocationInfo({includeResCalIntervals:true,startDate:u,endDate:o});Ext.Array.each(s,function(a){r+=a.totalAllocationMS;if(a.effectiveTotalAllocation>m){q=true;v=false}else{if(!q&&a.effectiveTotalAllocation<p){v=true}}Ext.Array.each(a.effectiveAssignments,function(d){var e=d.getId(),h=d.getTaskId(),c=d.getUnits(),i=Math.floor((a.endDate-a.startDate)*c/100),g=0,b=c>m,f=c<p,j;if(n[e]){j=n[e];j.allocationMs+=i;j.allocationDeltaMs+=g;j.isOverallocated=j.isOverallocated||b;j.isUnderallocated=j.isUnderallocated||f}else{j={isUtilized:true,allocationMs:i,allocationDeltaMs:g,isOverallocated:b,isUnderallocated:f};n[e]=j;t[h]=j}})});return{isUtilized:r>0,allocationMs:r,allocationDeltaMs:0,isOverallocated:q,isUnderallocated:v,assignmentInfo:n,taskInfo:t}}});Ext.define("Gnt.data.ResourceStore",{extend:Sch.data.ResourceStore,storeId:"resources",model:"Gnt.model.Resource",alias:"store.gantt_resourcestore",taskStore:null,constructor:function(b){this.callParent([b]);this.on({load:this.normalizeResources,remove:this.onResourceRemoved,priority:100})},normalizeResources:function(){this.each(function(c){if(!c.normalized){var d=c.getCalendarId();if(d){c.setCalendarId(d,true)}c.normalized=true}})},onResourceRemoved:function(e,f){var d=this.getAssignmentStore();Ext.Array.each(f,function(a){d.removeAssignmentsForResource(a)})},getTaskStore:function(){return this.taskStore},setTaskStore:function(b){this.taskStore=b},getAssignmentStore:function(){var b=this.getTaskStore();return b&&b.getAssignmentStore()||null},getDependencyStore:function(){var b=this.getTaskStore();return b&&b.getDependencyStore()||null}});Ext.define("Gnt.model.utilization.UtilizationNegotiationStrategyMixin",{utilizationNegotiationStrategyClass:"Gnt.model.utilization.DefaultUtilizationNegotiationStrategy",utilizationNegotiationStrategy:null,initUtilizationNegotiationStrategyMixin:function(d){var c=this;if(d&&d.hasOwnProperty("utilizationNegotiationStrategy")){c.utilizationNegotiationStrategy=d.utilizationNegotiationStrategy;delete d.utilizationNegotiationStrategy}else{c.utilizationNegotiationStrategy=Ext.create(c.utilizationNegotiationStrategyClass)}return d},getUtilizationNegotiationStrategy:function(){return this.utilizationNegotiationStrategy},setUtilizationNegotiationStrategy:function(c){var d=this;if(d.utilizationNegotiationStrategy!==c&&c){d.utilizationNegotiationStrategy=c}}});Ext.define("Gnt.model.UtilizationEvent",{extend:Sch.model.Event,mixins:[Gnt.model.utilization.UtilizationNegotiationStrategyMixin],originalResource:null,originalAssignment:null,customizableFields:[{name:"utilizationInfo",type:"auto",persist:false,defaultValue:null}],utilizationInfoField:"utilizationInfo",constructor:function(h){var g=this,e,f;h=g.initUtilizationNegotiationStrategyMixin(h);if(h.originalResource){e=h.originalResource;delete h.originalResource}if(h.originalAssignment){f=h.originalAssignment;delete h.originalAssignment}g.callParent(arguments);e&&g.setOriginalResource(e);f&&g.setOriginalAssignment(f)},isSurrogateAssignment:function(){return !!this.originalAssignment},isSurrogateSummary:function(){return !!this.originalResource},getOriginalAssignment:function(){return this.originalAssignment},setOriginalAssignment:function(c){var d=this;if(d.originalAssignment!==c){d.originalAssignment=c;if(!d.isInSyncWithOriginal()){d.syncFromOriginal()}}},getOriginalResource:function(){var e=this,d=e.originalResource,f=e.originalAssignment;return d||f&&f.getResource()||null},setOriginalResource:function(c){var d=this;if(d.originalResource!==c){d.originalResource=c;if(!d.isInSyncWithOriginal()){d.syncFromOriginal()}}},getOriginalTask:function(){var d=this,c=d.originalAssignment;return c&&c.getTask()||null},isInSyncWithOriginal:function(){var o=this,j=true,l,n,i,p,m;if(o.isSurrogateAssignment()){l=o.getOriginalAssignment(),i=o.getOriginalTask();if(l){j=j&&(o.getId()==o.self.getSurrogateIdFor(l))}if(i&&!i.isUnscheduled()){j=j&&(o.getStartDate()-o.adjustStartDateToTick(i.getStartDate())===0);j=j&&(o.getEndDate()-o.adjustEndDateToTick(i.getEndDate())===0)}}else{if(o.isSurrogateSummary()){n=o.getOriginalResource();p=o.calculateSurrogateSummaryTimeSpan();j=j&&(o.getId()==o.self.getSurrogateIdFor(n));j=j&&(o.getStartDate()-p.startDate===0);j=j&&(o.getEndDate()-p.endDate===0)}else{var k=false}}if(j){m=o.getUtilizationNegotiationStrategy().getUtilizationInfoForUtilizationEvent(o);j=Ext.Object.equals(o.getUtilizationInfo(),m)}return j},syncFromOriginal:function(){var l=this,i,k,h,g,j;l.beginEdit();if(l.isSurrogateAssignment()){i=l.getOriginalAssignment(),h=l.getOriginalTask();if(i){l.setId(l.self.getSurrogateIdFor(i))}if(h&&!h.isUnscheduled()){l.setStartEndDate(l.adjustStartDateToTick(h.getStartDate()),l.adjustEndDateToTick(h.getEndDate()))}}else{if(l.isSurrogateSummary()){k=l.getOriginalResource();if(k){l.setId(l.self.getSurrogateIdFor(k))}g=l.calculateSurrogateSummaryTimeSpan();l.setStartEndDate(g.startDate,g.endDate)}}j=l.getUtilizationNegotiationStrategy().getUtilizationInfoForUtilizationEvent(l);if(!Ext.Object.equals(l.getUtilizationInfo(),j)){l.setUtilizationInfo(j)}l.endEdit()},getUtilizationInfo:function(){var d=this,c=d.get(d.utilizationInfoField);if(!c){c=d.getUtilizationNegotiationStrategy().getUtilizationInfoForUtilizationEvent(d);d.set(d.utilizationInfoField,c)}return c},syncToOriginal:function(){var c=this,d;if(c.isSurrogateAssignment()){d=c.getOriginalTask();if(d){d.setStartEndDate(c.getStartDate(),c.getEndDate(),true)}}},isInSyncWithSurrogate:function(d){var c=this;return c.getOriginalResource()===d.getOriginalResource()&&c.getOriginalAssignment()===d.getOriginalAssignment()&&c.getId()===d.getId()&&c.getStartDate()-d.getStartDate()===0&&c.getEndDate()-d.getEndDate()===0&&Ext.Object.equals(c.getUtilizationInfo(),d.getUtilizationInfo())},syncFromSurrogate:function(d){var c=this;c.originalResource=d.originalResource;c.originalAssignment=d.originalAssignment;c.beginEdit();c.setId(d.getId());c.setStartEndDate(d.getStartDate(),d.getEndDate());if(!Ext.Object.equals(c.getUtilizationInfo(),d.getUtilizationInfo())){c.setUtilizationInfo(d.getUtilizationInfo())}c.endEdit()},getUtilizationInfoForInterval:function(c){var d=this;return d.getUtilizationNegotiationStrategy().getUtilizationInfoForAssignmentEventInterval(d,c)},forEachInterval:function(c){var d=this;return d.getUtilizationNegotiationStrategy().forEachTimeSpanInterval(d,c)},calculateSurrogateSummaryTimeSpan:function(){var b=this;return b.getUtilizationNegotiationStrategy().calculateResourceAssignmentsTimespan(b.getOriginalResource())},adjustStartDateToTick:function(d){var c=this;return c.getUtilizationNegotiationStrategy().adjustStartDateToTick(d)},adjustEndDateToTick:function(d){var c=this;return c.getUtilizationNegotiationStrategy().adjustEndDateToTick(d)},clone:function(d){var e=this,f=e.callParent([d]);f.setUtilizationNegotiationStrategy(e.getUtilizationNegotiationStrategy());return f},inheritableStatics:{getSurrogateIdFor:function(e){var f=e.getId();if(e instanceof Gnt.model.Resource){f="resource-"+f}else{if(e instanceof Gnt.model.Assignment){f="assignment-"+f}else{var d=false}}return f}}});Ext.define("Gnt.data.ResourceUtilizationEventStore",{extend:Sch.data.EventStore,model:"Gnt.model.UtilizationEvent",storeId:null,getModelByOriginal:function(c){var d=this;return d.getModelById(d.model.getSurrogateIdFor(c))}});Ext.define("Gnt.model.UtilizationResource",{extend:Sch.model.Resource,customizableFields:[{name:"TaskName"},{name:"TaskSequenceNumber"}],taskNameField:"TaskName",taskSequenceNumberField:"TaskSequenceNumber",originalResource:null,originalAssignment:null,constructor:function(f){var g=this,h,e;if(f.originalResource){h=f.originalResource;delete f.originalResource}if(f.originalAssignment){e=f.originalAssignment;delete f.originalAssignment}g.callParent(arguments);h&&g.setOriginalResource(h);e&&g.setOriginalAssignment(e)},getOriginalResource:function(){return this.originalResource||this.originalAssignment&&this.originalAssignment.getResource()},setOriginalResource:function(c){var d=this;if(d.originalResource!==c){d.originalResource=c;if(!d.isInSyncWithOriginal()){d.syncFromOriginal()}}},getOriginalAssignment:function(){return this.originalAssignment},setOriginalAssignment:function(c){var d=this;if(d.originalAssignment!==c){d.originalAssignment=c;if(!d.isInSyncWithOriginal()){d.syncFromOriginal()}}},getOriginalTask:function(){var b=this.getOriginalAssignment();return b&&b.getTask()||null},isSurrogateResource:function(){return !this.getOriginalAssignment()},isSurrogateAssignment:function(){return !!this.getOriginalAssignment()},isInSyncWithOriginal:function(){var j=this,i=j.getOriginalResource(),h=j.getOriginalAssignment(),f=j.getOriginalTask(),g=true;if(h){g=g&&(j.getId()==j.self.getSurrogateIdFor(h));if(f){g=g&&(j.getTaskName()==f.getName());g=g&&(j.getTaskSequenceNumber()==f.getSequenceNumber())}}else{if(i){g=g&&(j.getId()==j.self.getSurrogateIdFor(i));g=g&&(j.getName()==i.getName())}}return g},syncFromOriginal:function(){var e=this,h=e.getOriginalResource(),g=e.getOriginalAssignment(),f=e.getOriginalTask();e.beginEdit();if(h&&!g){e.setId(e.self.getSurrogateIdFor(h))}if(g&&!h){e.setId(e.self.getSurrogateIdFor(g))}if(h){e.setName(h.getName())}if(f){e.setTaskName(f.getName());e.setTaskSequenceNumber(f.getSequenceNumber())}e.endEdit()},syncToOriginal:function(){var b=false},isInSyncWithSurrogate:function(c){var d=this;return d.originalResource===c.originalResource&&d.originalAssignment===c.originalAssignment&&d.getName()===c.getName()&&d.getTaskName()===c.getTaskName()&&d.getTaskSequenceNumber()===c.getTaskSequenceNumber()},syncFromSurrogate:function(c){var d=this;d.originalResource=c.originalResource;d.originalAssignment=c.originalAssignment;d.beginEdit();d.setId(c.getId());d.setName(c.getName());d.setTaskName(c.getTaskName());d.setTaskSequenceNumber(c.getTaskSequenceNumber());d.endEdit()},inheritableStatics:{getSurrogateIdFor:function(e){var f=e.getId();if(e instanceof Gnt.model.Resource){f="resource-"+f}else{if(e instanceof Gnt.model.Assignment){f="assignment-"+f}else{var d=false}}return f}},getResourceStore:function(){return this.store}},function(){Ext.data.NodeInterface.decorate(this)});Ext.define("Gnt.data.ResourceUtilizationStore",{extend:Sch.data.ResourceTreeStore,mixins:[Gnt.model.utilization.UtilizationNegotiationStrategyMixin],model:"Gnt.model.UtilizationResource",eventModel:"Gnt.model.UtilizationEvent",autoDestroy:true,storeId:null,root:{expanded:true},proxy:"memory",config:{defaultResourceExpandedState:false,taskStore:null,resourceStore:null,assignmentStore:null,timeAxis:null,underUtilizationThreshold:null,overUtilizationThreshold:null},folderSort:false,taskStoreDetacher:null,resourceStoreDetacher:null,assignmentStoreDetacher:null,eventStoreDetacher:null,timeAxisDetacher:null,utilizationInfoCache:null,syncingWithOriginal:false,utilizationNegotiationStrategyClass:"Gnt.model.utilization.ResourceStoreUtilizationNegotiationStrategy",constructor:function(d){var c=this;c.eventModel=Ext.ClassManager.get(this.eventModel);c.utilizationInfoCache={};c.callParent([d]);c.initUtilizationNegotiationStrategyMixin({utilizationNegotiationStrategy:Ext.create(c.utilizationNegotiationStrategyClass,{underUtilizationThreshold:c.getUnderUtilizationThreshold(),overUtilizationThreshold:c.getOverUtilizationThreshold(),resourceUtilizationStore:c})});if(!c.getEventStore()){c.setEventStore(new Gnt.data.ResourceUtilizationEventStore({model:c.eventModel,resourceStore:c}))}c.setupSorters()},destroy:function(){var b=this;b.callParent(arguments);Ext.destroy(b.getEventStore());b.setEventStore(null)},setupSorters:function(){var b=this;b.setSorters([{sorterFn:function(a,f){var g;if(a.isSurrogateResource()&&f.isSurrogateResource()&&a.getName()>f.getName()){g=1}else{if(a.isSurrogateResource()&&f.isSurrogateResource()&&a.getName()<f.getName()){g=-1}else{if(a.isSurrogateResource()&&f.isSurrogateResource()){g=0}else{if(a.isSurrogateResource()&&f.isSurrogateAssignment()){g=1}else{if(a.isSurrogateAssignment()&&f.isSurrogateResource()){g=-1}else{if(a.isSurrogateAssignment()&&f.isSurrogateAssignment()){g=b.getUtilizationNegotiationStrategy().assignmentsComparator(a.getOriginalAssignment(),f.getOriginalAssignment())}else{g=0}}}}}}return g}}])},updateTaskStore:function(e,f){var d=this;f&&Ext.destroy(d.taskStoreDetacher);if(e){d.setResourceStore(e.getResourceStore()||d.setResourceStore());d.setAssignmentStore(e.getAssignmentStore()||d.getAssignmentStore());d.taskStoreDetacher=d.mon(e,{load:d.onSourceDataTouch,refresh:d.onSourceDataTouch,clear:d.onSourceDataTouch,add:d.onSourceDataTouch,append:d.onSourceDataTouch,update:d.onSourceDataTouch,remove:d.onSourceDataTouch,bulkremove:d.onSourceDataTouch,move:d.onSourceDataTouch,scope:d,destroyable:true})}},updateResourceStore:function(e,f){var d=this;f&&Ext.destroy(d.resourceStoreDetacher);if(e){d.resourceStoreDetacher=d.mon(e,{load:d.onSourceDataTouch,refresh:d.onSourceDataTouch,clear:d.onSourceDataTouch,add:d.onSourceDataTouch,update:d.onSourceDataTouch,remove:d.onSourceDataTouch,bulkremove:d.onSourceDataTouch,scope:d,destroyable:true})}},updateAssignmentStore:function(e,f){var d=this;f&&Ext.destroy(d.assignmentStoreDetacher);if(e){d.assignmentStoreDetacher=d.mon(e,{load:d.onSourceDataTouch,refresh:d.onSourceDataTouch,clear:d.onSourceDataTouch,add:d.onSourceDataTouch,update:d.onSourceDataTouch,remove:d.onSourceDataTouch,bulkremove:d.onSourceDataTouch,scope:d,destroyable:true})}},setEventStore:function(e){var d=this,f=d.eventStore;d.callParent([e]);if(f!=e){f&&Ext.destroy(d.eventStoreDetacher);if(e){d.utilizationEventStoreDetacher=d.mon(e,{update:d.onUtilizationEventStoreUpdate,scope:d})}}},updateTimeAxis:function(e,d){var f=this;d&&Ext.destroy(f.timeAxisDetacher);if(e){f.timeAxisDetacher=f.mon(e,{reconfigure:f.onSourceDataTouch,scope:f,destroyable:true})}},makeSurrogateResource:function(f){var d=this,e=d.model;return new d.model({Id:e.getSurrogateIdFor(f),originalResource:f,expanded:d.getDefaultResourceExpandedState()})},makeSurrogateAssignment:function(c){var d=this.model;return new d({Id:d.getSurrogateIdFor(c),originalAssignment:c,leaf:true})},makeSurrogateAssignmentEvent:function(f){var h=this,e=h.eventModel,g=e.getSurrogateIdFor(f);return new e({Id:g,ResourceId:g,originalResource:f instanceof Gnt.model.Resource&&f||null,originalAssignment:f instanceof Gnt.model.Assignment&&f||null,utilizationNegotiationStrategy:h.getUtilizationNegotiationStrategy()})},makeSurrogateResourceBranch:function(j){var f=this,h=f.makeSurrogateResource(j),g=[],i;j.forEachAssignment(function(a){var b=a.getTask();if(b&&!b.isUnscheduled()){h.appendChild(f.makeSurrogateAssignment(a));g.push(f.makeSurrogateAssignmentEvent(a))}});if(g.length>0){i=f.makeSurrogateAssignmentEvent(j);g.push(i)}return{resource:h,events:g}},fillStore:function(){var l=this,i=l.getRoot(),m=l.getResourceStore(),h=l.getEventStore(),j=m&&m.getRange(),n=[],k=[];l.syncingWithOriginal=true;i.removeAll();h.removeAll();j&&Ext.Array.each(j,function(a){var b=l.makeSurrogateResourceBranch(a);n.push(b.resource);k=k.concat(b.events)});h.add(k);i.appendChild(n);l.sorters&&l.sorters.getCount()&&i.sort();l.syncingWithOriginal=false},diffSyncStore:function(){var c=this,d;c.syncingWithOriginal=true;c.fireEvent("sync-start",c);c.suspendEvents();d=new c.self({underUtilizationThreshold:c.getUnderUtilizationThreshold(),overUtilizationThreshold:c.getOverUtilizationThreshold()});d.suspendEvents();d.setTimeAxis(c.getTimeAxis());d.setTaskStore(c.getTaskStore());d.fillStore();c.removeOutdatedSurrogateAssignments(c,d);c.removeOutdatedSurrogateResources(c,d);c.addNewSurrogateResources(c,d);c.addNewSurrogateAssignments(c,d);c.updatePresentSurrogates(c,d);c.rearrangePresentSurrogates(c,d);c.utilizationInfoCache=d.utilizationInfoCache;Ext.destroy(d);c.resumeEvents();c.fireEvent("sync-complete",c);c.fireEvent("refresh",c);c.syncingWithOriginal=false},removeOutdatedSurrogateAssignments:function(g,f){var h=g.getRoot(),i=[],j=[];h.cascadeBy(function(b){var a=f.getModelById(b.getId());if(!b.isRoot()&&b.isSurrogateAssignment()){if(!a||(a.parentNode.getId()!=b.parentNode.getId())){i.push(b);j=j.concat(b.getEvents())}}else{if(!b.isRoot()&&b.isSurrogateResource()){j=j.concat(Ext.Array.filter(b.getEvents(),function(c){return c.isSurrogateAssignment()||(a&&a.childNodes.length===0)}))}}});g.getEventStore().remove(j);Ext.Array.each(i,function(a){a.remove()})},removeOutdatedSurrogateResources:function(g,f){var h=g.getRoot(),i=[],j=[];h.cascadeBy(function(b){var a;if(!b.isRoot()&&b.isSurrogateResource()){a=f.getModelById(b.getId());if(!a){i.push(b);j=j.concat(b.getEvents())}}});g.getEventStore().remove(j);Ext.Array.each(i,function(a){a.remove()})},addNewSurrogateResources:function(h,k){var l=k.getRoot(),i=h.getRoot(),g=h.getEventStore(),j=[];l.cascadeBy(function(a){var b;if(!a.isRoot()&&a.isSurrogateResource()){b=h.getModelById(a.getId());if(!b){i.insertChild(a.get("index"),h.makeSurrogateResource(a.getOriginalResource()));j.push(h.makeSurrogateAssignmentEvent(a.getOriginalResource()))}else{if(b.getEvents().length===0){j=j.concat(Ext.Array.map(a.getEvents(),function(c){return c.clone()}))}}}});g.add(j)},addNewSurrogateAssignments:function(g,h){var j=h.getRoot(),i=g.getEventStore(),f=[];j.cascadeBy(function(a){var c,b,d;if(!a.isRoot()&&a.isSurrogateAssignment()){c=g.getModelById(a.getId());if(!c){b=a.parentNode;d=g.getModelById(b.getId());if(d){d.insertChild(a.get("index"),g.makeSurrogateAssignment(a.getOriginalAssignment()));f=f.concat(Ext.Array.map(a.getEvents(),function(e){return e.clone()}))}}}});i.add(f)},updatePresentSurrogates:function(e,d){var f=e.getRoot();f.cascadeBy(function(c){var a,b,h;if(!c.isRoot()){a=d.getModelById(c.getId());if(a){if(!c.isInSyncWithSurrogate(a)){c.syncFromSurrogate(a)}b=a.getEvents()[0];if(b){h=e.getEventStore().getModelById(b.getId());if(h&&!h.isInSyncWithSurrogate(b)){h.syncFromSurrogate(b)}}else{c.syncFromOriginal(a)}}}})},rearrangePresentSurrogates:function(e,f){var d=f.getRoot();d.cascadeBy(function(a){var b;if(!a.isRoot()){b=e.getModelById(a.getId());if(b&&b.get("index")!=a.get("index")){b.parentNode.insertChild(a.get("index"),b)}}})},clearUtilizationInfoCache:function(){this.utilizationInfoCache={}},getModelByOriginal:function(c){var d=this;return d.getModelById(d.model.getSurrogateIdFor(c))},onSourceDataTouch:Ext.Function.createBuffered(function(){var b=this;if(!b.isDestroyed){b.clearUtilizationInfoCache();b.diffSyncStore()}},10),onUtilizationEventStoreUpdate:function(l,g,h,j){var k=this;if(!k.syncingWithOriginal){if(!g.isInSyncWithOriginal()){g.syncToOriginal()}if(Ext.Array.contains(j,g.resourceIdField)){var i=g.getResource();Ext.Function.defer(function(){k.fireEvent("reassign",k,i.getOriginalResource(),i.getOriginalTask(),g.getOriginalResource(),g.getOriginalTask(),g.getOriginalAssignment())},1)}}}});Ext.define("Gnt.model.mixin.ProjectableModel",function(){var j={};function l(){Ext.override(this,j)}function h(a){return this.data[a]}function k(){var a=this,b=a.getTreeStore&&a.getTreeStore()||a.store,c=b&&b.getProjection&&b.getProjection();return c&&c.hasOwnProperty(a.internalId)?true:false}j.get=function g(a){var d=this,e=d.getTreeStore&&d.getTreeStore()||d.store,n=e&&e.getProjection&&e.getProjection(),f=d.internalId,b,c;if(n&&n.hasOwnProperty(f)){b=n[f];if(a in b){c=b[a]}else{c=d.callParent([a])}}else{c=d.callParent([a])}return c};j.set=function i(b,e){var f=this,d=f.getTreeStore&&f.getTreeStore()||f.store,u=d&&d.getProjection&&d.getProjection(),t=f.internalId,v,x,a,c,w,s;if(u){a=[];if(arguments.length==1){for(x in b){if(b.hasOwnProperty(x)){e=b[x];c=f.get(x);s=(e!==undefined&&e!==null)?(e).valueOf():e;w=(c!==undefined&&c!==null)?(c).valueOf():c;if(((s===undefined||s===null)&&s!==w)||s!=w){v=u[t]=u.hasOwnProperty(t)&&u[t]||{};v[x]=e;a.push(x)}}}}else{if(arguments.length>1){c=f.get(b);s=(e!==undefined&&e!==null)?(e).valueOf():e;w=(c!==undefined&&c!==null)?(c).valueOf():c;if(((s===undefined||s===null)&&s!==w)||s!=w){v=u[t]=u.hasOwnProperty(t)&&u[t]||{};v[b]=e;a.push(b)}}}}else{a=f.callParent(arguments)}return a};return{initProjectable:l,getUnprojected:h,isProjected:k}});Ext.define("Gnt.model.task.More",{propagating:false,indent:function(h){var i=this,j=i.previousSibling,f;if(j){var g=i.getTaskStore();g.beginIndent();i.propagateChanges(function(){return i.indentWithoutPropagation(function(a){f=a})},function(a,b){if(a){f&&f()}else{j.expand()}g.endIndent();h&&h(a,b)})}else{h&&h(false,{})}},indentWithoutPropagation:function(o){var l=this,m=l.previousSibling,i,k,n,p,j;j={parentNode:l.parentNode,previousSibling:l.previousSibling,nextSibling:l.nextSibling};i=l.parentNode;k=i.indexOf(l);n=m.get("leaf");if(n){p=m.getSegments();m.markAsParent()}m.appendChild(l);if(l.getParentsIncomingDependencies().length){l.alignByIncomingDependenciesWithoutPropagation()}l.removeContext=j;o&&o(function(){i.insertChild(k,l);if(n){m.set("leaf",true);p&&m.setSegmentsWithoutPropagation(p)}});return l},outdent:function(h){var i=this,g=i.parentNode,j;if(g&&!g.isRoot()){var f=i.getTaskStore();f.beginIndent();i.propagateChanges(function(){return i.outdentWithoutPropagation(function(a){j=a})},function(a,b){a&&j&&j();f.endIndent();h&&h(a,b)})}else{h&&h(false,{})}},outdentWithoutPropagation:function(j){var i=this,f,h,g;g={parentNode:i.parentNode,previousSibling:i.previousSibling,nextSibling:i.nextSibling};f=i.parentNode;h=f.indexOf(i);if(f.nextSibling){f.parentNode.insertBefore(i,f.nextSibling)}else{f.parentNode.appendChild(i)}i.removeContext=g;j&&j(function(){f.insertChild(h,i)});return f},removeInvalidDependencies:function(){var e=this.getDependencyStore(),f=this.getAllDependencies();for(var d=0;d<f.length;d++){if(!f[d].isValid()){e.remove(f[d])}}},removeDependenciesToParents:function(f){var d=this,e=d.getSuccessors().concat(d.getPredecessors());f.bubble(function(a){if(Ext.Array.indexOf(e,a)>=0){d.removeLinkToTask(a)}})},hasDependencies:function(){return this.hasIncomingDependencies()||this.hasOutgoingDependencies()},getAllDependencies:function(){return this.predecessors.concat(this.successors)},hasIncomingDependencies:function(){return this.predecessors.length>0},hasOutgoingDependencies:function(){return this.successors.length>0},getIncomingDependencies:function(b){return b?this.predecessors:this.predecessors.slice()},getParentsIncomingDependencies:function(e){var g=this.parentNode,f=[],h;while(g){if(e){h=Ext.Array.filter(g.getIncomingDependencies(),function(a){var b=a.getSourceTask();return b&&b.isAncestor(e)})}else{h=g.getIncomingDependencies()}f=f.concat(h);g=g.parentNode}return f},getOutgoingDependencies:function(b){return b?this.successors:this.successors.slice()},alignByIncomingDependencies:function(h,e,g){var f=this.alignByIncomingDependenciesWithoutPropagation(h,e);this.propagateChanges(null,g,true);return f},alignByIncomingDependenciesWithoutPropagation:function(l,m,n){if(this.isManuallyScheduled()||this.isReadOnly()){return false}var j=false;l=l||this.getTaskStore();var h=this.getIncomingDependenciesConstraintContext(l,n);if(h){var i=h.startDate;var k=h.endDate;if(i&&i-this.getStartDate()!==0){m&&m.addAffected(this);this.setStartDateWithoutPropagation(i,true,l.skipWeekendsDuringDragDrop);j=true}else{if(k&&k-this.getEndDate()!==0){m&&m.addAffected(this);this.setEndDateWithoutPropagation(k,true,l.skipWeekendsDuringDragDrop);j=true}}}return j},getDependencyCalendar:function(n,j,h){if(!j){j=(h||this.getTaskStore()).dependenciesCalendar}var l=this.getProjectCalendar(),i=n.getSourceTask(h),m=n.getTargetTask(h),k;switch(j){case"project":k=l;break;case"source":k=i.getCalendar();break;case"target":k=m.getCalendar();break;default:throw"Unsupported value for `dependenciesCalendar` config option"}return k},getIncomingDependenciesConstraintContext:function(r,p){var o=this,q=this.getIncomingDependencies(true).concat(this.getParentsIncomingDependencies(p));if(!q.length||this.isUnscheduled()){return null}var v=Gnt.model.Dependency.Type,t=new Date(0),u=new Date(0),n,w;var s=(r||this.getTaskStore()).dependenciesCalendar;Ext.Array.each(q,function(f){var g=f.getSourceTask(r);if(g&&(!p||g.isAncestor(p))){var d=o.getDependencyCalendar(f,s,r);var b=f.getLag()||0,e=f.getLagUnit(),c=g.getStartDate(),a=g.getEndDate();switch(f.getType()){case v.StartToEnd:if(c){c=d.skipWorkingTime(c,b,e);if(u<c){u=c;w=g}}break;case v.StartToStart:if(c){c=d.skipWorkingTime(c,b,e);if(t<c){t=c;n=g}}break;case v.EndToStart:if(a){a=d.skipWorkingTime(a,b,e);if(t<a){t=a;n=g}}break;case v.EndToEnd:if(a){a=d.skipWorkingTime(a,b,e);if(u<a){u=a;w=g}}break;default:throw"Invalid dependency type: "+f.getType()}}});var m={startDate:t>0?t:null,endDate:u>0?u:null,constrainingTask:n||w};if(t&&u){var x=this.calculateStartDate(u,this.getDuration());if(x>t){m.startDate=x;m.constrainingTask=w}m.endDate=null}return m.constrainingTask&&m},getCriticalPaths:function(){var c=[this],d=this.getIncomingDependenciesConstraintContext();while(d){c.push(d.constrainingTask);d=d.constrainingTask.getIncomingDependenciesConstraintContext()}return c},addSubtask:function(k,i){var l=this,h,g;l.propagateChanges(function(){return l.addSubtaskWithoutPropagation(k,function a(b,c){g=b;h=c})},function j(a,b){a&&g&&g();i&&i(a,b)});return h},addSubtaskWithoutPropagation:function(k,l){var o=this,j,n,m,p,i;j=k.parentNode;n=j&&j.indexOf(o);p=o.get("leaf");if(p){o.markAsParent();i=o.getSegments()}k=o.appendChild(k);o.expand();l&&l(function(){if(j){j.insertChild(n,k)}else{o.removeChild(k)}p&&o.set("leaf",true);p&&i&&o.setSegmentsWithoutPropagation(i)},k);if(!j){m=k}else{if(o!==j&&o.getTaskStore(true)===j.getTaskStore(true)){m=[k,j]}}return m},insertSubtask:function(h,l,j){var m=this,i,n;m.propagateChanges(function(){return m.insertSubtaskWithoutPropagation(h,l,function a(b,c){n=b;i=c})},function k(a,b){a&&n&&n();j&&j(a,b)});return i},insertSubtaskWithoutPropagation:function(l,r,k){var j=this,o,m,p,q,n;o=r.parentNode;m=o&&o.indexOf(j);q=j.get("leaf");if(q){j.markAsParent();n=j.getSegments()}r=j.insertChild(l,r);j.expand();k&&k(function(){if(o){o.insertChild(m,r)}else{j.removeChild(r)}q&&j.set("leaf",true);q&&n&&j.setSegmentsWithoutPropagation(n)},r);if(!o){p=r}else{if(j!==o&&j.getTaskStore(true)===o.getTaskStore(true)){p=[r,o]}}return p},removeSubtask:function(j,h){var f=this,g;if(f.indexOf(j)!==-1){f.propagateChanges(function(){return f.removeSubtaskWithoutPropagation(j,function a(b){g=b})},function i(a,b){a&&g&&g();h&&h(a,b)})}else{h&&h(false,{})}},removeSubtaskWithoutPropagation:function(z,y){var p=this,x=p.indexOf(z),i,w,t,q,A,r,v,u,s,B;w=p.getDependencyStore();t=p.getAssignmentStore();q=w&&w.getDependenciesForTask(z);A=t&&z.getAssignments();i=[];r=[];v=[];z.cascadeBy(function(a){i.push(a)});for(u=0,s=i.length;(w||t)&&u<s;u++){B=i[u];w&&(q=q.concat(w.getDependenciesForTask(B)));t&&(A=A.concat(B.getAssignments()))}q=w&&Ext.Array.unique(q);q=w&&Ext.Array.sort(q,function(b,a){return w.indexOf(b)<w.indexOf(a)?-1:1});for(u=0,s=q&&q.length;w&&u<s;u++){r.push(w.indexOf(q[u]))}A=t&&Ext.Array.sort(A,function(b,a){return t.indexOf(b)<t.indexOf(a)?-1:1});for(u=0,s=A&&A.length;t&&u<s;u++){v.push(t.indexOf(A[u]))}z=p.removeChild(z);t&&t.remove(A);w&&w.remove(q);if(p.childNodes.length===0&&p.convertEmptyParentToLeaf){p.set("leaf",true)}y&&y(function(){p.insertChild(x,z);for(u=0,s=A&&A.length;t&&u<s;u++){t.insert(v[u],A[u])}for(u=0,s=q&&q.length;w&&u<s;u++){w.insert(r[u],q[u])}});return p},addSuccessor:function(g,i){var k=this,h,l;k.propagateChanges(function(){return k.addSuccessorWithoutPropagation(g,function a(b,c){l=b;h=c})},function j(a,b){a&&l&&l();i&&i(a,b)});return h},addSuccessorWithoutPropagation:function(h,j){var k=this,i=k.parentNode,m=i.indexOf(k),n,l;h=h||new k.self();h.calendar=h.calendar||k.getCalendar();h.taskStore=h.taskStore||k.getTaskStore(true);if(k.getEndDate()){h.beginEdit();h.set(k.startDateField,k.getEndDate());h.set(k.endDateField,h.calculateEndDate(k.getEndDate(),1,Sch.util.Date.DAY));h.set(k.durationField,1);h.set(k.durationUnitField,Sch.util.Date.DAY);h.endEdit()}i.insertSubtaskWithoutPropagation(m+1,h,function(a,b){n=a;h=b});k.linkToWithoutPropagation(h,Gnt.model.Dependency.Type.EndToStart,function(a){l=a});j&&j(function(){l();n()},h);return k},addMilestone:function(h,g){var e=this,f=e.getEndDate();if(!h){h=new e.self()}else{if(Ext.isObject(h)&&!(h instanceof Gnt.model.Task)){h=new e.self(h)}}if(f&&!h.isMilestone()){h.calendar=h.calendar||e.getCalendar();h.setStartEndDate(f,f)}return e.addTaskBelow(h,g)},addPredecessor:function(l,i){var k=this,h,g;k.propagateChanges(function(){return k.addPredecessorWithoutPropagation(l,function a(b,c){g=b;h=c})},function j(a,b){a&&g();i&&i(a,b)});return h},addPredecessorWithoutPropagation:function(l,j){var k=this,i=k.parentNode,n=i.indexOf(k),h,m;l=l||new k.self();l.calendar=l.calendar||k.getCalendar();l.taskStore=l.taskStore||k.getTaskStore(true);if(k.getStartDate()){l.beginEdit();l.set(k.startDateField,l.calculateStartDate(k.getStartDate(),1,Sch.util.Date.DAY));l.set(k.endDateField,k.getStartDate());l.set(k.durationField,1);l.set(k.durationUnitField,Sch.util.Date.DAY);l.endEdit()}i.insertSubtaskWithoutPropagation(n,l,function(a,b){h=a;l=b});l.linkToWithoutPropagation(k,Gnt.model.Dependency.Type.EndToStart,function(a){m=a});j&&j(function(){m();h()},l);return l},getSuccessors:function(){var h=this.successors,i=[];for(var j=0,g=h.length;j<g;j++){var f=h[j].getTargetTask();if(f){i.push(f)}}return i},getPredecessors:function(){var h=this.predecessors,i=[];for(var j=0,g=h.length;j<g;j++){var f=h[j].getSourceTask();if(f){i.push(f)}}return i},addTaskAbove:function(p,k){var m=this,j=m.parentNode,o=j.indexOf(m),i,n;p=p||new m.self();m.propagateChanges(function(){return j.insertSubtaskWithoutPropagation(o,p,function a(b,c){n=b;i=c})},function l(a,b){a&&n();k&&k(a,b)});return i},addTaskBelow:function(p,k){var m=this,j=m.parentNode,o=j.indexOf(m)+1,i,n;p=p||new m.self();m.propagateChanges(function(){return j.insertSubtaskWithoutPropagation(o,p,function a(b,c){n=b;i=c})},function l(a,b){a&&n();k&&k(a,b)});return i},isAbove:function(f){var e=this,g=Math.min(e.data.depth,f.data.depth);var h=this;while(h.data.depth>g){h=h.parentNode;if(h==f){return false}}while(f.data.depth>g){f=f.parentNode;if(f==e){return true}}while(f.parentNode!==h.parentNode){f=f.parentNode;h=h.parentNode}return f.data.index>h.data.index},cascadeChildren:function(k,l){var j=this;if(j.isLeaf()){return}var i=this.childNodes;for(var g=0,h=i.length;g<h;g++){i[g].cascadeBy(k,l)}},getSlack:function(d){d=d||Sch.util.Date.DAY;var f=this.getEarlyStartDate(),e=this.getLateStartDate();if(!f||!e){return null}return this.getCalendar().calculateDuration(f,e,d)},getEarlyStartDate:function(){var p=this.getTaskStore(true);if(!p){return this.getStartDate()}var s=this.internalId;if(p.earlyStartDates[s]){return p.earlyStartDates[s]}var z,i=0,u,w;if(this.childNodes.length){for(u=0,w=this.childNodes.length;u<w;u++){z=this.childNodes[u].getEarlyStartDate();if(z<i||!i){i=z}}p.earlyStartDates[s]=i;return i}if(this.isManuallyScheduled()){i=p.earlyStartDates[s]=this.getStartDate();return i}var l=this.getIncomingDependencies(true);if(!l.length){i=p.earlyStartDates[s]=this.getStartDate();return i}var t=Gnt.model.Dependency.Type,q=this.getCalendar();for(u=0,w=l.length;u<w;u++){var x=l[u],r=x.getSourceTask(),v=this.getDependencyCalendar(x);if(r){switch(x.getType()){case t.StartToStart:z=r.getEarlyStartDate();break;case t.StartToEnd:z=r.getEarlyStartDate();z=q.calculateStartDate(z,this.getDuration(),this.getDurationUnit());break;case t.EndToStart:z=r.getEarlyEndDate();break;case t.EndToEnd:z=r.getEarlyEndDate();z=q.calculateStartDate(z,this.getDuration(),this.getDurationUnit());break}var y=x.getLag();if(z&&y){z=v.skipWorkingTime(z,y,x.getLagUnit())}if(z){z=q.skipNonWorkingTime(z,true)}}if(z>i){i=z}}p.earlyStartDates[s]=i;return i},getEarlyEndDate:function(){var m=this.getTaskStore(true);if(!m){return this.getEndDate()}var n=this.internalId;if(m.earlyEndDates[n]){return m.earlyEndDates[n]}var i=0;if(this.childNodes.length){var k,l,h;for(l=0,h=this.childNodes.length;l<h;l++){k=this.childNodes[l].getEarlyEndDate();if(k>i){i=k}}m.earlyEndDates[n]=i;return i}if(this.isManuallyScheduled()){i=m.earlyEndDates[n]=this.getEndDate();return i}var j=this.getEarlyStartDate();if(!j){return null}i=m.earlyEndDates[n]=this.getCalendar().calculateEndDate(j,this.getDuration(),this.getDurationUnit());return i},getLateEndDate:function(){var p=this.getTaskStore(true);if(!p){return this.getEndDate()}var r=this.internalId;if(p.lateEndDates[r]){return p.lateEndDates[r]}var z,i=0,t,w;if(this.childNodes.length){for(t=0,w=this.childNodes.length;t<w;t++){z=this.childNodes[t].getLateEndDate();if(z>i){i=z}}p.lateEndDates[r]=i;return i}if(this.isManuallyScheduled()){i=p.lateEndDates[r]=this.getEndDate();return i}var l=this.getOutgoingDependencies(true);if(!l.length){i=p.lateEndDates[r]=p.getProjectEndDate();return i}var s=Gnt.model.Dependency.Type,q=this.getCalendar();for(t=0,w=l.length;t<w;t++){var x=l[t],u=x.getTargetTask(),v=this.getDependencyCalendar(x);if(u){switch(x.getType()){case s.StartToStart:z=u.getLateStartDate();z=q.calculateEndDate(z,this.getDuration(),this.getDurationUnit());break;case s.StartToEnd:z=u.getLateEndDate();z=q.calculateEndDate(z,this.getDuration(),this.getDurationUnit());break;case s.EndToStart:z=u.getLateStartDate();break;case s.EndToEnd:z=u.getLateEndDate();break}var y=x.getLag();if(y){z=v.skipWorkingTime(z,-y,x.getLagUnit())}z=q.skipNonWorkingTime(z,false);if(z<i||!i){i=z}}}p.lateEndDates[r]=i||p.getProjectEndDate();return p.lateEndDates[r]},getLateStartDate:function(){var m=this.getTaskStore(true);if(!m){return this.getStartDate()}var n=this.internalId;if(m.lateStartDates[n]){return m.lateStartDates[n]}var i;if(this.childNodes.length){var k,l,h;for(l=0,h=this.childNodes.length;l<h;l++){k=this.childNodes[l].getLateStartDate();if(k<i||!i){i=k}}m.lateStartDates[n]=i;return i}if(this.isManuallyScheduled()){i=m.lateStartDates[n]=this.getStartDate();return i}var j=this.getLateEndDate();if(!j){return null}i=m.lateStartDates[n]=this.getCalendar().calculateStartDate(j,this.getDuration(),this.getDurationUnit());return i},getTopParent:function(j){var f=this.getTaskStore().getRoot(),h=this,i=[this],g;while(h){if(h===f){return j?i:g}i.push(h);g=h;h=h.parentNode}},getInDepthWalker:function(g){var i=g?this:this.childNodes&&this.childNodes[0];var f=this;var h={};var j=function(a){var b=a;var c=b.internalId;if(b.isLeaf()||!b.childNodes.length){b=b.nextSibling}else{if(h[c]===true){h[c]=false;b=b.nextSibling}else{h[c]=true;b=b.childNodes[0]}}if(!b){b=a;do{if(b===f){return null}b=b.parentNode;if(b===f){return null}}while(h[b.internalId]===false);return j(b)}return b};return function(){var a=i;if(i){i=j(i)}return a}},propagateChanges:function(m,e,o){var q=this,t,n,p,s;p=q.getTaskStore(true);o=arguments.length==3?o:p&&p.cascadeChanges;if(!q.propagating&&p){q.propagating=true;n={};p.suspendAutoSync();s=p.startBatchCascade();p.startProjection();try{t=(m&&m!==Ext.emptyFn)?m(q):[q]}catch(r){p.rejectProjection();p.endBatchCascade();p.resumeAutoSync(p.autoSync);q.propagating=false;throw r}if(t===true){t=q.isProjected()&&[q]||false}else{if(t){t=[].concat(t)}}if(t){q.propagateChangesThroughDependentTasks(p.getLinearWalkingSequenceForDependentTasks(t,{self:true,ancestors:p.recalculateParents,descendants:p.moveParentAsGroup,successors:o,cycles:p.cycleResolutionStrategy}),p,s,t,o,n,function l(a,b){if(a){p.rejectProjection();b={}}else{p.commitProjection()}p.endBatchCascade();q.propagating=false;e&&e(a,b);p.resumeAutoSync(p.autoSync&&!a&&!Ext.Object.isEmpty(b))})}else{p.rejectProjection();p.endBatchCascade();q.propagating=false;e&&e(false,{});p.resumeAutoSync(p.autoSync)}}else{if(!q.propagating){q.propagating=true;try{m&&m(q)}catch(r){q.propagating=false;throw r}q.verifyConstraint(function(b,a){n={};a=!!a;if(!a){n[q.getId()]=q}q.propagating=false;e&&e(a,n)})}else{e&&e(true,{})}}},propagateChangesThroughDependentTasks:function(r,q,w,x,p,o,i,u){var s=this,v,t,n;u=u||0;n=true;for(v=u,t=r.length;n&&v<t;++v){n=s.processTaskConstraints(r,v,q,w,x,p,o,function(d,c,b,a){if(b||(d==t-1)){i(b,a)}else{if(!c){s.propagateChangesThroughDependentTasks(r,q,w,x,p,a,i,d+1)}}})}},processTaskConstraints:function(G,I,N,X,E,S,P,T){var A=this,R=G[I],D=R[0],H=R[1],B=D.hasChildNodes(),C=!B,L=!(D.isManuallyScheduled()||D.isReadOnly()||Ext.Array.contains(E,D)),z=S||N.cascadeChanges,J=N.recalculateParents,U=N.moveParentAsGroup,O=D.parentNode,V=O&&(O.getStartDate()),F=O&&(O.getUnprojected(O.startDateField)),K=O&&(V-F),Q;function M(e,g,d){var c=e.getIncomingDependencies(true),f=false,b,a,h,i;for(b=0,a=c.length;!f&&b<a;++b){h=c[b];i=h.getSourceTask();f=i&&g.hasOwnProperty(i.getId())||Ext.Array.contains(d,i)}return f}switch(true){case L&&C&&H=="green"&&K&&U:case L&&B&&H=="yellow"&&K&&U:if(V){var W=D.getStartDate();if(W>=F){Q=D.calculateDuration(F,W,null,{segments:false});D.setStartDateWithoutPropagation(D.calculateEndDate(V,Q,null,{segments:false}),true,N.skipWeekendsDuringDragDrop)}else{Q=D.calculateDuration(W,F,null,{segments:false});D.setStartDateWithoutPropagation(D.calculateStartDate(V,Q,null,{segments:false}),true,N.skipWeekendsDuringDragDrop)}M(D,P,E)&&D.alignByIncomingDependenciesWithoutPropagation(N,null,O)}break;case L&&C&&H=="green"&&z:case L&&B&&H=="yellow"&&z:M(D,P,E)&&D.alignByIncomingDependenciesWithoutPropagation(N,null);break;case B&&H=="green"&&J:D.refreshCalculatedParentNodeData();break}if(D.isProjected()){X.addAffected(D);P[D.getId()]=D}return D.verifyConstraint(function(a,c){var b,d;if(!a&&B&&L&&N.recalculateParents&&H=="green"){b=Ext.Array.findBy(G,function(f,h){var e=f[0],g=f[1];d=h;return D===e&&g=="yellow"});T(d,a,!!c,P)}else{T(I,a,!!c,P)}})},removeLinkToTask:function(e){var h=this.getDependencyStore();var f=this.getId();var g=e.getId();Ext.Array.each(this.getAllDependencies(),function(a){if((a.getSourceId()===f&&a.getTargetId()===g)||(a.getSourceId()===g&&a.getTargetId()===f)){h.remove(a);return false}})},convertEmptyParentToLeafTask:function(){this.beginEdit();this.set("leaf",true);this.setDurationWithoutPropagation(1,Sch.util.Date.DAY);this.endEdit()},hasEndPredecessorsButNoStartPredecessors:function(){var d=this.getIncomingDependencies();var e=d.length>0;var f=Gnt.model.Dependency.Type;Ext.Array.each(d,function(a){if(a.getType()===f.StartToStart||a.getType()===f.EndToStart){return e=false}});return e},isCompleted:function(){return this.getPercentDone()>=100}});Ext.define("Gnt.model.task.Constraints",{setConstraint:function(f,g,h){var i=this;function j(){return i.setConstraintWithoutPropagation(f,g)}if(f){i.propagateChanges(j,h)}else{j();h&&h(false,{})}},setConstraintWithoutPropagation:function(e,f){var h=this,g;if(e){g=Gnt.constraint.Base.getConstraintClass(e)}if(!f&&g){f=g.getInitialConstraintDate(h)}h.beginEdit();h.set(h.constraintTypeField,e||"");h.set(h.constraintDateField,f);h.endEdit();return true},setConstraintType:function(d,c){this.setConstraint(d,this.getConstraintDate(),c)},setConstraintTypeWithoutPropagation:function(d,c){this.setConstraintWithoutPropagation(d,this.getConstraintDate(),c)},setConstraintDate:function(d,c){this.setConstraint(this.getConstraintType(),d,c)},setConstraintDateWithoutPropagation:function(b){this.setConstraintWithoutPropagation(this.getConstraintType(),b)},hasConstraint:function(){return !!this.getConstraintType()},getConstraintClass:function(){return Gnt.constraint.Base.getConstraintClass(this.getConstraintType())},isConstraintSatisfied:function(){var b=this;return !b.hasConstraint()||b.getConstraintClass().isSatisfied(b,b.getConstraintDate())},verifyConstraint:function(k){var l=this,h,i,m,n,j;n=l.isConstraintSatisfied();k=k&&Ext.Function.pass(k,[n]);h=l.getTaskStore(true);j=h&&h.hasListener("constraintconflict");i=h&&h.constraintDatePrecision||Sch.util.Date.DAY;m=!n&&l.getConstraintClass().getResolution(k,l,null,i);if(!n&&h&&j){h.fireEvent("constraintconflict",l,m)}else{if(!n){m.cancelAction()}else{if(k){k(false)}}}return n},getWorkingTimeStartForDate:function(j){var i=this,f=false,g,h;g=Ext.Date.clearTime(j,true);h=Sch.util.Date.add(g,Sch.util.Date.DAY,1);i.forEachAvailabilityInterval({isForward:true,startDate:g,endDate:h,segments:false,resources:true,fn:function(a,b){f=new Date(a);return false}});return f},getWorkingTimeEndForDate:function(j){var i=this,f=false,g,h;g=Ext.Date.clearTime(j,true);h=Sch.util.Date.add(g,Sch.util.Date.DAY,1);i.forEachAvailabilityInterval({isForward:false,startDate:g,endDate:h,segments:false,resources:true,fn:function(a,b){f=new Date(b);return false}});return f},getNearestWorkingTimeStartForDate:function(l,k,g){var i=this,j,h;k=k||false;g=g||365;j=k?-1:1;h=i.getWorkingTimeStartForDate(l);while(!h&&g--){l=Sch.util.Date.add(l,Sch.util.Date.DAY,j);h=i.getWorkingTimeStartForDate(l)}return h},getNearestWorkingTimeEndForDate:function(l,k,g){var i=this,j,h;k=k||false;g=g||365;j=k?-1:1;h=i.getWorkingTimeEndForDate(l);while(!h&&g--){l=Sch.util.Date.add(l,Sch.util.Date.DAY,j);h=i.getWorkingTimeEndForDate(l)}return h},getWorkingTimeIntervalForDateTime:function(i){var j=this,f=false,g,h;g=Ext.Date.clearTime(i,true);h=Sch.util.Date.add(g,Sch.util.Date.DAY,1);i=i.valueOf();j.forEachAvailabilityInterval({isForward:true,startDate:g,endDate:h,segments:false,resources:true,fn:function(a,b){if(a<=i&&i<=b){f={startDate:new Date(a),endDate:new Date(b)}}return !f}});return f},isDateTimeWithinWorkingTimeInterval:function(c){var d=this;return d.getWorkingTimeIntervalForDateTime(c)!==false}});Ext.define("Gnt.model.task.Splittable",{segmentsTrackingSuspended:0,changingTaskBySegments:false,segmentsSnapshot:null,segmentsProjection:null,getFirstSegment:function(){var b=this.getSegments();return b&&b[0]},getLastSegment:function(){var b=this.getSegments();return b&&b[b.length-1]},normalizeSegments:function(){var b=this.getSegments();this.suspendSegmentsTracking();b.sort(function(a,e){if(!a.normalized){a.normalize()}if(!e.normalized){e.normalize()}return a.getStartDate()>e.getStartDate()?1:-1});this.mergeOverlappedSegments();if(this.getSegments()){this.data[this.durationField]=this.getSegmentsDuration()}this.resumeSegmentsTracking()},updateSegmentsDates:function(d){d=d||{};if(!this.isSegmented()){return}this.suspendSegmentsTracking();d=Ext.apply({useAbsoluteOffset:false},d);d.isForward=d.isForward!==false;var c=false;this.forEachSegment(function(a){a.updateDatesByOffsets(d);c=c||Boolean(a.modified)},d.isForward);if(c){this.set(this.segmentsField,this.getSegments().slice())}this.resumeSegmentsTracking()},getSegmentIntervalsForRange:function(m,q,n){n=n||this.getSegments();if(!n){return}var s=Sch.util.Date,i=[];for(var o=0,p=n.length;o<p;o++){var r=n[o],l=r.getStartDate(),t=r.getEndDate();if(s.intersectSpans(m,q,l,t)){i.push([s.constrain(l,m,q)-0,s.constrain(t,m,q)-0])}}return i.length&&i||null},getSegmentByDate:function(i,j){j=j||this.getSegments();if(!j){return}for(var h=0,g=j.length;h<g;h++){var f=j[h];if(i>=f.getStartDate()&&i<f.getEndDate()){return f}}},constrainSegments:function(I){if(this.changingTaskBySegments){return}I=I||{};var z=this.getSegments();if(!z){return}var J=this.getDuration("MILLI"),w=I.unit||this.getDurationUnit(),E=I.duration,K=this.getStartDate(),v=this.getEndDate(),i=this.getUnitConverter();if(!K||(!v&&!J&&!E)){this.set(this.segmentsField,null);return}if(E){E=i.convertDurationToMs(E,w)}else{if(!v){E=J}}this.suspendSegmentsTracking();z[0].setStartDateWithoutPropagation(this.getStartDate(),false);var A=[],D=E,B,L;var C;if(E){C=function(){return D<=0}}else{C=function(a){return a.getStartDate()>=v}}for(var x=0,y=z.length;x<y;x++){B=z[x];if(C(B)){A.push.apply(A,z.slice(x));break}D-=B.getDuration("MILLI");L=B}this.removeSegments(A);if(z.length<2){this.set(this.segmentsField,null)}else{var G=this.getLastSegment();var l=false;if(E){if(D){G.setDurationWithoutPropagation(i.convertMSDurationToUnit(G.getEndOffset()-G.getStartOffset()+D,G.getDurationUnit()));l=true}}else{if(G.getEndDate()-v){G.setEndDateWithoutPropagation(v,false);l=true}}var F=this.getTaskStore(true),H=F&&F.isProjecting();if((A.length||l)&&(H||!this.modified||!this.modified[this.segmentsField])){this.set(this.segmentsField,this.getSegments().slice())}}this.resumeSegmentsTracking()},forEachSegment:function(g,j,k,h){if(!g){return}h=h||this;var i,l;if(j!==false){i="getNextSegment";l=k||this.getFirstSegment()}else{i="getPrevSegment";l=k||this.getLastSegment()}while(l){if(g.call(h,l)===false){return}l=l[i].call(l)}},split:function(j,m,n,k,l){var h=this,i;h.propagateChanges(function(){return h.splitWithoutPropagation(j,m,n,k,function a(b){i=b})},function(a,b){a&&i&&i();l&&l(a,b)})},splitWithoutPropagation:function(E,V,K,H,P){var y=this;if(H!==true&&H!==false){var N=y.getTaskStore(true);H=N?N.skipWeekendsDuringDragDrop:false}if(!E||!y.isLeaf()||y.isMilestone()){return}var S=y.getStartDate(),D=y.getEndDate();if(!S||!D||(S>=E)||(E>=D)){return}var G=y.getSegments(),U;var R=y.buildSegmentsSnapshot(G);if(G){U=y.getSegmentByDate(E);if(!U){return}}else{G=[]}V=V||1;K=K||this.getDurationUnit();var A=new Date(E),C=A,L=A,F=y.getUnitConverter().convertDurationToMs(V,K);if(H){L=y.skipNonWorkingTime(L,true,true);C=y.skipNonWorkingTime(C,false,true)}var B=y.getDurationUnit(),Q=Ext.ClassManager.get(y.segmentClassName).prototype,M,z,J;y.suspendSegmentsTracking();var O=true;if(!U){M=y.calculateDuration(S,C);z=y.getDuration()-M;J={task:y};J[Q.startDateField]=S;J[Q.durationField]=M;J[Q.durationUnitField]=B;G.push(Ext.create(y.segmentClassName,J))}else{M=y.calculateDuration(U.getStartDate(),C,B);z=U.getDuration(B)-M;O=!!M;var T;if(O){U.setEndDateWithoutPropagation(C,false,H);T=U.getNextSegment()}else{T=U}if(T){y.forEachSegment(function(a){a.setStartEndOffset(a.getStartOffset()+F,a.getEndOffset()+F);a.updateDatesByOffsets()},true,T)}}if(O){L=y.skipWorkingTime(L,F);if(H){L=y.skipNonWorkingTime(L)}J={prevSegment:U||G[0],task:y};J[Q.startDateField]=L;J[Q.durationField]=z;J[Q.durationUnitField]=B;var I=Ext.create(y.segmentClassName,J);if(U){Ext.Array.insert(G,Ext.Array.indexOf(G,U)+1,[I])}else{G.push(I)}}y.resumeSegmentsTracking();P&&P(function(){y.rollbackSegmentsToSnapshot(R)});if(!U){y.setSegmentsWithoutPropagation(G)}else{y.onSegmentsChanged(null,null)}return true},merge:function(e,f,g){var h=this;h.propagateChanges(function(){return h.mergeWithoutPropagation(e,f)},g)},mergeWithoutPropagation:function(h,f){if(!this.isSegmented()||!h||!f){return}var g,e;if(h.getStartOffset()>f.getStartOffset()){g=f;e=h}else{g=h;e=f}g.setEndDateWithoutPropagation(e.getEndDate(),false);return true},suspendSegmentsTracking:function(){this.segmentsTrackingSuspended++},resumeSegmentsTracking:function(){this.segmentsTrackingSuspended--},getSegmentsDuration:function(j){j=j||this.getDurationUnit();var g=this.getSegments();var i=0;for(var l=0,h=g.length;l<h;l++){var k=g[l];i+=k.getEndOffset()-k.getStartOffset()}return this.getUnitConverter().convertMSDurationToUnit(i,j)},mergeOverlappedSegments:function(j){var h=this.getSegments();if(h){var m=[],l=h[0],k;for(var n=1,i=h.length;n<i;n++){k=h[n];if(k.getStartOffset()<=l.getEndOffset()){m.push(k);if(k.getEndOffset()>l.getEndOffset()){l.setEndDateWithoutPropagation(k.getEndDate(),false)}}else{l=k}}this.removeSegments(m);if(h.length<2&&!j){this.setSegmentsWithoutPropagation(null)}}},onSegmentEditBegin:function(b){this.getTreeStore().onSegmentEditBegin(this,b);this.snapshotSegments()},onSegmentEditEnd:function(b){this.getTreeStore().onSegmentEditEnd(this,b)},onSegmentsChanged:function(f,d){if(this.segmentsTrackingSuspended){return}this.changingTaskBySegments=true;this.suspendSegmentsTracking();this.mergeOverlappedSegments(true);if(f&&d&&f.durationField in d){this.setDurationWithoutPropagation(this.getSegmentsDuration())}else{if(this.getSchedulingMode()=="EffortDriven"){this.setStartEndDateWithoutPropagation(this.getStartDate(),this.recalculateEndDate())}else{this.setStartDateWithoutPropagation(this.getStartDate())}}var e=this.getSegments();this.set(this.segmentsField,e&&e.slice()||null);this.resumeSegmentsTracking();this.changingTaskBySegments=false},removeSegments:function(g){var e=this.getSegments();if(!e||!g||!g.length){return}if(!Ext.isArray(g)){g=[g]}for(var h=0,f=g.length;h<f;h++){Ext.Array.remove(e,g[h])}this.onSegmentsChanged()},setSegments:function(d,f){var e=this;e.propagateChanges(function(){return e.setSegmentsWithoutPropagation(d)},f)},setSegmentsWithoutPropagation:function(b){this.onSegmentEditBegin();this.suspendSegmentsTracking();this.set(this.segmentsField,this.processSegmentsValue(b));this.resumeSegmentsTracking();this.onSegmentsChanged();this.onSegmentEditEnd();return true},processSegmentsValue:function(i){var g,j,k;if(i){i=[].concat(i);g=[];for(var l=0,h=i.length;l<h;l++){j=i[l];if(!(j instanceof Gnt.model.TaskSegment)){j=Ext.create(this.segmentClassName,Ext.apply(j,{task:this}))}g.push(j);k=j}i=g&&g.length>1&&g||null}return i},isSegmented:function(){return Boolean(this.getSegments())},getSegment:function(b){return this.getSegments()[b]},rejectSegmentsProjection:function(){var g=this.getTaskStore(true).getProjectionLevel();var e,h;if(this.segmentsProjection){var f;for(h=g;h>=0;h--){if(e=this.segmentsProjection[h]){f=h;break}}if(f===g){delete this.segmentsProjection[f]}}if(e){this.rollbackSegmentsToSnapshot(e)}},commitSegmentsProjection:function(){var d=this.getTaskStore(true),c=d&&d.getProjectionLevel();if(this.segmentsProjection){delete this.segmentsProjection[c]}},rollbackSegmentsToSnapshot:function(b){this.data[this.segmentsField]=b&&Ext.Array.map(b,function(a){return a&&a[0].readSnapshot(a)})},buildSegmentsSnapshot:function(b){b=b||this.getSegments();return b&&Ext.Array.map(b,function(a){return a&&a.buildSnapshot()})},snapshotSegments:function(){var h=this.getTaskStore(true),e=this.getSegments(),g=h&&h.getProjectionLevel(),f;if(g){this.segmentsProjection=this.segmentsProjection||{};f=this.segmentsProjection[g-1];if(!f){f=this.buildSegmentsSnapshot(e);this.segmentsProjection[g-1]=f}}if(!this.segmentsSnapshot){this.segmentsSnapshot=f||this.buildSegmentsSnapshot(e)}},commitSegments:function(){if(this.rejecting){return}this.segmentsSnapshot=null;var d=this.getSegments();if(d){for(var f=0,e=d.length;f<e;f++){d[f].commit()}}},rejectSegments:function(){this.rollbackSegmentsToSnapshot(this.segmentsSnapshot);this.segmentsSnapshot=null;var d=this.getSegments();if(d){for(var f=0,e=d.length;f<e;f++){d[f].reject()}}}});Ext.define("Gnt.model.Task",{extend:Sch.model.Range,alias:"gntmodel.event",mixins:[Gnt.model.mixin.ProjectableModel,Gnt.model.task.More,Gnt.model.task.Constraints,Gnt.model.task.Splittable],segmentClassName:"Gnt.model.TaskSegment",idProperty:"Id",customizableFields:[{name:"Duration",type:"number",allowNull:true},{name:"Effort",type:"number",allowNull:true},{name:"EffortUnit",type:"string",defaultValue:"h"},{name:"CalendarId",type:"string"},{name:"Note",type:"string"},{name:"DurationUnit",type:"string",defaultValue:"d",convert:function(b){return b||"d"}},{name:"PercentDone",type:"number",defaultValue:0},{name:"ConstraintType",type:"string",defaultValue:""},{name:"ConstraintDate",type:"date",dateFormat:"c"},{name:"ManuallyScheduled",type:"boolean",defaultValue:false},{name:"SchedulingMode",type:"string",defaultValue:"Normal"},{name:"BaselineStartDate",type:"date",dateFormat:"c"},{name:"BaselineEndDate",type:"date",dateFormat:"c"},{name:"BaselinePercentDone",type:"int",defaultValue:0},{name:"Draggable",type:"boolean",persist:false,defaultValue:true},{name:"Resizable",persist:false,defaultValue:""},{name:"ReadOnly",persist:false,type:"bool",defaultValue:false},{name:"Rollup",type:"boolean",defaultValue:false},{name:"Segments",persist:true,convert:function(c,d){return d.processSegmentsValue(c,d)},serialize:function(b){if(!b){return null}return Ext.Array.map([].concat(b),function(a){return a.serialize()})}},{name:"PhantomId",type:"string"},{name:"PhantomParentId",type:"string"},{name:"ShowInTimeline",type:"bool"},{name:"DeadlineDate",type:"date",dateFormat:"c"},{name:"index",type:"int",persist:true}],constraintTypeField:"ConstraintType",constraintDateField:"ConstraintDate",draggableField:"Draggable",resizableField:"Resizable",nameField:"Name",durationField:"Duration",durationUnitField:"DurationUnit",effortField:"Effort",effortUnitField:"EffortUnit",percentDoneField:"PercentDone",manuallyScheduledField:"ManuallyScheduled",schedulingModeField:"SchedulingMode",rollupField:"Rollup",calendarIdField:"CalendarId",baselineStartDateField:"BaselineStartDate",baselineEndDateField:"BaselineEndDate",baselinePercentDoneField:"BaselinePercentDone",noteField:"Note",segmentsField:"Segments",readOnlyField:"ReadOnly",calendar:null,dependencyStore:null,taskStore:null,phantomIdField:"PhantomId",phantomParentIdField:"PhantomParentId",showInTimelineField:"ShowInTimeline",deadlineDateField:"DeadlineDate",normalized:false,recognizedSchedulingModes:["Normal","FixedDuration","EffortDriven","DynamicAssignment"],convertEmptyParentToLeaf:true,autoCalculateEffortForParentTask:true,autoCalculatePercentDoneForParentTask:true,isHighlighted:false,calendarWaitingListener:null,childTasksDuration:null,completedChildTasksDuration:null,totalCount:null,predecessors:null,successors:null,removeChildIsCalledFromReplaceChild:false,savedDirty:null,useOwnCalendarAsConverter:false,constructor:function(){this._singleProp={};this.initProjectable();this.callParent(arguments);if(this.phantom){this.data[this.phantomIdField]=this.getId()}if(this.id==="root"){this.convertEmptyParentToLeaf=false}this.predecessors=[];this.successors=[]},normalize:function(){var w=this.getDurationUnit(),B=this.getStartDate(),x=this.getEndDate(),z=this.data,u=this.getTaskStore(true),y=this.getSchedulingMode();if(y=="Manual"){y=z[this.schedulingModeField]="Normal";z[this.manuallyScheduledField]=true}var C=this.endDateField;if(u&&this.isSegmented()){this.normalizeSegments();var r;if(r=this.getLastSegment()){x=z[C]=r.getEndDate()}}var A=this.getDuration();var t=this.effortField;if(x&&this.inclusiveEndDate){var s=this.getField(C).dateFormat;var D=(s&&!Ext.Date.formatContainsHourInfo(s))||(x.getHours()===0&&x.getMinutes()===0&&x.getSeconds()===0&&x.getMilliseconds()===0);if(D){if(Ext.isNumber(A)){x=z[C]=this.calculateEndDate(B,A,w)}else{x=z[C]=Ext.Date.add(x,Ext.Date.DAY,1)}}}if(A==null&&B&&x){A=z[this.durationField]=this.calculateDuration(B,x,w)}if((y=="Normal"||this.isManuallyScheduled())&&x==null&&B&&Ext.isNumber(A)){x=z[C]=this.calculateEndDate(B,A,w)}var p=this.get(t),v=this.getEffortUnit();switch(y){case"FixedDuration":if(x==null&&B&&Ext.isNumber(A)){x=z[C]=this.calculateEndDate(B,A,w)}if(p==null&&B&&x){z[t]=this.calculateEffort(B,x,v)}break;case"EffortDriven":if(p==null&&B&&x){z[t]=this.calculateEffort(B,x,v)}if(x==null&&B&&p){z[C]=this.calculateEffortDrivenEndDate(B,p,v);if(A==null){z[this.durationField]=this.calculateDuration(B,z[C],w)}}break;default:if(x==null&&B&&Ext.isNumber(A)){x=z[C]=this.calculateEndDate(B,A,w)}break}var q=this.getCalendarId();if(q){this.setCalendarId(q,true)}this.normalized=true},getUnitConverter:function(){return this.useOwnCalendarAsConverter&&this.getCalendar()||this.getProjectCalendar()},normalizeParent:function(){var i=this.childNodes;var v=0;var s=0;var o=0;var n=this.autoCalculatePercentDoneForParentTask;var q=this.autoCalculateEffortForParentTask;for(var r=0;r<i.length;r++){var t=i[r];var u=t.isLeaf();if(!u){t.normalizeParent()}if(q){v+=t.getEffort("MILLI")}if(n){var m=u?t.getDuration("MILLI")||0:t.childTasksDuration;s+=m;o+=u?m*(t.getPercentDone()||0):t.completedChildTasksDuration}}if(n){this.childTasksDuration=s;this.completedChildTasksDuration=o;var p=s?o/s:0;if(this.getPercentDone()!=p){this.data[this.percentDoneField]=p}}if(q){if(this.getEffort("MILLI")!=v){this.data[this.effortField]=this.getUnitConverter().convertMSDurationToUnit(v,this.getEffortUnit())}}},getCalendar:function(b){return b?this.getOwnCalendar():this.getOwnCalendar()||this.parentNode&&this.parentNode.getCalendar()||this.getProjectCalendar()},getOwnCalendar:function(){var b=this.get(this.calendarIdField);return b?Gnt.data.Calendar.getCalendar(b):this.calendar},getProject:function(){var d=this,c=null;this.bubble(function(a){if(d!==a&&a.isProject){c=a;return false}},this);return c},getProjectCalendar:function(){var d=this.getTaskStore(true);var c=d&&d.getCalendar()||this.parentNode&&this.parentNode.getProjectCalendar()||this.isRoot()&&this.calendar;if(!c){Ext.Error.raise("Can't find a project calendar in `getProjectCalendar`")}return c},setCalendar:function(h,g){var e=this,f=h instanceof Gnt.data.Calendar;if(f&&!h.calendarId){throw new Error("Can't set calendar w/o `calendarId` property")}return e.setCalendarId(f?h.calendarId:h,false,g)},setCalendarId:function(e,h,g){var f=this;if(!h){f.propagateChanges(function(){return f.setCalendarIdWithoutPropagation(e,h)},g)}else{f.setCalendarIdWithoutPropagation(e,h)}},onCalendarChange:function(b){if(!this.isReadOnly()){this.adjustToCalendarWithoutPropagation()}},setCalendarIdWithoutPropagation:function(m,l){var i=false;if(m instanceof Gnt.data.Calendar){m=m.calendarId}var n=this.getCalendarId();if(n!=m||l){i=true;if(this.calendarWaitingListener){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null}var h={calendarchange:this.onCalendarChange,scope:this};var j=this.calendar||Gnt.data.Calendar.getCalendar(n);this.calendar=null;j&&j.un(h);this.set(this.calendarIdField,m);var k=Gnt.data.Calendar.getCalendar(m);if(k){k.on(h);if(!l){this.onCalendarChange()}}else{this.calendarWaitingListener=Ext.data.StoreManager.on("add",function(){k=Gnt.data.Calendar.getCalendar(m);if(k){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null;k.on(h);this.onCalendarChange()}},this,{destroyable:true})}}return i},getDependencyStore:function(){var c=this.getTaskStore(true),d=c&&c.getDependencyStore();return d},getResourceStore:function(){var b=this.getTaskStore(true);return b&&b.getResourceStore()},getAssignmentStore:function(){var b=this.getTaskStore(true);return b&&b.getAssignmentStore()},getTaskStore:function(d){var c=this;if(!c.taskStore){c.taskStore=c.getTreeStore()||c.parentNode&&c.parentNode.getTaskStore(d)}if(!c.taskStore&&!d){Ext.Error.raise("Can't find a taskStore in `getTaskStore`")}return c.taskStore},getEventStore:function(){return this.getTaskStore()},setTaskStore:function(b){this.taskStore=b},isManuallyScheduled:function(){return this.get(this.schedulingModeField)==="Manual"||this.get(this.manuallyScheduledField)},isShowInTimeline:function(){return Boolean(this.getShowInTimeline())},setManuallyScheduled:function(d,f){var e=this;e.propagateChanges(function(){return e.setManuallyScheduledWithoutPropagation(d)},f)},setManuallyScheduledWithoutPropagation:function(f){var d=this,e;if(d.isManuallyScheduled()!=f){this.set(d.manuallyScheduledField,f);if(!f){e=d.getPredecessors()[0]}e=e||d}return e},setSchedulingMode:function(d,f){var e=this;e.propagateChanges(function(){return e.setSchedulingModeWithoutPropagation(d)},f)},setSchedulingModeWithoutPropagation:function(h){var e=this,f;if(e.getSchedulingMode()!=h){e.set(this.schedulingModeField,h);switch(h){case"FixedDuration":e.updateEffortBasedOnDuration();break;case"EffortDriven":e.updateSpanBasedOnEffort();break}var g=e.getPredecessors();if(g.length){f=g[0]}else{f=e}}return f},skipWorkingTime:function(m,k,l,n){var i;var j;l=l!==false;var h={isForward:l,segments:n||false,resources:this.hasResources(),fn:function(a,b){var c=b-a,d=new Date(a).getTimezoneOffset()-new Date(b).getTimezoneOffset();if(c>=j){i=new Date((l?a:b)-0+(l?1:-1)*j);return false}else{j-=c+d*60*1000}}};if(Ext.isObject(m)){Ext.apply(h,m)}else{if(l){h.startDate=m}else{h.endDate=m}}j=k||h.duration;if(!j){return m}this.forEachAvailabilityInterval(h);return i},skipNonWorkingTime:function(i,h,j){var f=false;h=h!==false;var g={isForward:h,segments:j||false,resources:this.hasResources(),fn:function(a,b){if(a!==b){i=h?a:b;f=true;return false}}};if(Ext.isObject(i)){Ext.apply(g,i)}else{if(h){g.startDate=i}else{g.endDate=i}}this.forEachAvailabilityInterval(g);return f?new Date(i):this.getCalendar().skipNonWorkingTime(i,h)},setStartDate:function(g,h,i,j){var f=this;f.propagateChanges(function(){return f.setStartDateWithoutPropagation(g,h,i)},j)},setStartDateWithoutPropagation:function(h,j,k){var n=this,i=n.getTaskStore(true),l,m;j=j!==false;if(i&&k!==true&&k!==false){k=i.skipWeekendsDuringDragDrop}else{if(k!==true&&k!==false){k=false}}n.beginEdit();if(!h){n.set(n.durationField,null);n.set(n.startDateField,null);n.setSegmentsWithoutPropagation(null)}else{if(k){h=n.skipNonWorkingTime(h,!n.isMilestone())}n.set(n.startDateField,h);if(i&&n.isSegmented()){n.updateSegmentsDates()}if(j!==false){n.set(n.endDateField,n.recalculateEndDate(h))}else{m=this.getEndDate();if(m){this.constrainSegments();n.set(n.durationField,n.calculateDuration(h,m,n.getDurationUnit()))}}}l=n.getDuration();m=n.getEndDate();if(h&&m&&(l===undefined||l===null)){n.set(n.durationField,n.calculateDuration(h,m,n.getDurationUnit()))}n.onPotentialEffortChange();n.endEdit();return true},setEndDate:function(g,h,i,j){var f=this;f.propagateChanges(function(){return f.setEndDateWithoutPropagation(g,h,i)},j)},setEndDateWithoutPropagation:function(p,r,q){var l=this,k=l.getTaskStore(true),n,s;r=r!==false;if(q!==true&&q!==false&&k){q=k.skipWeekendsDuringDragDrop}else{if(q!==true&&q!==false){q=false}}l.beginEdit();var m=l.getEndDate();if(!p){l.set(l.durationField,null);l.set(l.endDateField,null);l.setSegments(null)}else{s=l.getStartDate();if(p<s&&r===false){p=s}if(q){p=l.skipNonWorkingTime(p,false)}if(r!==false){n=l.getDuration();if(Ext.isNumber(n)){if(k&&l.isSegmented()&&(p-m)){l.updateSegmentsDates({isForward:false,endDate:p})}l.set(l.startDateField,l.calculateStartDate(p,n,l.getDurationUnit()));l.set(l.endDateField,p)}else{l.set(l.endDateField,p)}}else{var o=l.isMilestone();if(p<s){l.set(l.startDateField,p)}l.set(l.endDateField,p);l.constrainSegments();if(s){l.set(l.durationField,l.calculateDuration(s,p,l.getDurationUnit()));if(o&&!l.isMilestone()){var t=l.skipNonWorkingTime(s,true);if(t-s!==0){l.set(l.startDateField,t)}}}}}n=l.getDuration();s=l.getStartDate();if(p&&s&&(n===undefined||n===null)){l.set(l.durationField,l.calculateDuration(s,p,l.getDurationUnit()))}l.onPotentialEffortChange();l.endEdit();return true},setStartEndDate:function(g,j,h,i){var f=this;h=h||false;f.propagateChanges(function(){return f.setStartEndDateWithoutPropagation(g,j,h)},i)},setStartEndDateWithoutPropagation:function(i,l,j){var n=this,h=n.getTaskStore(true);if(j!==true&&j!==false&&h){j=h.skipWeekendsDuringDragDrop}else{if(j!==true&&j!==false){j=false}}if(j){i=i&&n.skipNonWorkingTime(i,true);l=l&&n.skipNonWorkingTime(l,false);if(l<i){i=l}}var k=n.getStartDate(),m=n.getEndDate();n.beginEdit();n.set(n.startDateField,i);n.set(n.endDateField,l);if(n.getTaskStore(true)&&n.isSegmented()&&((i-k)||(l-m))){n.updateSegmentsDates()}if(l-m){n.constrainSegments()}n.set(n.durationField,n.calculateDuration(i,l,n.getDurationUnit()));n.onPotentialEffortChange();n.endEdit();return true},shift:function(k,g,i){var l=this,h=l.getStartDate(),j=l.getEndDate();l.setStartEndDate(h&&Sch.util.Date.add(h,k,g),j&&Sch.util.Date.add(j,k,g),undefined,i)},getDuration:function(d){if(!d){return this.get(this.durationField)}var e=this.getUnitConverter(),f=e.convertDurationToMs(this.get(this.durationField),this.get(this.durationUnitField));return e.convertMSDurationToUnit(f,d)},getEffort:function(e){var h=this.get(this.effortField)||0;if(!e){return h}var f=this.getUnitConverter(),g=f.convertDurationToMs(h,this.getEffortUnit());return f.convertMSDurationToUnit(g,e)},setEffort:function(h,e,g){var f=this;f.propagateChanges(function(){return f.setEffortWithoutPropagation(h,e)},g)},setEffortWithoutPropagation:function(f,d){var e=this;d=d||e.getEffortUnit();e.beginEdit();e.set(e.effortField,f);e.set(e.effortUnitField,d);switch(e.getSchedulingMode()){case"EffortDriven":e.updateSpanBasedOnEffort();break;case"DynamicAssignment":e.updateAssignments();break}e.endEdit();return true},getCalendarDuration:function(b){return this.getUnitConverter().convertMSDurationToUnit(this.getEndDate()-this.getStartDate(),b||this.get(this.durationUnitField))},setDuration:function(h,e,g){var f=this;f.propagateChanges(function(){return f.setDurationWithoutPropagation(h,e)},g)},setDurationWithoutPropagation:function(u,n){var o=this;var m=!o.isManuallyScheduled()&&o.hasEndPredecessorsButNoStartPredecessors();var r=null;var w=null;var s=o.getEndDate();n=n||o.getDurationUnit();var t=o.isMilestone();o.beginEdit();if(Ext.isNumber(u)&&!o.getStartDate()){if(s){m=true}else{var p=o.getTaskStore(true);w=(p&&p.getProjectStartDate())||Ext.Date.clearTime(new Date());o.setStartDateWithoutPropagation(w)}}this.constrainSegments({duration:u,unit:n});if(Ext.isNumber(u)){if(m&&o.getEndDate()){w=o.calculateStartDate(o.getEndDate(),u,n)}else{r=o.calculateEndDate(o.getStartDate(),u,n)}}if(!m&&(r||this.getStartDate())){o.set(o.endDateField,r)}if(m&&(w||this.getEndDate())){o.set(o.startDateField,w)}o.set(o.durationField,u);o.set(o.durationUnitField,n);if(o.isMilestone()!=t){if(t){var v=o.getStartDate();if(v){var x=o.skipNonWorkingTime(v,true);if(x-v!==0){o.set(o.startDateField,x)}}}else{if(r){var q=o.skipNonWorkingTime(r,false);if(q-r!==0){o.set(o.startDateField,q);o.set(o.endDateField,q)}}}}o.onPotentialEffortChange();o.endEdit();return true},calculateStartDate:function(k,l,m,o){if(!l){return k}m=m||this.getDurationUnit();var n=this.getSchedulingMode(),p=n!="FixedDuration"&&n!="DynamicAssignment"&&n!="EffortDriven";o=Ext.apply({endDate:k,isForward:false,resources:p&&this.hasResources()},o);if(this.getTaskStore(true)&&(this.isSegmented()||p)){var i=this.getUnitConverter().convertDurationToMs(l,m);var j;this.forEachAvailabilityInterval(o,function(a,c){var b=c-a;if(b>=i){j=new Date(c-i);return false}else{var d=new Date(c).getTimezoneOffset()-new Date(a).getTimezoneOffset();i-=b+d*60*1000}});return j}else{return this.getCalendar().calculateStartDate(k,l,m)}},recalculateEndDate:function(e){var h=this,f,g;e=e||h.getStartDate();if(e&&h.getSchedulingMode()=="EffortDriven"){f=h.calculateEffortDrivenEndDate(e,h.getEffort())}else{g=h.getDuration();if(e&&Ext.isNumber(g)){f=h.calculateEndDate(e,g,h.getDurationUnit())}else{f=h.getEndDate()}}return f},calculateEndDate:function(j,k,m,o){m=m||this.getDurationUnit();if(!k){return j}o=Ext.apply({startDate:j},o);var n=this.getSchedulingMode(),l;var p=n!="FixedDuration"&&n!="DynamicAssignment"&&n!="EffortDriven";if(this.getTaskStore(true)&&(this.isSegmented()||p)){var i=this.getUnitConverter().convertDurationToMs(k,m);o.resources=p&&this.hasResources();this.forEachAvailabilityInterval(o,function(a,b){var c=b-a;if(c>=i){l=new Date(a+i);return false}else{var d=new Date(a).getTimezoneOffset()-new Date(b).getTimezoneOffset();i-=c+d*60*1000}})}else{return this.getCalendar().calculateEndDate(j,k,m)}return l},calculateDuration:function(g,i,j,f){j=j||this.getDurationUnit();if(!g||!i){return 0}if(this.getTaskStore(true)){var h=0;this.forEachAvailabilityInterval(Ext.apply({startDate:g,endDate:i,resources:this.hasResources()},f),function(a,b){var c=new Date(a).getTimezoneOffset()-new Date(b).getTimezoneOffset();h+=b-a+c*60*1000});return this.getUnitConverter().convertMSDurationToUnit(h,j)}else{return this.getCalendar().calculateDuration(g,i,j)}},isCalendarApplicable:function(i){var q=this.getStartDate();if(!q){return true}var k=this.getTaskStore(true);if(!k){return true}var l=Sch.util.Date.add(q,"d",(k&&k.availabilitySearchLimit)||5*365);var r=this.getAssignments();var p=[];Ext.Array.each(r,function(a){var b=a.getResource();if(b){p.push(b.getCalendar())}});if(!p.length){return true}var n=Gnt.data.Calendar.getCalendar(i);for(var m=0,o=p.length;m<o;m++){if(n.isAvailabilityIntersected(p[m],q,l)){return true}}return false},forEachAvailabilityInterval:function(av,aB,aj){aB=aB||av.fn;aj=aj||av.scope||this;var aD=this,aL=av.startDate,ay=av.endDate,aq=av.includeEmptyIntervals,k=av.resources,ag=av.segments||(av.segments!==false),aC=av.isForward!==false,aH=Sch.util.Date,aw,aI;var aQ=this.getTaskStore(true);var m,n,ab,aO,at,aP;if(aC){if(!aL){throw new Error("forEachAvailabilityInterval: `startDate` is required when `isForward` is true")}if(!ay){ay=aH.add(aL,"d",av.availabilitySearchLimit||(aQ&&aQ.availabilitySearchLimit)||5*365)}aw=new Date(aL)}else{if(!ay){throw new Error("forEachAvailabilityInterval: `endDate` is required when `isForward` is false")}if(!aL){aL=aH.add(ay,"d",-(av.availabilitySearchLimit||(aQ&&aQ.availabilitySearchLimit)||5*365))}aw=new Date(ay)}var ao=this.getOwnCalendar(),l=this.getProjectCalendar(),aK={},ax=[];if(k){var am=false;var aF=av.assignments;var aE=function(d){var e=d.getId(),b=aF&&Ext.Array.findBy(aF,function(f){return f.getResourceId()==e})||aD.getAssignmentFor(d),c=d.getCalendar(),a=c.getCalendarId();if(!aK[a]){aK[a]=[];ax.push(c)}aK[a].push({assignment:b,resourceId:e,units:b&&b.getUnits()});am=true};if(k!==true){Ext.each(k,aE)}else{Ext.Array.each(this.getAssignments(),function(a){var b=a.getResource();if(b){aE(b)}})}if(!am){return}}else{ao=ao||l}var af,az,i;if(ag){if(!Ext.isArray(ag)){aI=this.getSegments()}else{aI=ag}if(aI){af=[];for(m=0,ab=aI.length;m<ab-1;m++){az=aI[m].getEndDate()-0;i=aI[m+1].getStartDate()-0;if(az>aL||i<ay){af.push([aI[m].getEndDate()-0,aI[m+1].getStartDate()-0])}}if(!af.length){af=null}}}while(aC?aw<ay:aw>aL){var au={};var aJ=[];var al=aw-(aC?0:1);if(ao){var ak=ao.getAvailabilityIntervalsFor(al);for(n=0,ab=ak.length;n<ab;n++){aO=ak[n];at=aO.startDate-0;aP=aO.endDate-0;if(!au[at]){au[at]=[];aJ.push(at)}au[at].push({type:"00-taskAvailailabilityStart",typeBackward:"01-taskAvailailabilityStart"});aJ.push(aP);au[aP]=au[aP]||[];au[aP].push({type:"01-taskAvailailabilityEnd",typeBackward:"00-taskAvailailabilityEnd"})}}if(af){var aG,aM;if(aC){aG=aw;aM=aH.getStartOfNextDay(aw)}else{aG=aH.getEndOfPreviousDay(aw);aM=aw}for(m=0,ab=af.length;m<ab;m++){az=af[m][0];i=af[m][1];if(az<aM&&i>aG){az=aH.constrain(az,aG,aM)-0;i=aH.constrain(i,aG,aM)-0;if(!au[az]){au[az]=[];aJ.push(az)}au[az].push({type:"05-taskSegmentEnd",typeBackward:"04-taskSegmentEnd"});if(!au[i]){au[i]=[];aJ.push(i)}au[i].push({type:"04-taskSegmentStart",typeBackward:"05-taskSegmentStart"});break}}}var aa;for(m=0,ab=ax.length;m<ab;m++){var ah=ax[m],ar=ah.getAvailabilityIntervalsFor(al);aa=aK[ah.getCalendarId()];for(n=0;n<ar.length;n++){aO=ar[n];at=aO.startDate-0;aP=aO.endDate-0;if(!au[at]){au[at]=[];aJ.push(at)}au[at].push({type:"02-resourceAvailailabilityStart",typeBackward:"03-resourceAvailailabilityStart",resources:aa});if(!au[aP]){au[aP]=[];aJ.push(aP)}au[aP].push({type:"03-resourceAvailailabilityEnd",typeBackward:"02-resourceAvailailabilityEnd",resources:aa})}}aJ.sort(function(a,b){return a-b});var aN=false,aA=true,ac={},an=0,ai,ap,ad,ae;if(aC){for(m=0,ab=aJ.length;m<ab;m++){ai=au[aJ[m]];ai.sort(function(a,b){return a.type<b.type?1:-1});for(n=0;n<ai.length;n++){ap=ai[n];switch(ap.type){case"00-taskAvailailabilityStart":aN=true;break;case"01-taskAvailailabilityEnd":aN=false;break;case"02-resourceAvailailabilityStart":aa=ap.resources;for(ad=0,ae=aa.length;ad<ae;ad++){ac[aa[ad].resourceId]=aa[ad];an++}break;case"03-resourceAvailailabilityEnd":aa=ap.resources;for(ad=0,ae=aa.length;ad<ae;ad++){delete ac[aa[ad].resourceId];an--}break;case"04-taskSegmentStart":aA=true;break;case"05-taskSegmentEnd":aA=false;break}}if((aN||!ao)&&(!af||aA)&&(!k||an||aq)){at=aJ[m];aP=aJ[m+1];if(at>=ay||aP<=aL){continue}if(at<aL){at=aL-0}if(aP>ay){aP=ay-0}if(aB.call(aj,at,aP,ac)===false){return false}}}}else{for(m=aJ.length-1;m>=0;m--){ai=au[aJ[m]];ai.sort(function(a,b){return a.typeBackward<b.typeBackward?1:-1});for(n=0;n<ai.length;n++){ap=ai[n];switch(ap.typeBackward){case"00-taskAvailailabilityEnd":aN=true;break;case"01-taskAvailailabilityStart":aN=false;break;case"02-resourceAvailailabilityEnd":aa=ap.resources;for(ad=0,ae=aa.length;ad<ae;ad++){ac[aa[ad].resourceId]=aa[ad];an++}break;case"03-resourceAvailailabilityStart":aa=ap.resources;for(ad=0,ae=aa.length;ad<ae;ad++){delete ac[aa[ad].resourceId];an--}break;case"04-taskSegmentEnd":aA=true;break;case"05-taskSegmentStart":aA=false;break}}if((aN||!ao)&&(!af||aA)&&(!k||an||aq)){at=aJ[m-1];aP=aJ[m];if(at>ay||aP<=aL){continue}if(at<aL){at=aL-0}if(aP>ay){aP=ay-0}if(aB.call(aj,at,aP,ac)===false){return false}}}}aw=aC?aH.getStartOfNextDay(aw):aH.getEndOfPreviousDay(aw)}},forEachAvailabilityIntervalWithResources:function(e,f,d){if(!e.resources){e.resources=true}this.forEachAvailabilityInterval.apply(this,arguments)},calculateEffortDrivenEndDate:function(g,j,f){if(!j){return g}var h=this.getUnitConverter().convertDurationToMs(j,f||this.getEffortUnit());var i=new Date(g);this.forEachAvailabilityIntervalWithResources({startDate:g},function(b,c,d){var a=0;for(var e in d){a+=d[e].units}var n=c-b;var o=a*n/100;if(o>=h){i=new Date(b+h/o*n);return false}else{h-=o}});return i},refreshCalculatedParentNodeData:function(){var z=this.autoCalculatePercentDoneForParentTask;var J=this.autoCalculateEffortForParentTask;var R=this.childNodes;var O=R.length;var M={};if(O>0&&(J||z)){var K=0;var E=0;var C=0;for(var B=0;B<O;B++){var Q=R[B];if(Q.parentNode){var r=Q.isLeaf();if(J){K+=Q.getEffort("MILLI")}if(z){var P=r?Q.getDuration("MILLI")||0:Q.childTasksDuration;E+=P;C+=r?P*(Q.getPercentDone()||0):Q.completedChildTasksDuration}}}if(J&&this.getEffort("MILLI")!=K){M.Effort=true;this.setEffortWithoutPropagation(this.getUnitConverter().convertMSDurationToUnit(K,this.getEffortUnit()))}if(z){this.childTasksDuration=E;this.completedChildTasksDuration=C;var D=E?C/E:0;if(this.getPercentDone()!=D){M.PercentDone=true;this.setPercentDone(D)}}}var N,G;if(!this.isRoot()&&O>0&&!this.isManuallyScheduled()&&!this.isReadOnly()){var L=new Date(-8640000000000000),I=new Date(+8640000000000000),H=new Date(+8640000000000000),i=new Date(-8640000000000000);for(var A=0;A<O;A++){var F=R[A];H=Sch.util.Date.min(H,F.getStartDate()||H);i=Sch.util.Date.max(i,F.getEndDate()||i)}if(i<H&&H<I&&i>L){var k;k=i;i=H;H=k}N=M.StartDate=H-I!==0&&this.getStartDate()-H!==0;G=M.EndDate=i-L!==0&&this.getEndDate()-i!==0;if(N&&G){this.setStartEndDateWithoutPropagation(H,i,false)}else{if(N){this.setStartDateWithoutPropagation(H,false,false)}else{if(G){this.setEndDateWithoutPropagation(i,false,false)}}}}return M},recalculateParents:function(){var b=this.parentNode;b&&(b.refreshCalculatedParentNodeData(),!this.getTaskStore().cascading&&b.recalculateParents())},isMilestone:function(d){if(d){return this.isBaselineMilestone()}if(!this.get("leaf")){var e=this.getStartDate(),f=this.getEndDate();if(e&&f){return f-e===0}}return this.getDuration()===0},convertToMilestone:function(c){var d=this;d.propagateChanges(function(){return d.convertToMilestoneWithoutPropagation()},c)},convertToMilestoneWithoutPropagation:function(){var c=this,d=false;if(!c.isMilestone()){d=c.setStartDateWithoutPropagation(c.getEndDate(),false);d=d&&c.setDurationWithoutPropagation(0)}return d},convertToRegular:function(c){var d=this;d.propagateChanges(function(){return d.convertToRegularWithoutPropagation()},c)},convertToRegularWithoutPropagation:function(){var g=this,e=false,h,f;if(g.isMilestone()){h=g.get(g.durationUnitField);f=g.calculateStartDate(g.getStartDate(),1,h);e=g.setDurationWithoutPropagation(1,h);e=e&&g.setStartDateWithoutPropagation(f,true,false,false)}return e},isBaselineMilestone:function(){var c=this.getBaselineStartDate(),d=this.getBaselineEndDate();if(c&&d){return d-c===0}return false},markAsParent:function(){var b=this;b.isSegmented()&&b.setSegmentsWithoutPropagation(null);b.set("leaf",false)},getDurationUnit:function(){return this.get(this.durationUnitField)||"d"},getEffortUnit:function(){return this.get(this.effortUnitField)||"h"},getBaselinePercentDone:function(){return this.get(this.baselinePercentDoneField)||0},isPersistable:function(){var b=this.parentNode;return !b||!b.phantom||b.isRoot()},getResources:function(){var d=this,c=d.getAssignmentStore();return c&&c.getResourcesForEvent(d)||[]},getAssignments:function(){var d=this,c=d.getAssignmentStore();return c&&c.getAssignmentsForTask(d)||[]},hasAssignments:function(){return this.getAssignments().length>0},hasResources:function(){var h=this.getAssignments(),e=false,g,f;for(g=0,f=h.length;!e&&g<f;g++){e=!!h[g].getResource()}return e},getAssignmentFor:function(d){var e=this,f=e.getAssignmentStore();return f&&f.getAssignmentForEventAndResource(e,d)||null},isAssignedTo:function(d){var e=this,f=e.getAssignmentStore();return f&&f.isTaskAssignedToResource(e,d)||false},assign:function(l,h,j){var m=this,i,n;m.propagateChanges(function(){return m.assignWithoutPropagation(l,h,function a(b,c){n=b;i=c})},function k(a,b){a&&n&&n();j&&j(a,b)});return i},assignWithoutPropagation:function(u,q,r){var p=this,l=[],o=p.getTaskStore(),s=o.getAssignmentStore(),m=o.getResourceStore(),v,t;q=q||100;!p.getAssignmentFor(u)||Ext.Error.raise("Resource can't be assigned twice to the same task");if(u instanceof Gnt.model.Resource&&m.indexOf(u)==-1){t=u.getId();m.add(u);l.push(function(){m.remove(u)})}else{if(u instanceof Gnt.model.Resource){t=u.getId()}else{if(m.indexOfId(u)>=0){t=u}else{var n=false}}}v=s.assignTaskToResource(p,t,q);l.push(function(){s.unassignTaskFromResource(p,t)});r&&r(function(){Ext.Array.each(l,function(a){a()})},v[0]);return true},unassign:function(){return this.unAssign.apply(this,arguments)},unAssign:function(j,h){var f=this,g;f.propagateChanges(function(){return f.unassignWithoutPropagation(j,function a(b){g=b})},function i(a,b){a&&g&&g();h&&h(a,b)})},unassignWithoutPropagation:function(n,i){var h=this,j=n instanceof Gnt.model.Resource?n.getId():n,m=h.getAssignmentStore(),k=h.getAssignmentFor(j),l;l=m.indexOf(k);m.unassignTaskFromResource(h,n);i&&i(function(){m.insert(l,k)});return true},reassign:function(i,h,j){var m=this,l,n;m.propagateChanges(function(){var a=m.getAssignmentFor(i).getUnits();var d=false;d=m.unassignWithoutPropagation(i,function b(e){l=e});d=d&&m.assignWithoutPropagation(h,a,function c(e){n=e});return d},function k(a,b){if(a){n&&n();l&&l()}j&&j(a,b)})},linkTo:function(i,n,j,l){var m=this,h;m.propagateChanges(function(){return m.linkToWithoutPropagation(i,n,function a(b){h=b},l)},function k(a,b){a&&h&&h();j&&j(a,b)})},linkToWithoutPropagation:function(p,k,r,m){var l=this,n=l.getId(),j=l.getTaskStore(),q=l.getDependencyStore(),o;p=p instanceof Gnt.model.Task?p.getId():p;k=((k===null||k===undefined)&&Gnt.model.Dependency.Type.EndToStart)||k;o=new q.model();o.setSourceId(n);o.setTargetId(p);o.setType(k);if(q.isValidDependency(o)&&(!m||m(o)!==false)){q.add(o)}r&&r(function(){q.remove(o)});return l},unlinkFrom:function(g,h){var j=this,f;j.propagateChanges(function(){return j.unlinkFromWithoutPropagation(g,function a(b){f=b})},function i(a,b){a&&f&&f();h&&h(a,b)})},unlinkFromWithoutPropagation:function(m,l){var j=this,i=j.getId(),n=j.getDependencyStore(),h,k;m=m instanceof Gnt.model.Task?m.getId():m;h=n.getByTaskIds(m,i);k=n.indexOf(h);n.remove(h);l&&l(function(){n.insert(k,h)});return j},calculateEffort:function(f,h,e){if(!f||!h){return 0}var g=0;this.forEachAvailabilityIntervalWithResources({startDate:f,endDate:h},function(b,c,d){var a=0;for(var i in d){a+=d[i].units}g+=(c-b)*a/100});return this.getUnitConverter().convertMSDurationToUnit(g,e||this.getEffortUnit())},updateAssignments:function(){var f=this.getStartDate();var h=this.getEndDate();if(!f||!h){return}var e=0;this.forEachAvailabilityIntervalWithResources({startDate:f,endDate:h},function(b,c,d){for(var a in d){e+=c-b}});if(!e){return}var g=this.getEffort(Sch.util.Date.MILLI);Ext.Array.each(this.getAssignments(),function(a){a.setUnits(g/e*100)})},updateEffortBasedOnDuration:function(){this.setEffortWithoutPropagation(this.calculateEffort(this.getStartDate(),this.getEndDate()))},updateEffortBasedOnSpan:function(){this.updateEffortBasedOnDuration()},updateSpanBasedOnEffort:function(){this.setStartEndDateWithoutPropagation(this.getStartDate(),this.recalculateEndDate())},onPotentialEffortChange:function(){var c=this,d=c.getTaskStore(true);if(c.isTaskStored()&&(!d||!d.isUndoingOrRedoing())){switch(c.getSchedulingMode()){case"FixedDuration":c.updateEffortBasedOnDuration();break;case"DynamicAssignment":c.updateAssignments();break}}},onAssignmentMutation:function(){var c=this,d=c.getTaskStore(true);if(c.isTaskStored()&&(!d||!d.isUndoingOrRedoing())){switch(this.getSchedulingMode()){case"FixedDuration":this.updateEffortBasedOnDuration();break;case"EffortDriven":this.updateSpanBasedOnEffort();break;case"DynamicAssignment":this.updateAssignments();break}}},onAssignmentStructureMutation:function(){var c=this,d=c.getTaskStore(true);if(c.isTaskStored()&&(!d||!d.isUndoingOrRedoing())){switch(this.getSchedulingMode()){case"FixedDuration":this.updateEffortBasedOnDuration();break;case"EffortDriven":this.updateSpanBasedOnEffort();break;case"DynamicAssignment":this.updateAssignments();break}}},adjustToCalendar:function(c){var d=this;d.propagateChanges(function(){return d.adjustToCalendarWithoutPropagation()},c)},adjustToCalendarWithoutPropagation:function(){var f=this,d=f.getTaskStore(true),e=false;if(d){if(f.get("leaf")){f.setStartDateWithoutPropagation(f.getStartDate(),true,d.skipWeekendsDuringDragDrop);f.alignByIncomingDependenciesWithoutPropagation(d,null);e=f}else{if(f.getStartDate()&&f.getEndDate()){f.set(f.durationField,f.calculateDuration(f.getStartDate(),f.getEndDate(),f.getDurationUnit()));e=f}}}return e},isReadOnly:function(){var b=false;this.bubble(function(a){if(a.getReadOnly()){b=true;return false}},this);return b},isEditable:function(b){if(!this.getReadOnly()&&this.isReadOnly()){return false}if(b===this.readOnlyField){return true}if(this.getReadOnly()){return false}if(!this.isLeaf()){if(b===this.effortField&&this.autoCalculateEffortForParentTask){return false}if(b===this.percentDoneField&&this.autoCalculatePercentDoneForParentTask){return false}}if((b===this.durationField||b===this.endDateField)&&this.getSchedulingMode()==="EffortDriven"){return false}if(b===this.effortField&&this.getSchedulingMode()==="FixedDuration"){return false}return true},isDraggable:function(){return this.getDraggable()},isResizable:function(){return this.getResizable()},getWBSCode:function(){var c=[],d=this;while(d.parentNode){c.push(d.data.index+1);d=d.parentNode}return c.reverse().join(".")},resetTotalCount:function(c){var d=this;while(d){d.totalCount=c?-1:null;d=d.parentNode}},getTotalCount:function(){var f=this.totalCount;var j=f==-1;if(f==null||j){var h=this.childNodes;f=h.length;for(var i=0,g=h.length;i<g;i++){f+=h[i].getTotalCount()}if(j){return f}else{this.totalCount=f}}return f},getPreviousSiblingsTotalCount:function(){var d=this.previousSibling,c=this.data.index;while(d){c+=d.getTotalCount();d=d.previousSibling}return c},getPredecessorsCount:function(){return this.getPreviousSiblingsTotalCount.apply(this,arguments)},getSequenceNumber:function(){var c=0,d=this;while(d.parentNode){c+=d.getPredecessorsCount()+1;d=d.parentNode}return c},getBySequenceNumber:function(i){var l=null,j,g;if(i===0){l=this}else{if(i>0&&i<=this.getTotalCount()){i--;for(var k=0,h=this.childNodes.length;k<h;k++){j=this.childNodes[k];g=j.getTotalCount();if(i>g){i-=g+1}else{j=this.childNodes[k];l=j.getBySequenceNumber(i);break}}}}return l},getDisplayStartDate:function(h,j,i,g,f){h=h||Ext.Date.defaultFormat;if(arguments.length<3){i=this.getStartDate();if(arguments.length<2){j=true}}if(i&&j&&this.isMilestone(f)&&i-Ext.Date.clearTime(i,true)===0&&!Ext.Date.formatContainsHourInfo(h)){i=Sch.util.Date.add(i,Sch.util.Date.MILLI,-1)}return g?i:(i?Ext.util.Format.date(i,h):"")},getDisplayEndDate:function(h,j,i,g,f){h=h||Ext.Date.defaultFormat;if(arguments.length<3){i=this.getEndDate();if(arguments.length<2){j=true}}if(i&&(!this.isMilestone(f)||j)&&i-Ext.Date.clearTime(i,true)===0&&!Ext.Date.formatContainsHourInfo(h)){i=Sch.util.Date.add(i,Sch.util.Date.MILLI,-1)}return g?i:(i?Ext.util.Format.date(i,h):"")},copy:function(){var f=this.callParent(arguments),e=f.getSegments();if(e){for(var h=0;h<e.length;h++){var g=e[h];e[h]=g.copy(g.getId(),false)}}return f},fullCopy:function(d){var c=this.callParent(arguments);c.taskStore=this.getTaskStore();return c},commit:function(){this.callParent(arguments);this.commitSegments()},reject:function(){this.callParent(arguments);this.rejectSegments()},isUnscheduled:function(){return !this.getStartDate()||!this.getEndDate()},isTaskStored:function(){return !!this.getTreeStore()}},function(){Ext.data.NodeInterface.decorate(this);this.override({insertBefore:function(t,r){t=this.createNode(t);if(!t){return}var n=this.getTaskStore(true),o=n&&n.getRoot(),u=this.phantomParentIdField,s=this!==o&&this.phantom,m=!!t.parentNode,q=this.getId();if(s){this.data[this.phantomIdField]=q}if(q!==t.data[u]){var v=s?q:null;if(!t.phantom&&t.data[u]!==v){t.modified=t.modified||{};t.modified[u]=t.data[u]}t.data[u]=v}var l=r&&r.get("index");this.resetTotalCount(m);if(m&&t.hasDependencies()&&!n.isUndoingOrRedoing()){t.removeDependenciesToParents(this)}var p=this.callParent(arguments);if(m){if(this.hasDependencies()){n.getDependencyStore().resetMethodsCache();if(!n.isUndoingOrRedoing()){this.removeInvalidDependencies()}}this.resetTotalCount()}if(r&&r.get("index")!=l){r.modified=r.modified||{};r.modified.index=l}return p},appendChild:function(B,i,v){B=B instanceof Array?B:[B];var q=this.getTaskStore(true),r=q&&q.getRoot(),p=false,z=this.phantomParentIdField,x=this!==r&&this.phantom,t=this.getId(),u=0;if(q&&B.length>1){q.suspendAutoRecalculateParents++}for(var w=0;w<B.length;w++){var y=this.createNode(B[w]);if(!y){continue}u++;B[w]=y;if(y.parentNode){p=true;if(y.hasDependencies()&&q&&!q.isUndoingOrRedoing()){y.removeDependenciesToParents(this)}}if(t!==y.data[z]){var A=x?t:null;if(!y.phantom&&y.data[z]!==A){y.modified=y.modified||{};y.modified[z]=y.data[z]}y.data[z]=A}}if(!u){return}if(x){this.data[this.phantomIdField]=t}this.resetTotalCount(p);var s=this.callParent([B.length>1?B:B[0],i,v]);if(p){if(this.hasDependencies()){q.getDependencyStore().resetMethodsCache();if(q&&!q.isUndoingOrRedoing()){this.removeInvalidDependencies()}}this.resetTotalCount()}if(q&&!q.isUndoingOrRedoing()){this.beginEdit();this.markAsParent();this.set(this.schedulingModeField,"Normal");if(q&&B.length>1){q.suspendAutoRecalculateParents--}this.endEdit()}if(q&&q.recalculateParents&&!q.suspendAutoRecalculateParents&&!this.isRoot()&&!q.cascading&&!q.isUndoingOrRedoing()){B[0].recalculateParents()}return s},removeChild:function(k,n,m,i){var l=this,o=!l.removeChildIsCalledFromReplaceChild&&l.convertEmptyParentToLeaf&&l.childNodes.length==1,p=l.getTaskStore(true),j;l.resetTotalCount();l.removeChildIsCalledFromReplaceChild=false;j=l.callParent(arguments);if(i){l.resetTotalCount()}if(l.childNodes.length>0&&p&&p.recalculateParents&&!p.suspendAutoRecalculateParents&&!p.isUndoingOrRedoing()){l.childNodes[0].recalculateParents()}if(o&&!l.isRoot()&&p&&!p.isUndoingOrRedoing()){l.convertEmptyParentToLeafTask()}return j},replaceChild:function(){this.removeChildIsCalledFromReplaceChild=true;this.callParent(arguments)},removeAll:function(){var d=this.isLeaf(),c=this.getTaskStore(true);this.resetTotalCount();this.callParent(arguments);if(!d&&this.convertEmptyParentToLeaf&&c){this.convertEmptyParentToLeafTask()}},createNode:function(l){var m=this,o=m.getTaskStore(true),p=o&&o.getRoot(),i;if(o){i=o.getProxy().getReader();var k=i.getChildType;i.getChildType=function(){return k.apply(this,arguments)||this.getModel()}}l=this.callParent(arguments);if(o&&i){delete i.getChildType}if(o&&p!==this&&l.isProject){return}var j=o&&o.autoNormalizeNodes&&!l.normalized&&!l.normalizeScheduled;l=this.callParent(arguments);if(j){var n=l.updateInfo;l.updateInfo=function(){n.apply(this,arguments);delete l.updateInfo;l.normalize()};l.normalizeScheduled=true}return l}})});Ext.define("Gnt.model.Project",{extend:Gnt.model.Task,alias:"gntmodel.project",isProject:true,descriptionField:"Note",allowDependenciesField:"AllowDependencies",customizableFields:[{name:"Description",type:"string"},{name:"AllowDependencies",persist:false,type:"bool",defaultValue:false}],recognizedSchedulingModes:["Normal"],convertEmptyParentToLeaf:false,isEditable:function(b){switch(b){case this.nameField:case this.startDateField:case this.endDateField:case this.readOnlyField:case this.durationField:case this.durationUnitField:case this.descriptionField:case this.allowDependenciesField:return this.callParent(arguments);default:return false}}});Ext.define("Gnt.patches.TaskStore",{extend:Ext.Mixin,onClassMixedIn:function(b){Ext.override(b,{onTasksLoad:function(){if(!this._refreshCalled){this.onTasksLoaded()}this.un("refresh",this.onTaskStoreRefresh,this)},onTasksBeforeLoad:function(){this._refreshCalled=false;this.on("refresh",this.onTaskStoreRefresh,this,{priority:100})},onTaskStoreRefresh:function(){if(!this._refreshCalled){this._refreshCalled=true;this.onTasksLoaded()}},setupListeners:function(){this.callParent(arguments);this.on("beforeload",this.onTasksBeforeLoad,this,{priority:100});this.un({load:this.onTasksLoaded,rootchanged:this.onTasksLoaded,scope:this});this.on({load:this.onTasksLoad,rootchanged:this.onTasksLoad,scope:this})}})}});Ext.define("Gnt.data.undoredo.mixin.TaskStoreHint",{extend:Robo.data.Store,segmentsStateByTaskId:null,onSegmentEditBegin:function(e,f){var d=this;this.segmentsStateByTaskId=this.segmentsStateByTaskId||{};if(!this.segmentsStateByTaskId.hasOwnProperty(e.internalId)){this.segmentsStateByTaskId[e.internalId]=e.buildSegmentsSnapshot()}},onSegmentEditEnd:function(e,f){var d=this;if(!d.isInUndoRedoTransaction()){delete this.segmentsStateByTaskId[e.internalId]}},onUndoRedoTransactionEnd:function(e,f){var d=this;this.segmentsStateByTaskId=null;d.callParent([e,f])},getOriginalSegmentsState:function(e){var f=this.segmentsStateByTaskId&&this.segmentsStateByTaskId[e.internalId];if(!f){var d=(e.previous||e.previousValues)[e.segmentsField];if(d){f=e.buildSegmentsSnapshot(d)}}return f}});Ext.define("Gnt.data.mixin.ProjectableStore",function(){function i(b,a){return b.byInternalIdMap&&b.byInternalIdMap[a]||b.getByInternalId(a)}function n(){var a=this,b=a.projectionStack;return b&&b[b.length-1]}function o(){var a=this,b=a.projectionStack;return b&&b.length||0}function p(){return this.getProjectionLevel()>0}function k(b){var a,d,c;b=[].concat(b);for(c=false,a=0,d=b.length;!c&&a<d;a++){c=b[a].isProjected()}return c}function j(){var b=this,c=b.projectionStack,a,d;if(!c){b.projectionStack=[{}]}else{d=c[c.length-1];a={};Ext.Object.each(d,function(f,g){var e=function(){};e.prototype=g;a[f]=new e()});c.push(a)}b.fireEvent("projectionstart",b,b.getProjectionLevel())}function m(){var a=this,h=a.projectionStack,d,e,r,g,c,b,f;if(h.length===1){e=h[0];a.projectionStack=null;for(b in e){if(e.hasOwnProperty(b)){f=i(a,b);if(f){g=e[b];c=false;for(r in g){if(g.hasOwnProperty(r)){c=true;break}}c&&f.set(g)}}}}else{e=h.pop();d=h[h.length-1];for(b in e){if(e.hasOwnProperty(b)){if(!d.hasOwnProperty(b)){d[b]=e[b]}else{d[b]=Ext.apply(d[b],e[b])}}}}a.fireEvent("projectioncommit",a,h&&h[h.length-1],e,a.getProjectionLevel())}function l(){var a=this,b=a.projectionStack,c=b.pop();if(b.length===0){a.projectionStack=null}a.fireEvent("projectionreject",a,b&&b[b.length-1],c,a.getProjectionLevel())}return{projectionStack:null,getProjection:n,isProjecting:p,areProjected:k,getProjectionLevel:o,startProjection:j,commitProjection:m,rejectProjection:l}});Ext.define("Gnt.data.TaskStore",{extend:Ext.data.TreeStore,mixins:[Gnt.patches.TaskStore,Sch.data.mixin.FilterableTreeStore,Sch.data.mixin.UniversalModelGetter,Sch.data.mixin.CacheHintHelper,Sch.data.mixin.EventStore,Gnt.data.undoredo.mixin.TaskStoreHint,Gnt.data.mixin.ProjectableStore],model:"Gnt.model.Task",alias:"store.gantt_taskstore",storeId:"tasks",typeProperty:"TaskType",calendarManager:null,calendar:null,dependencyStore:null,resourceStore:null,assignmentStore:null,weekendsAreWorkdays:false,cascadeChanges:true,batchSync:true,recalculateParents:true,skipWeekendsDuringDragDrop:true,cascadeDelay:0,moveParentAsGroup:true,enableDependenciesForParentTasks:true,availabilitySearchLimit:1825,cycleResolutionStrategy:"cut",autoNormalizeNodes:true,cascading:false,isFillingRoot:false,isSettingRoot:false,earlyStartDates:null,earlyEndDates:null,lateStartDates:null,lateEndDates:null,lastTotalTimeSpan:null,suspendAutoRecalculateParents:0,suspendAutoCascade:0,currentCascadeBatch:null,batchCascadeLevel:0,dependenciesCalendar:"project",pendingDataUpdates:null,tasksLoadStarted:0,constructor:function(p){p=p||{};var q="calendarManager" in p?p.calendarManager:this.calendarManager;delete p.calendarManager;this.setCalendarManager(q);var o=p.calendar||this.calendar;if(!o){var m={};if(p.hasOwnProperty("weekendsAreWorkdays")){m.weekendsAreWorkdays=p.weekendsAreWorkdays}else{if(this.self.prototype.hasOwnProperty("weekendsAreWorkdays")&&this.self!=Gnt.data.TaskStore){m.weekendsAreWorkdays=this.weekendsAreWorkdays}}if(this.calendarManager){o=this.calendarManager.getProjectCalendar()}o=o&&Ext.data.StoreManager.lookup(o)||new Gnt.data.Calendar(m)}var r=p.dependencyStore||this.dependencyStore;r=r&&Ext.data.StoreManager.lookup(r)||Ext.create("Gnt.data.DependencyStore");delete p.dependencyStore;var k=p.resourceStore||this.resourceStore;k=k&&Ext.data.StoreManager.lookup(k)||Ext.create("Gnt.data.ResourceStore");delete p.resourceStore;var n=p.assignmentStore||this.assignmentStore;n=n&&Ext.data.StoreManager.lookup(n)||Ext.create("Gnt.data.AssignmentStore",{resourceStore:k});delete p.assignmentStore;if(o){delete p.calendar;this.setCalendar(o,true,true)}this.resetEarlyDates(true);this.resetLateDates(true);this.pendingDataUpdates={recalculateParents:{}};var j=p.root||this.root;this.root=null;delete p.root;this.callParent([p]);this.setResourceStore(k);this.setAssignmentStore(n);this.setDependencyStore(r);j&&this.setRoot(j);this.setupListeners();var l=this.getRoot();if(l&&this.autoNormalizeNodes){l.normalizeParent()}if(this.autoSync&&this.batchSync){this.sync=Ext.Function.createBuffered(this.sync,500)}this.initTreeFiltering()},setCalendarManager:function(b){if(this.calendarManagerListeners){this.calendarManagerListeners.destroy()}b=b&&Ext.data.StoreManager.lookup(b);this.calendarManager=b;if(b){this.projectCalendarSet=Boolean(b.getProjectCalendar());this.calendarManagerListeners=b.on({projectcalendarset:function(a,d){if(!this.settingCalendar){this.setCalendar(d,!this.projectCalendarSet);this.projectCalendarSet=true}},scope:this,destroyable:true})}return b},onProjectionCommit:function(i,g,h){for(var j in h){if(h.hasOwnProperty(j)){var f=this.getModelByInternalId(j);f&&f.commitSegmentsProjection()}}},onProjectionReject:function(h,g,f){for(var i in f){if(f.hasOwnProperty(i)){var j=this.getModelByInternalId(i);j&&j.rejectSegmentsProjection()}}},setupListeners:function(){this.on({nodeappend:this.onMyNodeAdded,nodeinsert:this.onMyNodeAdded,update:this.onTaskUpdated,projectioncommit:this.onProjectionCommit,projectionreject:this.onProjectionReject,scope:this});this.on({noderemove:this.onTaskRemoved,nodemove:this.onTaskMoved,write:this.onTaskStoreWrite,sort:this.onTasksSorted,load:this.onTasksLoaded,rootchange:this.onTasksRootChange,scope:this,priority:100})},createResourceEventsCache:Ext.emptyFn,createIdConsistencyManager:function(){var b=this;return new Sch.data.util.IdConsistencyManager({eventStore:b,resourceStore:b.getResourceStore(),assignmentStore:b.getAssignmentStore(),dependencyStore:b.getDependencyStore()})},createModelPersistencyManager:function(){var b=this;return new Sch.data.util.ModelPersistencyManager({eventStore:b,resourceStore:b.getResourceStore(),assignmentStore:b.getAssignmentStore(),dependencyStore:b.getDependencyStore()})},fillNode:function(c,d){if(c.isRoot()){this.isSettingRoot=true}this.callParent(arguments);if(c.isRoot()){this.isSettingRoot=false}},onTasksRootChange:function(){var b=this.getRoot();if(b&&this.autoNormalizeNodes){b.normalizeParent()}},onTasksLoaded:function(){this.onTasksRootChange();this.onTasksLoadEnd()},onTasksLoadStart:function(){this.tasksLoadStarted++;this.suspendAutoRecalculateParents++;this.un("noderemove",this.onTaskRemoved,this);this.un("nodeappend",this.onMyNodeAdded,this);this.un("update",this.onTaskUpdated,this)},onTasksLoadEnd:function(){this.lastTotalTimeSpan=null;this.tasksLoadStarted--;if(!this.tasksLoadStarted){this.on("noderemove",this.onTaskRemoved,this);this.on("nodeappend",this.onMyNodeAdded,this);this.on("update",this.onTaskUpdated,this)}this.suspendAutoRecalculateParents--},load:function(b){this.on("beforeload",this.onTasksLoadStart,this,{priority:-999,single:true});this.callParent(arguments)},setProxy:function(){this.callParent(arguments);if(this.typeProperty){var c=this,d=c.getProxy()&&c.getProxy().getReader();if(d&&!d.getTypeProperty()){d.setTypeProperty(c.typeProperty)}}},setRoot:function(f){var g=this;var e=this.count()&&this.getRoot();this.isSettingRoot=true;Ext.apply(f,{calendar:g.calendar,taskStore:g,dependencyStore:g.dependencyStore,phantom:false,dirty:false});var h=this.callParent(arguments);this.isSettingRoot=false;e&&e.cascadeBy(function(a){a.setTaskStore(null)});return h},setDependencyStore:function(f){var h=this,g=h.dependencyStore,e={add:h.onDependencyAdd,update:h.onDependencyUpdate,remove:h.onDependencyDelete,scope:h};if(g&&g.isStore){g.un(e);g.setTaskStore(null);h.idConsistencyManager&&h.idConsistencyManager.setDependencyStore(null);h.modelPersistencyManager&&h.modelPersistencyManager.setDependencyStore(null)}h.dependencyStore=f&&Ext.StoreMgr.lookup(f)||null;if(h.dependencyStore){h.modelPersistencyManager&&h.modelPersistencyManager.setDependencyStore(h.dependencyStore);h.idConsistencyManager&&h.idConsistencyManager.setDependencyStore(h.dependencyStore);h.dependencyStore.setTaskStore(h);h.dependencyStore.on(e)}if((g||f)&&g!==f){h.events&&h.fireEvent("dependencystorechange",h,f,g)}},getResourceStore:function(){return this.resourceStore||null},setResourceStore:function(d){var e=this,f=e.resourceStore;if(f&&f.isStore){f.setTaskStore(null);e.idConsistencyManager&&e.idConsistencyManager.setResourceStore(null);e.modelPersistencyManager&&e.modelPersistencyManager.setResourceStore(null)}e.resourceStore=d&&Ext.StoreMgr.lookup(d)||null;if(e.resourceStore){e.modelPersistencyManager&&e.modelPersistencyManager.setResourceStore(e.resourceStore);e.idConsistencyManager&&e.idConsistencyManager.setResourceStore(e.resourceStore);e.resourceStore.setTaskStore(e);e.resourceStore.normalizeResources()}if((f||d)&&(f!==d)){e.events&&e.fireEvent("resourcestorechange",e,d,f)}},getAssignmentStore:function(){return this.assignmentStore||null},setAssignmentStore:function(h){var e=this,g=e.assignmentStore,f={add:e.onAssignmentStructureMutation,update:e.onAssignmentMutation,remove:e.onAssignmentStructureMutation,scope:e};if(g&&g.isStore){g.un(f);g.setTaskStore(null);e.idConsistencyManager&&e.idConsistencyManager.setAssignmentStore(null);e.modelPersistencyManager&&e.modelPersistencyManager.setAssignmentStore(null)}e.assignmentStore=h&&Ext.StoreMgr.lookup(h)||null;if(e.assignmentStore){e.modelPersistencyManager&&e.modelPersistencyManager.setAssignmentStore(e.assignmentStore);e.idConsistencyManager&&e.idConsistencyManager.setAssignmentStore(e.assignmentStore);h.setTaskStore(e);h.on(f)}if((g||h)&&g!==h){e.events&&e.fireEvent("assignmentstorechange",e,h,g)}},adjustToCalendar:function(i,j){var l=this;l.resetEarlyDates();l.resetLateDates();if(i instanceof Gnt.model.Task){i.adjustToCalendar(j)}else{if(Ext.isFunction(i)){j=i;i=[]}var h=l.getRoot(),k={},g=false;if(!Ext.isArray(i)||!i.length){i=h&&h.childNodes||[];g=true}h&&h.propagateChanges(function(){var a=[];for(var c=0,d=i.length;c<d;c++){var b=i[c];b.cascadeBy(function(e){if(e!==h){e.adjustToCalendarWithoutPropagation()}});if(!g||!b.hasIncomingDependencies()){a.push(b)}}return a.length&&a||false},function(b,a){if(!b){Ext.apply(k,a)}j&&j.apply(this,arguments)})}},renormalizeTasks:function(d,e,f){this.adjustToCalendar(e,f)},getCalendar:function(){return this.calendar||null},setCalendar:function(h,j,f){if(this.settingCalendar){return}this.settingCalendar=true;var i={calendarchange:this.renormalizeTasks,scope:this};if(this.calendar){this.calendar.un(i)}this.calendar=h;if(h){h.on(i);var g=this.getRoot();if(g){g.calendar=h}if(!j){this.renormalizeTasks()}if(!f){this.fireEvent("calendarset",this,h)}if(this.calendarManager){this.calendarManager.setProjectCalendar(h)}}this.settingCalendar=false},getCriticalPaths:function(){var e=[],h=this.getProjects(),g=new Date(0),f=h.length===0?[this.getRoot()]:h;Ext.Array.each(f,function(a){a.cascadeBy(function(b){g=Sch.util.Date.max(b.getEndDate(),g)});a.cascadeBy(function(b){if(g-b.getEndDate()===0&&!b.isRoot()&&!(!b.isLeaf()&&b.childNodes.length)){e.push(b)}})});return Ext.Array.map(e,function(a){return a.getCriticalPaths()})},onMyNodeAdded:function(j,h){var i=this;if(!h.isRoot()){if(i.lastTotalTimeSpan){var f=i.getTotalTimeSpan();if(h.getEndDate()>f.end||h.getStartDate()<f.start){i.lastTotalTimeSpan=null}}if(h.getEndDate()-i.getProjectEndDate()===0){i.resetLateDates()}var g=this.getDependencyStore();!i.isUndoingOrRedoing()&&g&&g.reduceTaskDependencies(h,function(d,c){var a=c.getSourceTask(),b=c.getTargetTask();a&&b&&g.scheduleLinkedTasks(a,b)},null,false);if(i.cascadeChanges&&!i.suspendAutoCascade&&!i.isUndoingOrRedoing()){if(h.getParentsIncomingDependencies().length){h.alignByIncomingDependenciesWithoutPropagation()}}if(!i.cascading&&i.recalculateParents&&!i.suspendAutoRecalculateParents&&!i.isUndoingOrRedoing()){if(i.updating){i.pendingDataUpdates.recalculateParents[h.getId()]=h}else{h.recalculateParents()}}}},onTaskUpdated:function(p,i,j){var m=i.previous;if(this.lastTotalTimeSpan){var o=this.getTotalTimeSpan();if(m&&(m[i.endDateField]-o.end===0||m[i.startDateField]-o.start===0)||(i.getEndDate()>o.end||i.getStartDate()<o.start)){this.lastTotalTimeSpan=null}}if(!this.cascading&&j!==Ext.data.Model.COMMIT&&m&&!this.isUndoingOrRedoing()){var l=i.percentDoneField in m;if(i.startDateField in m||i.endDateField in m||"parentId" in m||i.effortField in m||m[i.schedulingModeField]==="Manual"||m[i.manuallyScheduledField]){var n=i;if(this.cascadeChanges&&!this.suspendAutoCascade){if(m[n.schedulingModeField]=="Manual"){var k=n.getIncomingDependencies(true);if(k.length){n=k[0].getSourceTask()}}Ext.Function.defer(this.cascadeChangesForTask,this.cascadeDelay,this,[n])}else{this.resetEarlyDates();this.resetLateDates()}l=true}else{if((m[i.schedulingModeField]||i.manuallyScheduledField in m)&&i.isManuallyScheduled()){this.resetEarlyDates();this.resetLateDates()}}if(l&&this.recalculateParents&&!this.suspendAutoRecalculateParents){if(this.updating){this.pendingDataUpdates.recalculateParents[i.getId()]=i}else{i.recalculateParents()}}}},onEndUpdate:function(){var d=this,f={},e;if(!this.isUndoingOrRedoing()){Ext.Object.each(d.pendingDataUpdates.recalculateParents,function(a,b){b.parentNode&&(f[b.parentNode.getId()]=b.parentNode)});f=Ext.Array.sort(Ext.Object.getValues(f),function(a,b){return(a.data.depth>b.data.depth)?1:((a.data.depth<b.data.depth)?-1:0)});while(f.length>0){e=f.pop();e.refreshCalculatedParentNodeData();e.recalculateParents()}}d.pendingDataUpdates.recalculateParents={};return d.callParent(arguments)},getEmptyCascadeBatch:function(){var b=this;return{nbrAffected:0,affected:{},visitedCounters:{},addVisited:function(d){var a=d.internalId;if(!this.visitedCounters[a]){this.visitedCounters[a]=1}else{this.visitedCounters[a]++}},addAffected:function(k,l){var a=k.internalId;if(this.affected[a]){return}else{this.affected[a]=k;this.nbrAffected++}if(!b.cascading&&this.nbrAffected>1){b.fireEvent("beforecascade",b);b.cascading=true}if(!l){var j=this.affectedParentsbyInternalId;var h=this.affectedParentsArray;var i=k.isLeaf()?k.parentNode:k;while(i&&!i.data.root){if(j[i.internalId]){break}j[i.internalId]=i;h.push(i);this.addAffected(i,true);i=i.parentNode}}},affectedParentsArray:[],affectedParentsbyInternalId:{},parentsStartDates:{}}},startBatchCascade:function(){if(!this.batchCascadeLevel){this.currentCascadeBatch=this.getEmptyCascadeBatch();this.suspendAutoRecalculateParents++;this.suspendAutoCascade++}this.batchCascadeLevel++;return this.currentCascadeBatch},endBatchCascade:function(){this.batchCascadeLevel--;if(!this.batchCascadeLevel){this.suspendAutoRecalculateParents--;this.suspendAutoCascade--;var b=this.currentCascadeBatch;this.currentCascadeBatch=null;this.resetEarlyDates();this.resetLateDates();if(this.cascading){this.cascading=false;this.fireEvent("cascade",this,b)}}},cascadeChangesForTask:function(d,c){d.propagateChanges(Ext.emptyFn,c,true)},removeTaskDependencies:function(e){var d=this.dependencyStore,f=e.getAllDependencies(d);if(f.length){d.remove(f)}},removeTaskAssignments:function(d){var f=this.getAssignmentStore(),e=d.getAssignments();if(e.length){f.remove(e)}},onTaskRemoved:function(l,n,k){var r=this.getDependencyStore();var o=this.getAssignmentStore();var j=!n.isReplace&&!k;if(r&&j){n.cascadeBy(this.removeTaskDependencies,this)}if(o&&j){o.fireEvent("beforetaskassignmentschange",o,n.getId(),[]);n.cascadeBy(this.removeTaskAssignments,this);o.fireEvent("taskassignmentschanged",o,n.getId(),[])}var m=this.getTotalTimeSpan();var q=n.getStartDate();var p=n.getEndDate();if(p-m.end===0||q-m.start===0){this.lastTotalTimeSpan=null}if(j){n.setTaskStore(null)}this.resetEarlyDates();this.resetLateDates()},onTaskMoved:function(h,m,k,n){var l=this.getTotalTimeSpan();var i=h.getStartDate();var j=h.getEndDate();if(j-l.end===0||i-l.start===0){this.lastTotalTimeSpan=null}this.resetEarlyDates();this.resetLateDates()},onAssignmentMutation:function(f,e){var d=this;if(!this.isUndoingOrRedoing()){Ext.Array.each([].concat(e),function(a){var b=a.getTask(d);if(b){b.onAssignmentMutation(a)}})}},onAssignmentStructureMutation:function(f,e){var d=this;if(!this.isUndoingOrRedoing()){Ext.Array.each([].concat(e),function(a){var b=a.getTask(d);if(b){b.onAssignmentStructureMutation(a)}})}},onDependencyUpdate:function(d,f,e){if(e!==Ext.data.Model.COMMIT){this.onDependencyAdd(d,f)}},onDependencyAdd:function(g,i){var f=this,j,h;f.resetEarlyDates();f.resetLateDates();if(f.cascadeChanges&&!f.suspendAutoCascade&&!f.isUndoingOrRedoing()){h=[];if(Ext.isArray(i)){Ext.Array.each(i,function(a){j=a.getSourceTask();j&&h.push(j)});h.length&&f.getRoot().propagateChanges(function(){return h})}else{h=i.getSourceTask();h&&h.propagateChanges()}}},onDependencyDelete:function(d,c){this.resetEarlyDates();this.resetLateDates()},onTaskStoreWrite:function(j,f){var i=this,g=f.getRecords(),h;Ext.Array.each(g,function(a){Ext.each(a.childNodes,function(b){if(b.phantom){h=true;return false}})});if(h&&!this.autoSync){setTimeout(function(){i.sync()},1)}},forEachTaskUnordered:function(f,d){var e=this.getRoot();if(e){e.cascadeBy(function(a){if(a!==e){return f.call(d||this,a)}})}},getTimeSpanForTasks:function(g){var f=new Date(9999,0,1),e=new Date(0);var h=function(b){var c=b.getStartDate();var a=b.getEndDate();if(c&&c<f){f=c}if(c&&a&&a>e){e=a}};if(g){if(!Ext.isArray(g)){g=[g]}Ext.Array.each(g,h)}else{this.forEachTaskUnordered(h)}f=f<new Date(9999,0,1)?f:null;e=e>new Date(0)?e:null;return{start:f,end:e||(f&&Ext.Date.add(f,Ext.Date.DAY,1))||null}},getTotalTimeSpan:function(){if(this.lastTotalTimeSpan){return this.lastTotalTimeSpan}this.lastTotalTimeSpan=this.getTimeSpanForTasks();return this.lastTotalTimeSpan},getProjectStartDate:function(){return this.getTotalTimeSpan().start},getProjectEndDate:function(){return this.getTotalTimeSpan().end},getProjects:function(){var f=this.getRoot(),i=[],h=f.childNodes;for(var j=0,g=h.length;j<g;j++){if(h[j].isProject){i.push(h[j])}}return i},getTotalTaskCount:function(c){var d=c===false?1:0;this.forEachTaskUnordered(function(){d++});return d},toArray:function(){var b=[];this.getRoot().cascadeBy(function(a){b.push(a)});return b},beginIndent:function(d,c){this.fireEvent("beforeindentationchange",this,d,c)},endIndent:function(d,c){this.fireEvent("indentationchange",this,d,c)},indent:function(p,k){var n=this,j=false,l={},o,i;p=Ext.isArray(p)?p.slice():[p];p=Ext.Array.filter(p,function(a){var b;b=!!a.previousSibling;while(b&&!a.isRoot()){b=!Ext.Array.contains(p,a.parentNode);a=a.parentNode}return b});p=Ext.Array.sort(p,function(a,b){return a.get("index")-b.get("index")});o=Ext.Array.reduce(p,function(b,a){b[a.getId()]={parentNode:a.parentNode,index:a.get("index")};return b},{});n.beginIndent(p,o);n.suspendEvent("beforeindentationchange","indentationchange");i=p.slice();(function m(){if(i.length){i.shift().indent(function(a,b){if(!a){l=Ext.apply(l,b);m()}else{j=true;l={}}})}else{n.resumeEvent("beforeindentationchange","indentationchange");n.endIndent(p,o);k&&k(j,l)}})()},outdent:function(p,k){var n=this,j=false,l={},o,i;p=Ext.isArray(p)?p.slice():[p];p=Ext.Array.filter(p,function(a){var b;b=a.parentNode&&!a.parentNode.isRoot();while(b&&!a.isRoot()){b=!Ext.Array.contains(p,a.parentNode);a=a.parentNode}return b});p=Ext.Array.sort(p,function(a,b){return b.get("index")-a.get("index")});o=Ext.Array.reduce(p,function(b,a){b[a.getId()]={parentNode:a.parentNode,index:a.get("index")};return b},{});n.beginIndent(p,o);n.suspendEvent("beforeindentationchange","indentationchange");i=p.slice();(function m(){if(i.length){i.shift().outdent(function(a,b){if(!a){l=Ext.apply(l,b);m()}else{j=true;l={}}})}else{n.resumeEvent("beforeindentationchange","indentationchange");n.endIndent(p,o);k&&k(j,l)}})()},getTasksForResource:function(b){return this.getEventsForResource(b)},getResourcesForTask:function(b){return this.getResourcesForEvent(b)},forEachScheduledEvent:function(c,d){d=d||this;this.forEachTaskUnordered(function(a){var b=a.getStartDate(),f=a.getEndDate();if(b&&f){return c.call(d,a,b,f)}})},onTasksSorted:function(){if(this.lastTreeFilter){this.filterTreeBy(this.lastTreeFilter)}},append:function(b){return this.getRoot().appendChild(b)},resetEarlyDates:function(b){this.earlyStartDates={};this.earlyEndDates={};if(!b){this.fireEvent("resetearlydates")}},resetLateDates:function(b){this.lateStartDates={};this.lateEndDates={};if(!b){this.fireEvent("resetlatedates")}},getBySequenceNumber:function(b){return this.getRoot().getBySequenceNumber(b)},destroy:function(){this.setCalendar(null);this.setCalendarManager(null);this.setAssignmentStore(null);this.setDependencyStore(null);this.setResourceStore(null);if(this.calendarManagerListeners){this.calendarManagerListeners.destroy()}this.callParent(arguments)},moveSeveralTasks:function(e){var g=this.startBatchCascade();var f;while(f=e()){var h=f.task;if(h.isLeaf()||!h.childNodes.length){if(!g.affected[h.internalId]){g.addAffected(h);f.method&&h[f.method].apply(h,f.args);if(this.cascadeChanges){this.cascadeChangesForTask(h)}}}else{if(this.recalculateParents){g.addAffected(h)}}}this.endBatchCascade()},linearWalkDependentTasks:function(g,f,h){var e=this;h=h||{self:true,ancestors:e.recalculateParents,descendants:e.moveParentAsGroup,successors:e.cascadeChanges,cycles:e.cycleResolutionStrategy};return Gnt.data.Linearizator.linearWalkBySpecification(g,f,h)},getLinearWalkingSequenceForDependentTasks:function(f,d){var e=[];this.linearWalkDependentTasks(f,function(b,c,h,a){e.push(Array.prototype.slice.call(arguments))},d);return e},isVisible:function(h){var f=h.parentNode,g=h.get("visible"),e=this.getRoot();while(g&&f){g=f.get("expanded")&&f.get("visible");f=f.parentNode}return g&&!(h===e&&!this.getRootVisible())},removeTasks:function(b){b=[].concat(b);b=Ext.Array.filter(b,function(a){return !a.parentNode||!a.parentNode.isReadOnly()});b=Ext.Array.sort(b,function(a,e){return e.getDepth()-a.getDepth()});this.fireEvent("beforebatchremove",this,b);Ext.Array.forEach(b,function(a){a.remove()});this.fireEvent("batchremove",this,b);return b}});Ext.define("Gnt.data.calendar.BusinessTime",{extend:Gnt.data.Calendar,daysPerMonth:20,daysPerWeek:5,hoursPerDay:8,defaultAvailability:["08:00-12:00","13:00-17:00"]});Ext.define("Gnt.data.undoredo.Manager",{extend:Robo.Manager,getStoreTypeListeners:function(e){var f=this,d=f.callParent([e]);if(e instanceof Gnt.data.TaskStore){d.update=f.onTaskStoreUpdate;d.projectionstart=f.onTaskStoreProjectionStart;d.projectioncommit=f.onTaskStoreProjectionEnd;d.projectionreject=f.onTaskStoreProjectionEnd}return d},onTaskStoreUpdate:function(h,f,e,g){if(!this.onAnyChangeInAnyStore(h)||e!="edit"||!g||!g.length||!this.hasPersistableChanges(f,g)){return}this.currentTransaction.addAction(new Gnt.data.undoredo.action.taskstore.Update({record:f,fieldNames:g}))},onTaskStoreProjectionStart:function(e,d){var f=this;if(d==1&&f.transactionBoundary==="timeout"){if(!f.currentTransaction){f.onAnyChangeInAnyStore(e)}if(f.currentTransaction){f.hold()}}},onTaskStoreProjectionEnd:function(f,g,h,j){var i=this;if(j===0&&i.transactionBoundary==="timeout"&&i.currentTransaction){i.release()}}});Ext.define("Gnt.data.undoredo.action.taskstore.Update",{extend:Robo.action.tree.Update,getSerializedSegments:function(b){return b?Ext.Array.map(b,function(a){return Ext.clone(a.data)}):b},processSavingOldValue:function(g,f){var e=this,h;if(g==f.segmentsField){h=f.getTaskStore().getOriginalSegmentsState(f)}else{h=e.callParent([g,f])}return h},processSavingNewValue:function(g,f){var e=this,h;if(g===f.segmentsField){h=f.buildSegmentsSnapshot()}else{h=e.callParent([g,f])}return h},processRestoringValue:function(h,g,f){var e=this;if(g==f.segmentsField){f.rollbackSegmentsToSnapshot(h);h=e.self.CUSTOMLY_PROCESSED}else{h=e.callParent([h,g,f])}return h}});Ext.define("Gnt.data.util.TaskDependencyCache",function(l){function h(a,c){var b;if(!(c instanceof Ext.data.Model)){b=a.dependencyStore.getTaskStore();c=b&&b.getModelById(c)}return c}function g(a,c){var b=h(a,c);b&&(b.successors=a.getSuccessors(c))}function j(a,c){var b=h(a,c);b&&(b.predecessors=a.getPredecessors(c))}function k(a){var b=a.dependencyStore.getTaskStore(),c=b&&b.getRoot();c&&c.cascadeBy(function(d){d.successors=[];d.predecessors=[]})}function i(a){var b=a.dependencyStore.getTaskStore(),c=b&&b.getRoot();c&&c.cascadeBy(function(d){d.successors=a.getSuccessors(d);d.predecessors=a.getPredecessors(d)})}return{extend:Sch.data.util.EventDependencyCache,taskStoreDetacher:null,taskStoreDependencyStoreDetacher:null,constructor:function(f){var c=this,o;c.callParent([f]);function d(m){i(c)}function b(n,m){g(c,m);j(c,m)}function a(n,m){e(m)}function p(m){i(c)}function e(m){Ext.destroy(c.taskStoreDetacher);c.taskStoreDetacher=m&&m.on({rootchange:d,nodeappend:b,priority:99,destroyable:true});i(c)}c.taskStoreDependencyStoreDetacher=f.on({eventstorechange:a,refresh:p,priority:100,destroyable:true});e(f.getTaskStore())},destroy:function(){var a=this;a.callParent();Ext.destroyMembers(a,"taskStoreDetacher","taskStoreDependencyStoreDetacher")},addSuccessor:function(b,c){var a=this;a.callParent([b,c]);g(a,b)},addPredecessor:function(b,c){var a=this;a.callParent([b,c]);j(a,b)},removeSuccessor:function(b,c){var a=this;a.callParent([b,c]);g(a,b)},removePredecessor:function(b,c){var a=this;a.callParent([b,c]);j(a,b)},moveSuccessors:function(b,a,d){var c=this;c.callParent(arguments);g(c,b);g(c,a)},movePredecessors:function(b,a,d){var c=this;c.callParent(arguments);j(c,b);j(c,a)},clearSuccessors:function(b){var a=this;a.callParent([b]);g(a,b)},clearPredecessors:function(b){var a=this;a.callParent([b]);j(a,b)},clear:function(b){var a=this;a.callParent(arguments);if(b){g(a,b);j(a,b)}else{k(a)}}}});Ext.define("Gnt.feature.DependencyDragZone",{extend:Ext.dd.DragZone,mixins:{observable:Ext.util.Observable},rtl:null,useLineProxy:null,terminalSelector:null,ganttView:null,fromText:null,toText:null,startText:null,endText:null,toolTipTpl:null,constructor:function(c,d){this.mixins.observable.constructor.call(this,d);this.callParent(arguments)},initLineProxy:function(l,g){var j=this.lineProxyEl=this.lineProxyEl||this.el.createChild({cls:"sch-gantt-connector-proxy"});var i=Ext.isIE9m?0:4;var k=this.rtl?(g?"r":"l"):(g?"l":"r");var h=this.ganttView.getScroll();j.alignTo(l,k,[g?-i:i,0]);Ext.apply(this,{containerTop:this.el.getTop(),containerLeft:this.el.getLeft(),startXY:j.getXY(),startScrollLeft:h.left,startScrollTop:h.top})},onDrag:function(c,d){if(this.useLineProxy){this.updateLineProxy(c.getXY())}},updateLineProxy:function(o){var B=this.lineProxyEl,r=this.ganttView.getScroll(),s=o[0]-this.startXY[0]+r.left-this.startScrollLeft,t=o[1]-this.startXY[1]+r.top-this.startScrollTop,A=Math.max(1,Math.sqrt(Math.pow(s,2)+Math.pow(t,2))-2),u=Math.atan2(t,s)-(Math.PI/2),x;if(Ext.isIE9m){var q=Math.cos(u),v=Math.sin(u),p='progid:DXImageTransform.Microsoft.Matrix(sizingMethod="auto expand", M11 = '+q+", M12 = "+(-v)+", M21 = "+v+", M22 = "+q+")",y,w;if(r.top!==this.startScrollTop){y=this.startScrollTop-this.containerTop}else{y=r.top-this.containerTop}if(r.left!==this.startScrollLeft){w=this.startScrollLeft-this.containerLeft}else{w=r.left-this.containerLeft}x={height:A+"px",top:Math.min(0,t)+this.startXY[1]+y+(t<0?2:0)+"px",left:Math.min(0,s)+this.startXY[0]+w+(s<0?2:0)+"px",filter:p,"-ms-filter":p}}else{var z="rotate("+u+"rad)";x={height:A+"px","-o-transform":z,"-webkit-transform":z,"-ms-transform":z,"-moz-transform":z,transform:z}}B.setStyle(x)},onStartDrag:function(){this.el.addCls("sch-gantt-dep-dd-dragging");this.proxy.el.addCls("sch-dd-dependency-proxy");this.fireEvent("dndstart",this);if(this.useLineProxy){var b=this.dragData;this.initLineProxy(b.sourceNode,b.isStart);this.lineProxyEl.show()}},getDragData:function(j){var k=j.getTarget(this.terminalSelector);if(k){var l=this.ganttView.resolveTaskRecord(k);if(this.fireEvent("beforednd",this,l)===false){return null}var e=!!k.className.match("sch-gantt-terminal-start");var h={fromLabel:this.fromText,fromTaskName:Ext.String.htmlEncode(l.getName()),fromSide:e?this.startText:this.endText,toLabel:this.toText,toTaskName:"",toSide:""};var i=Ext.core.DomHelper.createDom({html:this.toolTipTpl.apply(h)}).firstChild;return{fromId:l.getId()||l.internalId,tplData:h,isStart:e,repairXY:Ext.fly(k).getXY(),ddel:i,sourceNode:Ext.fly(k).up(this.ganttView.eventSelector)}}return false},afterRepair:function(){this.dragging=false;if(!this.destroyed){this.el.removeCls("sch-gantt-dep-dd-dragging");this.fireEvent("afterdnd",this)}},onMouseUp:function(){this.el.removeCls("sch-gantt-dep-dd-dragging");if(this.lineProxyEl){var c=Ext.isIE9m?0:400;var d=this.lineProxyEl;d.animate({to:{height:0},duration:c,callback:function(){Ext.destroy(d)}});this.lineProxyEl=null}},getRepairXY:function(){return this.dragData.repairXY},destroy:function(){Ext.destroy(this.lineProxyEl);this.callParent(arguments)}});Ext.define("Gnt.feature.DependencyDropZone",{extend:Ext.dd.DropZone,mixins:{observable:Ext.util.Observable},terminalSelector:null,dependencyStore:null,toText:null,startText:null,endText:null,ganttView:null,constructor:function(c,d){this.mixins.observable.constructor.call(this,d);this.callParent(arguments)},getTargetFromEvent:function(b){return b.getTarget(this.terminalSelector)},onNodeEnter:function(g,f,h,e){Ext.fly(g).addCls("sch-gantt-terminal-drophover")},onNodeOut:function(g,f,h,e){Ext.fly(g).removeCls("sch-gantt-terminal-drophover");this.toolTipTpl.overwrite(f.proxy.el.down(".sch-dd-dependency"),e.tplData)},onNodeOver:function(o,e,n,p){var r=this.ganttView.resolveTaskRecord(o),k=r.getId()||r.internalId,q=o.className.match("sch-gantt-terminal-start");var l={};Ext.apply(l,{toLabel:this.toText,toTaskName:Ext.String.htmlEncode(r.getName()),toSide:q?this.startText:this.endText},p.tplData);this.toolTipTpl.overwrite(e.proxy.el.down(".sch-dd-dependency"),l);var m=this.resolveType(p.isStart,o);if(this.dependencyStore.isValidDependency(p.fromId,k,m)){return this.dropAllowed}else{return this.dropNotAllowed}},onNodeDrop:function(k,j,l,n){var o=this.resolveType(n.isStart,k),m,p=this.ganttView.resolveTaskRecord(k),e=p.getId()||p.internalId;this.el.removeCls("sch-gantt-dep-dd-dragging");m=this.dependencyStore.isValidDependency(n.fromId,e,o);if(m){this.fireEvent("drop",this,n.fromId,e,o)}this.fireEvent("afterdnd",this);return m},resolveType:function(f,g){var h=Gnt.model.Dependency.Type,e=g.className.match("sch-gantt-terminal-start");if(f&&e){return h.StartToStart}if(f&&!e){return h.StartToEnd}if(!f&&e){return h.EndToStart}return h.EndToEnd}});Ext.define("Gnt.feature.DependencyDragDrop",{extend:Ext.util.Observable,mixins:{localizable:Gnt.mixin.Localizable},useLineProxy:true,dragZoneConfig:null,dropZoneConfig:null,toolTipTpl:['<div class="sch-dd-dependency">',"<table><tbody>","<tr>",'<td><span class="sch-dd-dependency-from">{fromLabel}:</span></td>','<td><span class="sch-dd-dependency-from-name">{fromTaskName}</span> - {fromSide}</td>',"</tr>","<tr>",'<td><span class="sch-dd-dependency-to">{toLabel}:</span></td>','<td><span class="sch-dd-dependency-to-name">{toTaskName}</span> - {toSide}</td>',"</tr>","</tbody></table>","</div>"],terminalSelector:".sch-gantt-terminal",el:null,rtl:null,ddGroup:null,ganttView:null,dependencyStore:null,constructor:function(c){var d=c.ganttView;Ext.apply(this,c);this.ddGroup=d.id+"-sch-dependency-dd";this.el.on("mousemove",this.doSetup,this,{single:true});this.callParent(arguments)},doSetup:function(){var b=this;this.dragZone=new Gnt.feature.DependencyDragZone(this.el,Ext.apply({rtl:this.rtl,terminalSelector:this.terminalSelector,useLineProxy:this.useLineProxy,ddGroup:this.ddGroup,ganttView:this.ganttView,startText:this.L("startText"),endText:this.L("endText"),fromText:this.L("fromText"),toText:this.L("toText"),toolTipTpl:Ext.XTemplate.getTpl(this,"toolTipTpl")},this.dragZoneConfig));this.relayEvents(this.dragZone,["beforednd","dndstart","afterdnd"]);this.dropZone=Ext.create("Gnt.feature.DependencyDropZone",this.el,Ext.apply({rtl:this.rtl,terminalSelector:this.terminalSelector,ddGroup:this.ddGroup,ganttView:this.ganttView,dependencyStore:this.dependencyStore,startText:this.L("startText"),endText:this.L("endText"),toText:this.L("toText"),toolTipTpl:Ext.XTemplate.getTpl(this,"toolTipTpl")},this.dropZoneConfig));this.relayEvents(this.dropZone,["drop","afterdnd"]);this.configureAllowedSourceTerminals();if(this.dependencyStore.allowedDependencyTypes){this.dragZone.on("dndstart",this.configureAllowedTargetTerminals,this)}else{this.el.addCls(["sch-gantt-terminal-allow-target-start","sch-gantt-terminal-allow-target-end"])}},configureAllowedSourceTerminals:function(){var c=this.dependencyStore.allowedDependencyTypes;var d=["sch-gantt-terminal-allow-source-start","sch-gantt-terminal-allow-source-end"];if(c){d=[];if(Ext.Array.indexOf(c,"EndToEnd")>-1||Ext.Array.indexOf(c,"EndToStart")>-1){d.push("sch-gantt-terminal-allow-source-end")}if(Ext.Array.indexOf(c,"StartToStart")>-1||Ext.Array.indexOf(c,"StartToEnd")>-1){d.push("sch-gantt-terminal-allow-source-start")}}this.el.addCls(d)},configureAllowedTargetTerminals:function(){var c=this.dependencyStore.allowedDependencyTypes;var d=[];this.el.removeCls(["sch-gantt-terminal-allow-target-start","sch-gantt-terminal-allow-target-end"]);if(Ext.Array.contains(c,"EndToEnd")||Ext.Array.contains(c,"StartToEnd")){d.push("sch-gantt-terminal-allow-target-end")}if(Ext.Array.contains(c,"StartToStart")||Ext.Array.contains(c,"EndToStart")){d.push("sch-gantt-terminal-allow-target-start")}this.el.addCls(d)},destroy:function(){if(this.dragZone){this.dragZone.destroy()}if(this.dropZone){this.dropZone.destroy()}}});Ext.define("Gnt.feature.DragCreator",{disabled:false,showDragTip:true,tooltipConfig:null,dragTolerance:2,validatorFn:Ext.emptyFn,validatorFnScope:null,constructor:function(b){Ext.apply(this,b||{});this.init()},setDisabled:function(b){this.disabled=b;if(this.dragTip){this.dragTip.setDisabled(b)}},getProxy:function(){if(!this.proxy){this.proxy=this.template.append(this.ganttView.up("tablepanel").el,{},true)}return this.proxy},onBeforeDragStart:function(h){var j=this.ganttView,e=h.getTarget("."+j.timeCellCls,2);if(e&&!this.disabled){var g=j.resolveTaskRecord(e);var i=j.getDateFromDomEvent(h);if(!g.isReadOnly()&&!g.getStartDate()&&!g.getEndDate()&&j.fireEvent("beforedragcreate",j,g,i,h)!==false){h.stopEvent();this.record=g;this.originalStart=i;this.rowRegion=j.getScheduleRegion(this.record,this.originalStart);this.dateConstraints=j.getDateConstraints(this.resourceRecord,this.originalStart);return true}}return false},onDragStart:function(){var f=this,e=f.ganttView,d=f.getProxy();f.start=f.originalStart;f.end=f.start;f.rowBoundaries={top:f.rowRegion.top,bottom:f.rowRegion.bottom};d.setBox({x:f.tracker.startXY[0],y:f.rowBoundaries.top,width:1,height:f.rowBoundaries.bottom-f.rowBoundaries.top});d.show();e.fireEvent("dragcreatestart",e);if(f.showDragTip){f.dragTip.updateContent(f.start,f.end,true,f.record);f.dragTip.enable();f.dragTip.show(d)}},onDrag:function(i){var k=this,l=k.ganttView,e=k.tracker.getRegion().constrainTo(k.rowRegion),j=l.getStartEndDatesFromRegion(e,"round");if(!j){return}k.start=j.start||k.start;k.end=j.end||k.end;var h=k.dateConstraints;if(h){k.end=Sch.util.Date.constrain(k.end,h.start,h.end);k.start=Sch.util.Date.constrain(k.start,h.start,h.end)}k.valid=k.validatorFn.call(k.validatorFnScope||k,k.record,k.start,k.end,i)!==false;if(k.showDragTip){k.dragTip.updateContent(k.start,k.end,k.valid,k.record)}Ext.apply(e,k.rowBoundaries);k.getProxy().setBox(e)},onDragEnd:function(g){var h=this,f=h.ganttView,e=false;h.createContext={start:h.start,end:h.end,e:g,record:h.record,finalize:function(){h.finalize.apply(h,arguments)}};if(h.showDragTip){h.dragTip.disable()}if(!h.start||!h.end||(h.end<h.start)){h.valid=false}if(h.valid){e=f.fireEvent("beforedragcreatefinalize",h,h.createContext,g)!==false}if(e){h.finalize(h.valid)}},finalize:function(e){var g=this,h=g.createContext,f=g.ganttView;if(e){h.record.setStartEndDate(h.start,h.end,h.record.getTaskStore().skipWeekendsDuringDragDrop);f.fireEvent("dragcreateend",f,h.record,h.e)}g.proxy.hide();f.fireEvent("afterdragcreate",f)},init:function(){var e=this.ganttView,d=e.el,f=Ext.Function.bind;this.lastTime=new Date();this.template=this.template||Ext.create("Ext.Template",'<div class="sch-gantt-dragcreator-proxy"></div>',{compiled:true,disableFormats:true});e.on({destroy:this.onGanttDestroy,scope:this});this.tracker=new Sch.util.DragTracker({el:d,tolerance:this.dragTolerance,onBeforeStart:f(this.onBeforeDragStart,this),onStart:f(this.onDragStart,this),onDrag:f(this.onDrag,this),onEnd:f(this.onDragEnd,this)});if(this.showDragTip){this.dragTip=new Gnt.Tooltip(Ext.apply({mode:"duration",cls:"sch-gantt-dragcreate-tip",gantt:e},this.tooltipConfig))}},onGanttDestroy:function(){if(this.dragTip){this.dragTip.destroy()}if(this.tracker){this.tracker.destroy()}if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}}});Ext.define("Gnt.feature.LabelEditor",{extend:Ext.Editor,labelPosition:"",triggerEvent:"dblclick",delegate:null,dataIndex:null,shadow:false,completeOnEnter:true,cancelOnEsc:true,ignoreNoChange:true,ganttView:null,constructor:function(c,d){this.ganttView=c;this.ganttView.on("afterrender",this.onGanttRender,this);Ext.apply(this,d);if(this.labelPosition==="left"){this.alignment="r-r"}else{if(this.labelPosition==="right"){this.alignment="l-l"}else{this.alignment="c-c"}}this.delegate=".sch-gantt-label-"+this.labelPosition;this.callParent([d])},edit:function(j){if(!j.isEditable(this.dataIndex)){return}var g=this.ganttView.getElementFromEventRecord(j);if(g){var h=g.up(this.ganttView.eventWrapSelector);var i,f;this.record=j;if(!this.rendered){this.render(this.ganttView.getSecondaryCanvasEl())}this.startEdit(h.down(this.delegate),this.dataIndex?j.get(this.dataIndex):"")}},onGanttRender:function(b){if(!this.field.width){this.autoSize="width"}this.on({beforestartedit:function(f,a,e){return b.fireEvent("labeledit_beforestartedit",b,this.record,e,f)},beforecomplete:function(f,e,a){return b.fireEvent("labeledit_beforecomplete",b,e,a,this.record,f)},complete:function(f,e,a){this.record.set(this.dataIndex,e);b.fireEvent("labeledit_complete",b,e,a,this.record,f)},scope:this});b.el.on(this.triggerEvent,function(d,a){this.edit(b.resolveTaskRecord(a))},this,{delegate:this.delegate})}});Ext.define("Gnt.feature.ProgressBarResize",{useTooltip:true,increment:10,tip:null,resizable:null,ganttView:null,constructor:function(d){Ext.apply(this,d||{});var c=this.ganttView;c.on({destroy:this.cleanUp,scope:this});c.el.on("mousedown",this.onMouseDown,this,{delegate:".sch-gantt-progressbar-handle"});this.callParent(arguments)},onMouseDown:function(i,e){var j=this.ganttView,h=j.resolveTaskRecord(e);if(j.fireEvent("beforeprogressbarresize",j,h)!==false){var g=Ext.fly(e).prev(".sch-gantt-progress-bar");i.stopEvent();g.addCls("active");this.resizable=this.createResizable(g,h,i);j.fireEvent("progressbarresizestart",j,h);Ext.getBody().on("mouseup",this.onBodyMouseUp,this,{single:true,delay:1})}},createResizable:function(p,j,l){var m=this.ganttView.rtl,k=p.up(this.ganttView.eventSelector),n=k.getWidth()-2*this.ganttView.eventBorderWidth,e=n*this.increment/100;var o=Ext.create("Ext.resizer.Resizer",{target:p,taskRecord:j,handles:m?"w":"e",minWidth:0,maxWidth:n,minHeight:1,widthIncrement:e,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}});o.resizeTracker.onMouseDown(l,o[m?"west":"east"].dom);k.addCls("sch-gantt-resizing");if(this.useTooltip){this.tip=Ext.create("Ext.ToolTip",{autoHide:false,anchor:"b",html:"%"});this.tip.setTarget(p);this.tip.update(j.getPercentDone()+"%");this.tip.show()}return o},partialResize:function(f,d){var e=Math.round(d*100/(f.maxWidth*this.increment))*this.increment;if(this.tip){this.tip.body.update(e+"%")}},afterResize:function(l,e,n,k){var j=l.taskRecord;if(this.tip){this.tip.destroy();this.tip=null}var h=l.taskRecord.getPercentDone();if(Ext.isNumber(e)){var m=Math.round(e*100/(l.maxWidth*this.increment))*this.increment;m=Math.min(100,Math.max(0,m));l.taskRecord.setPercentDone(m)}if(h===l.taskRecord.getPercentDone()){this.ganttView.refreshNode(this.ganttView.indexOf(l.taskRecord))}l.destroy();this.resizable=null;this.ganttView.fireEvent("afterprogressbarresize",this.ganttView,j)},onBodyMouseUp:function(){if(this.resizable){this.afterResize(this.resizable)}},cleanUp:function(){if(this.tip){this.tip.destroy()}}});Ext.define("Gnt.feature.TaskDragDrop",{extend:Ext.dd.DragZone,useTooltip:true,tooltipConfig:null,validatorFn:function(f,e,g,h){return true},validatorFnScope:null,showExactDropPosition:false,containerScroll:false,dropAllowed:"sch-gantt-dragproxy",dropNotAllowed:"sch-gantt-dragproxy",gantt:null,onDragEnter:Ext.emptyFn,onDragOut:Ext.emptyFn,tip:null,skipWeekendsDuringDragDrop:false,taskSelector:null,deadlineSelector:null,invalidHandleClasses:[Ext.baseCSSPrefix+"resizable-handle","sch-resizable-handle","sch-gantt-terminal","sch-gantt-progressbar-handle","sch-rollup-task","sch-gantt-baseline-item"],constructor:function(i,f){var j;f=f||{};Ext.apply(this,f);if(Ext.isIE&&(Ext.isIE8||Ext.ieVersion<9)&&window.top!==window){Ext.dd.DragDropManager.notifyOccluded=true}this.proxy=this.proxy||new Ext.dd.StatusProxy({shadow:false,dropAllowed:"sch-gantt-dragproxy",dropNotAllowed:"sch-gantt-dragproxy",ensureAttachedToBody:Ext.emptyFn});this.gantt.rtl&&this.proxy.addCls("sch-rtl");var h=this,g=h.gantt;if(h.useTooltip){h.tip=new Gnt.Tooltip(Ext.apply({cls:"gnt-dragdrop-tip",gantt:g},h.tooltipConfig))}j=this.invalidHandleClasses;h.callParent([i,Ext.apply(f,{ddGroup:g.id+"-task-dd"})]);Ext.Array.each(j,h.addInvalidHandleClass,h);h.scroll=false;h.isTarget=true;h.ignoreSelf=false;h.el.appendChild(h.proxy.el);g.on({destroy:h.destroy,scope:h})},destroy:function(){if(this.tip){this.tip.destroy()}this.callParent(arguments)},getDragData:function(x){var C=x.getTarget(this.taskSelector);var v=!C&&x.getTarget(this.deadlineSelector);var y=C||v;if(y){var I=this.gantt;var M=C&&x.getTarget(".sch-gantt-task-segment");var e=I.resolveTaskRecord(y);var J=0;var K,F,G;if(!e||e.isReadOnly()){return}if(M){J=Number(M.getAttribute("data-segmentIndex"));if(J>0){y=M;e=e.getSegment(J)}}if(C&&I.fireEvent("beforetaskdrag",I,e,x)===false){return}var N=x.getXY();var z=y.cloneNode(true),w=this.showExactDropPosition?0:I.getSnapPixelAmount(),B=Ext.fly(y).getXY();var L=[N[0]-B[0],N[1]-B[1]];z.id=Ext.id();var D=Ext.fly(y).getHeight();var A=Ext.fly(y).getWidth();Ext.fly(z).setHeight(D);if(Ext.isIE8m&&C&&e.isMilestone()){Ext.fly(z).setSize(D+5,D+5)}if(!I.rtl){z.style.left=-L[0]+"px"}else{z.style.left=A-L[0]+"px"}if(J>0){var E=e.getPrevSegment();var H=e.getNextSegment();K=Sch.util.Date.max(E.getEndDate(),I.timeAxis.getStart());F=H?Sch.util.Date.min(H.getStartDate(),I.timeAxis.getEnd()):I.timeAxis.getEnd();G={left:I.getCoordinateFromDate(K,false)+L[0],right:I.getCoordinateFromDate(F,false)-A+L[0]}}else{G=Ext.fly(I.findItemByChild(y)).getRegion()}this.constrainTo(G,Ext.fly(y).getRegion(),L[0],L[1]);if(w>=1){this.setXConstraint(this.leftConstraint,this.rightConstraint,w)}return{sourceNode:y,repairXY:B,offsetX:L[0],ddel:z,record:e,duration:Sch.util.Date.getDurationInMinutes(e.getStartDate(),e.getEndDate()),startPointDate:I.getDateFromCoordinate(N[0]),minDate:K,maxDate:F,start:null,isTaskDrag:Boolean(C),originalStart:C?e.getStartDate():e.getDeadlineDate(),valid:Boolean(v)}}},onDragOver:function(o){var e=this.dragData,s=e.record,l=e.originalStart,r=this.gantt;if(!e.hidden){Ext.fly(e.sourceNode).hide();e.hidden=true}var t=r.getDateFromCoordinate(o.getXY()[0])-e.startPointDate;var m=new Date(l-0+t);var q=this.proxy.el;var p;if(e.minDate){m=Sch.util.Date.constrain(new Date(l-0+t),e.minDate,e.maxDate)}if(r.timeAxis.isContinuous()){p=r.timeAxis.roundDate(m,r.snapRelativeToEventStartDate?l:false)}else{var n=q.getX()+(r.rtl?q.getWidth():0)+r.getXOffset(s)-e.offsetX;p=r.getDateFromXY([n,0],"round")}if(e.isTaskDrag){this.onTaskDrag(s,o,p,m)}else{if(p&&p-l!==0){this.onCustomElementDrag(s,o,p)}}e.start=p},onTaskDrag:function(t,m,p,l){var e=this.dragData;var s=this.gantt;if(this.showExactDropPosition&&this.skipWeekendsDuringDragDrop){var o=0;var n=t.skipNonWorkingTime(p,!t.isMilestone());var r=t.recalculateEndDate(n);if(l.getTime()!=n.getTime()){o=s.timeAxisViewModel.getDistanceBetweenDates(l,n)}if(l>s.timeAxis.getStart()){Ext.fly(e.ddel.id).setWidth(s.timeAxisViewModel.getDistanceBetweenDates(n,Sch.util.Date.min(r,s.timeAxis.getEnd())));if(o){this.proxy.setX(this.proxy.getX()+o)}}}if(p&&p-e.start!==0){e.valid=this.validatorFn.call(this.validatorFnScope||s,t,p,e.duration,m)!==false;if(this.tip){var q=t.calculateEndDate(p,t.getDuration(),t.getDurationUnit());this.updateTip(t,p,q,e.valid)}}},onCustomElementDrag:function(e,f,d){if(this.tip){this.updateTip(e,d,d,true)}},onStartDrag:function(){var c=this.dragData.record;var d=this.tip;if(d){d.enable();this.updateTip(c,this.dragData.originalStart,c.getEndDate());d.show(this.proxy.el)}if(this.dragData.isTaskDrag){this.gantt.fireEvent("taskdragstart",this.gantt,c)}},updateTip:function(e,g,f,h){h=h!==false;if(this.dragData.isTaskDrag){if(e.isMilestone()&&g-Ext.Date.clearTime(g,true)===0){g=Sch.util.Date.add(g,Sch.util.Date.MILLI,-1);f=Sch.util.Date.add(f,Sch.util.Date.MILLI,-1)}this.tip.updateContent(g,f,true,e)}else{this.tip.updateContent(null,g,true,e)}},afterRepair:function(){Ext.fly(this.dragData.sourceNode).show();if(this.tip){this.tip.hide()}this.dragging=false},getRepairXY:function(){this.dragData.isTaskDrag&&this.gantt.fireEvent("aftertaskdrop",this.gantt);return this.dragData.repairXY},onDragDrop:function(n,r){var l=this,m=l.cachedTarget||Ext.dd.DragDropMgr.getDDById(r),e=l.dragData,p=l.gantt,q=e.start,k=true,o=e.valid&&q&&e.originalStart-q!==0;e.ddCallbackArgs=[m,n,r];if(this.tip){this.tip.disable()}if(e.isTaskDrag&&o){e.finalize=function(){l.finalize.apply(l,arguments)};k=p.fireEvent("beforetaskdropfinalize",p,e,n)!==false}if(k){this.finalize(o)}},finalize:function(p){var m=this,o=this.dragData,i=this.gantt,j=o.record,k=o.start,n,l;if(p){n=o.originalStart;if(o.isTaskDrag){j.setStartDate(k,true,this.skipWeekendsDuringDragDrop,function(a,b){l=j.getStartDate();if(n-l!==0){i.fireEvent("taskdrop",i,j);if(Ext.isIE9){m.proxy.el.setStyle("visibility","hidden");Ext.Function.defer(m.onValidDrop,10,m,o.ddCallbackArgs)}else{m.onValidDrop.apply(m,o.ddCallbackArgs)}}else{m.onInvalidDrop.apply(m,o.ddCallbackArgs)}i.fireEvent("aftertaskdrop",i,j)})}else{j.setDeadlineDate(k);m.onValidDrop.apply(m,o.ddCallbackArgs)}}else{m.onInvalidDrop.apply(m,o.ddCallbackArgs);o.isTaskDrag&&i.fireEvent("aftertaskdrop",i,j)}},onInvalidDrop:function(d,e,f){if(!e){e=d;d=d.getTarget()||document.body}return this.callParent([d,e,f])},autoOffset:function(d,c){this.setDelta(0,0)},setXConstraint:function(f,d,e){this.leftConstraint=f;this.rightConstraint=d;this.minX=f;this.maxX=d;if(e){this.setXTicks(this.initPageX,e)}this.constrainX=true},setYConstraint:function(e,f,d){this.topConstraint=e;this.bottomConstraint=f;this.minY=e;this.maxY=f;if(d){this.setYTicks(this.initPageY,d)}this.constrainY=true},constrainTo:function(e,h,f,g){this.resetConstraints();this.initPageX=e.left+f;this.initPageY=h.top+g;this.setXConstraint(e.left,e.right,this.xTickSize);this.setYConstraint(h.top-1,h.top-1,this.yTickSize)},startDrag:function(){this.gantt.el.ddScrollConfig={increment:Ext.dd.ScrollManager.increment,hthresh:Ext.dd.ScrollManager.hthresh,vthresh:-1};return this.callParent(arguments)},endDrag:function(){delete this.gantt.el.ddScrollConfig;return this.callParent(arguments)}});Ext.define("Gnt.feature.TaskResize",{constructor:function(d){Ext.apply(this,d);var c=this.ganttView;c.on({destroy:this.cleanUp,scope:this});c.mon(c.el,"mousedown",this.onMouseDown,this,{delegate:".sch-resizable-handle"});this.callParent(arguments)},showDuration:true,showExactResizePosition:false,useTooltip:true,tooltipConfig:null,validatorFn:Ext.emptyFn,validatorFnScope:null,taskRec:null,taskEl:null,isStart:null,ganttView:null,resizable:null,onMouseDown:function(k,m){var n=this.ganttView;var j=k.getTarget(".sch-gantt-task-segment");var e=k.getTarget(n.eventSelector);var i=n.resolveTaskRecord(e);if(j){e=j;i=i.getSegment(parseInt(j.getAttribute("data-segmentIndex"),10))}var l=i.isResizable();if(k.button!==0||l===false||typeof l==="string"&&!e.className.match(l)){return}if(n.fireEvent("beforetaskresize",n,i,k)===false){return}k.stopEvent();this.taskEl=Ext.get(e);this.taskRec=i;this.isStart=!!m.className.match("sch-resizable-handle-start");n.el.on({mousemove:this.onMouseMove,mouseup:this.onMouseUp,scope:this,single:true})},onMouseMove:function(u,e){var w=this.ganttView,x=this.taskRec,s=this.taskEl,r=w.rtl,B=this.isStart,y=(r&&!B)||(!r&&B),z=w.getSnapPixelAmount(),A=s.getWidth(),g,q;z=Math.max(1,z);var v={otherEdgeX:y?s.getRight():s.getLeft(),target:s,record:x,isStart:B,isWest:y,handles:y?"w":"e",minHeight:1,minWidth:z,widthIncrement:z,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}};if(x instanceof Gnt.model.TaskSegment&&(q=this.taskEl.next(".sch-gantt-task-segment"))){v.maxWidth=r?q.getRight()-s.getRight():q.getLeft()-s.getLeft()}v.constrainRegion=s.up(w.getItemSelector()).getRegion();s.addCls("sch-gantt-resizing");this.ganttView.fireEvent("taskresizestart",this.ganttView,this.taskRec);var t=s.down(".sch-gantt-progress-bar");if(t){t.setWidth(100*t.getWidth()/s.getWidth()+"%")}this.resizable=Ext.create("Ext.resizer.Resizer",v);this.resizable.resizeTracker.onMouseDown(u,this.resizable[y?"west":"east"].dom);if(this.useTooltip){if(!this.tip){this.tip=Ext.create("Gnt.Tooltip",Ext.apply({mode:this.showDuration?"duration":"startend",gantt:this.ganttView},this.tooltipConfig))}else{this.tip.enable()}this.tip.show(s,u.getX()-15);this.tip.updateContent(x.getStartDate(),x.getEndDate(),true,x);Ext.getBody().on("mouseup",function(){this.tip.disable()},this,{single:true})}},onMouseUp:function(f,e){var d=this.ganttView;d.el.un({mousemove:this.onMouseMove,mouseup:this.onMouseUp,scope:this,single:true})},partialResize:function(A,B,z,v){var D=this.ganttView,F=A.isWest,w=A.record,E;if(F){E=D.getDateFromCoordinate(A.otherEdgeX-Math.min(B,this.resizable.maxWidth),!this.showExactResizePosition?"round":null)}else{E=D.getDateFromCoordinate(A.otherEdgeX+Math.min(B,this.resizable.maxWidth),!this.showExactResizePosition?"round":null)}if(!E||A.date-E===0){return}var I,J,G;if(this.showExactResizePosition){var x=D.timeAxis.roundDate(E,D.snapRelativeToEventStartDate?w.getStartDate():false);x=w.skipNonWorkingTime(x,!w.isMilestone());var e=A.target.el,H;if(F){I=w.skipNonWorkingTime(x,!w.isMilestone());G=I;H=D.timeAxisViewModel.getDistanceBetweenDates(I,w.getEndDate());e.setWidth(H);var u=D.timeAxisViewModel.getDistanceBetweenDates(E,I);e.setX(e.getX()+u)}else{var t=Gnt.util.Data.cloneModelSet([w])[0];var C=w.getTaskStore();t.setTaskStore(C);t.setCalendar(w.getCalendar());t.setEndDateWithoutPropagation(x,false,C.skipWeekendsDuringDragDrop);J=t.getEndDate();G=J;H=D.timeAxisViewModel.getDistanceBetweenDates(w.getStartDate(),J);e.setWidth(H)}}else{I=A.isStart?E:A.record.getStartDate();J=A.isStart?A.record.getEndDate():E;G=E}A.date=G;D.fireEvent("partialtaskresize",D,w,I,J,A.el,v);if(this.useTooltip){var y=this.validatorFn.call(this.validatorFnScope||this,w,I,J)!==false;this.tip.updateContent(I,J,y,w)}},afterResize:function(h,q,w,t){if(this.useTooltip){this.tip.disable()}var s=this,v=h.record,x=v.getStartDate(),e=v.getEndDate(),z=h.isStart?h.date:x,y=h.isStart?e:h.date,u=s.ganttView,p=false,r=true;s.resizeContext={record:v,start:z,end:y,oldStart:v.getStartDate(),finalize:function(){s.finalize.apply(s,arguments)}};if(z&&y&&(z-x||y-e)&&s.validatorFn.call(s.validatorFnScope||s,v,z,y,t)!==false){r=u.fireEvent("beforetaskresizefinalize",s,s.resizeContext,t)!==false;p=true}else{u.refreshKeepingScroll()}if(r){s.finalize(p)}},finalize:function(j){var n=this,l=n.ganttView,p=n.resizeContext,o=p.record,r=o.task||o,q=l.taskStore.skipWeekendsDuringDragDrop,m,k;if(j){if(p.start-p.oldStart!==0){m=o.getStartDate();k=p.start<=p.end?p.start:p.end;o.setStartDate(k,false,q,function(a,b){k=o.getStartDate();if(!(k<m||k>m)){l.refreshNode(l.store.indexOf(r))}l.fireEvent("aftertaskresize",l,r)})}else{m=o.getEndDate();k=p.start<=p.end?p.end:p.start;o.setEndDate(k,false,q,function(a,b){k=o.getEndDate();if(!(k<m||k>m)){l.refreshNode(l.store.indexOf(r))}l.fireEvent("aftertaskresize",l,r)})}}else{l.refreshNode(l.store.indexOf(r));l.fireEvent("aftertaskresize",l,r)}n.resizable.destroy();n.resizeContext=null},cleanUp:function(){if(this.tip){this.tip.destroy()}}});Ext.define("Gnt.field.ReadOnly",{extend:Ext.form.field.Checkbox,mixins:[Gnt.field.mixin.TaskField,Gnt.mixin.Localizable],alias:"widget.readonlyfield",alternateClassName:["Gnt.widget.ReadOnlyField"],taskField:"readOnlyField",setTaskValueMethod:"setReadOnly",getTaskValueMethod:"getReadOnly",instantUpdate:true,valueToVisible:function(b){return b?this.L("yes"):this.L("no")},getValue:function(){return this.value},setValue:function(b){this.callParent([b]);if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}}});Ext.define("Gnt.field.ShowInTimeline",{extend:Ext.form.field.Checkbox,mixins:[Gnt.field.mixin.TaskField,Gnt.mixin.Localizable],alias:"widget.showintimelinefield",alternateClassName:["Gnt.widget.ShowInTimelineField"],taskField:"showInTimelineField",setTaskValueMethod:"setShowInTimeline",getTaskValueMethod:"getShowInTimeline",valueToVisible:function(b){return b?this.L("yes"):this.L("no")},setValue:function(b){this.callParent(arguments);if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}}});Ext.define("Gnt.model.ProjectLine",{extend:Ext.data.Model,idProperty:"Id",fields:[{name:"Id"},{name:"ProjectId"},{name:"Date",type:"date"},{name:"Cls",type:"string"},{name:"Text",type:"string"}]});Ext.define("Gnt.model.TaskSegment",{extend:Gnt.model.Task,task:null,customizableFields:[{name:"StartOffset",type:"int",defaultValue:null},{name:"EndOffset",type:"int",defaultValue:null}],startOffsetField:"StartOffset",endOffsetField:"EndOffset",taskNotifyingSuspended:0,respectNeighbours:0,constructor:function(b){b=b||{};b.leaf=true;if(!b.task){throw"'task' has to be specified"}this.task=b.task;this.callParent(arguments);Ext.override(this,this.overridables);if(this.getTask().normalized&&this.getTaskStore(true)&&!this.normalized){this.normalize()}},overridables:{set:function(){var b=this.getTask();if(b&&!this.__editCounter&&!this.taskNotifyingSuspended){b.onSegmentEditBegin(this)}this.callParent(arguments);if(b&&!this.__editCounter&&!this.taskNotifyingSuspended){b.onSegmentEditEnd(this)}}},serialize:function(){var b={};if(this.getId()){b[this.idProperty]=this.getId()}b[this.phantomIdField]=this.getPhantomId();b[this.startDateField]=this.getStartDate();b[this.endDateField]=this.getEndDate();b[this.durationField]=this.getDuration();b[this.durationUnitField]=this.getDurationUnit();b[this.clsField]=this.getCls();return b},setStartOffset:function(e){var f=this.getTask().getProjectCalendar();var d=f.convertMSDurationToUnit(this.getEndOffset()-e,this.getDurationUnit());this.beginEdit();this.set(this.startOffsetField,e);this.set(this.durationField,d);this.endEdit()},setEndOffset:function(d){var f=this.getTask().getProjectCalendar();var e=f.convertMSDurationToUnit(d-this.getStartOffset(),this.getDurationUnit());this.beginEdit();this.set(this.endOffsetField,d);this.set(this.durationField,e);this.endEdit()},setStartEndOffset:function(f,h){var g=this.getTask().getProjectCalendar();var e=g.convertMSDurationToUnit(h-f,this.getDurationUnit());this.beginEdit();this.set(this.startOffsetField,f);this.set(this.endOffsetField,h);this.set(this.durationField,e);this.endEdit()},normalize:function(){this.callParent(arguments);var g=this.getStartDate();if(!Ext.isNumber(this.getStartOffset())&&g){var l=this.getTask();var h=this.calculateDuration(l.getStartDate(),g,"MILLI");var k=h+this.getDuration("MILLI");var i=l.getProjectCalendar();var j=i.convertMSDurationToUnit(k-h,this.getDurationUnit());this.data[this.startOffsetField]=h;this.data[this.endOffsetField]=k;this.data[this.durationField]=j}},updateOffsetsByDates:function(){if(!this.getTaskStore(true)){return}if(this.updatingOffsets||this.updatingDates){return}this.updatingOffsets=true;var b=this.calculateDuration(this.getTask().getStartDate(),this.getStartDate(),"MILLI");this.setStartEndOffset(b,b+this.getDuration("MILLI"));this.updatingOffsets=false},updateDatesByOffsets:function(m){m=m||{};if(this.updatingDates||this.updatingOffsets){return}var l=m.isForward!==false,n=m.useAbsoluteOffset!==false,i=m.startDate,k=m.endDate,o=this.getTaskStore(true);if(!o){return}this.updatingDates=true;var p,j;if(l){j=this.getPrevSegment();if(j&&!n){p=this.skipWorkingTime(j.getEndDate(),this.getStartOffset()-j.getEndOffset())}else{p=this.skipWorkingTime(i||this.getTask().getStartDate(),this.getStartOffset())}}else{j=this.getNextSegment();if(j&&!n){p=this.skipWorkingTime(j.getStartDate(),j.getStartOffset()-this.getEndOffset()+this.getDuration("MILLI"),false)}else{p=this.skipWorkingTime(k||this.getTask().getEndDate(),this.getDuration("MILLI"),false)}}this.setStartDateWithoutPropagation(p,true,o.skipWeekendsDuringDragDrop);this.updatingDates=false},getPrevSegment:function(){var b=this.task.getSegments();return b[Ext.Array.indexOf(b,this)-1]},getNextSegment:function(){var b=this.task.getSegments();return b[Ext.Array.indexOf(b,this)+1]},buildSnapshot:function(){return[this,Ext.apply({},this.data)]},readSnapshot:function(b){if(b){Ext.apply(this.data,b[1]);return this}return b},enableRespectNeighbours:function(){this.respectNeighbours++},disableRespectNeighbours:function(){this.respectNeighbours--},suspendTaskNotifying:function(){this.taskNotifyingSuspended++},resumeTaskNotifying:function(){this.taskNotifyingSuspended--},setStartDate:function(d,c){if(c){this.enableRespectNeighbours()}this.callParent(arguments);if(c){this.disableRespectNeighbours()}},setStartDateWithoutPropagation:function(){this.beginEdit();this.callParent(arguments);this.updateOffsetsByDates();if(!this.inShifting&&this.respectNeighbours&&this.getNextSegment()){var d=this.getNextSegment();var c=this.getEndOffset()-d.getStartOffset();if(d&&c>0){d.suspendTaskNotifying();d.enableRespectNeighbours();d.shiftWithoutPropagation(c);d.resumeTaskNotifying();d.disableRespectNeighbours()}}this.endEdit();return true},shiftWithoutPropagation:function(f){var d=this;if(!f){return}d.beginEdit();d.inShifting=true;d.setStartEndOffset(d.getStartOffset()+f,d.getEndOffset()+f);d.updateDatesByOffsets();var e;if(d.respectNeighbours&&(e=f>0?d.getNextSegment():d.getPrevSegment())){e.suspendTaskNotifying();e.enableRespectNeighbours();e.shiftWithoutPropagation(f);e.resumeTaskNotifying();e.disableRespectNeighbours()}d.inShifting=false;d.endEdit();return true},setEndDateWithoutPropagation:function(){this.beginEdit();this.callParent(arguments);this.updateOffsetsByDates();this.endEdit();return true},setStartEndDateWithoutPropagation:function(){this.beginEdit();this.callParent(arguments);this.updateOffsetsByDates();this.endEdit();return true},setDurationWithoutPropagation:function(){this.beginEdit();this.callParent(arguments);this.updateOffsetsByDates();this.endEdit();return true},getTask:function(){return this.task},beginEdit:function(){var b=this.getTask();if(b&&!this.__editCounter&&!this.taskNotifyingSuspended){b.onSegmentEditBegin(this)}this.callParent(arguments)},endEdit:function(){var c=this.previous,d=this.getTask();this.callParent(arguments);if(d&&!this.__editCounter&&!this.taskNotifyingSuspended){if(this.startDateField in c||this.endDateField in c||this.startOffsetField in c||this.endOffsetField in c||this.durationField in c){d.onSegmentsChanged(this,c)}d.onSegmentEditEnd(this)}},setSegments:Ext.emptyFn,getSegments:Ext.emptyFn,callTask:function(e){var f=this.task;var g=this.callTask.caller;var h=g&&f[g.$name];if(h){return h.apply(f,e)}},getSchedulingMode:function(){return"Normal"},getCalendar:function(){return this.callTask(arguments)},getOwnCalendar:function(){return this.callTask(arguments)},getProjectCalendar:function(){return this.callTask(arguments)},getDependencyStore:function(){return this.callTask(arguments)},getResourceStore:function(){return this.callTask(arguments)},getAssignmentStore:function(){return this.callTask(arguments)},getTaskStore:function(){return this.callTask(arguments)},forEachAvailabilityInterval:function(b){b.segments=b.segments||false;return this.callTask(arguments)},propagateChanges:function(){return this.callTask(arguments)},rejectSegmentsProjection:function(){return this.callTask(arguments)},commitSegmentsProjection:function(){return this.callTask(arguments)},getAssignments:function(){return this.callTask(arguments)},getAssignmentFor:function(){return this.callTask(arguments)},isAssignedTo:function(){return this.callTask(arguments)},getResources:function(){return this.callTask(arguments)}});Ext.define("Gnt.model.Week",{extend:Ext.data.Model,idProperty:"Id",fields:[{name:"Id"},{name:"name",type:"string"},{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"mainDay"},{name:"weekAvailability"}],set:function(c,d){if(c==="name"){Ext.Array.each(this.get("weekAvailability").concat(this.get("mainDay")),function(a){if(a){a.setName(d)}})}this.callParent(arguments)}});Ext.define("Gnt.model.utilization.DefaultUtilizationNegotiationStrategy",{getUtilizationInfoForUtilizationEvent:function(h){var g=this,f={};g.forEachTimeSpanInterval(h,function e(d,b){var c;if(h.isSurrogateAssignment()){c=h.getOriginalAssignment().getUtilizationInfo(d,b)}else{if(h.isSurrogateSummary()){c=h.getOriginalResource().getUtilizationInfo(d,b)}else{var a=false}}Ext.Object.each(c,function(l,k){f[g.self.makeUtilizationInfoKey(d,b,l)]=k});return c});return f},getUtilizationInfoForAssignmentEventInterval:function(n,k,l){var h=Ext.Date,m=this,i={isUtilized:false,allocationMs:0,allocationDeltaMs:0,isOverallocated:false,isUnderallocated:false,assignmentInfo:null,taskInfo:null},j=n.getUtilizationInfo();l=l||h.add(k,h.DAY,1);Ext.Object.each(i,function(c,a){var b=m.self.makeUtilizationInfoKey(k,l,c);i[c]=j.hasOwnProperty(b)?j[b]:a});return i},forEachTimeSpanInterval:function(i,j){var l=Ext.Date,h=i.getStartDate?i.getStartDate():i.startDate,k=i.getEndDate?i.getEndDate():i.endDate,g;g=l.clearTime(h,true);while(g<k){h=g;g=l.add(g,l.DAY,1);j(h,g)}},adjustStartDateToTick:function(b){return b&&Ext.Date.clearTime(b,true)||b},adjustEndDateToTick:function(g){var h=Ext.Date,e=g,f;if(g){f=new Date(g.getTime()-1);if(f.getDate()!=g.getDate()){e=new Date(g)}else{e=h.clearTime(h.add(g,h.DAY,1))}}return e},calculateResourceAssignmentsTimespan:function(i){var k=this,l=false,j,g;j=new Date(+8640000000000000);g=new Date(-8640000000000000);i.forEachAssignment(function h(a){var c=a.getTask(),b=c&&c.getStartDate()||j,d=c&&c.getEndDate()||g;if(j>b){j=b}if(g<d){g=d}l=true});return{startDate:l&&k.adjustStartDateToTick(j)||null,endDate:l&&k.adjustEndDateToTick(g)||null}},assignmentsComparator:function(a,b){if(a.getTask().getName()>b.getTask().getName()){return 1}return -1},inheritableStatics:{makeUtilizationInfoKey:function(e,f,d){return[e.getTime(),f.getTime(),d].join("-")}}});Ext.define("Gnt.model.utilization.ResourceStoreUtilizationNegotiationStrategy",{extend:Gnt.model.utilization.DefaultUtilizationNegotiationStrategy,config:{resourceUtilizationStore:null,underUtilizationThreshold:null,overUtilizationThreshold:null},constructor:function(d){var c=this;c.initConfig(d)},getUtilizationInfoForUtilizationEvent:function(n){var t=Gnt.model.UtilizationEvent,q=this,o=q.getResourceUtilizationStore(),w=n.getId(),x=o&&o.utilizationInfoCache||{},m=x[w]||null,r,p,u,s;if(!m){r=n.getOriginalResource();p=q.calculateResourceAssignmentsTimespan(r);u=[];r.forEachAssignment(function(a){u.push(a)});u.sort(function(b,a){return q.assignmentsComparator(b,a)});q.forEachTimeSpanInterval(p,function v(c,d){var b=r.getUtilizationInfo(c,d,q.getUnderUtilizationThreshold(),q.getOverUtilizationThreshold()),a,e;a=t.getSurrogateIdFor(r);e=x[a]=(x[a]||{});Ext.Object.each(b,function(g,f){e[q.self.makeUtilizationInfoKey(c,d,g)]=f});s=0;Ext.Array.each(u,function(g){var f,h=g.getId();if(b.assignmentInfo.hasOwnProperty(h)){a=t.getSurrogateIdFor(g);e=x[a]=(x[a]||{});f=b.assignmentInfo[h];Ext.Object.each(f,function(j,i){e[q.self.makeUtilizationInfoKey(c,d,j)]=i})}})});m=x[w]||{}}return m},getUtilizationInfoForAssignmentEventInterval:function(i,l){var j=Ext.Date,o=this,p=o.getResourceUtilizationStore(),m=p.getTimeAxis(),k=m.getTickFromDate(l),n;if(k!==-1&&k<m.count()){n=m.getAt(k).getEndDate()}else{n=j.add(l,1,m.unit)}return o.callParent([i,l,n])},forEachTimeSpanInterval:function(j,k){var n=this,h=n.getResourceUtilizationStore(),m=h.getTimeAxis(),i,l;if(m){i=j.getStartDate?j.getStartDate():j.startDate;l=j.getEndDate?j.getEndDate():j.endDate;i=new Date(Math.max(i,m.getStart()));l=new Date(Math.min(l,m.getEnd()));Ext.Array.each(m.generateTicks(i,l,m.getUnit()),function(a){if(a.start-i>=0&&a.end-l<=0){k(a.start,a.end)}})}else{n.callParent([j,k])}},adjustStartDateToTick:function(f){var h=this,e=h.getResourceUtilizationStore(),g=e.getTimeAxis();return g.floorDate(f,false,g.unit,1)},adjustEndDateToTick:function(f){var h=this,e=h.getResourceUtilizationStore(),g=e.getTimeAxis();return g.ceilDate(f,false,g.unit,1)}});Ext.define("Gnt.view.dependency.Mixin",{extend:Sch.view.dependency.Mixin,dependencyViewConfig:null,enableDependencyDragDrop:true,dependencyDragZoneConfig:null,dependencyDropZoneConfig:null,dependencyDnd:null,dependencyViewDeprecatedRelayDetacher:null,destroy:function(){var b=this;Ext.destroyMembers(b,"dependencyDnd","dependencyViewDeprecatedRelayDetacher");b.callParent()},getDependencyViewConfig:function(){var b=this;return Ext.applyIf(b.callParent()||b.getSchedulingView().dependencyViewConfig||{},{drawDependencies:b.getSchedulingView().drawDependencies!==undefined?b.getSchedulingView().drawDependencies:true})},getDependencyDragZoneConfig:function(){var d=this,e=d.dependencyDragZoneConfig,f;if(!e){f=d.getDependencyViewConfig();if(f){e=f.dragZoneConfig||null}}return e},getDependencyDropZoneConfig:function(){var d=this,e=d.dependencyDragZoneConfig,f;if(!e){f=d.getDependencyViewConfig();if(f){e=f.dropZoneConfig||null}}return e},createDependencyView:function(d,c){return Sch.view.dependency.View.create(Ext.apply({},d,{primaryView:c,type:"basegantt"}))},setupDependencyView:function(e,f){var d=this;d.callParent([e,f]);if(d.enableDependencyDragDrop){d.dependencyDnd=Ext.create("Gnt.feature.DependencyDragDrop",{el:f.getEl(),rtl:f.rtl,ganttView:f,dragZoneConfig:d.getDependencyDragZoneConfig(),dropZoneConfig:d.getDependencyDropZoneConfig(),dependencyStore:d.getDependencyStore(),listeners:{beforednd:d.onBeforeDependencyDrag,dndstart:d.onDependencyDragStart,drop:d.onDependencyDrop,afterdnd:d.onAfterDependencyDragDrop,scope:d}})}},setupDependencyViewRelay:function(){var b=this;b.callParent();Ext.destroy(b.dependencyViewDeprecatedRelayDetacher);b.dependencyViewDeprecatedRelayDetacher=b.getSchedulingView().relayEvents(b.getDependencyView(),["dependencyclick","dependencydblclick","dependencycontextmenu"])},onBeforeDependencyDrag:function(l,h){var k=this,g,i,j;g=k.fireEvent("beforedependencydrag",k,h);j=k.getDependencyView().fireEvent("beforednd",k.getDependencyView(),h);i=k.getSchedulingView().fireEvent("beforedependencydrag",k.getSchedulingView(),h);return g!==false&&j!==false&&i!==false},onDependencyDragStart:function(d){var c=this;c.fireEvent("dependencydragstart",this);c.getDependencyView().fireEvent("dndstart",c.getDependencyView());c.getSchedulingView().fireEvent("dependencydragstart",c.getSchedulingView());if(c.tip){c.tip.disable()}c.preventOverCls=true},onDependencyDrop:function(p,m,i,l){var k=this,n=k.getTaskStore(),o=n.getModelById(m),j=n.getModelById(i);o&&o.linkTo(i,l);k.fireEvent("dependencydrop",k,o,j,l);k.getDependencyView().fireEvent("drop",k.getDependencyView(),o,j,l);k.getSchedulingView().fireEvent("dependencydrop",k.getSchedulingView(),o,j,l)},onAfterDependencyDragDrop:function(){var b=this;b.fireEvent("afterdependencydragdrop",b);b.getDependencyView().fireEvent("afterdnd",b.getDependencyView());b.getSchedulingView().fireEvent("afterdependencydragdrop",b.getSchedulingView());if(b.tip){b.tip.enable()}b.preventOverCls=false}});Ext.define("Gnt.patches.CellEditor",{extend:Sch.util.Patch,target:"Ext.grid.CellEditor",minVersion:"6.0.0",maxVersion:"6.0.2",overrides:{onViewRefresh:function(f){var i=this,h=i.el&&i.el.dom,g,j=i.context;if(h){g=f.getCellByPosition(j,true);if(!g){i.allowBlur=i.wasAllowBlur;i.completeEdit();Ext.getDetachedBody().dom.appendChild(h);return}j.node=f.getNode(j.record);j.row=f.getRow(j.record);j.cell=g;j.rowIdx=f.indexOf(j.row);g.insertBefore(h,g.firstChild);i.boundEl=i.container=Ext.get(g);i.realign(true);if(i.editing){if(Ext.isIE){Ext.defer(function(){if(!i.destroyed){i.allowBlur=i.wasAllowBlur;i.editingPlugin.getActiveEditor()===i&&i.field.focus()}},10)}else{i.allowBlur=i.wasAllowBlur;i.field.focus()}}}}}});Ext.define("Gnt.patches.CellEditing",{extend:Sch.util.Patch,target:"Ext.grid.plugin.CellEditing",minVersion:"5.1.1",maxVersion:"6.0.1.250",overrides:{showEditor:function(e,d,f){if(e.context&&e.context.record!==d.record&&e.field instanceof Ext.form.field.ComboBox){e.field.lastSelectedRecords=null}this.callParent(arguments)},cancelEdit:function(g){var h=this,e=h.context;if(g&&g.isCellEditor){h.context.value=g.context.value=("editedValue" in g)?g.editedValue:g.getValue();var f=h.context;h.context=g.context;h.callParent(arguments);h.context=f;if(g.context===e){h.setActiveEditor(null);h.setActiveColumn(null);h.setActiveRecord(null)}else{h.editing=true}}else{g=h.getActiveEditor();if(g&&g.field){g.cancelEdit()}}}}});Ext.define("Gnt.patches.TreeViewDragDrop",{extend:Sch.util.Patch,target:"Ext.tree.plugin.TreeViewDragDrop",minVersion:"6.0.0",overrides:{disable:function(){this.callParent(arguments);this.dragZone&&this.dragZone.lock();this.dropZone&&this.dropZone.lock()},enable:function(){this.callParent(arguments);this.dragZone&&this.dragZone.unlock();this.dropZone&&this.dropZone.unlock()}}});Ext.define("Gnt.patches.SelectionExtender",{extend:Sch.util.Patch,target:"Ext.grid.selection.SelectionExtender",minVersion:"6.0.0",applyFn:function(){var b={onDrag:function(a){if(!Ext.fly(a.getTarget()).up(".sch-ganttview")){this.callParent(arguments)}}};if(Ext.getVersion().isLessThan("6.0.1")){b.setHandle=function(d,a){d&&d.record&&a&&a.record&&this.callParent(arguments)}}Ext.ClassManager.get(this.target).override(b)}});Ext.define("Gnt.patches.SpreadsheetModel",{extend:Sch.util.Patch,target:"Ext.grid.selection.SpreadsheetModel",minVersion:"6.0.0",applyFn:function(){var b={privates:{onMouseMove:function(d,a){if(!Ext.fly(a).up(".sch-ganttview")){this.callParent(arguments)}},handleMouseDown:function(i,j,h,a){if(!(i instanceof Gnt.view.Gantt)){var g=j.className.indexOf("sch-gantt-column-dragdrop")>=0;if(g){this.selectRows([a],this.isSelected(a))}else{this.callParent(arguments)}}}}};if(Ext.getVersion().isLessThan("6.0.2")){b.select=function(u,a,i){var p=this,v=p.selected,o=p.view,n=o.dataSource,q,s,r,t=false;if(!v||!v.isRows||v.view!==o){p.resetSelection(true);v=p.selected=new Ext.grid.selection.Rows(o)}else{if(!a){v.clear()}}if(!Ext.isArray(u)){u=[u]}q=u.length;for(s=0;s<q;s++){r=u[s];if(typeof r==="number"){r=n.getAt(r)}if(!v.contains(r)){v.add(r);t=true}}if(t){p.updateHeaderState();if(!i){p.fireSelectionChange()}}}}Ext.override(Ext.grid.selection.SpreadsheetModel,b)}});Ext.define("Gnt.patches.LockingView",{extend:Sch.util.Patch,target:"Ext.grid.locking.View",minVersion:"6.0.0",overrides:{getCellByPosition:function(c,d){if(c&&!c.column){return null}return this.callParent(arguments)},onCellDeselect:function(b){if(b&&!b.column){return}return this.callParent(arguments)}}});Ext.define("Gnt.template.Template",{extend:Ext.XTemplate,disableFormats:true,isLegacyIE:Ext.isIE8m,getInnerTpl:Ext.emptyFn,innerTpl:null,dependencyTerminalMarkup:'<div class="sch-gantt-terminal sch-gantt-terminal-start"></div><div class="sch-gantt-terminal sch-gantt-terminal-end"></div>',constructor:function(e){Ext.apply(this,e);var f=e.rtl?"right":"left";var d=this.getInnerTpl(e)||"";this.callParent(['<div class="sch-event-wrap {ctcls} '+Ext.baseCSSPrefix+'unselectable" style="'+f+':{offset}px">','<tpl if="isRollup">',d,"<tpl else>",(e.leftLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-left"><label class="sch-gantt-label sch-gantt-label-left">{leftLabel}</label></div>':""),(e.rightLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-right" style="left:{width}px"><label class="sch-gantt-label sch-gantt-label-right">{rightLabel}</label></div>':""),(e.topLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-top"><label class="sch-gantt-label sch-gantt-label-top">{topLabel}</label></div>':""),d,(e.bottomLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-bottom"><label class="sch-gantt-label sch-gantt-label-bottom">{bottomLabel}</label></div>':""),"</tpl>","</div>"])}});Ext.define("Gnt.template.Task",{extend:Gnt.template.Template,innerTpl:'<div class="sch-gantt-progress-bar" style="width:{progressBarWidth}px;{progressBarStyle}" unselectable="on">&#160;</div>',getInnerTpl:function(d){var c=d.rtl?"right":"left";return'<div id="'+d.prefix+'{id}" class="sch-gantt-item sch-gantt-task-bar {cls}" unselectable="on" style="width:{width}px;{style}"><tpl if="isRollup"><tpl else><tpl if="segments"><div class="sch-gantt-segment-connector"></div></tpl>'+((d.taskResizeHandles==="both"||d.taskResizeHandles==="left")?'<div class="sch-resizable-handle sch-gantt-task-handle sch-resizable-handle-start"></div>':"")+'<tpl for="segments"><div id="'+d.prefix+'{parent.Id}-segment-{[xindex-1]}" class="sch-gantt-task-segment {cls}" style="'+c+':{left}px;width:{width}px;{style}" data-segmentIndex="{[xindex-1]}">'+this.innerTpl+((d.taskResizeHandles==="both"||d.taskResizeHandles==="right")?'<div class="sch-resizable-handle sch-gantt-task-handle sch-resizable-handle-end"></div>':"")+"</div></tpl>"+this.innerTpl+((d.taskResizeHandles==="both"||d.taskResizeHandles==="right")?'<div class="sch-resizable-handle sch-gantt-task-handle sch-resizable-handle-end"></div>':"")+(d.enableProgressBarResize?'<div style="'+c+':{progressBarWidth}px" class="sch-gantt-progressbar-handle"></div>':"")+(d.enableDependencyDragDrop?this.dependencyTerminalMarkup:"")+"</tpl></div>"}});Ext.define("Gnt.template.ParentTask",{extend:Gnt.template.Template,innerTpl:'<div class="sch-gantt-progress-bar" style="width:{progressBarWidth}px;{progressBarStyle}">&#160;</div><div class="sch-gantt-parenttask-arrow sch-gantt-parenttask-leftarrow"></div><div class="sch-gantt-parenttask-arrow sch-gantt-parenttask-rightarrow"></div>',getInnerTpl:function(b){return'<div id="'+b.prefix+'{id}" class="sch-gantt-item sch-gantt-parenttask-bar {cls}" style="width:{width}px; {style}">'+this.innerTpl+((b.enableDependencyDragDrop&&b.allowParentTaskDependencies)?this.dependencyTerminalMarkup:"")+"</div>"}});Ext.define("Gnt.template.Milestone",{extend:Gnt.template.Template,innerTpl:(Ext.isIE8m?('<div style="border-width:{[Math.floor(values.side*0.7)]}px;{style}" class="sch-gantt-milestone-diamond-top {cls}" unselectable="on"></div><div style="border-width:{[Math.floor(values.side*0.7)]}px;{style}" class="sch-gantt-milestone-diamond-bottom {cls}" unselectable="on"></div>'):('<img style="{[values.print ? "height:" + values.side + "px;border-left-width:" + values.side + "px" : ""]};{style}" src="'+Ext.BLANK_IMAGE_URL+'" class="sch-gantt-milestone-diamond {cls}" unselectable="on"/>')),getInnerTpl:function(b){return"<div "+(this.isLegacyIE?'style="width:{[Math.floor(values.side*0.7)]}px"':"")+' id="'+b.prefix+'{id}" class="sch-gantt-item sch-gantt-milestone-diamond-ct">'+this.innerTpl+'<tpl if="isRollup"><tpl else>'+(b.enableDependencyDragDrop?this.dependencyTerminalMarkup:"")+"</tpl></div>"}});Ext.define("Gnt.template.RollupTask",{extend:Ext.XTemplate,text:'<div class="sch-rollup-wrap"><tpl for=".">{[values.tpl.apply(values)]}</tpl></div>',constructor:function(b){this.callParent([this.text])}});Ext.define("Gnt.template.Deadline",{extend:Ext.XTemplate,mixins:[Gnt.mixin.Localizable],disableFormats:true,markup:'<div data-qtip="__DEADLINE__:  {date}" data-qalign="b-tl" class="gnt-deadline-indicator {cls}" style="{dir}:{offset}px"></div>',constructor:function(){this.markup=this.markup.replace(/__DEADLINE__/,this.L("deadline"));this.callParent([this.markup])}});Ext.define("Gnt.view.Gantt",{extend:Sch.view.TimelineGridView,alias:["widget.ganttview"],mixins:[Sch.mixin.GridViewCanvas,Sch.mixin.FilterableTreeView],_cmpCls:"sch-ganttview",scheduledEventName:"task",trackOver:false,toggleOnDblClick:false,eventSelector:".sch-gantt-item",eventWrapSelector:".sch-event-wrap",barMargin:4,progressBarResizer:null,taskResizer:null,taskDragDrop:null,dragCreator:null,resizeConfig:null,createConfig:null,dragDropConfig:null,progressBarResizeConfig:null,externalGetRowClass:null,outsideLabelsGatherWidth:200,constructor:function(b){b=b||{};if(b){this.externalGetRowClass=b.getRowClass;delete b.getRowClass}this.callParent(arguments);this.on({itemupdate:this.onRowUpdate,scope:this});this.mon(this.taskStore,{update:this.onTaskStoreUpdate,scope:this});this.initTreeFiltering()},onBeforeIndentationChange:function(){var b=this.getNavigationModel().getPosition();if(b&&b.record){this._lastNavigatedRecord=b.record}},onIndentationChange:function(){this._lastNavigatedRecord&&this.getNavigationModel().setPosition(this._lastNavigatedRecord);delete this._lastNavigatedRecord},onRender:function(){this.addCls("sch-ganttview-touch-only");this.mon(this.getTaskStore(),{beforeindentationchange:this.onBeforeIndentationChange,indentationchange:this.onIndentationChange,scope:this});this.configureLabels();this.setupGanttEvents();this.setupTemplates();this.callParent(arguments);var b=function(d,a){if(!("TouchEvent" in window&&(d.parentEvent&&d.parentEvent.type.match(/touch/i)))){Ext.getBody().un("mousemove",b,this);this.removeCls("sch-ganttview-touch-only")}};Ext.getBody().on("mousemove",b,this)},getDependencyStore:function(){return this.dependencyStore},configureFeatures:function(){if(this.enableProgressBarResize!==false){this.progressBarResizer=Ext.create("Gnt.feature.ProgressBarResize",Ext.apply({ganttView:this},this.progressBarResizeConfig||{}));this.on({beforeprogressbarresize:this.onBeforeTaskProgressBarResize,progressbarresizestart:this.onTaskProgressBarResizeStart,afterprogressbarresize:this.onTaskProgressBarResizeEnd,scope:this})}if(this.taskResizeHandles!=="none"){this.taskResizer=Ext.create("Gnt.feature.TaskResize",Ext.apply({ganttView:this,validatorFn:this.resizeValidatorFn||Ext.emptyFn,validatorFnScope:this},this.resizeConfig||{}));this.on({beforedragcreate:this.onBeforeDragCreate,beforetaskresize:this.onBeforeTaskResize,taskresizestart:this.onTaskResizeStart,aftertaskresize:this.onTaskResizeEnd,progressbarresizestart:this.onTaskResizeStart,afterprogressbarresize:this.onTaskResizeEnd,scope:this})}if(this.enableTaskDragDrop){this.taskDragDrop=Ext.create("Gnt.feature.TaskDragDrop",this.up("tablepanel").getEl(),Ext.apply({gantt:this,taskSelector:this.eventSelector,deadlineSelector:".gnt-deadline-indicator",validatorFn:this.dndValidatorFn||Ext.emptyFn,validatorFnScope:this,skipWeekendsDuringDragDrop:this.taskStore.skipWeekendsDuringDragDrop},this.dragDropConfig));this.on({beforetaskdrag:this.onBeforeTaskDrag,taskdragstart:this.onDragDropStart,aftertaskdrop:this.onDragDropEnd,scope:this})}if(this.enableDragCreation){this.dragCreator=Ext.create("Gnt.feature.DragCreator",Ext.apply({ganttView:this,validatorFn:this.createValidatorFn||Ext.emptyFn,validatorFnScope:this},this.createConfig))}},getTemplateForTask:function(c,d){if(c.isMilestone(d)){return this.milestoneTemplate}if(c.isLeaf()){return this.eventTemplate}return this.parentEventTemplate},refreshNotReadOnlyChildNodes:function(b){b.cascadeBy({before:function(a){return a==b||!a.getReadOnly()},after:function(a){if(a!==b){this.refreshNode(a)}},scope:this})},setShowRollupTasks:function(f){this.showRollupTasks=f;var e={};this.taskStore.getRootNode().cascadeBy(function(a){if(a.getRollup()){var b=a.parentNode;e[b.internalId]=b}});for(var g in e){var h=this.store.indexOf(e[g]);if(h>=0){this.refreshNode(h)}}},getRollupRenderData:function(B){var F=[];var x=this.timeAxis,w=x.getStart(),t=x.getEnd();for(var y=0;y<B.childNodes.length;y++){var A=B.childNodes[y];var i=A.getStartDate();var C=A.getEndDate()||i&&Sch.util.Date.add(i,A.getDurationUnit()||Sch.util.Date.DAY,1);if(A.getRollup()&&i&&C){if(Sch.util.Date.intersectSpans(i,C,w,t)){var z={},s=A.isMilestone();z.isRollup=true;z.id="rollup_"+A.getId();var D=C>t,E=Sch.util.Date.betweenLesser(i,w,t),u=Math.floor(this.getXFromDate(E?i:w)),r=Math.floor(this.getXFromDate(D?t:C)),v=s?0:r-u;z.offset=(s?(r||u)-this.getXOffset(A):u);z.tpl=s?this.milestoneTemplate:this.eventTemplate;z.cls=A.getCls();z.ctcls="";z.record=A;if(s){z.side=Ext.isIE8m?Math.round(0.3*this.getRowHeight()):Math.round(0.5*this.getRowHeight());z.ctcls+=" sch-gantt-milestone"}else{z.width=Math.max(1,v);if(D){z.ctcls+=" sch-event-endsoutside "}if(!E){z.ctcls+=" sch-event-startsoutside "}z.ctcls+=" sch-gantt-task"}if(A.isReadOnly()){z.ctcls+=" sch-gantt-task-readonly"}if(A.isProject){z.ctcls+=" sch-gantt-project-task"}z.cls+=" sch-rollup-task";F.push(z)}}}return F},getLabelRenderData:function(g){var j=this.leftLabelField,h=this.rightLabelField,i=this.topLabelField,l=this.bottomLabelField,k={};if(j){k.leftLabel=Ext.util.Format.htmlEncode(j.renderer.call(j.scope||this,g.data[j.dataIndex],g))}if(h){k.rightLabel=Ext.util.Format.htmlEncode(h.renderer.call(h.scope||this,g.data[h.dataIndex],g))}if(i){k.topLabel=Ext.util.Format.htmlEncode(i.renderer.call(i.scope||this,g.data[i.dataIndex],g))}if(l){k.bottomLabel=Ext.util.Format.htmlEncode(l.renderer.call(l.scope||this,g.data[l.dataIndex],g))}return k},columnRenderer:function(ad,aC,at){var ac=at.getStartDate(),aI=this.timeAxis,ax=Sch.util.Date,au={},aB="",aj="",aq=aI.getStart(),ae=aI.getEnd(),an=at.isMilestone(),aL=false,aE,aP,ap;if(ac){var aa=at.getEndDate()||ax.add(ac,at.getDurationUnit()||ax.DAY,1),aQ=aI.getAt(0),ai=(aQ.getEndDate()-aQ.getStartDate())/this.timeAxisViewModel.getTickWidth(),am=ai*this.outsideLabelsGatherWidth,aA=ax.intersectSpans(ac,aa,aq,ae),aK=this.outsideLabelsGatherWidth>0,aN=aK&&ax.intersectSpans(ac,aa,ae,new Date(ae.getTime()+am)),av=aK&&ax.intersectSpans(ac,aa,new Date(aq.getTime()-am),aq);if(aA||aN||av){ap=aa>ae;aP=ax.betweenLesser(ac,aq,ae);var ak,ar,aM;if(aA){ak=Math.floor(this.getXFromDate(aP?ac:aq));ar=Math.floor(this.getXFromDate(ap?ae:aa));aM=an?0:ar-ak}else{aP=true;aM=0;if(aN){ak=Math.floor(this.getXFromDate(ae)+(ac-ae)/ai)}else{ak=Math.floor(this.getXFromDate(aq)-(aq-aa)/ai)}}var X=an?(ar||ak)-this.getXOffset(at):ak;var al=Math.min(at.getPercentDone()||0,100)/100,ab,ag,D;var Y=at.getSegments(),ay;if(Y){var aG=0,ao=Y.length,Z,aw;for(Z=0;Z<ao;Z++){aw=Y[Z];aG+=(aw.getEndDate()-aw.getStartDate())*al}ay=[];var af,aJ,aD,aO;for(Z=0;Z<ao;Z++){aw=Y[Z];var aH={},ah=aw.getCls()||"";aO=aw.getEndDate()||at.getStartDate();aD=aw.getStartDate();if(ax.betweenLesser(aD,aq,ae)){af=Math.floor(this.getXFromDate(aD));if(ax.betweenLesser(aO,aq,ae)){aJ=Math.floor(this.getXFromDate(aO))}else{aJ=Math.floor(this.getXFromDate(ae))}}else{af=Math.floor(this.getXFromDate(aq));if(ax.betweenLesser(aO,aq,ae)){aJ=Math.floor(this.getXFromDate(aO))}else{if(aD>ae&&aO>ae){af=aJ=Math.floor(this.getXFromDate(ae))+100}else{if(aD<aq&&aO<aq){af=aJ=Math.floor(this.getXFromDate(aq))-100}else{aJ=Math.floor(this.getXFromDate(ae))}}}}aH.left=af-ak;aH.width=aJ-af;if(!ab){aG-=(aO-aD);if(aG<=0){ab=ax.add(aO,ax.MILLI,aG);ah+=" sch-segment-in-progress";ag=Math.floor(this.getXFromDate(ab));aH.progressBarWidth=Math.min(Math.abs(ag-af),aH.width)}else{aH.progressBarWidth=aw.width}}else{aH.progressBarWidth=0}aH.percentDone=al*100;Ext.apply(aH,aw.data);aH.cls=ah;aH.SegmentIndex=Z;ay.push(aH)}ay[0].cls+=" sch-gantt-task-segment-first";ay[ao-1].cls+=" sch-gantt-task-segment-last"}else{ab=new Date((aa-ac)*al+ac.getTime());if(ab<aq){ab=aq}else{if(ab>ae){ab=ae}}}ag=Math.floor(this.getXFromDate(ab));D=Math.min(Math.abs(ag-ak),aM);au=Ext.apply({},{id:at.internalId+"-x-x",offset:X,width:Math.max(1,aM),ctcls:"",cls:"",print:this._print,record:at,percentDone:al*100,progressBarWidth:Math.max(0,D-2*this.eventBorderWidth),segments:ay},at.data);aE=this.eventRenderer.call(this.eventRendererScope||this,at,au,at.store)||{};Ext.apply(au,this.getLabelRenderData(at));aL=true;Ext.apply(au,aE);var aF=" sch-event-resizable-"+at.getResizable();if(an){au.side=Math.round((this.enableBaseline?0.4:0.5)*this.getRowHeight());aj+=" sch-gantt-milestone"}else{au.width=Math.max(1,aM);if(ap){aj+=" sch-event-endsoutside "}if(!aP){aj+=" sch-event-startsoutside "}if(at.isLeaf()){aj+=" sch-gantt-task"}else{aj+=" sch-gantt-parent-task"}}if(at.isReadOnly()){aj+=" sch-gantt-task-readonly"}if(at.isProject){aj+=" sch-gantt-project-task"}if(at.dirty){aF+=" sch-dirty "}if(at.isDraggable()===false){aF+=" sch-event-fixed "}aF+=at.isSegmented()?" sch-event-segmented ":" sch-event-notsegmented ";au.cls=(au.cls||"")+(at.getCls()||"")+aF;au.ctcls+=" "+aj;if(this.showRollupTasks){var az=this.getRollupRenderData(at);if(az.length>0){aB+=this.rollupTemplate.apply(az)}}aB+=this.getTemplateForTask(at).apply(au)}}if(this.enableBaseline){if(!aE){aE=this.eventRenderer.call(this,at,au,at.store)||{}}aB+=this.baselineRenderer(at,aE,aq,ae,aL)}var i=at.getDeadlineDate();if(i){aB+=this.deadlineTemplate.apply({dir:this.rtl?"right":"left",offset:Math.floor(this.getXFromDate(i)),date:this.getFormattedEndDate(i),cls:(new Date()>i&&!at.isCompleted())?"gnt-deadline-indicator-late":""})}return aB},baselineRenderer:function(z,E,w,u,B){var H=Sch.util.Date,s=z.getBaselineStartDate(),v=z.getBaselineEndDate();if(s&&v&&H.intersectSpans(s,v,w,u)){var C=v>u;var D=H.betweenLesser(s,w,u);var x=z.isBaselineMilestone(),r=Math.floor(this.getXFromDate(D?s:w)),t=Math.floor(this.getXFromDate(C?u:v)),A=Math.max(1,x?0:t-r),F=this.getTemplateForTask(z,true),y={progressBarStyle:E.baseProgressBarStyle||"",id:"base-"+z.internalId,progressBarWidth:Math.min(100,z.getBaselinePercentDone())*A/100,percentDone:z.getBaselinePercentDone(),offset:x?(t||r)-this.getXOffset(z,true):r,print:this._print,width:Math.max(1,A),baseline:true};var G="";if(x){y.side=Math.round(0.4*this.getRowHeight());G="sch-gantt-milestone-baseline sch-gantt-baseline-item"}else{if(z.isLeaf()){G="sch-gantt-task-baseline sch-gantt-baseline-item"}else{G="sch-gantt-parenttask-baseline sch-gantt-baseline-item"}}if(C){G+=" sch-event-endsoutside "}if(!D){G+=" sch-event-startsoutside "}y.ctcls=G+" "+(E.basecls||"");if(!B){Ext.apply(y,this.getLabelRenderData(z))}return F.apply(y)}return""},setupTemplates:function(){var d={leftLabel:this.leftLabelField,rightLabel:this.rightLabelField,topLabel:this.topLabelField,bottomLabel:this.bottomLabelField,prefix:this.eventPrefix,taskResizeHandles:this.taskResizeHandles,enableDependencyDragDrop:this.enableDependencyDragDrop!==false,allowParentTaskDependencies:this.allowParentTaskDependencies!==false,enableProgressBarResize:this.enableProgressBarResize,rtl:this.rtl};var c;if(!this.eventTemplate){c=this.taskBodyTemplate?Ext.apply({innerTpl:this.taskBodyTemplate},d):d;this.eventTemplate=Ext.create("Gnt.template.Task",c)}if(!this.parentEventTemplate){c=this.parentTaskBodyTemplate?Ext.apply({innerTpl:this.parentTaskBodyTemplate},d):d;this.parentEventTemplate=Ext.create("Gnt.template.ParentTask",c)}if(!this.milestoneTemplate){c=this.milestoneBodyTemplate?Ext.apply({innerTpl:this.milestoneBodyTemplate},d):d;this.milestoneTemplate=Ext.create("Gnt.template.Milestone",c)}if(!this.rollupTemplate){this.rollupTemplate=Ext.create("Gnt.template.RollupTask",d)}if(!this.deadlineTemplate){this.deadlineTemplate=Ext.create("Gnt.template.Deadline")}},getDependencyView:function(){return this.ownerGrid.getDependencyView()},getTaskStore:function(){return this.taskStore},getEventStore:function(){return this.getTaskStore()},setupGanttEvents:function(){var b=this.taskStore;if(this.toggleParentTasksOnClick){this.on({taskclick:function(a,g){if(!g.isLeaf()&&(!b.isTreeFiltered()||b.allowExpandCollapseWhileFiltered)){var f=this;var h=function(){this.fireEvent.apply(this,["taskdblclick"].concat(Array.prototype.slice.apply(arguments)))};this.on("taskclick",h);setTimeout(function(){f.un("taskclick",h)},300);g.isExpanded()?g.collapse():g.expand()}}})}},configureLabels:function(){var b={renderer:function(a){return a},dataIndex:undefined};Ext.Array.each(["left","right","top","bottom"],function(d){var a=this[d+"LabelField"];if(a){if(Ext.isString(a)){a=this[d+"LabelField"]={dataIndex:a}}Ext.applyIf(a,b);if(a.editor){a.editor=Ext.create("Gnt.feature.LabelEditor",this,{labelPosition:d,field:a.editor,dataIndex:a.dataIndex})}}},this);this.on("labeledit_beforestartedit",this.onBeforeLabelEdit,this)},onBeforeTaskDrag:function(c,d){return !this.readOnly&&d.isDraggable()!==false&&(this.allowParentTaskMove||d.isLeaf())},onDragDropStart:function(){if(this.tip){this.tip.on("beforeshow",this.falseReturningFn)}},falseReturningFn:function(){return false},onDragDropEnd:function(){if(this.tip){this.tip.un("beforeshow",this.falseReturningFn)}},onTaskProgressBarResizeStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}},onTaskProgressBarResizeEnd:function(){if(this.tip){this.tip.enable()}},onTaskResizeStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}this.getScrollable().setDisabled(true)},onTaskResizeEnd:function(){if(this.tip){this.tip.enable()}this.getScrollable().setDisabled(false)},onBeforeDragCreate:function(){return !this.readOnly},onBeforeTaskResize:function(d,c){return !this.readOnly&&c.getSchedulingMode()!=="EffortDriven"},onBeforeTaskProgressBarResize:function(){return !this.readOnly},onBeforeLabelEdit:function(){return !this.readOnly},afterRender:function(){this.callParent(arguments);this.getEl().on("mousemove",this.configureFeatures,this,{single:true});Ext.dd.ScrollManager.register(this.el)},resolveTaskRecord:function(d){var c=this.findItemByChild(d);if(c){return this.getRecord(c)}return null},resolveEventRecord:function(b){return this.resolveTaskRecord(b)},resolveEventRecordFromResourceRow:function(b){return this.resolveTaskRecord(b)},highlightTask:function(l,g){if(!(l instanceof Ext.data.Model)){l=this.taskStore.getModelById(l)}if(l){l.isHighlighted=true;var j=this.getRow(l);if(j){Ext.fly(j).addCls("sch-gantt-task-highlighted")}if(g!==false){for(var k=0,h=l.successors.length;k<h;k++){var i=l.successors[k];this.highlightDependency(i);this.highlightTask(i.getTargetTask(),g)}}}},unhighlightTask:function(g,j){if(!(g instanceof Ext.data.Model)){g=this.taskStore.getModelById(g)}if(g){g.isHighlighted=false;var k=this.getRow(g);if(k){Ext.fly(k).removeCls("sch-gantt-task-highlighted")}if(j!==false){for(var l=0,h=g.successors.length;l<h;l++){var i=g.successors[l];this.unhighlightDependency(i);this.unhighlightTask(i.getTargetTask(),j)}}}},getRowClass:function(c){var d="";if(c.isHighlighted){d="sch-gantt-task-highlighted"}if(this.externalGetRowClass){d+=" "+(this.externalGetRowClass.apply(this,arguments)||"")}return d},clearSelectedTasksAndDependencies:function(){this.ownerGrid.getDependencyView().clearSelectedDependencies();this.el.select(".sch-gantt-task-highlighted").removeCls("sch-gantt-task-highlighted");this.taskStore.getRootNode().cascadeBy(function(b){b.isHighlighted=false})},getCriticalPaths:function(){return this.taskStore.getCriticalPaths()},highlightCriticalPaths:function(){this.clearSelectedTasksAndDependencies();var i=this.getCriticalPaths(),l=this.getDependencyView(),j,k,g,h;Ext.Array.each(i,function(a){for(k=0,g=a.length;k<g;k++){j=a[k];this.highlightTask(j,false);if(k<g-1){for(var b=0,c=j.predecessors.length;b<c;b++){if(j.predecessors[b].getSourceId()==a[k+1].getId()){h=j.predecessors[b];break}}l.highlightDependency(h)}}},this);this.addCls("sch-gantt-critical-chain")},unhighlightCriticalPaths:function(){this.removeCls("sch-gantt-critical-chain");this.clearSelectedTasksAndDependencies()},getXOffset:function(d,e){var f=0;if(d.isMilestone(e)){f=Math.floor(this.getRowHeight()*0.3535533905932738)-2}return f},onDestroy:function(){if(this.rendered){Ext.dd.ScrollManager.unregister(this.el)}this.callParent(arguments)},highlightDependency:function(b){this.ownerGrid.getDependencyView().highlightDependency(b)},unhighlightDependency:function(b){this.ownerGrid.getDependencyView().unhighlightDependency(b)},getLeftEditor:function(){return this.leftLabelField&&this.leftLabelField.editor},getRightEditor:function(){return this.rightLabelField&&this.rightLabelField.editor},getTopEditor:function(){return this.topLabelField&&this.topLabelField.editor},getBottomEditor:function(){return this.bottomLabelField&&this.bottomLabelField.editor},editLeftLabel:function(d){var c=this.getLeftEditor();if(c){c.edit(d)}},editRightLabel:function(d){var c=this.getRightEditor();if(c){c.edit(d)}},editTopLabel:function(d){var c=this.getTopEditor();if(c){c.edit(d)}},editBottomLabel:function(d){var c=this.getBottomEditor();if(c){c.edit(d)}},getDependenciesForTask:function(b){return b.getAllDependencies()},onRowUpdate:function(e,h){var f=this.store.getAt(h);var g=f.previous;if(g){if(f.parentNode&&(f.rollupField in g||f.getRollup())){this.refreshNode(f.parentNode)}if(f.readOnlyField in g){this.refreshNotReadOnlyChildNodes(f)}}},onTaskStoreUpdate:function(l,g,h,i,k){var j=g.previous;if(j&&g.getRollup()&&g.parentNode&&!g.parentNode.expanded&&l.isUndoingOrRedoing()){this.refreshNode(g.parentNode)}},handleScheduleEvent:function(f){var e=f.getTarget("."+this.timeCellCls,3);if(e){var d=this.findRowByChild(e);if(f.type.indexOf("pinch")>=0){this.fireEvent("schedule"+f.type,this,f)}else{this.fireEvent("schedule"+f.type,this,this.getDateFromDomEvent(f,"floor"),this.indexOf(d),f)}}},scrollEventIntoView:function(y,x,A,p,o){o=o||this;var t=this;var s=this.taskStore;var r=function(a,b){t.up("panel").scrollTask.cancel();t.scrollElementIntoView(a,b,A);if(x){if(typeof x==="boolean"){a.highlight()}else{a.highlight(null,x)}}p&&p.call(o)};if(!y.isVisible()){y.bubble(function(a){a.expand()})}var q;var z=y.getStartDate();var u=y.getEndDate();var B=Boolean(z&&u);if(B){var v=this.timeAxis;if(!v.dateInAxis(z)||!v.dateInAxis(u)){var w=v.getEnd()-v.getStart();v.setTimeSpan(new Date(z.getTime()-w/2),new Date(u.getTime()+w/2))}q=this.getElementFromEventRecord(y)}else{q=this.getNode(y);if(q){q=Ext.fly(q).down(this.getCellSelector())}}if(q){r(q,B)}else{if(this.bufferedRenderer){Ext.Function.defer(function(){t.bufferedRenderer.scrollTo(y,false,function(){var a=t.getElementFromEventRecord(y);if(a){r(a,true)}else{p&&p.call(o)}})},10)}}},getItemBox:function(P){var N=Sch.util.Date,y=this,J=null,M=y.timeAxis.getStart(),O=y.timeAxis.getEnd(),A=P.isMilestone()&&P.getEndDate()||P.getStartDate(),x=P.getEndDate(),K=y.getTaskStore(),C,Q,B,L,S,R,E,T,I;J=(A&&x&&N.intersectSpans(A,x,M,O)&&y.store.indexOf(P)>=0&&(!K.isTreeFiltered()||K.lastTreeFilter.filter.call(K.lastTreeFilter.scope||K,P)))||null;if(J){B=y.getNode(P);if(B){var D,H;var F=y.getNodeContainer();if(P.isMilestone()){var z=y.getRowHeight()*0.16;S=Ext.fly(B).getOffsetsTo(F)[1];D=S+z;H=S+y.getRowHeight()-z}else{var G=Ext.fly(B).down("."+Ext.baseCSSPrefix+"grid-cell-inner > .sch-event-wrap .sch-gantt-item",true);D=Ext.fly(G).getOffsetsTo(F)[1];H=D+Ext.fly(G).getHeight()}C=Math.floor(y.getXFromDate(N.max(A,M)));Q=Math.floor(y.getXFromDate(N.min(x,O)));J={rendered:true,start:C,end:Q,top:Math.round(D),bottom:Math.round(H)}}else{J={rendered:false,start:y.getXFromDate(N.max(A,M)),end:y.getXFromDate(N.min(x,O))};E=y.all.startIndex;I=y.getRecord(E);if(I){R=y.getRowHeight();if(P.isAbove(I)){J.top=-2*R;J.relPos="before"}else{T=y.all.endIndex;J.top=(T-E+1)*R;J.relPos="after"}J.bottom=J.top+R}else{J=null}}if(J){J=y.adjustItemBox(P,J)}}return J},adjustItemBox:function(d,f){var e=f;if(d.isMilestone()){e={rendered:f.rendered,top:f.top,bottom:f.bottom+1,start:f.start-8,end:f.end+8,relPos:f.relPos}}return e}});Ext.define("Gnt.patches.RightClick",{extend:Sch.util.Patch,target:"Gnt.view.Gantt",maxVersion:"6.0.1",overrides:{handleScheduleBarEvent:function(b){if(Ext.isGecko&&b.type==="click"&&b.button===2){return false}return this.callParent(arguments)}}});Ext.define("Gnt.widget.ConstraintResolutionForm",{extend:Ext.form.Panel,mixins:[Gnt.mixin.Localizable],alias:"widget.constraintresolutionform",legacyMode:false,config:{resolutionContext:null,dateFormat:null},bodyPadding:5,autoScroll:true,initComponent:function(){var b=this;b.setupItemsFromResolutionContext(b.resolutionContext);b.setupFooterFromResolutionContext(b.resolutionContext);b.callParent(arguments)},setupItemsFromResolutionContext:function(d){var f=this,e;e=Ext.Array.map(d.resolutions,function(a,b){return{xtype:"radio",boxLabel:f.getResolutionOptionDescription(a.title,d),name:"resolutionOption",checked:a===d.getCancelActionOption(),inputValue:b,tabIndex:b}});f.items=[{xtype:"displayfield",itemId:"description",value:f.getConstraintViolationDescription(d),anchor:"-0"},{xtype:"radiogroup",itemId:"options",columns:1,title:f.L("Resolution options"),allowBlank:false,items:e,anchor:"-0"}]},setupFooterFromResolutionContext:function(d){var c=this;c.fbar={itemId:"footer-tb",items:[{xtype:"checkbox",itemId:"dont-ask-cb",boxLabel:c.L("Don't ask again"),tabIndex:d.resolutions.length+1},"->",{text:c.L("OK"),itemId:"ok-btn",formBind:true,tabIndex:d.resolutions.length+2,handler:c.onUserActionOk,scope:c},{text:c.L("Cancel"),itemId:"cancel-btn",tabIndex:d.resolutions.length+3,handler:c.onUserActionCancel,scope:c}]}},getDontAskValue:function(){var b=this;return b.down("#dont-ask-cb").getValue()},getConstraintViolationDescription:function(m){var k=this,l,o,n,p,i,j;l=m.title;p=m.task;i=p.getName()||"";n=p.getConstraintClass();j=k.dateFormat||k.L("dateFormat")||Ext.Date.defaultFormat;o=n&&n.getDisplayableConstraintDateForFormat(m.date,j,p)||m.date;return o?Ext.String.format(k.L("Task {0} violates constraint {1} {2}"),i,l,Ext.Date.format(o,j)):Ext.String.format(k.L("Task {0} violates constraint {1}"),i,l)},getResolutionOptionDescription:function(j,l){var k=this,n,h,m,i;n=l.task;m=n.getConstraintClass();i=k.dateFormat||k.L("dateFormat")||Ext.Date.defaultFormat;h=m&&m.getDisplayableConstraintDateForFormat(l.date,i,n)||l.date;return h?Ext.String.format(j,Ext.Date.format(h,i)):Ext.String.format(j,"")},onUserActionOk:function(d){var f=this,e;e=f.getValues();e.dontAsk=f.getDontAskValue();f.fireEvent("ok",f,e)},onUserActionCancel:function(d){var c=this;c.fireEvent("cancel",c)},getOptimalHeight:function(m){var l=this,j,k,n,o,p,i;if(m){j=l.getXY();k=l.getWidth();l.setXY([-10000,-10000]);l.setWidth(m)}n=l.getComponent("options");o=n.getEl().getOffsetsTo(l.body);i=l.getDockedComponent("footer-tb");p=o[1]+Ext.getDom(n.getEl()).scrollHeight+2*l.bodyPadding+i.getHeight()+10;if(m){l.setWidth(k);l.setXY(j)}return p}});Ext.define("Gnt.widget.ConstraintResolutionWindow",{extend:Ext.window.Window,alias:"widget.constraintresolutionwindow",mixins:[Gnt.mixin.Localizable],modal:true,closable:true,resizable:true,collapsible:false,border:false,bodyBorder:false,config:{resolutionContext:null,dateFormat:null},form:null,initComponent:function(){var b=this;b.title=b.L("Constraint violation");b.setupItems();b.height=Math.round(Ext.dom.Element.getViewportHeight()/3);b.width=Math.round(Ext.dom.Element.getViewportWidth()/4);b.callParent(arguments);b.on("afterlayout",b.onAfterOptimalLayout,b,{single:true})},setupItems:function(){var b=this;b.layout="fit";b.form=new Gnt.widget.ConstraintResolutionForm({margin:"0 0 3 0",resolutionContext:b.getResolutionContext(),dateFormat:b.getDateFormat(),bubbleEvents:["ok","cancel"]});b.items=b.form},onAfterOptimalLayout:function(){var j=this,i,g,h,f;i=j.getHeight();g=j.form.getHeight();h=j.form.getOptimalHeight();f=h+i-g;i!=f&&j.setHeight(f)}});Ext.define("Gnt.plugin.ConstraintResolutionGui",{extend:Ext.AbstractPlugin,alias:"plugin.constraintresolutiongui",config:{dateFormat:null},cmpDetacher:null,storeDetacher:null,storedResolutions:null,init:function(c){var d=this;d.callParent(arguments);if(!d.disabled){d.enable()}},enable:function(){var c=this,d=c.getCmp();c.callParent();if(d.rendered){c.attachToTaskStore()}else{c.cmpDetacher=d.on("afterrender",function(){c.attachToTaskStore()},null,{destroyable:true,single:true})}},disable:function(){var c=this,d=c.getCmp();c.callParent();if(d.rendered){c.detachFromTaskStore()}else{c.cmpDetacher&&Ext.destroy(c.cmpDetacher);c.cmpDetacher=null}},attachToTaskStore:function(){var f=this,d,e;if(!f.storeDetacher){d=f.getCmp();e=d.getTaskStore();f.storeDetacher=d.mon(e,"constraintconflict",f.onConstraintConflict,f,{destroyable:true})}},detachFromTaskStore:function(){var b=this;b.storeDetacher&&Ext.destroy(b.storeDetacher);b.storeDetacher=null},onConstraintConflict:function(w,x){var p=this,n=p.getCmp(),m=n.lockedGrid.getView(),u=n.normalGrid.getView(),s=n.getDependencyView(),o=u.indexOf(w),v,q,r={destroy:function(){Ext.destroy(q)}};function t(){if(o!=-1){m.refreshNode(o);u.refreshNode(o);s.updateDependencies(w.getAllDependencies())}}t();if(!p.hasStoredResolutionForContext(x)){v=new Gnt.widget.ConstraintResolutionWindow({dateFormat:p.getDateFormat(),resolutionContext:x});q=v.on({ok:Ext.Function.bind(p.onUserActionOk,p,[x,t,v,r],true),cancel:Ext.Function.bind(p.onUserActionCancel,p,[x,t,v,r],true),close:Ext.Function.bind(p.onUserActionClose,p,[x,t,r],true),destroyable:true});n.completeEdit();v.show()}else{p.resolveSilently(x,t)}},getStoredResolutions:function(){var b=this;if(!b.storedResolutions){b.storedResolutions={}}return b.storedResolutions},getStoredResolutionKeyForContext:function(b){return b.title+b.resolutions.length},hasStoredResolutionForContext:function(e){var h=this,f=h.getStoredResolutionKeyForContext(e),g=h.getStoredResolutions();return Ext.isDefined(g[f])},getStoredResolutionForContext:function(e){var h=this,f=h.getStoredResolutionKeyForContext(e),g=h.getStoredResolutions();return g[f]},storeResolutionForContext:function(f,i){var j=this,g=j.getStoredResolutionKeyForContext(f),h=j.storedResolutions;j.storedResolutions[g]=i},resolveSilently:function(f,g){var h=this,e=h.getStoredResolutionForContext(f);f.resolutions[e].resolve();g()},onUserActionOk:function(l,o,p,i,k,m,j){var n=this;Ext.destroy(j);m.close();if(o.dontAsk){n.storeResolutionForContext(i,o.resolutionOption)}i.resolutions[o.resolutionOption].resolve();k()},onUserActionCancel:function(k,n,h,j,l,i){var m=this;Ext.destroy(i);l.close();h.cancelAction();j()},onUserActionClose:function(j,l,g,i,h){var k=this;Ext.destroy(h);g.cancelAction();i()}});Ext.define("Gnt.plugin.ProjectLines",{extend:Sch.plugin.Lines,alias:"plugin.gantt_projectlines",innerTpl:'<span class="sch-gantt-project-line-text" style="{Style}">{Text}</span>',labelHeight:25,showHeaderElements:true,taskStore:null,linesFor:"both",init:function(b){this.taskStore=this.taskStore||b.getTaskStore();this.bindTaskStore(this.taskStore);if(!this.store){this.store=new Ext.data.Store({model:"Gnt.model.ProjectLine"})}this.callParent(arguments);b.on("viewchange",this.onViewChange,this);this.onViewChange()},bindTaskStore:function(d){var c={datachanged:this.onDataChanged,update:this.onUpdate,scope:this,delay:1};if(this.taskStore){this.taskStore.un(c)}if(d){d.on(c)}this.taskStore=d},onDataChanged:function(b){this.refresh()},onUpdate:function(g,f,h){if(f&&f.isProject&&h==Ext.data.Model.EDIT){var e=f.modified&&f.modified.Id||f.getId();this.store.remove(this.getProjectLines(e));this.store.add(this.retrieveProjectLines(f))}},onViewChange:function(){this.refresh()},loadStore:function(){this.store.removeAll(true);this.store.add(this.retrieveProjectLines())},refresh:function(){this.loadStore()},getProjectLines:function(c){var d=[];this.store.each(function(a){if(a.get("ProjectId")==c){d.push(a)}});return d},prepareProjectStartLine:function(c,d){return{Date:c.getStartDate(),Text:"Start of: "+c.getName(),Cls:"sch-gantt-project-line-start sch-gantt-project-line-"+c.getId(),ProjectId:c.getId(),Style:"margin-top:"+(d*this.labelHeight)+"px"}},prepareProjectEndLine:function(c,d){return{Date:c.getEndDate(),Text:"End of: "+c.getName(),Cls:"sch-gantt-project-line-end sch-gantt-project-line-"+c.getId(),ProjectId:c.getId(),Style:"margin-top:"+(d*this.labelHeight)+"px"}},retrieveProjectLines:function(i){var j=this,l=Ext.isArray(i)?i:i&&[i]||this.taskStore.getProjects(),g=[],k=j.linesFor;for(var h=0;h<l.length;h++){k!="end"&&g.push(j.prepareProjectStartLine(l[h],h));k!="start"&&g.push(j.prepareProjectEndLine(l[h],h))}return g},destroy:function(){this.bindTaskStore(null);this.store.destroy();this.callParent(arguments)}});Ext.define("Gnt.plugin.Replicator",{extend:Ext.grid.selection.Replicator,alias:"plugin.gantt_selectionreplicator",init:function(b){this.gantt=b;this.callParent(arguments)},replicateSelection:function(S,E,M){var H=this;if(M.columns||E.isColumns||this.gantt.isReadOnly()){return}var y=E.getFirstRowIndex(),x=E.getLastRowIndex(),L=x-y+1,P={},N=E.view.dataSource,O,G,i,R,U=H.columns,I=U.length,Q,T,F,V,D,J,K,j,C;if(L===1){T=H.getColumnValues(N.getAt(y))}else{T=new Array(I);if(M.rows<0){F=[N.getAt(y+1),N.getAt(y)]}else{F=[N.getAt(x-1),N.getAt(x)]}F[0]=H.getColumnValues(F[0]);F[1]=H.getColumnValues(F[1]);for(C=0;C<I;C++){J=F[1][C];K=F[0][C];if(!isNaN(J)&&!isNaN(K)){T[C]=Number(J)-Number(K)}}}if(M.rows<0){O=M.end.rowIdx;G=M.start.rowIdx-1;i=-1}else{O=M.start.rowIdx;G=M.end.rowIdx+1;i=1}H.gantt.lockedGrid.view.un("beforerefresh",H.gantt.selModel.onBeforeViewRefresh,H.gantt.selModel);H.gantt.normalGrid.view.un("beforerefresh",H.gantt.selModel.onBeforeViewRefresh,H.gantt.selModel);if(L===1){for(j=O;j!==G;j+=i){R=N.getAt(j);if(R.isReadOnly()){continue}for(C=0;C<I;C++){Q=U[C];if(Q.putRawData){Q.putRawData(Ext.clone(T[C]),R)}else{if(Q.dataIndex){R.set(Q.dataIndex,T[C])}}}}}else{for(j=O;j!==G;j+=i){R=N.getAt(j);if(R.isReadOnly()){continue}V=H.getColumnValues(N.getAt(j-i));for(C=0;C<I;C++){Q=U[C];if(Q.dataIndex){D=V[C];if(!isNaN(D)){if(D instanceof Date){R.set(Q.dataIndex,Sch.util.Date.add(D,"ms",T[C]))}else{if(!Ext.isEmpty(D)){R.set(Q.dataIndex,Ext.coerce(Number(D)+T[C],D))}}}}}}}H.gantt.lockedGrid.view.on("beforerefresh",H.gantt.selModel.onBeforeViewRefresh,H.gantt.selModel);H.gantt.normalGrid.view.on("beforerefresh",H.gantt.selModel.onBeforeViewRefresh,H.gantt.selModel)},getColumnValues:function(b){return Ext.Array.map(this.columns,function(a){if(a.getRawData){return a.getRawData(b)}else{if(a.dataIndex){return b.get(a.dataIndex)}}})}});Ext.define("Gnt.panel.Gantt",{extend:Sch.panel.TimelineTreePanel,alias:["widget.ganttpanel"],alternateClassName:["Sch.gantt.GanttPanel"],mixins:[Gnt.view.dependency.Mixin],viewType:"ganttview",layout:"border",rowLines:true,syncRowHeight:false,rowHeight:24,rowNumberColumn:null,topLabelField:null,leftLabelField:null,bottomLabelField:null,rightLabelField:null,weekendsAreWorkdays:false,skipWeekendsDuringDragDrop:true,enableTaskDragDrop:true,enableProgressBarResize:false,toggleParentTasksOnClick:true,addRowOnTab:true,recalculateParents:true,cascadeChanges:false,enableBaseline:false,baselineVisible:false,enableAnimations:false,animate:false,workingTimePlugin:null,todayLinePlugin:null,highlightWeekends:true,allowParentTaskMove:true,allowParentTaskDependencies:true,enableDragCreation:true,eventRenderer:Ext.emptyFn,eventRendererScope:null,eventTemplate:null,parentEventTemplate:null,rollupTemplate:null,milestoneTemplate:null,taskBodyTemplate:null,parentTaskBodyTemplate:null,milestoneBodyTemplate:null,autoHeight:null,calendar:null,crudManager:null,taskStore:null,dependencyStore:null,resourceStore:null,assignmentStore:null,columnLines:false,dndValidatorFn:Ext.emptyFn,createValidatorFn:Ext.emptyFn,resizeHandles:"both",taskResizeHandles:"both",resizeValidatorFn:Ext.emptyFn,resizeConfig:null,progressBarResizeConfig:null,dragDropConfig:null,createConfig:null,autoFitOnLoad:false,showRollupTasks:false,enableConstraintsResolutionGui:true,showProjectLines:true,projectLinesConfig:null,constraintResolutionGuiConfig:null,scrollTaskIntoViewOnClick:false,enableTaskReordering:true,refreshLockedTreeOnDependencyUpdate:false,_lockedDependencyListeners:null,_lastSpreadsheetSelection:null,earlyStartColumn:null,earlyEndColumn:null,lateStartColumn:null,lateEndColumn:null,earlyDatesListeners:null,lateDatesListeners:null,slackListeners:null,refreshTimeout:100,ganttEditingPlugin:null,simpleCascadeThreshold:30,forceDefineTimeSpanByStore:true,keepSelection:true,setShowRollupTasks:function(b){this.showRollupTasks=b;this.getSchedulingView().setShowRollupTasks(b)},onCalendarSet:function(d,c){if(this.needToTranslateOption("weekendsAreWorkdays")){c.setWeekendsAreWorkDays(this.weekendsAreWorkdays)}if(this.workingTimePlugin){this.workingTimePlugin.bindCalendar(c);this.workingTimePlugin.refresh()}this.calendar=c},initStores:function(){if(this.crudManager){if(this.crudManager&&!(this.crudManager instanceof Gnt.data.CrudManager)){this.crudManager=new Gnt.data.CrudManager(this.crudManager)}if(!this.taskStore){this.taskStore=this.crudManager.getTaskStore()}if(!this.dependencyStore){this.dependencyStore=this.crudManager.getDependencyStore()}if(!this.resourceStore){this.resourceStore=this.crudManager.getResourceStore()}if(!this.assignmentStore){this.assignmentStore=this.crudManager.getAssignmentStore()}}if(!this.taskStore){Ext.Error.raise("You must specify a taskStore config.")}var f=Ext.StoreMgr.lookup(this.taskStore);if(!f){Ext.Error.raise("You have provided an incorrect taskStore identifier")}if(!(f instanceof Gnt.data.TaskStore)){Ext.Error.raise("A `taskStore` should be an instance of `Gnt.data.TaskStore` (or of a subclass)")}this.mon(f,{calendarset:this.onCalendarSet,scope:this});this.mon(f,{beforeindentationchange:this.onBeforeBatchStoreUpdate,indentationchange:this.onBatchStoreUpdate,beforebatchremove:this.onBeforeBatchStoreUpdate,batchremove:this.onBatchStoreUpdate,scope:this});Ext.apply(this,{store:f,taskStore:f});var g=this.calendar=f.calendar;if(this.dependencyStore){this.dependencyStore=Ext.StoreMgr.lookup(this.dependencyStore);f.setDependencyStore(this.dependencyStore)}else{this.dependencyStore=f.dependencyStore}this.dependencyStore.allowParentTaskDependencies=this.allowParentTaskDependencies;if(!(this.dependencyStore instanceof Gnt.data.DependencyStore)){Ext.Error.raise("The Gantt dependency store should be a Gnt.data.DependencyStore, or a subclass thereof.")}var e=this.resourceStore?Ext.StoreMgr.lookup(this.resourceStore):f.getResourceStore();if(!(e instanceof Gnt.data.ResourceStore)){Ext.Error.raise("A `ResourceStore` should be an instance of `Gnt.data.ResourceStore` (or of a subclass)")}var h=this.assignmentStore?Ext.StoreMgr.lookup(this.assignmentStore):f.getAssignmentStore();if(!(h instanceof Gnt.data.AssignmentStore)){Ext.Error.raise("An `assignmentStore` should be an instance of `Gnt.data.AssignmentStore` (or of a subclass)")}this.bindAssignmentStore(h,true);this.bindResourceStore(e,true);if(this.needToTranslateOption("weekendsAreWorkdays")){g.setWeekendsAreWorkDays(this.weekendsAreWorkdays)}},onBeforeBatchStoreUpdate:function(){this.taskStore.suspendEvent("refresh","add","insert","remove");this.taskStore.filterUpdateSuspended=true;var f=this.getSchedulingView().getNavigationModel().getPosition();if(f){this._lastNavigationPosition=f.clone()}var h=this.getSelectionModel(),g=h.getSelected();if(g&&g.isCells&&this.keepSelection){this._lastCellSelectedRange=h.getSelected().getRange();var e=[];g.eachRow(function(a){e.push(a)});this._lastCellSelectedRecords=e}if(this.bufferedRenderer){this.suspendLayouts()}},onBatchStoreUpdate:function(){var l=this.getTaskStore();l.resumeEvent("refresh","add","insert","remove");l.filterUpdateSuspended=false;var r=this._lastNavigationPosition;if(r){if(r.record&&l.getNodeById(r.record.getId())){this.getSchedulingView().getNavigationModel().setPosition(r)}delete this._lastNavigationPosition}this.getView().relayFn("refreshView");if(this.bufferedRenderer){this.resumeLayouts(true);l.reApplyFilter()}var s=this._lastCellSelectedRecords;if(s&&s.length){var i=this.lockedGrid.view;var o=-1,t,m;for(var q=0,n=s.length;q<n;q++){m=i.indexOf(s[q]);if(m!==-1){if(o===-1){o=t=m}else{if(m-o>1){break}else{o=m}}}else{if(o!==-1){break}}}if(o!==-1){o=Math.min(i.getNodes().length-1,o);var p=this._lastCellSelectedRange;this.getSelectionModel().selectCells([p[0][0],t],[p[1][0],o])}this._lastCellSelectedRecords=null;this._lastCellSelectedRange=null}},initComponent:function(){this.autoHeight=false;this.initStores();if(this.needToTranslateOption("cascadeChanges")){this.setCascadeChanges(this.cascadeChanges)}if(this.needToTranslateOption("recalculateParents")){this.setRecalculateParents(this.recalculateParents)}if(this.needToTranslateOption("skipWeekendsDuringDragDrop")){this.setSkipWeekendsDuringDragDrop(this.skipWeekendsDuringDragDrop)}this.normalViewConfig=this.normalViewConfig||{};Ext.applyIf(this.normalViewConfig,{taskStore:this.taskStore,dependencyStore:this.dependencyStore,snapRelativeToEventStartDate:this.snapRelativeToEventStartDate,enableDependencyDragDrop:this.enableDependencyDragDrop,enableTaskDragDrop:this.enableTaskDragDrop,enableProgressBarResize:this.enableProgressBarResize,enableDragCreation:this.enableDragCreation,allowParentTaskMove:this.allowParentTaskMove,allowParentTaskDependencies:this.allowParentTaskDependencies,toggleParentTasksOnClick:this.toggleParentTasksOnClick,taskResizeHandles:this.resizable?this.taskResizeHandles:this.resizeHandles,enableBaseline:this.baselineVisible||this.enableBaseline,leftLabelField:this.leftLabelField,rightLabelField:this.rightLabelField,topLabelField:this.topLabelField,bottomLabelField:this.bottomLabelField,eventTemplate:this.eventTemplate,parentEventTemplate:this.parentEventTemplate,milestoneTemplate:this.milestoneTemplate,rollupTemplate:this.rollupTemplate,taskBodyTemplate:this.taskBodyTemplate,parentTaskBodyTemplate:this.parentTaskBodyTemplate,milestoneBodyTemplate:this.milestoneBodyTemplate,resizeConfig:this.resizeConfig,dragDropConfig:this.dragDropConfig,showRollupTasks:this.showRollupTasks});if(this.topLabelField||this.bottomLabelField){this.addCls("sch-gantt-topbottom-labels "+(this.topLabelField?"sch-gantt-top-label":""));this.normalViewConfig.rowHeight=52}this.configureFunctionality();this.mon(this.taskStore,{beforecascade:this.onBeforeCascade,cascade:this.onAfterCascade,scope:this});this.callParent(arguments);var j=this.getSelectionModel();if(this.keepSelection&&j instanceof Ext.grid.selection.SpreadsheetModel){this.mon(this.taskStore,{remove:this.tryRestoreSelectionAfterRemove,priority:1,scope:this});if(Ext.getVersion().isLessThan("6.0.1")){this.mon(this.taskStore,{remove:this.storeSelectionBeforeRemove,priority:1001,scope:this})}this.mon(this.taskStore,{beforebatchremove:this.storeSelectionBeforeRemove,batchremove:this.tryRestoreSelectionAfterBatchRemove,scope:this})}if(j instanceof Ext.grid.selection.SpreadsheetModel){var k=this.lockedGrid;var n=j.applyExtensible;j.applyExtensible=function(b){var a=n.apply(this,arguments);k.body.appendChild(a.handle);this.applyExtensible=n;return a}}if(this.autoFitOnLoad){var h=typeof this.autoFitOnLoad==="object"?this.autoFitOnLoad:{};this.normalGrid.on("afterlayout",function(){if(this.store.getCount()){this.zoomToFit(null,h)}this.mon(this.store,"load",function(){this.zoomToFit(null,h)},this)},this,{single:true})}this.bodyCls=(this.bodyCls||"")+" sch-ganttpanel-container-body";var m=this.getSchedulingView();this.relayEvents(m,["taskclick","taskdblclick","taskcontextmenu","beforetaskresize","taskresizestart","partialtaskresize","beforetaskresizefinalize","aftertaskresize","beforeprogressbarresize","progressbarresizestart","afterprogressbarresize","beforetaskdrag","taskdragstart","beforetaskdropfinalize","beforedragcreate","dragcreatestart","beforedragcreatefinalize","dragcreateend","afterdragcreate","taskdrop","aftertaskdrop","labeledit_beforestartedit","labeledit_beforecomplete","labeledit_complete","scheduleclick","scheduledblclick","schedulecontextmenu","rowlongpress","containerlongpress"]);this.relayEvents(this.lockedGrid.getView(),["rowlongpress","containerlongpress"]);if(this.addRowOnTab){var l=this.lockedGrid.getView();l.onRowExit=Ext.Function.createInterceptor(l.onRowExit,this.beforeRowExit,this)}this.registerRenderer(m.columnRenderer,m);var i=" sch-ganttpanel sch-horizontal ";this.addCls(i);if(this.eventBorderWidth<1){this.addCls("sch-gantt-no-task-border")}if(this.baselineVisible){this.showBaseline()}this.on("add",function(a,b){if(b instanceof Ext.Editor){a.lockedGrid.suspendLayouts();a.suspendLayouts();a.lockedGrid.add(b);a.resumeLayouts();a.lockedGrid.resumeLayouts()}});this.on("viewready",this.onMyViewReady,this);this.on({dragcreatestart:function(){var a=this.findPlugin("scheduler_pan");if(a){a.disable()}this.getSchedulingView().getScrollable().setDisabled(true)},afterdragcreate:function(){var a=this.findPlugin("scheduler_pan");if(a){a.enable()}this.getSchedulingView().getScrollable().setDisabled(false)},scope:this});if(this.scrollTaskIntoViewOnClick){this.lockedGrid.on("itemclick",this.onRowClicked,this)}},tryRestoreSelectionAfterRemove:function(i,z,r){var v=this.getSelectionModel();var y=this._lastSpreadsheetSelection||v.selected;this._lastSpreadsheetSelection=null;if(!y||i.getCount()===0){return}var p=this.lockedGrid.getView();if(y.isCells){var w=y.getRange();if(w[1][0]===-1){return}var s=p.getNodes().length-1;v.selectCells([w[0][0],Math.min(s,w[0][1])],[w[1][0],Math.min(s,w[1][1])])}else{if(y.isRows){var t=y.getRecords();if(t.length){var q=false;for(var x=0,u=t.length;x<u;x++){if(q=q||i.indexOf(t[x])!==-1){break}}if(!q){var o=p.getRecord(Math.min(r,i.getCount()-1));o&&v.select(o)}}}}},storeSelectionBeforeRemove:function(){var c=this.getSelectionModel().getSelected();if(!c){return}c=c.clone();if(c.isRows){var d=c.getRecords();if(d.length){c._lastRecordIndex=this.getView().indexOf(d[d.length-1])}}this._lastSpreadsheetSelection=c},tryRestoreSelectionAfterBatchRemove:function(i,x){var w=this._lastSpreadsheetSelection;this._lastSpreadsheetSelection=null;this.getSelectionModel().onStoreRemove(i,x,null,false);if(!w||i.getCount()===0){return}var t=this.getSelectionModel();var o=this.lockedGrid.getView();if(w.isCells){var u=w.getRange();if(u[1][0]===-1){return}var q=o.getNodes().length;t.selectCells([u[0][0],Math.min(q,u[0][1])],[u[1][0],Math.min(q,u[1][1])])}else{if(w.isRows){var r=w.getRecords();var p=false;for(var v=0,s=r.length;v<s;v++){if(p=p||i.indexOf(r[v])!==-1){break}}if(!p){var n=o.getRecord(Math.min(w._lastRecordIndex,i.getCount()-1));n&&t.select(n)}}}},getTreeViewDragDropPlugin:function(){var e=this.lockedGrid.view.plugins||[];var f;for(var d=0;d<e.length;d++){f=e[d];if(f instanceof Ext.tree.plugin.TreeViewDragDrop){return f}}},doSetTreeViewDragDropDisabled:function(d){var c=this.getTreeViewDragDropPlugin();if(c){if(d){c.disable()}else{c.enable()}}},setTreeViewDragDropDisabled:function(d){var f=this;var e=this.lockedGrid.view;if(e.rendered){f.doSetTreeViewDragDropDisabled(d)}else{e.on("render",function(){f.doSetTreeViewDragDropDisabled(d)})}},restoreSpreadsheetSelectionModel:function(){var d=this.getSelectionModel(),c=this.getTreeViewDragDropPlugin();if(d.isLocked()&&c&&!c.disabled){d.setLocked(false);this.setTreeViewDragDropDisabled(true);this.lockedGrid.view.on("cellmousedown",d.handleMouseDown,d);d.navigationListeners=d.navigationModel.on({navigate:d.onNavigate,scope:d,destroyable:true})}},setReadOnly:function(b){this.callParent(arguments);this.fireEvent("setreadonly",this,b)},getTimeSpanDefiningStore:function(){return this.taskStore},bindAutoTimeSpanListeners:function(){if(!this.autoFitOnLoad){this.callParent(arguments)}},onBeforeCascade:function(){this.lockedGrid.view.onUpdate=this.normalGrid.view.onUpdate=Ext.emptyFn;this.suspendLayouts()},onAfterCascade:function(o,q){var l=this;this.lockedGrid.view.onUpdate=this.lockedGrid.view.self.prototype.onUpdate;this.normalGrid.view.onUpdate=this.normalGrid.view.self.prototype.onUpdate;l.resumeLayouts();if(q.nbrAffected>0){var j=this.lockedGrid.getView();if(q.nbrAffected<=l.simpleCascadeThreshold){var k=this.getView();var n=this.getSchedulingView();n.suspendEvents(true);for(var r in q.affected){var p=q.affected[r];var m=j.store.indexOf(p);if(m>=0){k.refreshNode(m)}}n.resumeEvents();return}this.refreshViews()}},bindFullRefreshListeners:function(f){var h=this;var g;var e=function(){if(g){return}g=setTimeout(function(){g=null;h.redrawColumns([f])},h.refreshTimeout)};f.mon(this.taskStore,{nodeappend:e,nodeinsert:e,noderemove:e,scope:this})},bindSequentialDataListeners:function(d){var f=this.lockedGrid.view;var e=this.taskStore;d.mon(e,{nodeappend:function(b,a){if(!e.fillCount){this.updateAutoGeneratedCells(d,f.store.indexOf(a.parentNode))}},nodeinsert:function(c,a,b){this.updateAutoGeneratedCells(d,f.store.indexOf(b))},noderemove:function(b,a,c){if(!c){this.updateAutoGeneratedCells(d,f.store.indexOf(a))}},nodemove:function(b,a){this.updateAutoGeneratedCells(d,f.store.indexOf(a))},scope:this})},bindSlackListeners:function(){var b=Ext.Function.createBuffered(this.updateSlackColumns,this.refreshTimeout,this,[]);this.slackListeners=this.mon(this.taskStore,{resetearlydates:b,resetlatedates:b,scope:this,destroyable:true})},bindEarlyDatesListeners:function(){var b=Ext.Function.createBuffered(this.updateEarlyDateColumns,this.refreshTimeout,this,[]);this.earlyDatesListeners=this.mon(this.taskStore,{resetearlydates:b,scope:this,destroyable:true})},bindLateDatesListeners:function(){var b=Ext.Function.createBuffered(this.updateLateDateColumns,this.refreshTimeout,this,[]);this.lateDatesListeners=this.mon(this.taskStore,{resetlatedates:b,scope:this,destroyable:true})},startEditScrollToEditor:function(){var b=this.ganttEditingPlugin;!Sch.disableOverrides&&b&&b.on("beforeedit",function(a,d){d.column.getEl().scrollIntoView(this.lockedGrid.getHeaderContainer().getEl())},this,{single:true})},beforeRowExit:function(i,j,k){if(k&&!j){var g=this.lockedGrid.getView();var h=g.getRecord(i);var l=h.addTaskBelow({leaf:true});this.startEditScrollToEditor(l)}},needToTranslateOption:function(b){return this.hasOwnProperty(b)||this.self.prototype.hasOwnProperty(b)&&this.self!=Gnt.panel.Gantt},disableWeekendHighlighting:function(b){this.workingTimePlugin.setDisabled(b)},resolveTaskRecord:function(b){return this.getSchedulingView().resolveTaskRecord(b)},fitTimeColumns:function(){this.getSchedulingView().fitColumns()},getResourceStore:function(){return this.getTaskStore().getResourceStore()},getAssignmentStore:function(){return this.getTaskStore().getAssignmentStore()},getCrudManager:function(){return this.crudManager},getTaskStore:function(){return this.taskStore},getEventStore:function(){return this.taskStore},getDependencyStore:function(){return this.dependencyStore},onDragDropStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}},onDragDropEnd:function(){if(this.tip){this.tip.enable()}},configureFunctionality:function(){var f=this.plugins=[].concat(this.plugins||[]);if(this.enableConstraintsResolutionGui&&!Ext.Array.findBy(f,function(a){return(a instanceof Gnt.plugin.ConstraintResolutionGui)||(a.ptype=="constraintresolutiongui")})){f.push(Ext.apply(this.constraintResolutionGuiConfig||{},{pluginId:"constraintresolutiongui",ptype:"constraintresolutiongui"}))}if(this.showProjectLines){f.push(Ext.apply({pluginId:"gantt_projectlines",ptype:"gantt_projectlines"},this.projectLinesConfig))}if(this.enableTaskReordering){this.lockedViewConfig=this.lockedViewConfig||{};this.lockedViewConfig.plugins=[].concat(this.lockedViewConfig.plugins||[]);var h=this.lockedViewConfig.plugins;var g;Ext.Array.each(h,function(a){if(a==="treeviewdragdrop"||a.ptype==="treeviewdragdrop"){g=true}});if(!g){var e=typeof this.enableTaskReordering!=="boolean"?this.enableTaskReordering:{ptype:"treeviewdragdrop",pluginId:"bryntum_treedragdrop",nodeHighlightOnDrop:false,nodeHighlightOnRepair:false,containerScroll:true,dragZone:{onBeforeDrag:Ext.Function.bind(this.onBeforeTaskReorder,this),beforeDragOver:Ext.Function.bind(this.onBeforeTaskReorderOver,this)}};h.push(e)}}},getWorkingTimePlugin:function(){return this.workingTimePlugin},registerLockedDependencyListeners:function(){var c=this;var d=this.getDependencyStore();this._lockedDependencyListeners=this._lockedDependencyListeners||{load:function(){var a=c.getTaskStore();a.resetEarlyDates();a.resetLateDates();c.lockedGrid.getView().refreshView()},clear:function(){var a=c.getTaskStore();a.resetEarlyDates();a.resetLateDates();c.lockedGrid.getView().refreshView()},add:function(a,b){c.refreshTasksForDependencies(b)},update:function(a,i,b){if(b!=Ext.data.Model.COMMIT){var j=c.lockedGrid.view;if(i.previous[i.fromField]){var k=c.taskStore.getModelById(i.previous[i.fromField]);if(k){j.refreshNode(k)}}if(i.previous[i.toField]){var l=c.taskStore.getModelById(i.previous[i.toField]);if(l){j.refreshNode(l)}}}c.refreshTasksForDependencies([i])},remove:function(a,b){c.refreshTasksForDependencies(b)}};this.mun(d,this._lockedDependencyListeners);this.mon(d,this._lockedDependencyListeners)},getDependencyTasks:function(h){var e=h.getSourceTask(this.taskStore),g=h.getTargetTask(this.taskStore),f=[];if(e&&e.getTreeStore()){f.push(e)}if(g&&g.getTreeStore()){f.push(g)}return f},refreshLockedViewRows:function(f){var d=this.lockedGrid.view;for(var e=0;e<f.length;e++){d.refreshNode(f[e])}},refreshTasksForDependencies:function(g){var h=this,f={},e=[];Ext.Array.each(g,function(c){var a=h.getDependencyTasks(c);for(var b=0;b<a.length;b++){if(!f[a[b].getId()]){f[a[b].getId()]=1;e.push(a[b])}}h.refreshLockedViewRows(e)})},showBaseline:function(){this.addCls("sch-ganttpanel-showbaseline")},hideBaseline:function(){this.removeCls("sch-ganttpanel-showbaseline")},toggleBaseline:function(){this.toggleCls("sch-ganttpanel-showbaseline")},zoomToFit:function(f,e){e=Ext.apply({adjustStart:1,adjustEnd:1},e);if(!f&&this.taskStore.isTreeFiltered()){f=this.getSchedulingView().store.getRange()}var d=f?this.taskStore.getTimeSpanForTasks(f):this.taskStore.getTotalTimeSpan();if(this.zoomToSpan(d,e)===null){if(!f){this.fitTimeColumns()}}},getCascadeChanges:function(){return this.taskStore.cascadeChanges},setCascadeChanges:function(b){this.taskStore.cascadeChanges=b},getRecalculateParents:function(){return this.taskStore.recalculateParents},setRecalculateParents:function(b){this.taskStore.recalculateParents=b},setSkipWeekendsDuringDragDrop:function(b){this.taskStore.skipWeekendsDuringDragDrop=this.skipWeekendsDuringDragDrop=b},getSkipWeekendsDuringDragDrop:function(){return this.taskStore.skipWeekendsDuringDragDrop},bindResourceStore:function(g,f){var h=this;var e={scope:h,update:h.onResourceStoreUpdate,datachanged:h.onResourceStoreDataChanged};if(!f&&h.resourceStore){if(g!==h.resourceStore&&h.resourceStore.autoDestroy){h.resourceStore.destroy()}else{h.mun(h.resourceStore,e)}if(!g){h.resourceStore=null}}if(g){g=Ext.data.StoreManager.lookup(g);h.mon(g,e);this.taskStore.setResourceStore(g)}h.resourceStore=g;if(g&&!f){h.refreshViews()}},bindAssignmentStore:function(g,f){var h=this;var e={scope:h,beforetaskassignmentschange:h.onBeforeSingleTaskAssignmentChange,taskassignmentschanged:h.onSingleTaskAssignmentChange,update:h.onAssignmentStoreUpdate,datachanged:h.onAssignmentStoreDataChanged};if(!f&&h.assignmentStore){if(g!==h.assignmentStore&&h.assignmentStore.autoDestroy){h.assignmentStore.destroy()}else{h.mun(h.assignmentStore,e)}if(!g){h.assignmentStore=null}}if(g){g=Ext.data.StoreManager.lookup(g);h.mon(g,e);this.taskStore.setAssignmentStore(g)}h.assignmentStore=g;if(g&&!f){h.refreshViews()}},onResourceStoreUpdate:function(d,c){Ext.Array.each(c.getTasks(),function(b){var a=this.lockedGrid.view.store.indexOf(b);if(a>=0){this.getView().refreshNode(a)}},this)},onResourceStoreDataChanged:function(){if(this.taskStore.getRootNode().childNodes.length>0){this.refreshViews()}},onAssignmentStoreDataChanged:function(){if(this.taskStore.getRootNode().childNodes.length>0){this.refreshViews()}},onAssignmentStoreUpdate:function(e,g){var f=g.getTask();if(f){var h=this.lockedGrid.view.store.indexOf(f);if(h>=0){this.getView().refreshNode(h)}}},onBeforeSingleTaskAssignmentChange:function(){this.assignmentStore.un("datachanged",this.onAssignmentStoreDataChanged,this)},onSingleTaskAssignmentChange:function(g,h){this.assignmentStore.on("datachanged",this.onAssignmentStoreDataChanged,this);if(this.rendered){var f=this.taskStore.getModelById(h);if(f&&f.parentNode){var e=this.taskStore.indexOf(f);if(e>=0){this.getView().refreshNode(e)}}}},updateAutoGeneratedCells:function(n,p){var i=this.lockedGrid.view;var k=i.all.startIndex;var m=i.all.endIndex;if(p<0||p>m){return}for(var o=Math.max(k,p);o<=m;o++){var l=i.store.getAt(o);var j=this.getCellDom(i,l,n);if(j){j.firstChild.innerHTML=n.renderer(null,null,l)}}},getCellDom:function(e,f,h){var g=e.getNode(f,true);return g&&Ext.fly(g).down(h.getCellSelector(),true)},redrawCell:function(r,o,p,l,n){if(!this.isDestroyed){var k=this.lockedGrid.view;var j=this.getCellDom(k,o,r);if(j){var q=[];if(p===undefined){p=this.taskStore.indexOf(o)}if(l===undefined){l=k.indexOf(o)}if(n===undefined){n=r.getIndex()}k.renderCell(r,o,p,l,n,q);var m=Ext.DomHelper.createDom(q.join(""));Ext.fly(j).down("."+Ext.baseCSSPrefix+"grid-cell-inner").syncContent(m)}}},redrawColumns:function(k){if(k.length&&!this.isDestroyed){var i=this.lockedGrid.view;for(var m=i.all.startIndex;m<=i.all.endIndex;m++){var j=i.store.getAt(m);for(var n=0,l=k.length;n<l;n++){var h=k[n];this.redrawCell(h,j,m,m,h.getIndex())}}}},updateSlackColumns:function(){if(this.slackColumn){this.redrawColumns([this.slackColumn])}},updateEarlyDateColumns:function(){var b=[];if(this.earlyStartColumn){b.push(this.earlyStartColumn)}if(this.earlyEndColumn){b.push(this.earlyEndColumn)}if(b.length){this.redrawColumns(b)}},updateLateDateColumns:function(){var b=[];if(this.lateStartColumn){b.push(this.lateStartColumn)}if(this.lateEndColumn){b.push(this.lateEndColumn)}if(b.length){this.redrawColumns(b)}},onMyViewReady:function(){this.on("beforeedit",this.onBeforeEdit,this);this.setupColumnListeners();var h=this.lockedGrid.plugins||[];Ext.Array.each(h,function(a){if(Sch.plugin&&Sch.plugin.TreeCellEditing&&a instanceof Sch.plugin.TreeCellEditing){this.ganttEditingPlugin=a;return false}},this);this.mon(this.taskStore,{"nodestore-datachange-start":this.onFilterChange,"filter-clear":this.onFilterChange,scope:this});var g=this.down("splitter");if(g){g.on("dragend",function(){this.saveState()},this,{delay:10})}if(this.ganttEditingPlugin){if((Ext.isIE10m||Ext.isFirefox)&&Ext.getVersion().isLessThan("6.0.2")){this.applyIETabbingPatch()}this.ganttEditingPlugin.on({editingstart:this.onEditingStart,edit:this.onAfterEdit,canceledit:this.onAfterEdit})}var e=this.getTreeViewDragDropPlugin();if(e&&this.getSelectionModel() instanceof Ext.grid.selection.SpreadsheetModel){var f=this.lockedGrid.getView();f.getEl().on("mouseover",function(a,b){if(Ext.fly(b).hasCls("sch-gantt-column-dragdrop")){e.enable()}else{e.disable()}},this,{delegate:f.getCellSelector()})}},applyIETabbingPatch:function(){var c=function(a,f){var b=f.column;b.preventUpdate=b._oldPreventUpdate;this.redrawCell(b,f.record)};var d=function(a,f){var b=f.column;b._oldPreventUpdate=b.preventUpdate;b.preventUpdate=true};this.ganttEditingPlugin.on({edit:c,canceledit:c,scope:this});this.ganttEditingPlugin.on({beforeedit:d,priority:-50})},onBeforeEdit:function(d,f){var e=f.column;return !this.isReadOnly()&&f.record.isEditable(f.field)&&(!e.isEditable||e.isEditable(f.record))},onEditingStart:function(e,d){var f=d.field;if(f.originalInstantUpdate){f.setInstantUpdate(true)}},onAfterEdit:function(d,e){var f=e.column.getEditor();if(f.setInstantUpdate){f.setInstantUpdate(false)}},onFilterChange:function(){this.getSelectionModel().deselectAll()},setupColumnListeners:function(){var d=this;var c=this.lockedGrid.getHeaderContainer();c.on("add",this.onLockedColumnAdded,this);c.items.each(function(a){d.onLockedColumnAdded(c,a)})},onLockedColumnAdded:function(d,e){var f=Gnt.column;if(f){if((f.WBS&&e instanceof f.WBS)||(f.Sequence&&e instanceof f.Sequence)){this.bindSequentialDataListeners(e)}else{if(f.Dependency&&e instanceof f.Dependency&&e.useSequenceNumber){this.bindFullRefreshListeners(e)}else{if(f.EarlyStartDate&&e instanceof f.EarlyStartDate){this.earlyStartColumn=e}else{if(f.EarlyEndDate&&e instanceof f.EarlyEndDate){this.earlyEndColumn=e}else{if(f.LateStartDate&&e instanceof f.LateStartDate){this.lateStartColumn=e}else{if(f.LateEndDate&&e instanceof f.LateEndDate){this.lateEndColumn=e}else{if(f.Slack&&e instanceof f.Slack){this.slackColumn=e}}}}}}}}if(!this.slackListeners&&this.slackColumn){this.bindSlackListeners()}if(!this.earlyDatesListeners&&(this.earlyStartColumn||this.earlyEndColumn)){this.bindEarlyDatesListeners()}if(!this.lateDatesListeners&&(this.lateStartColumn||this.lateEndColumn)){this.bindLateDatesListeners()}},getState:function(){var d=this,c=d.callParent(arguments);c.lockedWidth=d.lockedGrid.getWidth();return c},applyState:function(c){var d=this;d.callParent(arguments);if(c&&c.lockedWidth){d.lockedGrid.setWidth(c.lockedWidth)}},completeEdit:function(){this.ganttEditingPlugin&&this.ganttEditingPlugin.completeEdit()},cancelEdit:function(){this.ganttEditingPlugin&&this.ganttEditingPlugin.cancelEdit()},setRowHeight:function(d){var c="#"+this.getId()+" ."+Ext.baseCSSPrefix+"grid-cell";if(!Ext.util.CSS.getRule(c)){Ext.util.CSS.createStyleSheet(c+"{ height:"+d+"px; }")}else{Ext.util.CSS.updateRule(c,"height",d+"px")}this.getSchedulingView().setRowHeight(d)},getTaskEditor:function(j){var f=this.plugins;for(var i=0,g=f.length;i<g;i++){var h=f[i];if(h.isTaskEditor&&(!j||h.matchFilters(j))){return h}}},onRowClicked:function(d,c){this.getSchedulingView().scrollEventIntoView(c,false,false)},onBeforeTaskReorder:function(f,d){var e=d.record;this._reorderingTask=e;return !this.isReadOnly()&&e&&!e.isReadOnly()},onBeforeTaskReorderOver:function(g,e){var h=g.getTargetFromEvent(e);if(h){var f=g.view.getRecord(h);return f!==this._reorderingTask&&!f.isReadOnly()}},getSelectedRows:function(){var d=this.getSelectionModel().getSelected();var c=[];if(Ext.grid.selection.Cells&&d instanceof Ext.grid.selection.Cells){d.eachRow(function(a){c.push(a)})}else{c=this.getSelectionModel().getSelection()}return c},destroy:function(){if(this.destroyStores){var b=this.taskStore.calendarManager;this.assignmentStore&&this.assignmentStore.destroy();this.assignmentStore=null;this.resourceStore&&this.resourceStore.destroy();this.resourceStore=null;this.taskStore&&this.taskStore.destroy();this.taskStore=null;this.dependencyStore&&this.dependencyStore.destroy();this.dependencyStore=null;this.dependencyStore&&this.dependencyStore.destroy();this.dependencyStore=null;b&&b.destroy()}this.callParent(arguments)},collapseAll:function(){this.taskStore.suspendEvent("refresh","add","insert","remove");this.lockedGrid.getView().blockRefresh=this.normalGrid.getView().blockRefresh=true;this.callParent(arguments);this.lockedGrid.getView().blockRefresh=this.normalGrid.getView().blockRefresh=false;this.taskStore.resumeEvent("refresh","add","insert","remove");this.refreshViews()},expandAll:function(){this.lockedGrid.getView().blockRefresh=this.normalGrid.getView().blockRefresh=true;this.callParent(arguments);this.lockedGrid.getView().blockRefresh=this.normalGrid.getView().blockRefresh=false;this.refreshViews()}});Ext.define("Gnt.view.ResourceHistogram",{extend:Sch.view.TimelineGridView,alias:"widget.resourcehistogramview",mixins:[Sch.mixin.GridViewCanvas],_cmpCls:"gnt-resourcehistogramview",scheduledEventName:"bar",eventSelector:".gnt-resourcehistogram-bar",barTpl:null,barRenderer:Ext.emptyFn,limitLineRenderer:Ext.emptyFn,lineRenderer:Ext.emptyFn,lineTpl:null,limitLineTpl:null,_barCls:"gnt-resourcehistogram-bar",_limitLineCls:"gnt-resourcehistogram-limitline",_limitLineVerticalCls:"gnt-resourcehistogram-limitline-vertical",_lineCls:"gnt-resourcehistogram-line",barCls:null,limitLineCls:null,lineCls:null,limitLineWidth:1,rowHeight:60,showLimitLinesThreshold:10,showVerticalLimitLines:true,labelMode:false,labelPercentFormat:"0",labelUnitsFormat:"0.0",histogram:null,unitHeight:null,availableRowHeight:null,initComponent:function(b){if(this.barCls){this.eventSelector="."+this.barCls}if(!this.barTpl){this.barTpl=new Ext.XTemplate('<tpl for=".">','<div id="{id}" class="gnt-resourcehistogram-bar '+(this.barCls||"")+' {cls}" gnt-bar-index="{index}" style="left:{left}px;top:{top}px;height:{height}px;width:{width}px">',"<tpl if=\"text !== ''\">",'<span class="gnt-resourcehistogram-bar-text" style="bottom:'+Math.floor(this.rowHeight/2)+'px">{text}</span>',"</tpl>","</div>","</tpl>")}if(!this.lineTpl){this.lineTpl=new Ext.XTemplate('<tpl for=".">','<div class="gnt-resourcehistogram-line '+(this.lineCls||"")+' {cls}" style="top:{top}px;"></div>',"</tpl>")}if(!this.limitLineTpl){this.limitLineTpl=new Ext.XTemplate('<tpl for=".">','<div class="gnt-resourcehistogram-limitline '+(this.limitLineCls||"")+' {cls}" style="left:{left}px;top:{top}px;width:{width}px;height:{height}px"></div>',"</tpl>")}this.callParent(arguments);this.unitHeight=this.getAvailableRowHeight()/(this.scaleMax-this.scaleMin+this.scaleStep)},renderLines:function(){return this.lineTpl.apply(this.prepareLines())},prepareLines:function(){var v=this.scaleMin,r=this.scaleMax,q=v,u=this.scaleLabelStep,z=this.getAvailableRowHeight(),t=[],i=this._lineCls,p=i+"min";var l,y;if(this.scalePoints){for(var w=0,x=this.scalePoints.length;w<x;w++){var s=this.scalePoints[w];l={value:s.value,top:s.top||Math.round(z-this.unitHeight*(s.value-v)),cls:s.cls+(s.label?" "+i+"-label":"")+(w===0?" "+i+"-min":(w==x?" "+i+"-max":""))};y=this.lineRenderer(t,l);t.push(Ext.apply(l,y))}}else{while(q<=r){l={value:q,top:Math.round(z-this.unitHeight*(q-v)),cls:p};y=this.lineRenderer(t,l);t.push(Ext.apply(l,y));q+=this.scaleStep;p=q%u?"":i+"-label";if(q==r){p+=" "+i+"-max"}}if(t.length&&t[t.length-1].value!==r){l={value:r,top:Math.round(z-this.unitHeight*(r-v)),cls:(r%u?"":i+"-label")+" "+i+"-max"};y=this.lineRenderer(t,l);t.push(Ext.apply(l,y))}}return t},renderLimitLines:function(b){return this.limitLineTpl.apply(this.prepareLimitLines(b))},getLimitLinesConnector:function(c,d){return{left:c.right,width:1,top:Math.min(c.top,d.top),height:Math.abs(c.top-d.top)+this.limitLineWidth,cls:this._limitLineCls+"-top "+this._limitLineVerticalCls}},pushLimitLine:function(j,f,i){var h=j[j.length-1];if(i){if(h){h.width=i.right-h.left;h.right=i.right}else{f.left=i.left;f.width=f.right-i.left}}if(h&&this.showVerticalLimitLines){if(!h.visible){j.pop()}j.push(this.getLimitLinesConnector(h,f))}var g=this.limitLineRenderer(j,f,i);j.push(Ext.apply(f,g))},prepareLimitLines:function(i){if(!i){return}var M=[],N=this.scaleMin,K=this.scaleMax,E=this.scaleStep,x=this.scaleUnit,L=this.getAvailableRowHeight(),B=this._limitLineCls,w=this.getTimeAxisViewModel()&&this.getTimeAxisViewModel().getTotalWidth(),A,F,D;for(var y=0,z=i.length;y<z;y++){var J=this.calendar.convertMSDurationToUnit(i[y].allocationMS,x);var I=true;if(J*this.unitHeight>L){J=K+E;I=false}else{if(J<=0){J=0;I=false}}var H=i[y].startDate&&this.getXFromDate(i[y].startDate,true)||0;var l=i[y].endDate&&this.getXFromDate(i[y].endDate,true)||w;if(H<0){H=0}if(l<0){l=w}F={left:H,width:l-H,right:l,top:"",height:0,cls:"",visible:I};F.top=Math.round(L-(J-N)*this.unitHeight);if(I){F.cls+=" "+B+"-top"}D=M[M.length-1]||A;var G=F.width<=this.showLimitLinesThreshold;if(D&&(F.top==D.top||(G&&!I))){D.width=l-D.left;D.right=l;F=null;if(M[M.length-1]){A=null}else{if(A.width>this.showLimitLinesThreshold){this.pushLimitLine(M,A);A=null}}}else{if(G&&I){if(A){var C=A.width+F.width;A.top=Math.round(F.top*F.width/C+A.top*A.width/C);A.width=l-A.left;A.right=l}else{A=F}if(A.width>this.showLimitLinesThreshold){this.pushLimitLine(M,A);F=A=null}}else{this.pushLimitLine(M,F,A);F=A=null}}}F&&this.pushLimitLine(M,F,A);D=M[M.length-1];if(D&&!D.visible){M.pop()}return M},renderBars:function(d,c){return this.barTpl.apply(this.prepareBars(d,c))},prepareBars:function(x,v){if(!x){return}var s=[],F=this.getAvailableRowHeight(),i=this._barCls,C=this.scaleUnit,z=Sch.util.Date.getShortNameOfUnit(C),w=this.scaleMin,l=this.scaleMax,t=this.scaleStep,A=l+t,D,u;for(var y=0,B=x.length;y<B;y++){if(x[y].totalAllocation){u=this.calendar.convertMSDurationToUnit(x[y].allocationMS,C);D={id:v+"-"+y,index:y,left:this.getXFromDate(x[y].startDate,true),width:this.getXFromDate(x[y].endDate,true)-this.getXFromDate(x[y].startDate,true),height:F,top:0,text:"",cls:""};if(this.labelMode){switch(this.labelMode){case"percent":D.text=Ext.util.Format.number(x[y].totalAllocation,this.labelPercentFormat)+"%";break;case"units":D.text=Ext.util.Format.number(u,this.labelUnitsFormat)+z;break;default:D.text=this.labelMode.apply({allocation:u,percent:x[y].totalAllocation})}}if(u<=A){D.height=u>=w?Math.round((u-w)*this.unitHeight):0;D.top=F-D.height}else{D.cls+=" "+i+"-partofbar"}if(x[y].totalAllocation>100||x[y].totalOverAllocationMS>0){D.cls+=" "+i+"-overwork"}var E=this.barRenderer(v,x[y],D);if(E&&E.cls){E.cls=D.cls+" "+E.cls}D=Ext.apply(D,E);s.push(D)}}return s},getAvailableRowHeight:function(){if(this.availableRowHeight){return this.availableRowHeight}this.availableRowHeight=this.rowHeight-this.cellTopBorderWidth-this.cellBottomBorderWidth;return this.availableRowHeight},resolveEventRecord:function(n){var l=this.findItemByChild(n);if(l){var j=this.getRecord(l);if(j){var i={resource:j};var k=this.histogram.allocationData[j.getId()];var h=n.getAttribute("gnt-bar-index");var m=k.bars[h];if(m){i.startDate=m.startDate;i.endDate=m.endDate;i.assignments=m.assignments;i.allocationMS=m.allocationMS;i.totalAllocation=m.totalAllocation}return i}}return null},resolveEventRecordFromResourceRow:function(b){return this.resolveEventRecord(b)},getDataForTooltipTpl:function(b){return b}});Ext.define("Gnt.panel.ResourceHistogram",{extend:Sch.panel.TimelineGridPanel,mixins:[Gnt.mixin.Localizable],alias:"widget.resourcehistogram",viewType:"resourcehistogramview",layout:"border",preserveScrollOnRefresh:true,showScaleLines:false,showLimitLines:true,showLimitLinesThreshold:10,showVerticalLimitLines:true,cacheLimitDurationMS:0,cacheLimitDuration:6,cacheLimitDurationUnit:"mo",calendarResources:null,calendarListenersHash:null,calendar:null,taskStore:null,resourceStore:null,assignmentStore:null,startDate:null,endDate:null,highlightWeekends:true,allocationData:null,scaleUnit:"HOUR",scaleMin:0,scaleMax:24,scaleLabelStep:4,scaleStep:2,rowHeight:50,scaleColumnClass:"Gnt.column.Scale",scaleColumnConfigs:["scalePoints","scaleStep","scaleLabelStep","scaleMin","scaleMax","scaleLabelStep","scaleStep"],normalViewConfigs:["barCls","barTpl","barRenderer","lineRenderer","limitLineRenderer","lineTpl","lineCls","limitLineTpl","limitLineCls","limitLineWidth","labelMode","labelPercentFormat","labelUnitsFormat","scaleMin","scaleMax","scaleStep","scaleLabelStep","scalePoints","scaleUnit","loadMask","showLimitLinesThreshold","showVerticalLimitLines","calendar"],cacheUpdateSuspended:false,suspendedCacheUpdatesCount:0,gapThreshold:24*3600000,rowLines:true,initComponent:function(){this.cacheLimitDurationMS=Sch.util.Date.getUnitDurationInMs(this.cacheLimitDurationUnit)*this.cacheLimitDuration;this.resetAllocationDataCache();this.initStores();this.lockedGridConfig=Ext.applyIf(this.lockedGridConfig||{},{reserveScrollbar:false,width:300,forceFit:true});this.normalViewConfig=Ext.apply(this.normalViewConfig||{},{histogram:this,trackOver:false,rowHeight:this.rowHeight,preserveScrollOnRefresh:this.preserveScrollOnRefresh});this.lockedViewConfig=Ext.apply(this.lockedViewConfig||{},{rowHeight:this.rowHeight,preserveScrollOnRefresh:this.preserveScrollOnRefresh});if(this.scalePoints){this.scalePoints.sort(function(a,b){return a.value>b.value?1:-1});this.scaleMin=this.scalePoints[0].value;this.scaleMax=this.scalePoints[this.scalePoints.length-1].value;this.scaleStep=(this.scaleMax-this.scaleMin)/10}this.initColumns();Ext.Array.each(this.normalViewConfigs,function(a){if(a in this){this.normalViewConfig[a]=this[a]}},this);this.callParent(arguments);var c="gnt-resourcehistogram sch-horizontal ";if(this.highlightWeekends){c+=" gnt-resourcehistogram-highlightweekends "}this.addCls(c);this.registerRenderer(this.columnRenderer,this);var d=this.getSchedulingView();this.relayEvents(d,["barclick","bardblclick","barcontextmenu"])},initStores:function(){var b=false;if(this.crudManager){this.setCrudManager(this.crudManager);b=true}this.store=this.resourceStore;this.taskStore=this.taskStore||this.store.getTaskStore();this.calendar=this.calendar||this.taskStore&&this.taskStore.getCalendar();if(!this.calendar){throw'Cannot get project calendar instance: please specify either "calendar" or "taskStore" option'}this.assignmentStore=this.assignmentStore||this.store.getAssignmentStore()||this.taskStore&&this.taskStore.getAssignmentStore();if(!b){this.bindStores()}},getCrudManager:function(){return this.crudManager},setCrudManager:function(b){this.unbindStores();this.crudManagerListeners&&this.crudManagerListeners.destroy();this.crudManager=b;this.taskStore=this.crudManager.getTaskStore();this.store=this.resourceStore=this.crudManager.getResourceStore();this.assignmentStore=this.crudManager.getAssignmentStore();this.crudManagerListeners=this.mon(this.crudManager,{beforeloadapply:{fn:this.beforeCrudManagerLoad,priority:-999},load:this.afterCrudManagerLoad,destroyable:true,scope:this});this.bindStores()},beforeCrudManagerLoad:function(){this.suspendStoreListeners()},afterCrudManagerLoad:function(){this.beforeCrudOperationStart(this.crudManager,null,"load");this.resumeStoreListeners(true);this.onCrudOperationComplete()},bindStores:function(){if(this.taskStore){this.mon(this.taskStore,{refresh:this.onTaskStoreRefresh,load:this.onTaskStoreRefresh,update:this.onTaskUpdate,nodeappend:this.onTaskUpdate,scope:this})}if(this.assignmentStore){this.mon(this.assignmentStore,{refresh:this.onAssignmentsRefresh,remove:this.onAssignmentsChange,update:this.onAssignmentUpdate,add:this.onAssignmentsChange,scope:this})}this.calendar&&this.mon(this.calendar,{calendarchange:this.onProjectCalendarChange,scope:this});this.bindCalendarListeners();this.store&&this.mon(this.store,{update:this.onResourceUpdate,refresh:this.onResourceStoreRefresh,scope:this,priority:100})},unbindStores:function(){if(this.taskStore){this.mun(this.taskStore,{refresh:this.onTaskStoreRefresh,load:this.onTaskStoreRefresh,update:this.onTaskUpdate,nodeappend:this.onTaskUpdate,scope:this})}if(this.assignmentStore){this.mun(this.assignmentStore,{refresh:this.onAssignmentsRefresh,remove:this.onAssignmentsChange,update:this.onAssignmentUpdate,add:this.onAssignmentsChange,scope:this})}this.calendar&&this.mun(this.calendar,{calendarchange:this.onProjectCalendarChange,scope:this});this.unbindCalendarListeners();this.store&&this.mun(this.store,{update:this.onResourceUpdate,refresh:this.onResourceStoreRefresh,scope:this,priority:100})},suspendStoreListeners:function(){this.cacheUpdateSuspended=true;this.suspendedCacheUpdatesCount=0;this.unbindStores()},resumeStoreListeners:function(b){this.cacheUpdateSuspended=false;this.bindStores();if(b&&this.suspendedCacheUpdatesCount){this.clearCacheAndRefresh()}},clearCacheAndRefresh:function(b){this.resetAllocationDataCache(b);this.refreshIfRendered(b)},createDefaultColumns:function(){var d=[],f,e;f=this.resourceNameCol=new Ext.grid.column.Column({flex:1,resizable:false,text:this.L("resourceText"),dataIndex:this.resourceStore.model.prototype.nameField});d.push(f);e={width:40,resizable:false,availableHeight:this.rowHeight};Ext.copyTo(e,this,this.scaleColumnConfigs,true);e=this.scaleCol=Ext.create(this.scaleColumnClass,e);e.on({beforerender:function(){e.setAvailableHeight(this.getSchedulingView().getAvailableRowHeight());if(this.scalePoints){this.scalePoints=e.scalePoints}},scope:this});d.push(e);return d},initColumns:function(){if(!this.columns){this.columns=this.createDefaultColumns();var f=this.scaleCol;if(this.scalePoints){this.scaleMin=f.scaleMin;this.scaleMax=f.scaleMax;this.scaleStep=f.scaleStep}}else{var g=!Ext.isArray(this.columns)?[this.columns]:this.columns;for(var h=0;h<g.length;h++){var e=g[h];if(this.isScaleColumn(e)){Ext.copyToIf(e,this,this.scaleColumnConfigs);if(!(e instanceof Gnt.column.Scale)){e=g[h]=Ext.ComponentManager.create(e,e.xtype)}this.mon(e,{beforerender:function(){e.setAvailableHeight(this.getSchedulingView().getAvailableRowHeight())},scope:this,single:true})}}}},isScaleColumn:function(d){var c=d.xtype&&(Ext.ClassManager.getByAlias("widget."+d.xtype));c=c&&c.prototype;return(d instanceof Gnt.column.Scale||(c&&c.isXType("scalecolumn")))},destroy:function(){this.unbindStores();this.callParent(arguments)},getEventStore:function(){return this.taskStore},getTimeSpanDefiningStore:function(){return this.taskStore},unbindResourceCalendarListener:function(d,e){var f=this.calendarResources[e];if(f){Ext.Array.remove(f,d);if(!f.length){this.calendarListenersHash[e].destroy();delete this.calendarListenersHash[e];delete this.calendarResources[e]}}},bindResourceCalendarListener:function(h){var e=this,g=h.getOwnCalendar(),f=g.getCalendarId();if(!e.calendarListenersHash[f]){e.calendarListenersHash[f]=e.mon(g,{load:e.onCalendarChange,calendarchange:e.onCalendarChange,scope:e,destroyable:true})}if(!e.calendarResources[f]){e.calendarResources[f]=[h]}else{if(Ext.Array.indexOf(e.calendarResources,h)===-1){e.calendarResources[f].push(h)}}},bindCalendarListeners:function(){var b=this;b.unbindCalendarListeners();b.store.each(function(a){var d=a.getOwnCalendar();if(d&&d!==b.calendar){b.bindResourceCalendarListener(a)}})},unbindCalendarListeners:function(){for(var b in this.calendarListenersHash){this.calendarListenersHash[b].destroy()}this.calendarResources=[];this.calendarListenersHash={}},onTaskStoreRefresh:function(){this.clearCacheAndRefresh()},onCalendarChange:function(f){var d=this.calendarResources[f.getCalendarId()];if(d){for(var e=0;e<d.length;e++){this.clearCacheAndRefresh(d[e])}}},onProjectCalendarChange:function(){this.clearCacheAndRefresh()},onTaskUpdate:function(f,d){var e;if(this.assignmentStore&&d.getAssignmentStore()!=this.assignmentStore){e=this.assignmentStore.getAssignmentsForTask(d.getId())}else{e=d.getAssignments()}this.onAssignmentsChange(this.assignmentStore,e)},onAssignmentsRefresh:function(b){this.onAssignmentsChange(b,b.getRange())},onAssignmentUpdate:function(l,k,i,o){var p=this,m=p.assignmentStore.model.prototype.resourceIdField,n;if(i==Ext.data.Model.EDIT){if(o&&Ext.Array.contains(o,m)){var j=k.previous[m];n=this.resourceStore.getModelById(j);if(n){this.clearCacheAndRefresh(n)}}p.onAssignmentsChange(l,[k])}},onAssignmentsChange:function(i,g){var k=this,j;if(!Ext.isArray(g)){g=[g]}for(var l=0,h=g.length;l<h;l++){j=k.resourceStore.getModelById(g[l].getResourceId());if(j&&!j.inOnCalendarChange){k.clearCacheAndRefresh(j)}}},findEndIndex:function(g,h){h=h||this.getEndDate();var f=g.length-1;for(var e=f;e>=0;e--){if(g[e].startDate<h){f=e;break}}return f},findStartIndex:function(h,f){f=f||this.getStartDate();var g=0;for(var i=0,j=h.length;i<j;i++){if(h[i].endDate>f){g=i;break}}return g},resetAllocationDataCache:function(c){var d=this;if(!c){d.allocationData={}}else{d.allocationData=d.allocationData||{};d.allocationData[c.getId()]=null}},constrainAllocationDataCache:function(q){var n=this,m=new Date(n.timeAxis.getStart()-this.cacheLimitDurationMS),k=new Date(n.timeAxis.getEnd()-0+this.cacheLimitDurationMS),j=q.maxBars.length-1,r=0,p=q.bars.length-1,o=0,l=false;if(q.cacheEnd>k){j=n.findEndIndex(q.maxBars,k);p=n.findEndIndex(q.bars,k);q.cacheEnd=k;l=true}if(q.cacheStart<m){r=n.findStartIndex(q.maxBars,m);o=n.findStartIndex(q.bars,m);q.cacheStart=m;l=true}if(l){q.maxBars=Ext.Array.splice(q.maxBars,r,j+1-r);q.bars=Ext.Array.splice(q.bars,o,p+1-o)}return l},updateAllocationDataCache:function(y,D,w){var B=Sch.util.Date,t=this,u,x,C,z,r;if(t.cacheUpdateSuspended){t.suspendedCacheUpdatesCount++;return}D=D||t.getStartDate();w=w||t.getEndDate();if(!y){t.resourceStore.each(function(a){t.updateAllocationDataCache(a,D,w)})}else{u=t.allocationData[y.getId()]||{};x=u.cacheStart;C=u.cacheEnd;if(x!=D||C!=w){if(x&&C&&B.intersectSpans(x,C,D,w)){if(x>D){z=t.processAllocationData(y.getAllocationInfo({startDate:D,endDate:x,includeResCalIntervals:true}));if(z.maxBars.length){if(z.maxBars[z.maxBars.length-1].startDate.getTime()===x.getTime()){z.maxBars.pop()}}if(z.bars.length&&u.bars.length){var A=z.bars[z.bars.length-1];var v=u.bars[0];if(A.startDate>=v.startDate&&A.endDate<=v.endDate){z.bars.pop()}}z.maxBars.length&&(z.maxBars[z.maxBars.length-1].endDate=x);u.maxBars.length&&(u.maxBars[0].startDate=x);u.bars=z.bars.concat(u.bars);u.maxBars=z.maxBars.concat(u.maxBars);u.maxBarsStartIndex=0;u.barsStartIndex=0;u.cacheStart=D}if(C<w){r=t.processAllocationData(y.getAllocationInfo({startDate:C,endDate:w,includeResCalIntervals:true}));if(r.maxBars.length){var p=r.maxBars[0];if(p.endDate.getTime()===C.getTime()){r.maxBars.shift()}else{p.startDate=C}}if(r.bars.length&&u.bars.length){var s=r.bars[0];var q=u.bars[u.bars.length-1];if(s.startDate>=q.startDate&&s.endDate<=q.endDate){r.bars.shift()}}r.maxBars.length&&(r.maxBars[r.maxBars.length-1].endDate=w);u.maxBars.length&&(u.maxBars[u.maxBars.length-1].endDate=C);u.bars=u.bars.concat(r.bars);u.maxBars=u.maxBars.concat(r.maxBars);u.maxBarsEndIndex=u.maxBars.length-1;u.barsEndIndex=u.bars.length-1;u.cacheEnd=w}if(t.cacheLimitDuration>0){t.constrainAllocationDataCache(u)}u.maxBarsStartIndex=t.findStartIndex(u.maxBars,D);u.barsStartIndex=t.findStartIndex(u.bars,D);u.maxBarsEndIndex=t.findEndIndex(u.maxBars,w);u.barsEndIndex=t.findEndIndex(u.bars,w)}else{u=t.processAllocationData(y.getAllocationInfo({startDate:D,endDate:w,includeResCalIntervals:true}));u.maxBarsStartIndex=0;u.maxBarsEndIndex=u.maxBars.length-1;u.barsStartIndex=0;u.barsEndIndex=u.bars.length-1;u.cacheStart=D;u.cacheEnd=w}}t.allocationData[y.getId()]=u}},isBarAssignmentsChanged:function(j){var i=j.bar,h=j.period;if(!i.assignments||!h.inResourceCalendar||!h.totalAllocation||!h.inTasksCalendar){return false}for(var f=0,g=i.assignments.length;f<g;f++){if(h.assignmentsHash[i.assignments[f].getTaskId()]){return false}}return true},openBar:function(c,d){d.bar={startDate:c,totalAllocation:d.period.totalAllocation,allocationMS:d.allocationMS,assignments:d.period.assignments,totalOverAllocationMS:d.totalOverAllocationMS};d.barOpened=true;return d.bar},closeBar:function(c,d){if(!d.barOpened){return false}if(c){d.bar.endDate=c}d.bars.push(d.bar);d.barOpened=false},appendZeroMaxBars:function(p,j,i){if(!p){return false}var o=this,k=Sch.util.Date.getDurationInDays(p,j);if(k<2){return false}var l=true,n=i.maxBar,m=i.maxBars;if(n){if(!n.allocationMS){l=false}else{n.endDate=Sch.util.Date.getStartOfNextDay(p,true);m.push(n)}}if(l){i.maxBar={startDate:n&&n.endDate||o.getStart(),allocationMS:0}}i.maxAllocationMS=0;return i.maxBar},getMergePeriodStart:function(b){return Ext.Date.clearTime(b,true)},processAllocationData:function(j){var A,z,J,E,G,Q,R,H,P,i,M,L,F=[],K=[],l=this,N={bars:F,maxBars:K};var I=l.getMergePeriodStart(j[0].startDate);if(I>this.getStartDate()){K.push({startDate:this.getStartDate(),endDate:I,allocationMS:0})}for(var B=0,D=j.length;B<D;B++){A=N.period=j[B];I=l.getMergePeriodStart(A.startDate);if(I-E!==0){if(this.showLimitLines){if(l.appendZeroMaxBars(E,I,N)){J=N.maxBar}}E=I;H=N.allocationMS;L=N.totalOverAllocationMS;i=N.maxAllocationMS;R=0;M=0;P=0;var C=B;while(j[C]&&l.getMergePeriodStart(j[C].startDate)-I===0){if(j[C].inResourceCalendar){P+=j[C].endDate-j[C].startDate;if(j[C].totalAllocationMS){R+=j[C].totalAllocationMS;M+=j[C].totalOverAllocationMS||0}}C++}N.allocationMS=R;N.totalOverAllocationMS=M;N.maxAllocationMS=P}else{I=false}if(l.showLimitLines){if(I&&P!=i){if(J){J.endDate=I;K.push(J)}J=N.maxBar={startDate:I,allocationMS:P}}J.endDate=A.endDate}if(!N.barOpened){if(A.inTask){z=l.openBar(new Date(A.startDate),N)}}else{if(!A.inTask){l.closeBar(null,N)}else{var O=false;if(l.isBarAssignmentsChanged(N)){G=z.endDate;Q=new Date(A.startDate);O=true}else{if(I&&I-z.endDate>=l.gapThreshold){G=Ext.Date.clearTime(z.endDate,true);if(G<z.endDate){G=Sch.util.Date.add(G,Sch.util.Date.DAY,1)}Q=Ext.Date.clearTime(A.startDate,true);O=true}else{if(I&&R!==H&&A.totalAllocation){G=Q=Ext.Date.clearTime(A.startDate,true);O=true}}}if(O){l.closeBar(G,N);z=l.openBar(Q,N)}}}if(N.barOpened){z.endDate=A.endDate}}l.closeBar(null,N);if(l.showLimitLines){if(l.appendZeroMaxBars(E||l.getStart(),l.getEnd(),N)){J=N.maxBar}if(J){K.push(J)}}return{bars:F,maxBars:K}},onResourceUpdate:function(g,j,h,l){if(Ext.Array.indexOf(l,j.calendarIdField)>-1){this.resetAllocationDataCache(j);var k=j.previous[j.calendarIdField];this.unbindResourceCalendarListener(j,k);var i=j.getOwnCalendar();if(i&&i!==this.calendar){this.bindResourceCalendarListener(j)}}},onResourceStoreRefresh:function(){var b=this;b.clearCacheAndRefresh();b.bindCalendarListeners()},refreshIfRendered:function(c){var d=this;if(d.rendered&&d.resourceStore&&c){d.getView().refreshNode(d.resourceStore.indexOf(c))}else{if(d.rendered){d.getView().refresh()}}},columnRenderer:function(v,l,u,p,m){var q=this,s=u.getId(),o=this.normalGrid.getView(),t,n,r;q.updateAllocationDataCache(u);t=q.allocationData[s];n=t&&t.bars;r=t&&t.maxBars;if(n&&(t.barsStartIndex>0||t.barsEndIndex<n.length-1)){n=n.slice(t.barsStartIndex,t.barsEndIndex+1)}if(r&&(t.maxBarsStartIndex>0||t.maxBarsEndIndex<r.length-1)){r=r.slice(t.maxBarsStartIndex,t.maxBarsEndIndex+1)}return(q.showScaleLines?o.renderLines():"")+o.renderBars(n,s)+(q.showLimitLines?o.renderLimitLines(r):"")}});Ext.define("Gnt.panel.ResourceUtilization",{extend:Sch.panel.SchedulerTree,alias:"widget.resourceutilizationpanel",enableDragCreation:false,enableEventDragDrop:false,eventResizeHandles:"none",readOnly:true,rowHeight:32,rowLines:true,eventBorderWidth:0,columnLines:{useLowestHeader:true},variableRowHeight:false,syncRowHeight:false,lockedGridDependsOnSchedule:false,enableRowHeightInjection:function(){},dependencyViewConfig:{drawDependencies:false},underUtilizationThreshold:99,overUtilizationThreshold:100,columns:[{xtype:"treecolumn",flex:1,resizable:false,sortable:false,renderer:function(e,d,f){if(f.isSurrogateResource()){return f.getName()}else{return f.getTaskName()}}}],config:{taskStore:null,numberFormat:"0"},resourceStoreClass:"Gnt.data.ResourceUtilizationStore",viewConfig:{markDirty:false,dynamicRowHeight:false,getRowClass:function(b){return b.data.leaf?"gnt-utilizationrow-task":"gnt-utilizationrow-resource"}},eventBodyTemplate:['<tpl for=".">','<div class="gnt-resource-utilization-interval gnt-resource-utilization-interval-{status} {cls}" style="{dir}: {position}px; width: {width}px;{style}"','data-utilization-interval-start="{startTime}"','data-utilization-interval-end="{endTime}">',"{value}</div>","</tpl>"].join(""),lockedGridConfig:{width:200},utilizationBarRenderer:null,utilizationBarRendererScope:null,initComponent:function(){var b=this;b.eventRendererScope=b;b.setupComponentStores();b.callParent(arguments);b.addCls("gnt-resourceutilizationpanel");b.provideTimeAxisToStore();if(b.partnerTimelinePanel&&Ext.isFunction(b.partnerTimelinePanel.getTaskStore)){b.resourceStore.setTaskStore(b.partnerTimelinePanel.getTaskStore())}b.resourceStore.fillStore()},setupComponentStores:function(){var b=this;b.resourceStore=b.resourceStore||Ext.create(b.resourceStoreClass,{underUtilizationThreshold:this.underUtilizationThreshold,overUtilizationThreshold:this.overUtilizationThreshold,taskStore:b.getTaskStore()});b.eventStore=b.resourceStore.getEventStore()},provideTimeAxisToStore:function(){var b=this;b.getStore().setTimeAxis(b.timeAxis)},eventRenderer:function(A,C,r){var z=Ext.util.Format,w=this,u=w.getSchedulingView(),B=A.getStartDate(),t=60*60*1000,y=w.getNumberFormat(),p=[],x,v,s,D,q=this.utilizationBarRendererScope||this;x=u.getXFromDate(B);A.forEachInterval(function(a,b){var d=A.getUtilizationInfoForInterval(a),c=z.number(d.allocationMs/t,y),e={};v=u.getXFromDate(a);s=u.getXFromDate(b)-1;if(!d.isUtilized){D="notutilized"}else{if(d.isUnderallocated){D="underallocated"}else{if(d.isOverallocated){D="overallocated"}else{D="optimallyallocated"}}}if(w.utilizationBarRenderer){w.utilizationBarRenderer.call(q,d,C,a,b,e)}p.push({status:D,dir:w.rtl?"right":"left",position:v-x,width:s-v,startTime:a.getTime(),endTime:b.getTime(),value:(s-v>10?c:""),style:e.style||"",cls:e.cls||""})});return p},getRowHeight:function(){return this.rowHeight}});Ext.define("Gnt.panel.TimelineScheduler",{extend:Sch.panel.SchedulerGrid,alias:"widget.gantt_timelinescheduler",taskStore:null,split:false,milestoneBottomPadding:23,barMargin:0,header:false,enableColumnMove:false,enableColumnHide:false,enableColumnResize:false,sortableColumns:false,trackMouseOver:false,bufferedRenderer:false,border:false,rowLines:false,columnLines:false,readOnly:true,resizeHandles:"none",enableDragCreation:false,enableEventDragDrop:false,forceFit:true,autoAdjustTimeAxis:false,leftTimespanMargin:25,rightTimespanMargin:50,resourceStoreClass:"Sch.data.ResourceStore",eventStoreClass:"Sch.data.EventStore",refreshMainRowTimeout:5,needToZoom:false,destroyStores:true,variableRowHeight:false,syncRowHeight:false,lockedGridDependsOnSchedule:false,initComponent:function(){var h=this;h.addCls("sch-gantt-timeline-scheduler");h.setTaskStore(this.taskStore);Ext.apply(h,{normalViewConfig:{onEventUpdate:Ext.Function.bind(h.onEventUpdate,h),onEventAdd:Ext.Function.bind(h.onEventAdd,h),onEventRemove:Ext.Function.bind(h.onEventRemove,h)},resourceStore:h.buildResourceStore(),eventStore:h.buildEventStore(),refreshMainRow:Ext.Function.createBuffered(h.refreshMainRow,h.refreshMainRowTimeout,h)});var i=h.taskStore.getRoot();if(i&&i.childNodes.length){h.on({afterlayout:h.fillStoreFromTaskStore,scope:h,single:true})}h.callParent(arguments);h.on("resize",h.onSchedResize,h);h.resourceRecord=h.resourceStore.first();var j=h.getSchedulingView(),f=j.eventLayout.horizontal,g=f.applyLayout;f.applyLayout=function(b,a){b=Ext.Array.filter(b,function(c){return c.event.getDuration()>0});return g.call(this,b,a)};this.registerRenderer(this.rowHeightRenderer,this)},setTaskStore:function(f,g){var h=this;var e={load:h.fillStoreFromTaskStore,nodeappend:h.onTaskAdded,update:h.onTaskUpdated,noderemove:h.onTaskRemoved,clear:h.onTaskStoreClear,scope:h};g&&h.mun(g,e);f=Ext.data.StoreManager.lookup(f);h.mon(f,e);h.taskStore=f;return f},buildResourceStore:function(b){return Ext.create(this.resourceStoreClass,Ext.apply({storeId:null,data:[{Id:1}]},b))},buildEventStore:function(b){return Ext.create(this.eventStoreClass,Ext.apply({storeId:null,createResourceEventsCache:Ext.emptyFn,filterEventsForResource:function(){return this.getRange()},getEventsForResource:function(){return this.getRange()},isDateRangeAvailable:function(t,o,l,p){if(!t||!o){return true}var s=Sch.util.Date,a=this.getRange(),r;for(var n=0,q=a.length;n<q;n++){var i=a[n];r=(l===i||i.getDuration()===0||!i.getStartDate()||!i.getEndDate()||!s.intersectSpans(t,o,i.getStartDate(),i.getEndDate()));if(!r){break}}return r}},b))},refreshMainRow:function(b){if(b||this.needToZoom){this.zoomToFit()}else{this.getSchedulingView().repaintEventsForResource(this.resourceRecord);this.fitEvents()}},eventRenderer:function(e,d,f){if(e.store.isDateRangeAvailable(e.getStartDate(),e.getEndDate(),e,d)){f.cls="sch-gantt-timeline-stretch"}if(!e.isMilestone()){f.style="line-height:"+f.height+"px;"}return e.getName()},rowHeightRenderer:function(d,c){c.style="height:"+this.getAvailableRowHeight()+"px"},onTaskStoreClear:function(){this.eventStore.removeAll()},onTaskRemoved:function(d,f,e){if(!e){this.eventStore.remove(f);Ext.Array.each(f.childNodes||[],function(a){this.onTaskRemoved(d,a)},this)}},onTaskAdded:function(c,d){if(d.getShowInTimeline()){this.eventStore.add(d)}},onTaskUpdated:function(h,e,f,g){if(g){if(Ext.Array.contains(g,e.showInTimelineField)){if(e.getShowInTimeline()){this.eventStore.add(e)}else{this.eventStore.remove(e)}}}},onEventAdd:function(){if(!this.needToZoom){var b=this.eventStore.getTotalTimeSpan();this.needToZoom=b.start<this.getStart()||b.end>this.getEnd()}this.refreshMainRow()},onEventRemove:function(f,h){if(!this.needToZoom){var i=this.eventStore.getTotalTimeSpan();for(var j=0;j<h.length;j++){var g=h[j];if(i.start>g.getStartDate()||i.end<g.getEndDate()){this.needToZoom=true;break}}}this.refreshMainRow()},onEventUpdate:function(l,g,h,k){var j=g.previous,i=this.eventStore.lastTotalTimeSpan;if(k){if(!this.needToZoom&&j&&i&&(g.startDateField in j||g.endDateField in j)){this.needToZoom=(g.startDateField in j&&i.start-j[g.startDateField]===0)||(g.endDateField in j&&i.end-j[g.endDateField]===0)||(g.startDateField in j&&i.start>g.getStartDate())||(g.endDateField in j&&i.end<g.getEndDate())}this.refreshMainRow()}},fillStoreFromTaskStore:function(){var d=[],c=[];this.taskStore.forEachTaskUnordered(function(a){if(a.getShowInTimeline()){if(a.isMilestone()){c.push(a)}else{d.push(a)}}});d=d.concat(c);this.eventStore.removeAll();if(d.length||this.eventStore.getCount()){this.eventStore.loadData(d);this.zoomToFit()}},zoomToFit:function(){this.suspendLayouts();this.needToZoom=false;this.callParent([{leftMargin:this.leftTimespanMargin,rightMargin:this.rightTimespanMargin}]);this.fitEvents();this.resumeLayouts()},onSchedResize:function(i,j,g,f,h){if(g!==h){this.fitEvents()}},fitEvents:function(j,k,h,g,i){var l=this.getSchedulingView().eventLayout.horizontal.nbrOfBandsByResource[this.resourceRecord.internalId]||1;this.setRowHeight(Math.ceil(this.getAvailableRowHeight()/l))},getAvailableRowHeight:function(){return this.getSchedulingView().getHeight()-this.milestoneBottomPadding}});Ext.define("Gnt.panel.Timeline",{extend:Ext.Panel,mixins:[Gnt.mixin.Localizable],alias:"widget.gantt_timeline",layout:{type:"hbox",align:"stretch"},bodyPadding:"10 0 20 0",height:190,labelWidth:100,taskStore:null,scheduler:null,schedulerClass:"Gnt.panel.TimelineScheduler",initComponent:function(){this.addCls("sch-gantt-timeline");this.scheduler=Ext.create(this.schedulerClass,{taskStore:this.taskStore,flex:1});this.scheduler.on("viewchange",this.onTimespanChange,this);this.items=this.buildItems();this.callParent(arguments)},buildItems:function(){return[{xtype:"displayfield",fieldLabel:this.L("start"),labelAlign:"top",itemId:"startlabel",cls:"sch-gantt-timeline-label sch-gantt-timeline-left-label",width:this.labelWidth},this.scheduler,{xtype:"displayfield",fieldLabel:this.L("end"),labelAlign:"top",itemId:"endlabel",cls:"sch-gantt-timeline-label sch-gantt-timeline-right-label",width:this.labelWidth}]},getStartLabel:function(){return this.startLabel||(this.startLabel=this.down("#startlabel"))},getEndLabel:function(){return this.endLabel||(this.endLabel=this.down("#endlabel"))},onTimespanChange:function(){var c=this.scheduler.getStart();var d=this.scheduler.getEnd();this.getStartLabel().setValue(Ext.Date.format(c,Ext.Date.defaultFormat));this.getEndLabel().setValue(Ext.Date.format(d,Ext.Date.defaultFormat))}});Ext.define("Gnt.patches.AbstractClipboard",{extend:Sch.util.Patch,target:"Ext.plugin.AbstractClipboard",minVersion:"6.0.0",overrides:{privates:{getData:function(o,k){var n=this,j=n.getFormats(),m,p,i,l;if(Ext.isString(k)){if(!j[k]){Ext.raise('Invalid clipboard format "'+k+'"')}m=n[j[k].get](k,o)}else{m={};l=[];if(k){for(i in k){if(!j[i]){Ext.raise('Invalid clipboard format "'+i+'"')}l.push(i)}}else{l=Ext.Object.getAllKeys(j)}for(p=l.length;p-->0;){i=l[p];m[i]=n[j[i].get](i,o&&!p)}}return m}}}});Ext.define("Gnt.patches.ComponentManager",{extend:Sch.util.Patch,minVersion:"6.0.0",applyFn:function(){Ext.ComponentManager.onGlobalFocus=function(n){var l=this,o=n.toElement,m=n.fromElement,p=Ext.Component.fromElement(o),k=Ext.Component.fromElement(m),e=l.getCommonAncestor(k,p),r,q;if(k&&!(k.destroyed||k.destroying)){if(k.handleBlurEvent){k.handleBlurEvent(n)}for(q=k;q&&q!==e;q=q.getRefOwner()){if(q instanceof Gnt.widget.AssignmentGrid&&q.view.refreshing&&q.getRefOwner() instanceof Gnt.field.Assignment){break}if(!(q.destroyed||q.destroying)){q.onFocusLeave({event:n.event,type:"focusleave",target:m,relatedTarget:o,fromComponent:k,toComponent:p})}}}if(p&&!p.destroyed){if(p.handleFocusEvent){p.handleFocusEvent(n)}for(q=p;q&&q!==e;q=q.getRefOwner()){q.onFocusEnter({event:n.event,type:"focusenter",relatedTarget:m,target:o,fromComponent:k,toComponent:p})}}}}});Ext.define("Gnt.patches.DelimitedValue",{extend:Sch.util.Patch,target:"Ext.util.DelimitedValue",minVersion:"6.0.0",overrides:{decode:function(b){if(b===""){return[]}return this.callParent(arguments)}}});Ext.define("Gnt.patches.LabelEditor",{extend:Sch.util.Patch,target:"Gnt.feature.LabelEditor",minVersion:"6.0.0",maxVersion:"6.0.1",ieOnly:true,overrides:{constructor:function(){this.callParent(arguments);if(this.rendered){this.getEl().setVisibilityMode(Ext.dom.Element.OFFSETS)}else{this.on("render",function(){this.getEl().setVisibilityMode(Ext.dom.Element.OFFSETS)},this,{single:true})}}}});Ext.define("Gnt.patches.Tooltip",{extend:Sch.util.Patch,target:"Ext.tip.ToolTip",minVersion:"5.1.0",overrides:{onDocMouseDown:function(){if(this.isDisabled()){return}this.callParent(arguments)}}});Ext.define("Gnt.plugin.Clipboard",{extend:Ext.grid.plugin.Clipboard,alias:"plugin.gantt_clipboard",memory:"raw",formats:{raw:{get:"getRawData",put:"putRawData"}},putTextData:function(d,c){return},getRawData:function(k,q){var m=this,o=m.getCmp().getSelectionModel(),n=[],l=k==="raw",p=k==="text",r,j;n.schedulingFields={};o.getSelected().eachCell(function(h){var f=h.column,a=h.column.getView(),b=h.record,g=f.dataIndex,e;if(!m.isColumnCopyPasteable(f,k)){return}if(r!==b){r=b;n.push(j=[])}if(n.length<2){if(Gnt.column.StartDate&&f instanceof Gnt.column.StartDate){n.schedulingFields.startDate=1}else{if(Gnt.column.EndDate&&f instanceof Gnt.column.EndDate){n.schedulingFields.endDate=1}else{if(Gnt.column.Duration&&f instanceof Gnt.column.Duration){n.schedulingFields.duration=1}}}}if(l){if(f.getRawData){e=f.getRawData(b)}else{if(g){e=b.data[g]}}}else{var c=a.all.item(h.rowIdx);if(!c){c=Ext.fly(a.createRowElement(b,h.rowIdx))}var d=c.down(f.getCellInnerSelector());e=d.dom.innerHTML;if(p){e=Ext.util.Format.stripTags(e)}}j.push(e);if(q&&g){b.set(g,b.getField(g).getDefaultValue())}});return n},getCellData:function(c,d){return Ext.util.TSV.encode(this.getRawData(c,d))},isColumnCopyPasteable:function(d,c){return !d.ignoreExport&&(c!="raw"||d.dataIndex||d.getRawData)},putRawData:function(w,z){var y=this,R=w.length,F=this.getCmp().getView(),M=F.dataSource.getCount()-1,E=F.getVisibleColumnManager().getColumns().length-1,N=F.getNavigationModel(),B=N.getPosition(),P,x,G,A,H,O,Q,K,L;if(!B||this.getCmp().isReadOnly()){return}B=new Ext.grid.CellContext(F).setPosition(B.record,B.column);G=B.colIdx;for(var D=0;D<R;D++){var J=w[D];var I=B.record;O={};if(I.isReadOnly()){continue}for(P=0;B.colIdx<E&&P<J.length;){A=B.column;H=J[P];if(y.isColumnCopyPasteable(A,z)){var C;if(w.schedulingFields.startDate&&w.schedulingFields.endDate){C=A.fieldProperty==="durationField"||A.fieldProperty==="startDateField"||A.fieldProperty==="endDateField";if(A.fieldProperty==="startDateField"){K=H}if(A.fieldProperty==="endDateField"){L=H}}x=A.dataIndex;if(!C){if(A.putRawData){A.putRawData(H,B.record)}else{if(x&&x!=="index"){Q=A.field;if(Q){if(!Q.getErrors(H).length){O[x]=H}}else{O[x]=H}}}}P++}if(B.colIdx===E){break}B.setColumn(B.colIdx+1)}I.beginEdit();I.set(O);if(K!==undefined&&L!==undefined){I.setStartEndDate(K,L)}I.endEdit();if(B.rowIdx===M){break}B.setPosition(B.rowIdx+1,G)}}});Ext.define("Gnt.plugin.DependencyEditor",{extend:Ext.form.Panel,alias:"plugin.gantt_dependencyeditor",ptype:"gantt_dependencyeditor",mixins:[Ext.AbstractPlugin,Gnt.mixin.Localizable],hideOnBlur:true,showLag:false,triggerEvent:"dependencydblclick",constrain:true,lockableScope:"top",header:false,border:false,frame:true,labelWidth:60,floating:true,hideMode:"offsets",bodyPadding:10,initComponent:function(){this.buttons=this.hasOwnProperty("buttons")?this.buttons:(this.buttons||[{text:this.L("okButtonText"),itemId:"okbutton",scope:this,handler:function(){this.getForm().updateRecord(this.dependencyRecord);this.collapse()}},{text:this.L("cancelButtonText"),itemId:"cancelbutton",scope:this,handler:function(){this.collapse()}},{text:this.L("deleteButtonText"),itemId:"deletebutton",scope:this,handler:function(){var b=this.taskStore&&this.taskStore.getDependencyStore();b.remove(this.dependencyRecord);this.collapse()}}]);this.callParent(arguments);this.saveButton=this.down("#okbutton");this.deleteButton=this.down("#deletebutton");this.addCls("sch-gantt-dependencyeditor")},getState:function(){if(this.rendered){return this.callParent(arguments)}},init:function(b){b.on(this.triggerEvent,this.onTriggerEvent,this);this.gantt=b;this.taskStore=b.getTaskStore();this.add(this.buildFields())},renderAndCollapse:function(){this.render(Ext.getBody());this.collapse(Ext.Component.DIRECTION_TOP,false);this.hide();if(this.hideOnBlur){this.on({show:function(){this.mon(Ext.getBody(),{click:this.onMouseClick,scope:this})},hide:function(){this.mun(Ext.getBody(),{click:this.onMouseClick,scope:this})},delay:50})}},show:function(e,h){this.dependencyRecord=e;this.getForm().loadRecord(e);this.fromLabel.setValue(Ext.String.htmlEncode(this.dependencyRecord.getSourceTask().getName()));this.toLabel.setValue(Ext.String.htmlEncode(this.dependencyRecord.getTargetTask().getName()));if(this.typeField){var f=this.taskStore&&this.taskStore.getDependencyStore(),g=f&&f.allowedDependencyTypes;this.typeField.store.filter();this.typeField.setReadOnly(g&&g.length<2)}this.callParent([]);this.el.setXY(h);this.expand(!this.constrain);if(this.constrain){this.doConstrain(Ext.util.Region.getRegion(Ext.getBody()))}this.saveButton&&this.saveButton.setVisible(!this.gantt.isReadOnly());this.deleteButton&&this.deleteButton.setVisible(!this.gantt.isReadOnly())},buildFields:function(){var f=this,d=f.taskStore&&f.taskStore.getDependencyStore();var e=[f.fromLabel=new Ext.form.TextField({readOnly:true,border:false,fieldLabel:f.L("fromText"),cls:"sch-gantt-dependencyeditor-readonly"}),f.toLabel=new Ext.form.TextField({readOnly:true,border:false,fieldLabel:f.L("toText"),cls:"sch-gantt-dependencyeditor-readonly"}),f.typeField=f.buildTypeField()];if(f.showLag){e.push(f.lagField=new Ext.form.NumberField({name:d?d.model.prototype.lagField:Gnt.model.Dependency.prototype.lagField,fieldLabel:f.L("lagText")}))}return e},onTriggerEvent:function(h,f,g,e){if(!this.rendered){this.renderAndCollapse()}if(f!==this.dependencyRecord){this.show(f,g.getXY())}},filterAllowedTypes:function(h){var n=this.taskStore&&this.taskStore.getDependencyStore();if(!n||!n.allowedDependencyTypes){return true}var k=n.allowedDependencyTypes;var j=n.model.Type;for(var m=0,i=k.length;m<i;m++){var l=j[k[m]];if(h.getId()==l){return true}}return false},buildTypeField:function(){var d=this.taskStore?this.taskStore.getDependencyStore().model:Gnt.model.Dependency;var f=d.Type;this.typesFilter=new Ext.util.Filter({filterFn:this.filterAllowedTypes,scope:this});var e=new Ext.data.ArrayStore({fields:[{name:"id",type:"int"},"text"],data:[[f.EndToStart,this.L("endToStartText")],[f.StartToStart,this.L("startToStartText")],[f.EndToEnd,this.L("endToEndText")],[f.StartToEnd,this.L("startToEndText")]]});e.filter(this.typesFilter);return new Ext.form.field.ComboBox({name:d.prototype.typeField,fieldLabel:this.L("typeText"),triggerAction:"all",queryMode:"local",editable:false,valueField:"id",displayField:"text",store:e})},onMouseClick:function(b){if(this.collapsed||b.within(this.getEl())||b.getTarget("."+Ext.baseCSSPrefix+"layer")||b.getTarget(".sch-ignore-click")){return}this.collapse()},afterCollapse:function(){delete this.dependencyRecord;this.hide();this.callParent(arguments);if(this.hideOnBlur){this.mun(Ext.getBody(),"click",this.onMouseClick,this)}}});Ext.define("Gnt.plugin.exporter.mixin.DependencyPainter",{fillRecordRelatedBoxes:function(j){if(j.hasIncomingDependencies()||j.hasOutgoingDependencies()){var h=this,f=h.normalView,g=f.getDependencyView().painter;var i=g.getItemBox(h.normalView,j);i.top+=f.bufferedRenderer.bodyTop;i.bottom+=f.bufferedRenderer.bodyTop;i.rendered=true;h.eventBoxes[j.internalId]=i}},onClassMixedIn:function(b){b.addMember("fillRecordRelatedBoxes",this.prototype.fillRecordRelatedBoxes)}});Ext.define("Gnt.plugin.exporter.SinglePage",{extend:Sch.plugin.exporter.SinglePage,mixins:[Gnt.plugin.exporter.mixin.DependencyPainter]});Ext.define("Gnt.plugin.exporter.MultiPage",{extend:Sch.plugin.exporter.MultiPage,mixins:[Gnt.plugin.exporter.mixin.DependencyPainter],normalGridOffset:0,onRowsCollected:function(){var b=this;b.normalGridOffset=0;b.callParent(arguments)},startPage:function(f,e){var d=this;d.normalGridOffset=f.normalGridOffset;d.callParent(arguments)},buildPageFrame:function(f,h){var e=this;var g=e.callParent(arguments);g.normalHidden=e.normalGrid.hidden;g.lockedHidden=e.lockedGrid.hidden;return g}});Ext.define("Gnt.plugin.exporter.MultiPageVertical",{extend:Sch.plugin.exporter.MultiPageVertical,mixins:[Gnt.plugin.exporter.mixin.DependencyPainter]});Ext.define("Gnt.plugin.Export",{extend:Sch.plugin.Export,alias:"plugin.gantt_export",alternateClassName:"Gnt.plugin.PdfExport",buildExporters:function(){return["Gnt.plugin.exporter.SinglePage","Gnt.plugin.exporter.MultiPage","Gnt.plugin.exporter.MultiPageVertical"]},showExportDialog:function(){this.exportDialogConfig.scrollerDisabled=true;this.callParent(arguments)}});Ext.define("Gnt.plugin.Printable",{extend:Sch.plugin.Printable,alias:"plugin.gantt_printable",buildExporters:function(){return["Gnt.plugin.exporter.MultiPage","Gnt.plugin.exporter.MultiPageVertical"]},showExportDialog:function(){this.exportDialogConfig.scrollerDisabled=true;this.callParent(arguments)}});Ext.define("Gnt.plugin.TaskContextMenu",{extend:Ext.menu.Menu,alias:"plugin.gantt_taskcontextmenu",xtype:"gantt_taskcontextmenu",ptype:"gantt_taskcontextmenu",mixins:[Ext.AbstractPlugin,Gnt.mixin.Localizable],lockableScope:"top",plain:true,triggerEvent:["rowcontextmenu","containercontextmenu","rowlongpress","containerlongpress"],hideEvent:null,grid:null,rec:null,triggerEventXY:null,lastHighlightedItem:null,taskEditorInjected:false,config:{splitDuration:0,splitDurationUnit:"d",maxSplitDuration:1,maxSplitDurationUnit:"d",minSplitDuration:1,minSplitDurationUnit:"h"},initComponent:function(){var b=this.hideEvent;this.defaults=this.defaults||{};this.defaults.scope=this;this.triggerEvent=[].concat(this.triggerEvent);if(b){if(!Ext.isArray(b)){b=[b]}}if(Ext.isIE){b=b||[];b.push("itemclick")}this.hideEvent=b;this.buildMenuItems();this.callParent(arguments)},init:function(b){this.grid=b;this.bindTriggerEvent();this.bindHideEvent()},getState:function(){if(this.rendered){return this.callParent(arguments)}},isNotProject:function(b){return !b||!b.isProject},isReadOnly:function(b){return this.getCmp().isReadOnly()||(b&&b.isReadOnly())},createMenuItems:function(){var b=this;return[{handler:this.deleteTask,requiresTask:true,itemId:"deleteTask",text:this.L("deleteTask"),isValidAction:function(a){return !b.isReadOnly(a)}},{handler:this.editLeftLabel,requiresTask:true,itemId:"editLeftLabel",text:this.L("editLeftLabel"),isValidAction:function(a){return b.grid.getSchedulingView().getLeftEditor()&&!b.isReadOnly(a)}},{handler:this.editRightLabel,requiresTask:true,itemId:"editRightLabel",text:this.L("editRightLabel"),isValidAction:function(a){return b.grid.getSchedulingView().getRightEditor()&&!b.isReadOnly(a)}},{handler:this.toggleMilestone,requiresTask:true,itemId:"toggleMilestone",text:this.L("convertToMilestone"),isValidAction:function(a){return this.isNotProject(a)&&!b.isReadOnly(a)}},{handler:this.splitTask,requiresTask:true,itemId:"splitTask",isValidAction:function(d,a){return d&&!b.isReadOnly(d)&&d.getStartDate()&&d.getEndDate()&&!d.isMilestone()&&d.isLeaf()&&a&&a.getTarget(".sch-gantt-task-bar")},text:this.L("splitTask")},{text:this.L("add"),itemId:"addTaskMenu",menu:{plain:true,defaults:{scope:this},items:[{handler:this.addTaskAboveAction,requiresTask:true,itemId:"addTaskAbove",text:this.L("addTaskAbove"),isValidAction:function(a){return b.isNotProject(a)&&!b.isReadOnly(a.parentNode)}},{handler:this.addTaskBelowAction,itemId:"addTaskBelow",text:this.L("addTaskBelow"),isValidAction:function(a){return(a&&b.isNotProject(a)&&!b.isReadOnly(a.parentNode))||(!a&&!b.isReadOnly())}},{handler:this.addMilestone,itemId:"addMilestone",requiresTask:true,text:this.L("addMilestone"),isValidAction:function(a){return b.isNotProject(a)&&!b.isReadOnly(a.parentNode)}},{handler:this.addSubtask,requiresTask:true,itemId:"addSubtask",text:this.L("addSubtask"),isValidAction:function(a){return !b.isReadOnly(a)}},{handler:this.addSuccessor,requiresTask:true,itemId:"addSuccessor",text:this.L("addSuccessor"),isValidAction:function(a){return b.isNotProject(a)&&!b.isReadOnly(a.parentNode)}},{handler:this.addPredecessor,requiresTask:true,itemId:"addPredecessor",text:this.L("addPredecessor"),isValidAction:function(a){return b.isNotProject(a)&&!b.isReadOnly(a.parentNode)}}]}},{text:this.L("deleteDependency"),requiresTask:true,itemId:"deleteDependencyMenu",isValidAction:function(a){return a&&!b.isReadOnly(a)&&a.getAllDependencies().length>0},menu:{plain:true,listeners:{beforeshow:this.populateDependencyMenu,mouseover:this.onDependencyMouseOver,mouseleave:this.onDependencyMouseOut,scope:this}}}]},buildMenuItems:function(){this.items=this.createMenuItems()},bindGridEvents:function(j,h,i){i=i||this;var f=this.getCmp();if(j){for(var g=j.length-1;g>=0;g--){f.on(j[g],h,i)}}},bindTriggerEvent:function(){this.bindGridEvents(this.triggerEvent,this.onTriggerEvent)},bindHideEvent:function(){this.bindGridEvents(this.hideEvent,this.onHideEvent)},onHideEvent:function(){this.hide()},swallowNextClickEvent:function(){Ext.getBody().on("click",function(b){b.stopPropagation()},null,{single:true,capture:true})},populateDependencyMenu:function(i){if(i.up("menuitem").isDisabled()){return false}var k=this.getCmp(),g=k.getTaskStore(),j=this.rec.getAllDependencies(),h=k.dependencyStore;i.removeAll();if(!j.length){return false}var l=this.rec.getId()||this.rec.internalId;Ext.Array.each(j,function(a){var b=a.getSourceId(),c=g.getModelById(b==l?a.getTargetId():b);if(c){i.add({dependency:a,text:Ext.util.Format.ellipsis(Ext.String.htmlEncode(c.getName()),30),scope:this,handler:function(d){h.remove(d.dependency)},disabled:this.isReadOnly(this.rec)})}},this)},onDependencyMouseOver:function(g,f,e){if(f){var h=this.getCmp().getSchedulingView();if(this.lastHighlightedItem){h.unhighlightDependency(this.lastHighlightedItem.dependency)}this.lastHighlightedItem=f;h.highlightDependency(f.dependency)}},onDependencyMouseOut:function(c,d){if(this.lastHighlightedItem){this.getCmp().getSchedulingView().unhighlightDependency(this.lastHighlightedItem.dependency)}},onTriggerEvent:function(){var b=this.getTriggerEventContext.apply(this,arguments);if(!b.e.type.match("longpress")||b.e.pointerType!=="mouse"){this.activateMenu(b.record,b.e)}},getTriggerEventContext:function(){var e={};for(var f=0,d=arguments.length-1;f<=d;f++){if(arguments[f] instanceof Gnt.model.Task){e.record=arguments[f];break}}for(f=arguments.length-1;f>=0;f--){if(arguments[f] instanceof Ext.EventObjectImpl){e.e=arguments[f];break}}return e},activateMenu:function(c,d){if(this.getCmp().taskStore.getRootNode()===c){return}if(d.type.match("longpress")){this.swallowNextClickEvent()}d.stopEvent();this.rec=c;this.triggerEventXY=d.getXY();this.configureMenuItems(d);this.showAt(d.getXY());this.focus()},addTaskEditorEntry:function(){this.insert(0,{text:this.L("taskInformation"),itemId:"taskEditor",requiresTask:true,handler:function(){this.getCmp().getTaskEditor(this.rec).showTask(this.rec)},isValidAction:function(b){return this.getCmp().getTaskEditor(b)},scope:this});this.taskEditorInjected=true},setTaskEditorEntryLabel:function(d){var c=this.down("#taskEditor");if(d&&c){c.setText(d.isProject?this.L("projectInformation"):this.L("taskInformation"))}},configureMenuItems:function(e){var d=this.rec;if(this.getCmp().getTaskEditor()){if(!this.taskEditorInjected){this.addTaskEditorEntry()}this.setTaskEditorEntryLabel(d)}Ext.Array.each(this.query("menuitem"),function(a){var b=(a.requiresTask&&!d)||(a.isValidAction&&!a.isValidAction.call(a.scope||a,d,e));a.setDisabled(b)});var f=this.down("#toggleMilestone");if(d&&f){f.setText(d.isMilestone()?this.L("convertToRegular"):this.L("convertToMilestone"))}},copyTask:function(f){var d=f&&f.self||this.getCmp().getTaskStore().getModel();var e=new d({leaf:true});e.setPercentDone(0);e.setName(this.L("newTaskText",this.texts));e.set(e.startDateField,(f&&f.getStartDate())||null);e.set(e.endDateField,(f&&f.getEndDate())||null);e.set(e.durationField,(f&&f.getDuration())||null);e.set(e.durationUnitField,(f&&f.getDurationUnit())||"d");return e},addTaskAbove:function(d){var c=this.rec;if(c){c.addTaskAbove(d)}else{this.getCmp().taskStore.getRootNode().appendChild(d)}},addTaskBelow:function(d){var c=this.rec;if(c){c.addTaskBelow(d)}else{this.getCmp().taskStore.getRootNode().appendChild(d)}},deleteTask:function(){var b=this.getCmp().getSelectedRows().slice();if(this.rec&&!Ext.Array.contains(b,this.rec)){b.push(this.rec)}this.getCmp().getTaskStore().removeTasks(b)},editLeftLabel:function(){this.getCmp().getSchedulingView().editLeftLabel(this.rec)},editRightLabel:function(){this.getCmp().getSchedulingView().editRightLabel(this.rec)},addTaskAboveAction:function(){this.addTaskAbove(this.copyTask(this.rec))},addTaskBelowAction:function(){this.addTaskBelow(this.copyTask(this.rec))},addSubtask:function(){var d=this.rec;var c=this.copyTask(this.isNotProject(d)&&d);d.addSubtask(c)},addSuccessor:function(){var b=this.rec;b.addSuccessor(this.copyTask(b))},addPredecessor:function(){var b=this.rec;b.addPredecessor(this.copyTask(b))},addMilestone:function(){var c=this.rec,d=this.copyTask(c);c.addTaskBelow(d);d.setStartEndDate(c.getEndDate(),c.getEndDate())},toggleMilestone:function(){if(this.rec.isMilestone()){this.rec.convertToRegular()}else{this.rec.convertToMilestone()}},getSplitDate:function(l){var h=l.task,n=l.date,m=l.tick,j=l.timeAxis,k=this.getMaxSplitDuration(),i;if(m){i=m.getStartDate();if(k){k=h.getUnitConverter().convertDurationToMs(k,this.getMaxSplitDurationUnit());if(k<m.getEndDate()-m.getStartDate()){i=null}}}return i||j.roundDate(n,h.getStartDate())},getSplitDuration:function(q){if(this.splitDuration){return this.splitDuration}var p=q.task,k=q.pos,o=q.date,l=q.tick;if(l){var j=p.calculateDuration(l.getStartDate(),l.getEndDate(),Sch.util.Date.MILLI),n=p.getUnitConverter(),r=this.getMinSplitDuration(),m=this.getMaxSplitDuration();if(r||m){if(m){j=Math.min(j,n.convertDurationToMs(m,this.getMaxSplitDurationUnit()))}if(r){j=Math.max(j,n.convertDurationToMs(r,this.getMinSplitDurationUnit()))}}return n.convertMSDurationToUnit(j,this.getSplitDurationUnit(p,k,o,l))}},getSplitDurationUnit:function(b){return this.splitDuration?this.splitDurationUnit:Sch.util.Date.MILLI},splitTask:function(){var i=this,f=i.grid.getSchedulingView(),g=f.getDateFromX(i.triggerEventXY[0]),h=f.timeAxis;var j={task:i.rec,pos:i.triggerEventXY,date:g,timeAxis:h,tick:h.getAt(Math.floor(h.getTickFromDate(g)))};j.task.split(i.getSplitDate(j),i.getSplitDuration(j),i.getSplitDurationUnit(j))}});Ext.define("Gnt.plugin.taskeditor.BaseEditor",{extend:Ext.window.Window,mixins:[Ext.AbstractPlugin,Gnt.mixin.Localizable],lockableScope:"top",closeOnBlur:true,taskEditorCls:"Gnt.widget.taskeditor.TaskEditor",isTaskEditor:true,taskEditor:null,panelConfig:null,height:340,width:600,layout:"card",constrain:true,triggerEvent:"taskdblclick",closeAction:"hide",modal:true,gantt:null,assignmentStore:null,resourceStore:null,taskStore:null,monitorDataUpdates:false,monitorDataUpdatesInterval:500,taskEditorConfigs:"l10n,task,taskStore,assignmentStore,resourceStore",taskFilters:null,constructor:function(b){b=b||{};this.taskFilters=[];Ext.apply(this,b);this.title=this.L("title");if(!b.buttons){this.buttons=["->",{itemId:"teOkBtn",text:this.L("okText"),handler:function(){this.completeEditing()||Ext.Msg.alert(this.L("alertCaption"),this.L("alertText"))},scope:this},{text:this.L("cancelText"),handler:this.close,scope:this}]}this.callParent([b]);this.addCls("gnt-taskeditor-window");if(this.closeOnBlur){this.on("show",this.onFirstShow,this,{single:true})}},getState:function(){if(this.rendered){return this.callParent(arguments)}},init:function(b){this.assignmentStore=this.assignmentStore||b.getAssignmentStore();this.resourceStore=this.resourceStore||b.getResourceStore();this.taskStore=this.taskStore||b.getTaskStore();this.buildTaskEditor(Ext.apply(this.buildTaskEditorConfig(b),this.panelConfig));this.add(this.taskEditor);this.mon(b,this.triggerEvent,this.onTriggerEvent,this);this.gantt=b},buildTaskEditorConfig:function(i){var g={width:null,height:null,border:false,showBaseline:i.enableBaseline,showRollup:i.showRollupTasks,allowParentTaskDependencies:i.allowParentTaskDependencies};var h=this.taskEditorConfigs.split(",");for(var j=0;j<h.length;j++){var f=h[j];if(typeof this[f]!=="undefined"){g[f]=this[f]}}return g},buildTaskEditor:function(b){this.taskEditor=Ext.create(this.taskEditorCls,b);this.relayEvents(this.taskEditor,["loadtask","validate","beforeupdatetask","afterupdatetask"])},onTriggerEvent:function(c,d){this.showTask(d)},showTask:function(d){if(this.taskEditor&&d&&this.matchFilters(d)){this.taskEditor.loadTask(d);var c=this.gantt.isReadOnly();if(c!=this.taskEditor.setReadOnly()){this.taskEditor.setReadOnly(c)}this.down("#teOkBtn").setVisible(!c);this.show()}},matchFilters:function(e){if(!e){return}for(var d=0;d<this.taskFilters.length;d++){var f=this.taskFilters[d];if(!f.fn.call(f.scope,e)){return false}}return true},addFilter:function(c,d){this.taskFilters.push({fn:c,scope:d||this})},validate:function(){if(this.taskEditor){return this.taskEditor.validate()}},completeEditing:function(){if(this.taskEditor){var b=this.taskEditor.getActiveTab();if(b.editingPlugin&&b.editingPlugin.completeEdit){b.editingPlugin.completeEdit()}if(!this.taskEditor.validate()){return false}if(this.taskEditor.updateTask()){this.hide();return true}return false}},updateTask:function(){if(this.taskEditor){return this.taskEditor.updateTask()}},afterRender:function(){var b=this;b.callParent(arguments);b.startDataUpdatesMonitoring()},onFirstShow:function(){if(this.zIndexManager.mask){this.mon(this.zIndexManager.mask,"click",function(){if(this.isVisible()){this.hide()}},this)}},startDataUpdatesMonitoring:function(){var h=this,i=h.down("#teOkBtn"),j=true;function f(){if(j&&i&&h.taskEditor){i.setDisabled(!h.taskEditor.isDataChanged()||!h.taskEditor.isDataValid());j=Ext.Function.defer(f,h.monitorDataUpdatesInterval)}}function g(){j!==true&&clearTimeout(j);j=true}if(h.monitorDataUpdates&&i){h.on({show:f,hide:g,destroy:g})}}});Ext.define("Gnt.util.Data",{singleton:true,cloneModelSet:function(g,k,l){var j=[],h;var i=function(a){h=a.copy();h.phantom=false;h.originalRecord=a;if(k){if(k.call(l||g,h,a)===false){return}}j.push(h)};if(g.each){g.each(i)}else{Ext.Array.each(g,i)}return j},applyCloneChanges:function(v,r,t,l){var B=[];var z=r.autoSyncSuspended;if(r.autoSync&&!z){r.suspendAutoSync()}var w=v.getRemovedRecords();for(var x=0,A=w.length;x<A;x++){if(w[x].originalRecord){B.push(w[x].originalRecord)}}if(B.length){r.remove(B);v.removed.length=0}var q=v.getModifiedRecords(),i,y,u;for(x=0,A=q.length;x<A;x++){i=q[x].originalRecord;y=q[x].getData();delete y[q[x].idProperty];if(i){i.beginEdit();for(var s in y){i.set(s,y[s])}if(t){t.call(l||q[x],y,q[x])}i.endEdit()}else{if(t){t.call(l||q[x],y,q[x])}u=r.add(y);q[x].originalRecord=u&&u[0]}q[x].commit(true)}if(r.autoSync&&!z){r.resumeAutoSync();r.sync()}}});Ext.define("Gnt.widget.taskeditor.BaseEditor",{extend:Ext.tab.Panel,mixins:[Gnt.mixin.Localizable],margin:"5 0 0 0",height:340,width:600,layout:"fit",border:false,plain:false,defaults:{margin:5,border:false},eventIndicator:"task",task:null,taskBuffer:null,taskStore:null,assignmentStore:null,resourceStore:null,tabBar:{cls:"gnt-taskeditor-header"},clonedStores:null,constructor:function(e){var g=this;e=e||{};Ext.apply(g,e);if(!g.clonedStores){g.clonedStores=(g.task||g.taskStore)?g.cloneStores():{}}var f=g.buildItems(e);var h=g.items;if(h){f.push.apply(f,Ext.isArray(h)?h:[h]);delete e.items}g.items=f;if(g.items.length<=1){e.tabBar=e.tabBar||{};Ext.applyIf(e.tabBar,{hidden:true})}this.callParent([e])},buildItems:function(b){return[]},cloneTaskBranch:function(o,k){o=o||this.task;var l=this,n=l.getTaskStore(),i=n&&n.getRoot(),m=l.clonedStores,j,p;o.bubble(function(b){if(b!==i){var a=k[b.getId()];if(a){if(p){a.appendChild(p)}p=null;return false}else{a=l.cloneTask(b);k[b.getId()]=a;a.taskStore=m.taskStore}if(p){a.appendChild(p)}else{j=a}p=a}});return{branch:p,task:j}},cloneRelevantTasks:function(l){l=l||this.task;var k=this,j={};var h=k.cloneTaskBranch(l,j),g=h.task,i=[h.branch];Ext.Array.each(l.predecessors,function(a){var b=k.cloneTaskBranch(a.getSourceTask(),j);if(b.branch){i.push(b.branch)}});Ext.Array.each(l.successors,function(a){var b=k.cloneTaskBranch(a.getTargetTask(),j);if(b.branch){i.push(b.branch)}});return{task:g,tasks:i}},loadTask:function(d){if(!d){return}var c=this;this.clonedStores=this.cloneStores({task:d});this.loadClonedStores(this.clonedStores,d)},cloneTaskStore:function(e,h){var f=this.getTaskStore();if(!f){return null}var g=new f.self(Ext.apply({isCloned:true,calendarManager:null,storeId:null,calendar:f.getCalendar(),model:f.model,weekendsAreWorkdays:f.weekendsAreWorkdays,cascadeChanges:f.cascadeChanges,batchSync:false,recalculateParents:false,skipWeekendsDuringDragDrop:f.skipWeekendsDuringDragDrop,moveParentAsGroup:f.moveParentAsGroup,enableDependenciesForParentTasks:f.enableDependenciesForParentTasks,availabilitySearchLimit:f.availabilitySearchLimit,autoNormalizeNodes:false,dependenciesCalendar:"project",proxy:{type:"memory",reader:{type:"json"}}},h));this.mon(f,{calendarset:function(b,a){g.setCalendar(a)}});return g},cloneDependencyStore:function(e,g){var h=this.getTaskStore();var f=this.dependencyStore||h&&h.getDependencyStore();if(!f){return null}return new f.self(Ext.apply({isCloned:true,model:f.model,strictDependencyValidation:f.strictDependencyValidation,allowedDependencyTypes:f.allowedDependencyTypes,proxy:{type:"memory",reader:{type:"json"}}},g))},cloneAssignmentStore:function(e,g){var h=this.getTaskStore();var f=this.assignmentStore||h&&h.getAssignmentStore();if(!f){return null}return new f.self(Ext.apply({isCloned:true,model:f.model,proxy:{type:"memory",reader:{type:"json"}}},g))},cloneResourceStore:function(e,g){var h=this.getTaskStore();var f=this.resourceStore||h&&h.getResourceStore();if(!f){return null}return new f.self(Ext.apply({isCloned:true,model:f.model,proxy:{type:"memory",reader:{type:"json"}}},g))},cloneStores:function(m){m=m||{};var i=m.task||this.task,l=this.clonedStores||{},k=l.resourceStore||this.cloneResourceStore(i,m&&m.resourceStore),j=l.assignmentStore||this.cloneAssignmentStore(i,m&&m.assignmentStore),n=l.dependencyStore||this.cloneDependencyStore(i,m&&m.dependencyStore);var h=l.taskStore||this.cloneTaskStore(i,Ext.apply({assignmentStore:j,resourceStore:k,dependencyStore:n},m&&m.taskStore));k.taskStore=h;Ext.apply(l,{resourceStore:k,assignmentStore:j,dependencyStore:n,taskStore:h});return l},getTaskStore:function(b){b=b||this.task;return this.taskStore||b&&b.getTaskStore()},loadClonedStores:function(l,g){var k=this,j=k.cloneRelevantTasks(g),i=j.tasks,h=j.task;h.taskStore.on({update:function(a,c,b){if(c===h&&b==Ext.data.Model.EDIT){k.onTaskUpdated.call(k,c);c.fireEvent(k.eventIndicator+"updated",c)}}});l.taskStore.setRootNode({expanded:true,children:i});k.loadClonedDependencyStore(l,g);k.loadClonedResourceStore(l,g);k.loadClonedAssignmentStore(l,g);k.taskBuffer=h},loadClonedDependencyStore:function(c,d){c=c||this.clonedStores;c.dependencyStore&&c.dependencyStore.loadData(Gnt.util.Data.cloneModelSet(d.getAllDependencies(),function(a,b){a.setId(b.getId())}))},loadClonedResourceStore:function(c,d){c=c||this.clonedStores;c.resourceStore&&c.resourceStore.loadData(Gnt.util.Data.cloneModelSet(this.resourceStore||this.getTaskStore().getResourceStore(),function(a,b){a.setId(b.getId())}))},loadClonedAssignmentStore:function(c,d){c=c||this.clonedStores;c.assignmentStore&&c.assignmentStore.loadData(Gnt.util.Data.cloneModelSet(d.getAssignments(),function(a,b){a.setId(b.getId())}))},cloneTask:function(b){return b.copy(b.getId(),false)},getTabByComponent:function(c){var d;this.items.each(function(a){if(c===a||c.isDescendantOf(a)){d=a;return false}},this);return d},validate:function(){var e,f=this.getActiveTab(),h=[],g;e=this.doValidate(function(a){h.push(a)});if(!e&&f&&!Ext.Array.contains(h,f)){g=h[0];this.setActiveTab(g)}else{if(!e&&f){g=f}else{if(!e){g=h[0]}}}return(this.fireEvent("validate",this,g)!==false)&&e},updateTask:function(){var c=this,d=false;if(c.fireEvent("beforeupdate"+c.eventIndicator,c,function(){c.doUpdateTask()})!==false){c.doUpdateTask();c.fireEvent("afterupdate"+c.eventIndicator,c);d=true}return d},onDestroy:function(){if(this.clonedStores.taskStore){this.clonedStores.taskStore.destroy()}this.callParent(arguments)},doValidate:function(){return true},isDataValid:function(){return this.doValidate()},isDataChanged:function(){return false},doUpdateTask:function(){throw"Abstract method called"},updateReadOnly:function(){throw"Abstract method called"},getReadOnly:function(){return this.readOnly},setReadOnly:function(b){this.readOnly=b;this.updateReadOnly()},onTaskUpdated:function(b){this.updateReadOnly()}});Ext.define("Gnt.widget.taskeditor.BaseForm",{extend:Ext.form.Panel,highlightTaskUpdates:true,task:null,taskBuffer:null,taskStore:null,taskListeners:null,autoScroll:true,defaults:{labelWidth:110},bodyPadding:5,border:false,layout:"anchor",defaultType:"textfield",initComponent:function(){if(this.task){this.fieldNames=this.getFieldNames(this.task)}if(!this.items){this.buildFields()}this.callParent(arguments);if(this.task){this.loadRecord(this.task,this.taskBuffer)}},getFieldNames:function(d){if(!d){return}var e={};for(var f in this.fieldNames){e[f]=d[f]}return e},renameFields:function(g){var h=this.getFieldNames(g);if(!h){return}var k=this.getForm(),i=false,j;for(var l in this.fieldNames){j=k.findField(this.fieldNames[l]);if(j&&h[l]&&h[l]!=j.name){i=true;j.name=h[l]}}if(i){this.fieldNames=h}},setSuppressTaskUpdate:function(c){var d=this.getForm().getFields();d.each(function(a){a.setSuppressTaskUpdate&&a.setSuppressTaskUpdate(c)})},isDataChanged:function(){return this.isDirty()},buildTaskBuffer:function(d){var c=this;c.taskBuffer=d.copy();c.taskBuffer.taskStore=d.taskStore},loadRecord:function(f,g){var i=this;if(f&&f!==i.task){i.renameFields(f)}i.task=f;i.taskBuffer=g;if(!i.taskBuffer){i.buildTaskBuffer(f)}i.taskListeners&&i.taskListeners.destroy();i.taskListeners=i.mon(i.taskBuffer,{taskupdated:i.onTaskUpdated,destroyable:true,scope:i});var j=i.getForm();j._record=f;this.suspendLayouts();var h=f.getData();j.getFields().each(function(a){if(a.getName() in h){if(a.setTask){a.setTask(i.taskBuffer)}else{a.setValue(h[a.getName()])}i.updateFieldReadOnly(a);if(j.trackResetOnLoad){a.resetOriginalValue()}}});this.resumeLayouts(true);this.fireEvent("afterloadrecord",this,f)},updateFieldReadOnly:function(g){var e=this;if(!g.disabled){var f=g.isTaskField,h=e.getReadOnly()||!e.taskBuffer.isEditable(g.name);g.setReadOnly(h);if(g.editable===false){if(!h&&g.inputEl){g.inputEl.dom.readOnly=true}}if(f){g.forceReadOnly=h}}},updateReadOnly:function(){var d=this,e=d.getForm(),f=d.taskBuffer.getData();e.getFields().each(function(a){if(a.getName() in f){d.updateFieldReadOnly(a)}})},updateRecord:function(d){var c=this;d=d||c.task;if(d&&c.fireEvent("beforeupdaterecord",c,d,c.updateRecordFn)!==false){c.setSuppressTaskUpdate(true);c.updateRecordFn.call(c,d);c.setSuppressTaskUpdate(false);c.fireEvent("afterupdaterecord",c,d);return true}return false},updateRecordWithFieldValue:function(e,f){var d=e.getField(f.name);if(f.applyChanges){f.applyChanges(e)}else{if(d&&f.name in this.getForm().getFieldValues()){e.set(f.name,f.getValue())}}},updateRecordFn:function(d){var c=this;d.beginEdit();c.getForm().getFields().each(function(a){c.updateRecordWithFieldValue(d,a)});d.endEdit()},initFieldDefinition:function(g,f){var h=this;var e={taskStore:h.taskStore,task:h.task,highlightTaskUpdates:h.highlightTaskUpdates};if(!g.readOnly&&h.task){e.readOnly=!h.task.isEditable(g.name)}return Ext.apply(g,e,f)},getTaskFieldValue:function(f){var d=this,e=this.task;return e?e.get(d.fieldNames[f]):""},onTaskUpdated:function(d,c){this.updateReadOnly()},getReadOnly:function(){return this.readOnly},setReadOnly:function(b){this.readOnly=b;this.updateReadOnly()}});Ext.define("Gnt.widget.taskeditor.ProjectForm",{extend:Gnt.widget.taskeditor.BaseForm,alias:"widget.projectform",mixins:[Gnt.mixin.Localizable],alternateClassName:["Gnt.widget.ProjectForm"],showCalendar:false,nameConfig:null,readOnlyConfig:null,allowDependenciesConfig:null,startConfig:null,finishConfig:null,calendarConfig:null,constructor:function(c){c=c||{};var d=c.taskStore&&c.taskStore.projectModel&&c.taskStore.projectModel.prototype||Gnt.model.Project.prototype;this.fieldNames={calendarIdField:d.calendarIdField,readOnlyField:d.readOnlyField,allowDependenciesField:d.allowDependenciesField,startDateField:d.startDateField,endDateField:d.endDateField,nameField:d.nameField,descriptionField:d.descriptionField};this.callParent(arguments);this.addBodyCls("gnt-projecteditor-projectform")},buildFields:function(){var d=this,c=d.fieldNames;d.items=d.items||[];d.items.push({xtype:"fieldset",title:d.L("projectText"),layout:"vbox",defaults:{allowBlank:false},items:[d.initFieldDefinition({xtype:"textfield",fieldLabel:d.L("nameText"),name:c.nameField,labelWidth:110,flex:1,value:d.getTaskFieldValue(c.nameField)},d.nameConfig),d.initFieldDefinition({xtype:"readonlyfield",fieldLabel:d.L("readOnlyText"),name:c.readOnlyField,labelWidth:110,flex:1,value:d.getTaskFieldValue(c.readOnlyField)},d.readOnlyConfig),d.initFieldDefinition({xtype:"checkboxfield",fieldLabel:d.L("allowDependenciesText"),name:c.allowDependenciesField,labelWidth:110,flex:1,value:d.getTaskFieldValue(c.allowDependenciesField)},d.allowDependenciesConfig)]},d.initFieldDefinition({xtype:"fieldset",title:d.L("datesText"),layout:"hbox",defaults:{labelWidth:110,allowBlank:false,margin:"5 5 5 0"},items:[d.initFieldDefinition({xtype:"startdatefield",fieldLabel:d.L("startText"),width:260,name:c.startDateField,value:d.getTaskFieldValue(c.startDateField),format:Config.Data.DE_DATE_FORMAT},d.startConfig),d.initFieldDefinition({xtype:"enddatefield",fieldLabel:d.L("finishText"),flex:1,labelWidth:110,name:c.endDateField,value:d.getTaskFieldValue(c.endDateField),format:Config.Data.DE_DATE_FORMAT},d.finishConfig)]}));if(d.showCalendar){d.items.push({xtype:"fieldset",layout:"hbox",defaults:{labelWidth:110,allowBlank:false,margin:"5 0 5 0"},items:[d.initFieldDefinition({xtype:"calendarfield",fieldLabel:this.L("calendarText"),width:260,name:c.calendarIdField,value:d.getTaskFieldValue(c.calendarIdField)},d.calendarConfig)]})}}});Ext.define("Gnt.widget.taskeditor.ProjectEditor",{extend:Gnt.widget.taskeditor.BaseEditor,alias:"widget.projecteditor",alternateClassName:["Gnt.widget.ProjectEditor"],eventIndicator:"project",projectFormClass:"Gnt.widget.taskeditor.ProjectForm",showDescription:true,projectFormConfig:null,descriptionConfig:null,descriptionPanel:null,descriptionEditor:null,projectForm:null,buildItems:function(){var d=this,e=[],f=this.task;d.projectForm=Ext.create(d.projectFormClass,Ext.applyIf(d.projectFormConfig||{},{task:f,taskStore:d.taskStore}));e.push(d.projectForm);if(d.showDescription){d.descriptionEditor=Ext.create("Ext.form.field.HtmlEditor",Ext.apply({listeners:{afterrender:function(a){d.descriptionEditor.setValue(d.task.get(d.task.descriptionField))}},readOnly:f&&!f.isEditable(f.descriptionField),isDataChanged:function(){return this.isDirty()}},d.descriptionConfig));d.descriptionPanel=Ext.create("Ext.panel.Panel",{border:false,layout:"fit",items:d.descriptionEditor});e.push(d.descriptionPanel)}if(!d.projectForm.title){d.projectForm.title=d.L("generalText")}if(d.descriptionPanel&&!d.descriptionPanel.title){d.descriptionPanel.title=this.L("descriptionText")}return e},loadProject:function(b){this.loadTask.apply(this,arguments)},loadTask:function(c){if(!c){return}this.task=c;var d=this.projectForm;d.setSuppressTaskUpdate(true);d.getForm().reset();this.callParent(arguments);d.loadRecord(c,this.taskBuffer);if(this.descriptionEditor){this.descriptionEditor.setValue(c.getDescription())}this.setReadOnly(c.isReadOnly());d.setSuppressTaskUpdate(false);this.fireEvent("loadproject",this,c)},setReadOnly:function(f){var e=this,d=e.task;if(d){if(e.descriptionEditor){e.descriptionEditor.setReadOnly(f||!d.isEditable(d.descriptionField))}}},onTaskUpdated:function(b){this.setReadOnly(b.isReadOnly())},updateProject:function(){this.updateTask()},loadClonedDependencyStore:Ext.emptyFn,loadClonedResourceStore:Ext.emptyFn,loadClonedAssignmentStore:Ext.emptyFn,doValidate:function(c){var d=this.callParent(arguments);if(this.projectForm&&!this.projectForm.isValid()){d=false;c&&c(this.getTabByComponent(this.projectForm))}return d},doUpdateTask:function(){var b=this.task;this.projectForm&&this.projectForm.updateRecord();this.descriptionEditor&&b.set(b.descriptionField,this.descriptionEditor.getValue())},isDataChanged:function(c){var d=this.callParent(arguments);if(this.projectForm&&this.projectForm.isDataChanged()){d=true;c&&c(this.getTabByComponent(this.projectForm))}if(this.descriptionEditor&&this.descriptionEditor.isDataChanged()){d=true;c&&c(this.getTabByComponent(this.descriptionEditor))}return d}});Ext.define("Gnt.plugin.taskeditor.ProjectEditor",{extend:Gnt.plugin.taskeditor.BaseEditor,alternateClassName:["Gnt.plugin.ProjectEditor"],alias:"plugin.gantt_projecteditor",ptype:"gantt_projecteditor",taskEditorCls:"Gnt.widget.taskeditor.ProjectEditor",taskEditorConfigs:"l10n,task,taskStore,assignmentStore,resourceStore,projectFormClass,showDescription,projectFormConfig,descriptionConfig",constructor:function(b){this.callParent(arguments);this.addCls("gnt-projecteditor-window");this.addFilter(this.isProject)},init:function(b){this.callParent(arguments);b.projectEditor=this},isProject:function(b){return b&&b.isProject}});Ext.define("Gnt.widget.taskeditor.TaskForm",{extend:Gnt.widget.taskeditor.BaseForm,alias:"widget.taskform",mixins:[Gnt.mixin.Localizable],alternateClassName:["Gnt.widget.TaskForm"],showGeneral:true,showBaseline:true,editBaseline:false,taskNameConfig:null,durationConfig:null,startConfig:null,finishConfig:null,percentDoneConfig:null,baselineStartConfig:null,baselineFinishConfig:null,baselinePercentDoneConfig:null,effortConfig:null,constructor:function(c){c=c||{};this.showBaseline=c.showBaseline;this.editBaseline=c.editBaseline;var d=c.taskStore?c.taskStore.model.prototype:Gnt.model.Task.prototype;this.fieldNames={baselineEndDateField:d.baselineEndDateField,baselinePercentDoneField:d.baselinePercentDoneField,baselineStartDateField:d.baselineStartDateField,calendarIdField:d.calendarIdField,readOnlyField:d.readOnlyField,clsField:d.clsField,draggableField:d.draggableField,durationField:d.durationField,durationUnitField:d.durationUnitField,effortField:d.effortField,effortUnitField:d.effortUnitField,endDateField:d.endDateField,manuallyScheduledField:d.manuallyScheduledField,nameField:d.nameField,percentDoneField:d.percentDoneField,resizableField:d.resizableField,rollupField:d.rollupField,schedulingModeField:d.schedulingModeField,startDateField:d.startDateField,noteField:d.noteField,constraintTypeField:d.constraintTypeField,constraintDateField:d.constraintDateField};this.callParent(arguments);this.addBodyCls("gnt-taskeditor-taskform")},buildFields:function(){var d=this,c=d.fieldNames;d.items=d.items||[];if(d.showGeneral){d.items.push({xtype:"fieldcontainer",layout:"hbox",items:[d.initFieldDefinition({xtype:"textfield",fieldLabel:d.L("taskNameText"),name:c.nameField,labelWidth:110,allowBlank:false,flex:1,value:d.getTaskFieldValue(c.nameField)},d.nameConfig)]},{xtype:"fieldcontainer",layout:"hbox",defaults:{labelWidth:110,allowBlank:false},items:[d.initFieldDefinition({xtype:"percentfield",fieldLabel:d.L("percentDoneText"),name:c.percentDoneField,margin:"0 0 0 8",flex:1,value:d.getTaskFieldValue(c.percentDoneField)},d.percentDoneConfig),d.initFieldDefinition({xtype:"durationfield",fieldLabel:d.L("durationText"),name:c.durationField,flex:1,value:d.getTaskFieldValue(c.durationField)},d.durationConfig)]},{xtype:"fieldset",title:d.L("datesText"),layout:"hbox",items:[{xtype:"container",layout:"anchor",flex:1,margin:"0 8 0 0",defaults:{labelWidth:110},items:[d.initFieldDefinition({xtype:"startdatefield",fieldLabel:d.L("startText"),width:"100%",allowBlank:false,name:c.startDateField,value:d.getTaskFieldValue(c.startDateField)},d.startConfig),d.initFieldDefinition({xtype:"effortfield",fieldLabel:d.L("effortText"),name:c.effortField,invalidText:d.L("invalidEffortText"),width:"100%",allowBlank:true,value:d.getTaskFieldValue(c.effortField)},d.effortConfig)]},d.initFieldDefinition({xtype:"enddatefield",fieldLabel:d.L("finishText"),flex:1,labelWidth:110,allowBlank:false,name:c.endDateField,value:d.getTaskFieldValue(c.endDateField)},d.finishConfig)]})}if(d.showBaseline){d.items.push({xtype:"fieldset",title:d.L("baselineText"),layout:"hbox",items:[{xtype:"container",layout:"anchor",flex:1,margin:"0 8 0 0",defaults:{labelWidth:110,cls:"gnt-baselinefield"},items:[d.initFieldDefinition({xtype:"baselinestartdatefield",fieldLabel:d.L("baselineStartText"),name:c.baselineStartDateField,value:d.getTaskFieldValue(c.baselineStartDateField),width:"100%",readOnly:!d.editBaseline,forceReadOnly:!d.editBaseline},d.baselineStartConfig),d.initFieldDefinition({xtype:"percentfield",fieldLabel:d.L("baselinePercentDoneText"),width:"100%",name:c.baselinePercentDoneField,value:d.getTaskFieldValue(c.baselinePercentDoneField),readOnly:!d.editBaseline},d.baselinePercentDoneConfig)]},d.initFieldDefinition({xtype:"baselineenddatefield",fieldLabel:d.L("baselineFinishText"),name:c.baselineEndDateField,cls:"gnt-baselinefield",flex:1,labelWidth:110,value:d.getTaskFieldValue(c.baselineEndDateField),readOnly:!d.editBaseline,forceReadOnly:!d.editBaseline},d.baselineFinishConfig)]})}},updateRecordWithFieldValue:function(e,f){var d=this;if(f.name!=d.fieldNames.constraintTypeField&&f.name!=d.fieldNames.constraintDateField){return this.callParent(arguments)}},updateRecordFn:function(g){var j=this,i=j.fieldNames,k=j.getForm(),l=k.findField(i.constraintTypeField),h=k.findField(i.constraintDateField);g.beginEdit();this.callParent(arguments);if(l&&h&&g.setConstraint){g.setConstraint(l.getValue(),h.getValue())}g.endEdit()},buildTaskBuffer:function(b){this.callParent(arguments);if(!b.getReadOnly()&&b.isReadOnly()){this.taskBuffer.isReadOnly=function(){return true}}}});Ext.define("Gnt.widget.taskeditor.AdvancedForm",{extend:Gnt.widget.taskeditor.TaskForm,alias:"widget.advanced_taskform",mixins:[Gnt.mixin.Localizable],alternateClassName:["Gnt.widget.AdvancedForm"],showGeneral:false,showBaseline:false,editBaseline:false,showCalendar:true,showManuallyScheduled:true,showSchedulingMode:true,showWbsCode:true,showRollup:false,showConstraint:true,showReadOnly:false,calendarConfig:null,manuallyScheduledConfig:null,schedulingModeConfig:null,wbsCodeConfig:null,rollupConfig:null,constraintTypeConfig:null,constraintDateConfig:null,defaults:{labelWidth:110,flex:1},bodyPadding:"5 5 0 0",readOnlyConfig:null,constructor:function(b){this.callParent(arguments);this.addBodyCls("gnt-taskeditor-advancedtaskform")},buildFields:function(){var d=this,c=d.fieldNames;d.items=d.items||[];if(d.showCalendar){d.items.push(d.initFieldDefinition({xtype:"calendarfield",fieldLabel:this.L("calendarText"),name:c.calendarIdField,value:d.getTaskFieldValue(c.calendarIdField)},d.calendarConfig))}if(d.showManuallyScheduled){d.items.push(d.initFieldDefinition({xtype:"manuallyscheduledfield",fieldLabel:d.L("manuallyScheduledText"),name:c.manuallyScheduledField,value:d.getTaskFieldValue(c.manuallyScheduledField)},d.manuallyScheduledConfig))}if(d.showSchedulingMode){d.items.push(d.initFieldDefinition({xtype:"schedulingmodefield",fieldLabel:d.L("schedulingModeText"),name:c.schedulingModeField,value:d.getTaskFieldValue(c.schedulingModeField),allowBlank:false},d.schedulingModeConfig))}if(d.showWbsCode){d.items.push(d.initFieldDefinition({xtype:"textfield",fieldLabel:d.L("wbsCodeText"),name:"wbsCode",forceReadOnly:true,readOnly:true,value:d.task&&d.task.getWBSCode()},d.wbsCodeConfig))}if(d.showRollup){this.items.push(d.initFieldDefinition({xtype:"checkboxfield",fieldLabel:this.L("rollupText"),name:c.rollupField,value:d.getTaskFieldValue(c.rollupField)},d.rollupConfig))}if(d.showReadOnly){this.items.push(d.initFieldDefinition({xtype:"readonlyfield",fieldLabel:d.L("readOnlyText"),name:c.readOnlyField,value:d.getTaskFieldValue(c.readOnlyField)},d.readOnlyConfig))}if(d.showConstraint){d.items.push(d.initFieldDefinition({xtype:"constrainttypefield",fieldLabel:d.L("Constraint Type"),name:c.constraintTypeField,value:d.getTaskFieldValue(c.constraintTypeField)},d.constraintTypeConfig),d.initFieldDefinition({xtype:"constraintdatefield",fieldLabel:d.L("Constraint Date"),name:c.constraintDateField,value:d.getTaskFieldValue(c.constraintDateField)},d.constraintDateConfig))}}});Ext.define("Gnt.widget.AssignmentEditGrid",{extend:Ext.grid.Panel,alias:"widget.assignmenteditgrid",mixins:[Gnt.mixin.Localizable],assignmentStore:null,resourceStore:null,readOnly:false,cls:"gnt-assignmentgrid",defaultAssignedUnits:100,confirmAddResource:true,addResources:true,taskId:null,refreshTimeout:100,resourceDupStore:null,resourceComboStore:null,assignmentUnitsEditor:null,constructor:function(e){Ext.apply(this,e);var g=e.assignmentStore;var f=e.taskStore||g.getTaskStore();this.store=e.store||new g.self({model:g.model,taskStore:f});var h=f.getResourceStore();this.resourceDupStore=e.resourceDupStore||new h.self({model:h.model,taskStore:f});this.resourceComboStore=new Ext.data.JsonStore({autoDestroy:true,model:this.resourceDupStore.model});if(e.addResources!==undefined){this.addResources=e.addResources}this.columns=this.buildColumns();if(!this.readOnly){this.plugins=this.buildPlugins()}this.callParent(arguments)},suspendRefreshResources:function(){this.refreshResourcesSuspended++},resumeRefreshResources:function(){this.refreshResourcesSuspended--},refreshResources:function(){if(!this.refreshResourcesSuspended){this.loadResources()}},suspendRefreshAssignments:function(){this.refreshAssignmentsSuspended++},resumeRefreshAssignments:function(){this.refreshAssignmentsSuspended--},refreshAssignments:function(){if(!this.refreshAssignmentsSuspended){this.loadTaskAssignments()}},initComponent:function(){this.loadResources();var d=Ext.Function.createBuffered(this.refreshResources,this.refreshTimeout,this,[]);this.mon(this.resourceStore,{add:d,remove:d,load:d,clear:d});this.loadTaskAssignments();var c=Ext.Function.createBuffered(this.refreshAssignments,this.refreshTimeout,this,[]);this.mon(this.assignmentStore,{add:c,remove:c,load:c,clear:c});this.callParent(arguments)},loadResources:function(c){if(!this.resourceStore){return false}var d=Gnt.util.Data.cloneModelSet(this.resourceStore);this.resourceDupStore.loadData(d);this.resourceComboStore.loadData(d);if(!c){this.loadTaskAssignments()}return true},afterRender:function(){var d;this.callParent(arguments);if(this.taskId){var c=this.taskStore||this.assignmentStore.getTaskStore();d=c&&c.getModelById(this.taskId)}if(d){this.setEditableFields(d)}},getUnitsEditor:function(){if(!this.readOnly){if(!this.assignmentUnitsEditor){this.assignmentUnitsEditor=this.down("assignmentunitscolumn").getEditor()}}return this.assignmentUnitsEditor},setEditableFields:function(d){var c=this.getUnitsEditor();if(c){switch(d.getSchedulingMode()){case"DynamicAssignment":c.setReadOnly(true);break;default:c.setReadOnly(false)}}},setReadOnly:function(b){if(this.cellEditing){if(b){this.cellEditing.disable()}else{this.cellEditing.enable()}}},loadTaskAssignments:function(m){m=m||this.taskId;if(!m){return false}var n=this.taskStore||this.assignmentStore.getTaskStore(),h=n&&n.getModelById(m),j;if(h){j=h.getAssignments()}else{if(!this.assignmentStore){return false}j=this.assignmentStore.queryBy(function(a){return a.getTaskId()==m})}this.taskId=m;var i=this.store,l=this.resourceDupStore,k=Gnt.util.Data.cloneModelSet(j,function(c,d){var a=d.getResourceId();var b=l.queryBy(function(e){var f=e.originalRecord;return(f.getId()||f.internalId)==a});if(b.getCount()){b=b.first();c.setResourceId(b.getId()||b.internalId)}});i.loadData(k);if(h&&this.rendered){this.setEditableFields(h)}return true},insertAssignment:function(e,g){if(!e||!e.isModel){e=new this.store.model(e);if(!e){e.setUnits(this.defaultAssignedUnits)}}if(e.getResourceId()===undefined){e.setResourceId(null)}e.setTaskId(this.taskId);this.store.insert(0,e);var h=this,f=e.isValid;e.isValid=function(){return f.apply(this,arguments)&&h.isValidAssignment(this)};if(!g&&this.cellEditing){this.cellEditing.startEditByPosition({row:0,column:0})}return e},isValid:function(){var b=true;this.store.each(function(a){if(!a.isValid()){b=false;return false}});return b},getAssignmentErrors:function(d){var c=d.getResourceId();if(!c){return[this.L("noValueText")]}if(!this.resourceDupStore.getModelById(c)){return[Ext.String.format(this.L("noResourceText"),c)]}},isValidAssignment:function(b){return !this.getAssignmentErrors(b)},buildPlugins:function(){var d=this.cellEditing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1});var c=d.startEdit;d.startEdit=function(){this.completeEdit();return c.apply(this,arguments)};d.on({beforeedit:this.onEditingStart,scope:this});return[d]},hide:function(){this.cellEditing.cancelEdit();return this.callParent(arguments)},onEditingStart:function(e,f){var d=this.store.model.prototype;if(f.field==d.resourceIdField){this.assignment=f.record;this.resourceId=f.record.getResourceId();this.resourceComboStore.loadData(this.resourceDupStore.getRange());this.resourceComboStore.filter(this.resourcesFilter)}},resourceRender:function(f,j,i){var h=this.getAssignmentErrors(i);if(h&&h.length){j.tdCls=Ext.baseCSSPrefix+"form-invalid";j.tdAttr='data-errorqtip="'+h.join("<br>")+'"'}else{j.tdCls="";j.tdAttr='data-errorqtip=""'}var g=this.resourceDupStore.getModelById(f);return Ext.String.htmlEncode((g&&g.getName())||f)},filterResources:function(h){var g=h.getId(),e=this.store.model.prototype.resourceIdField,f=true;if(g!==this.resourceId){this.store.each(function(a){if(g==a.get(e)){f=false;return false}})}return f},onResourceComboAssert:function(p){var n=p.getRawValue();if(n){var k=this.resourceDupStore.findExact(p.displayField,n);var m=k!==-1?this.resourceDupStore.getAt(k):false;if(!m){var q=this.assignment;var l=this;var r=function(c){var b=l.resourceStore.model,d={};d[b.prototype.nameField]=n;d=new b(d);d.setId(d.internalId);var a=l.resourceDupStore.add(d);if(a&&a.length){if(!c){p.getStore().add(d);p.setValue(a[0].getId())}else{q.setResourceId(a[0].getId())}}};if(this.confirmAddResource){var j=Ext.String.format(this.L("confirmAddResourceText"),Ext.String.htmlEncode(n));var o=Ext.Msg.confirm(this.L("confirmAddResourceTitle"),j,function(a){if(a=="yes"){r(true)}});setTimeout(function(){o.toFront()},1)}else{r()}}else{p.select(m,true)}}},buildColumns:function(){var b=this;this.resourceCombo=new Ext.form.field.ComboBox({queryMode:"local",store:this.resourceComboStore,allowBlank:false,editing:this.addResources,validateOnChange:false,autoSelect:false,forceSelection:!this.addResources,valueField:this.resourceComboStore.model.prototype.idProperty,displayField:this.resourceComboStore.model.prototype.nameField,queryCaching:false,listConfig:{getInnerTpl:function(){return"{"+this.displayField+":htmlEncode}"}}});this.resourcesFilter=Ext.create("Ext.util.Filter",{filterFn:this.filterResources,scope:this});if(this.addResources){Ext.Function.interceptBefore(this.resourceCombo,"assertValue",function(){b.onResourceComboAssert(this)})}return[{xtype:"resourcenamecolumn",editor:this.resourceCombo,dataIndex:this.assignmentStore.model.prototype.resourceIdField,renderer:this.resourceRender,scope:this},{xtype:"assignmentunitscolumn",assignmentStore:this.assignmentStore,dataIndex:this.assignmentStore.model.prototype.unitsField}]},saveResources:function(){Gnt.util.Data.applyCloneChanges(this.resourceDupStore,this.resourceStore)},saveTaskAssignments:function(){this.suspendRefreshAssignments();this.suspendRefreshResources();this.saveResources();var d=this.store.model,f=this.resourceDupStore,e=true;Gnt.util.Data.applyCloneChanges(this.store,this.assignmentStore,function(a){var b=f.getById(this.getResourceId());if(!b||!b.originalRecord){e=false;return}var c=b.originalRecord;a[d.prototype.resourceIdField]=c.getId()||c.internalId});this.resumeRefreshAssignments();this.resumeRefreshResources();return e},isDataChanged:function(){var b=this;return b.store&&b.store.getUpdatedRecords().length>0||b.store.getNewRecords().length>0||b.store.getRemovedRecords().length>0},isDataValid:function(){var b=true;this.store.each(function(a){if(!a.isValid()){b=false;return false}});return b}});Ext.define("Gnt.widget.DependencyGrid",{extend:Ext.grid.Panel,alias:"widget.dependencygrid",mixins:[Gnt.mixin.Localizable],readOnly:false,showCls:false,cls:"gnt-dependencygrid",task:null,dependencyStore:null,taskModel:null,direction:"predecessors",oppositeStore:null,taskStoreListeners:null,refreshTimeout:100,allowParentTaskDependencies:false,useSequenceNumber:false,lagEditor:null,typesCombo:null,constructor:function(c){c=c||{};Ext.Array.each(["idText","taskText","blankTaskText","invalidDependencyText","parentChildDependencyText","duplicatingDependencyText","transitiveDependencyText","cyclicDependencyText","typeText","lagText","clsText","endToStartText","startToStartText","endToEndText","startToEndText"],function(a){if(a in c){this[a]=c[a]}},this);this.store=c.store||new Ext.data.JsonStore({autoDestroy:true,model:c.dependencyStore?c.dependencyStore.model:"Gnt.model.Dependency"});if(!this.readOnly){this.plugins=this.buildPlugins()}this.direction=c.direction||this.direction;if(!c.taskModel){c.taskModel=Ext.ClassManager.get("Gnt.model.Task");if(c.dependencyStore){var d=c.dependencyStore.getTaskStore();if(d){c.taskModel=d.model}}}if(c.oppositeStore){this.setOppositeStore(c.oppositeStore)}this.callParent([c])},initComponent:function(){if(this.task){this.setTask(this.task);this.loadDependencies(this.task)}if(!this.title){this.title=this.direction==="predecessors"?this.L("predecessorsText"):this.L("successorsText")}this.columns=this.buildColumns();this.callParent(arguments)},destroy:function(){if(this.deferredStoreBind){this.tasksCombo.un("render",this.bindTaskStore,this)}this.tasksCombo.destroy();this.typesCombo.destroy();this.lagEditor.destroy();this.callParent(arguments);this.cellEditing.destroy()},setTask:function(d){if(!d){return}this.task=d;var c=d.dependencyStore||d.getTaskStore().dependencyStore;if(c&&c!==this.dependencyStore){if(this.dependencyStore){this.mun(this.dependencyStore,this.onDependencyStoreDataChanged,this)}this.dependencyStore=c;if(this.typesCombo){this.typesCombo.store.filter(this.typesFilter)}this.mon(this.dependencyStore,this.onDependencyStoreDataChanged,this)}this.setReadOnly(d.isReadOnly())},setReadOnly:function(b){if(this.cellEditing){if(b){this.cellEditing.disable()}else{this.cellEditing.enable()}}},onDependencyStoreDataChanged:function(){this.loadDependencies()},buildPlugins:function(){var b=this.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1});b.on({beforeedit:this.onEditingStart,edit:this.onEditingDone,scope:this});return[b]},hide:function(){this.cellEditing.cancelEdit();this.callParent(arguments)},onEditingStart:function(e,f){var d=this.store.model.prototype;switch(f.field){case d.lagField:this.lagEditor.durationUnit=f.record.getLagUnit();break;case d.typeField:this.typesCombo.store.filter(this.typesFilter);if(this.typesCombo.store.count()<2){return false}break;case d.fromField:if(this.direction=="predecessors"){this.activeDependency=f.record;this.refilterTasksCombo()}break;case d.toField:if(this.direction!="predecessors"){this.activeDependency=f.record;this.refilterTasksCombo()}break}},onEditingDone:function(e,f){var d=this.store.model.prototype;if(f.field==d.lagField){f.record.setLagUnit(this.lagEditor.durationUnit)}this.getView().refreshView()},dependencyTypeRender:function(c){var d=this.store.model.Type;switch(c){case d.EndToStart:return this.L("endToStartText");case d.StartToStart:return this.L("startToStartText");case d.EndToEnd:return this.L("endToEndText");case d.StartToEnd:return this.L("startToEndText")}return c},taskValidate:function(d,e){if(!d){return[this.L("blankTaskText")]}if(!e.isValid()){var f=this.getDependencyErrors(e);if(f&&f.length){return f}return[this.L("invalidDependencyText")]}},taskRender:function(k,j,g){var i=this.taskValidate(k,g),h;if(i&&i.length){j.tdCls=Ext.baseCSSPrefix+"form-invalid";j.tdAttr='data-errorqtip="'+i.join("<br>")+'"'}else{j.tdCls="";j.tdAttr='data-errorqtip=""'}var l=this.dependencyStore&&this.dependencyStore.getTaskStore();if(l){h=l.getModelById(k);return(h&&Ext.String.htmlEncode(h.getName()))||""}return""},filterTasks:function(j){var h=j.getId(),f,i,g;if(this.direction==="predecessors"){i=h;g=this.task.getId();f=this.activeDependency&&this.activeDependency.getSourceId()}else{g=h;i=this.task.getId();f=this.activeDependency&&this.activeDependency.getTargetId()}return !this.activeDependency||h==f||this.isValidDependency(i,g)},refilterTasksCombo:function(){this.tasksCombo.getStore().addFilter(this.tasksFilter)},bindTaskStore:function(){var h=this.dependencyStore&&this.dependencyStore.getTaskStore();if(h){if(!this.taskStoreListeners){var g=Ext.Function.createBuffered(this.bindTaskStore,this.refreshTimeout,this,[]);this.taskStoreListeners=this.mon(h,{nodeappend:g,nodeinsert:g,noderemove:g,update:g,refresh:g,clear:g,"nodestore-datachange-end":g,scope:this,destroyable:true})}var e=new Ext.data.JsonStore({autoDestroy:true,model:h.model,sorters:h.model.prototype.nameField});var f=h.getRoot();e.loadData(Gnt.util.Data.cloneModelSet(h.toArray(),function(a,b){if(b===f||b.hidden||b.isReadOnly()){return false}if(!b.getId()){a.setId(b.getId())}}));this.tasksFilter=new Ext.util.Filter({id:"dependencygrid-tasksfilter",filterFn:this.filterTasks,scope:this});e.filter(this.tasksFilter);this.tasksCombo.bindStore(e)}},buildTasksCombo:function(){var b=this;return new Ext.form.field.ComboBox({queryMode:"local",allowBlank:false,editing:false,forceSelection:true,valueField:this.taskModel.prototype.idProperty,displayField:this.taskModel.prototype.nameField,queryCaching:false,listConfig:{getInnerTpl:function(){return"{"+this.displayField+":htmlEncode}"}},validator:function(a){if(!a){return b.L("blankTaskText")}return true}})},filterAllowedTypes:function(g){if(!this.dependencyStore||!this.dependencyStore.allowedDependencyTypes){return true}var j=this.dependencyStore.allowedDependencyTypes;var i=this.store.model.Type;for(var l=0,h=j.length;l<h;l++){var k=i[j[l]];if(g.getId()==k){return true}}return false},buildTypesCombo:function(){var c=this.store.model.Type;this.typesFilter=new Ext.util.Filter({id:"typesfilter",filterFn:this.filterAllowedTypes,scope:this});var d=new Ext.data.ArrayStore({fields:[{name:"id",type:"int"},"text"],data:[[c.EndToStart,this.L("endToStartText")],[c.StartToStart,this.L("startToStartText")],[c.EndToEnd,this.L("endToEndText")],[c.StartToEnd,this.L("startToEndText")]]});d.filter(this.typesFilter);return new Ext.form.field.ComboBox({triggerAction:"all",queryMode:"local",editable:false,valueField:"id",displayField:"text",store:d})},buildLagEditor:function(){return new Gnt.field.Duration({minValue:Number.NEGATIVE_INFINITY})},buildColumns:function(){var k=this,g=this.store.model.prototype,j=[],h=this.dependencyStore&&this.dependencyStore.getTaskStore();this.tasksCombo=this.buildTasksCombo();if(!h){this.deferredStoreBind=true;this.tasksCombo.on("render",this.bindTaskStore,this)}else{this.bindTaskStore()}var l={};var i=g[this.direction==="predecessors"?"fromField":"toField"];if(this.useSequenceNumber){l={text:this.L("snText"),dataIndex:i,renderer:function(b,a,e){var d=k.dependencyStore&&k.dependencyStore.getTaskStore(),c=d&&d.getModelById(e.get("From"));return c?c.getSequenceNumber():""},width:50}}else{l={text:this.L("idText"),dataIndex:i,width:50}}j.push(l,{text:this.L("taskText"),dataIndex:i,flex:1,editor:this.tasksCombo,renderer:function(b,a,c){return k.taskRender(b,a,c)}});this.lagEditor=this.buildLagEditor();this.typesCombo=this.buildTypesCombo();j.push({text:this.L("typeText"),dataIndex:g.typeField,width:120,renderer:this.dependencyTypeRender,scope:this,editor:this.typesCombo},{text:this.L("lagText"),dataIndex:g.lagField,width:100,editor:this.lagEditor,renderer:function(b,a,c){return k.lagEditor.valueToVisible(b,c.get(g.lagUnitField),2)}},{text:this.L("clsText"),dataIndex:g.clsField,hidden:!this.showCls,width:100});return j},insertDependency:function(i,k){if(!this.dependencyStore){return}var n=this.task.getId(),o=this.store.model.prototype,p={},l=this;if(i){p=i}else{p[o.typeField]=this.typesCombo.store.getAt(0).getId();p[o.lagField]=0;p[o.lagUnitField]="d"}if(this.direction==="predecessors"){p[o.toField]=n}else{p[o.fromField]=n}var m=this.store.insert(0,p);if(m.length){var j=m[0].isValid;m[0].isValid=function(){return j.call(this,false)&&l.isValidDependency(this)}}if(!k){this.cellEditing.startEditByPosition({row:0,column:1})}return m},onOppositeStoreChange:function(){this.getView().refreshView()},setOppositeStore:function(d){var c={update:this.onOppositeStoreChange,datachanged:this.onOppositeStoreChange,scope:this};if(this.oppositeStore){this.mun(this.oppositeStore,c)}this.oppositeStore=d;this.mon(this.oppositeStore,c)},loadDependencies:function(e){var h=this;e=e||this.task;if(!e){return}if(this.task!==e){this.setTask(e)}var g;if(this.direction==="predecessors"){g=e.getIncomingDependencies(true);if(!this.oppositeStore){this.oppositeData=e.getOutgoingDependencies(true)}}else{g=e.getOutgoingDependencies(true);if(!this.oppositeStore){this.oppositeData=e.getIncomingDependencies(true)}}var f=Gnt.util.Data.cloneModelSet(g,function(a){var b=a.isValid;a.isValid=function(){return b.call(this,false)&&h.isValidDependency(this)}});this.store.loadData(f);this.fireEvent("loaddependencies",this,this.store,f,e)},getDependencyErrors:function(q,s){var o=this,l=o.dependencyStore,m=[],r,n;if(q instanceof Gnt.model.Dependency){r=q;q=o.task.getId();s=q;n=r.getType();if(o.direction==="predecessors"){q=r.getSourceId()}else{s=r.getTargetId()}}if(r){o.store.each(function(a){if((q==a.getSourceId())&&(s==a.getTargetId())&&(a!==r)){m.push(o.L("duplicatingDependencyText"));return false}});if(m.length){return m}}var k=o.store.getRange();r&&k.splice(Ext.Array.indexOf(k,r),1);var t=o.task[o.direction];var p=l.getDependencyError(q,s,n,k,t);if(p){switch(p){case -3:case -8:case -5:case -6:return[o.L("transitiveDependencyText")];case -4:case -7:return[o.L("cyclicDependencyText")];case -9:return[o.L("parentChildDependencyText")]}return[this.L("invalidDependencyText")]}return m},isValidDependency:function(){return !this.getDependencyErrors.apply(this,arguments).length},isValid:function(){var b=true;this.store.each(function(a){if(!a.isValid()){b=false;return false}});return b},saveDependencies:function(){if(!this.dependencyStore||!this.isValid()){return}Gnt.util.Data.applyCloneChanges(this.store,this.dependencyStore)},isDataChanged:function(){var b=this;return b.store&&b.store.getUpdatedRecords().length>0||b.store.getNewRecords().length>0||b.store.getRemovedRecords().length>0},isDataValid:function(){return this.isValid()}});Ext.define("Gnt.widget.taskeditor.TaskEditor",{extend:Gnt.widget.taskeditor.BaseEditor,alias:"widget.taskeditor",alternateClassName:["Gnt.widget.TaskEditor"],taskFormClass:"Gnt.widget.taskeditor.TaskForm",advancedFormClass:"Gnt.widget.taskeditor.AdvancedForm",showAssignmentGrid:true,showDependencyGrid:true,allowParentTaskDependencies:true,showNotes:true,showAdvancedForm:true,showRollup:false,showReadOnly:true,showBaseline:true,taskFormConfig:null,dependencyGridClass:"Gnt.widget.DependencyGrid",dependencyGridConfig:null,assignmentGridClass:"Gnt.widget.AssignmentEditGrid",assignmentGridConfig:null,advancedFormConfig:null,notesConfig:null,notesPanel:null,notesEditor:null,taskForm:null,assignmentGrid:null,dependencyGrid:null,advancedForm:null,margin:0,buildItems:function(){var f=this,e=[];var d=f.clonedStores||{};f.taskFormConfig=f.taskFormConfig||{};Ext.applyIf(f.taskFormConfig,{showBaseline:f.showBaseline,showRollup:false});f.taskForm=Ext.create(f.taskFormClass,Ext.apply({task:f.task,border:false,taskStore:f.taskStore},f.taskFormConfig));e.push(f.taskForm);if(f.showDependencyGrid){f.dependencyGrid=Ext.create(f.dependencyGridClass,Ext.apply({allowParentTaskDependencies:f.allowParentTaskDependencies,taskModel:f.taskStore.model,task:f.task,margin:0,border:false,tbar:{layout:"auto",items:[{xtype:"button",iconCls:"gnt-action-add",text:f.L("addDependencyText"),itemId:"add-dependency-btn",handler:function(){f.dependencyGrid.insertDependency()}},{xtype:"button",iconCls:"gnt-action-remove",text:f.L("dropDependencyText"),itemId:"drop-dependency-btn",disabled:true,handler:function(){var a=f.dependencyGrid.getSelectionModel().getSelection();if(a&&a.length){f.dependencyGrid.store.remove(a)}}}]},listeners:{selectionchange:function(a,b){var c=f.dependencyGrid;if(!c.dropDepBtn){c.dropDepBtn=c.down("#drop-dependency-btn")}c.dropDepBtn&&c.dropDepBtn.setDisabled(!b.length)}}},f.dependencyGridConfig));e.push(f.dependencyGrid)}if(f.showAssignmentGrid&&f.assignmentStore&&f.resourceStore){if(!d.assignmentStore){d.assignmentStore=f.cloneAssignmentStore(f.task)}if(!d.resourceStore){d.resourceStore=f.cloneResourceStore(f.task)}f.assignmentGrid=Ext.create(f.assignmentGridClass,Ext.apply({assignmentStore:f.assignmentStore,resourceStore:f.resourceStore,border:false,margin:0,store:d.assignmentStore,resourceDupStore:d.resourceStore,tbar:{layout:"auto",items:[{xtype:"button",iconCls:"gnt-action-add",text:f.L("addAssignmentText"),itemId:"add-assignment-btn",handler:function(){f.assignmentGrid.insertAssignment()}},{xtype:"button",iconCls:"gnt-action-remove",text:f.L("dropAssignmentText"),itemId:"drop-assignment-btn",disabled:true,handler:function(){var a=f.assignmentGrid.getSelectionModel().getSelection();if(a&&a.length){f.assignmentGrid.store.remove(a)}}}]},listeners:{afterrender:{fn:function(a){a.loadTaskAssignments(f.task.get(f.task.idProperty))},single:true},selectionchange:function(a,b){var c=f.assignmentGrid;if(!c.dropBtn){c.dropBtn=c.down("#drop-assignment-btn")}c.dropBtn&&c.dropBtn.setDisabled(!b.length)}}},f.assignmentGridConfig));e.push(f.assignmentGrid)}if(f.showAdvancedForm){f.advancedFormConfig=f.advancedFormConfig||{};f.advancedForm=Ext.create(f.advancedFormClass,Ext.applyIf(f.advancedFormConfig,{showGeneral:false,showBaseline:false,showCalendar:true,showManuallyScheduled:true,showSchedulingMode:true,showWbsCode:true,showConstraint:true,showRollup:f.showRollup,showReadOnly:f.showReadOnly,layout:{type:"table",columns:2},border:false,margin:0,task:f.task,taskStore:f.taskStore}));e.push(f.advancedForm)}if(f.showNotes){f.notesEditor=Ext.create("Ext.form.field.HtmlEditor",Ext.apply({listeners:{afterrender:function(a){f.notesEditor.setValue(f.task.get(f.task.noteField))}},readOnly:f.task&&!f.task.isEditable(f.task.noteField),isDataChanged:function(){return this.isDirty()}},f.notesConfig));f.notesPanel=Ext.create("Ext.panel.Panel",{border:false,margin:0,layout:"fit",items:f.notesEditor});e.push(f.notesPanel)}if(!f.taskForm.title){f.taskForm.title=f.L("generalText")}if(f.assignmentGrid&&!f.assignmentGrid.title){f.assignmentGrid.title=f.L("resourcesText")}if(f.advancedForm&&!f.advancedForm.title){f.advancedForm.title=f.L("advancedText")}if(f.notesPanel&&!f.notesPanel.title){f.notesPanel.title=f.L("notesText")}return e},bindDependencyGrid:function(){var d=this.clonedStores.dependencyStore;var c=this.dependencyGrid;c.store.taskStore=this.clonedStores.taskStore;if(d){this.mon(c,{loaddependencies:function(a,b){d.loadData(b.getRange().concat(Gnt.util.Data.cloneModelSet(a.oppositeData)))}});this.mon(c.store,{add:function(a,b){d.add(b)},remove:function(a,b){d.remove(b)}});this.dependencyGridBound=true}},loadTask:function(r){if(!r){return}this.task=r;var o=this,s=o.taskForm,l=o.dependencyGrid,q=o.assignmentGrid,k=r.isReadOnly();s.setSuppressTaskUpdate(true);s.getForm().reset();o.callParent(arguments);var m=o.clonedStores,p=o.taskBuffer;if(l){if(!o.dependencyGridBound){o.bindDependencyGrid()}l.loadDependencies(r);l.tab.setVisible(o.allowParentTaskDependencies||r.isLeaf())}if(q){if(m.assignmentStore!==q.getStore()){q.reconfigure(m.assignmentStore)}if(q.resourceDupStore!==m.resourceStore){q.resourceDupStore=m.resourceStore}q.loadResources(true);q.loadTaskAssignments(r.getId()||r.getPhantomId());q.task=p}s.loadRecord(r,p);if(o.advancedForm){o.advancedForm.setSuppressTaskUpdate(true);var t=o.advancedForm.getForm();t.reset();o.advancedForm.loadRecord(r,s.taskBuffer);var n=t.findField("wbsCode");if(n){n.setValue(r.getWBSCode())}o.advancedForm.setSuppressTaskUpdate(false)}s.setSuppressTaskUpdate(false);if(o.notesEditor){o.notesEditor.setValue(r.getNote())}o.setReadOnly(k);o.fireEvent("loadtask",o,r)},updateReadOnly:function(){var h=this,e=h.taskBuffer,f=h.getReadOnly(),g=f||e.isReadOnly();if(e){if(h.taskForm){if(f!=h.taskForm.getReadOnly()){h.taskForm.setReadOnly(f)}else{h.taskForm.updateReadOnly()}}if(h.assignmentGrid){h.assignmentGrid.setReadOnly(g);h.assignmentGrid.down("toolbar").setVisible(!g)}if(h.dependencyGrid){h.dependencyGrid.down("toolbar").setVisible(!g)}if(h.notesEditor){h.notesEditor.setReadOnly(g||!e.isEditable(e.noteField))}if(h.advancedForm){if(f!=h.advancedForm.getReadOnly()){h.advancedForm.setReadOnly(f)}else{h.advancedForm.updateReadOnly()}}}},doValidate:function(c){var d=this.callParent(arguments);if(this.taskForm&&!this.taskForm.isValid()){d=false;c&&c(this.getTabByComponent(this.taskForm),this.taskForm)}if(this.dependencyGrid&&!this.dependencyGrid.isValid()){d=false;c&&c(this.getTabByComponent(this.dependencyGrid),this.dependencyGrid)}if(this.assignmentGrid&&!this.assignmentGrid.isValid()){d=false;c&&c(this.getTabByComponent(this.assignmentGrid),this.assignmentGrid)}if(this.advancedForm&&!this.advancedForm.isValid()){d=false;c&&c(this.getTabByComponent(this.advancedForm),this.advancedForm)}return d},doUpdateTask:function(){this.taskForm&&this.taskForm.updateRecord();this.advancedForm&&this.advancedForm.updateRecord();this.notesEditor&&this.task.set(this.task.noteField,this.notesEditor.getValue());this.assignmentGrid&&this.assignmentGrid.saveTaskAssignments();this.dependencyGrid&&this.dependencyGrid.saveDependencies()},isDataChanged:function(c){var d=this.callParent(arguments);if(this.taskForm&&this.taskForm.isDataChanged()){d=true;c&&c(this.getTabByComponent(this.taskForm))}if(this.dependencyGrid&&this.dependencyGrid.isDataChanged()){d=true;c&&c(this.getTabByComponent(this.dependencyGrid))}if(this.assignmentGrid&&this.assignmentGrid.isDataChanged()){d=true;c&&c(this.getTabByComponent(this.assignmentGrid))}if(this.advancedForm&&this.advancedForm.isDataChanged()){d=true;c&&c(this.getTabByComponent(this.advancedForm))}if(this.notesEditor&&this.notesEditor.isDataChanged()){d=true;c&&c(this.getTabByComponent(this.notesEditor))}return d}});Ext.define("Gnt.plugin.taskeditor.TaskEditor",{extend:Gnt.plugin.taskeditor.BaseEditor,alternateClassName:["Gnt.plugin.TaskEditor"],alias:"plugin.gantt_taskeditor",ptype:"gantt_taskeditor",taskEditorCls:"Gnt.widget.taskeditor.TaskEditor",height:390,width:600,taskEditorConfigs:"l10n,task,taskStore,assignmentStore,resourceStore,generalText,resourcesText,dependencyText,addDependencyText,dropDependencyText,notesText,advancedText,wbsCodeText,addAssignmentText,dropAssignmentText,showAssignmentGrid,showDependencyGrid,allowParentTaskDependencies,showNotes,showStyle,showAdvancedForm,taskFormClass,advancedFormClass,taskFormConfig,dependencyGridConfig,assignmentGridConfig,advancedFormConfig,styleFormConfig,dependencyGridClass,assignmentGridClass",constructor:function(b){this.callParent(arguments);this.addFilter(this.isTask)},init:function(b){this.callParent(arguments);b.taskEditor=this},isTask:function(b){return b&&!b.isProject}});Ext.define("Gnt.selection.SpreadsheetModel",{extend:Ext.grid.selection.SpreadsheetModel,alias:"selection.gantt_spreadsheet",privates:{getNumbererColumnConfig:function(){var b=this;return{xtype:"wbscolumn",text:"&nbsp;",width:b.rowNumbererHeaderWidth,editRenderer:"&#160;",tdCls:b.rowNumbererTdCls,cls:b.rowNumbererHeaderCls,sortable:false,draggable:false,hideable:false,menuDisabled:true,lockable:false,ignoreExport:true,locked:true}}}});Ext.define("Gnt.template.CalendarDateInfo",{extend:Ext.XTemplate,disableFormats:true,workingHoursText:null,nonWorkingText:null,basedOnText:null,overrideText:null,inCalendarText:null,dayInCalendarText:null,markup:'<div class="gnt-calendar-overridedate"><tpl if="isWorkingDay">__WORKINGHOURS__ {date}:<tpl else>{date} __NONWORKING__</tpl></div><ul class="gnt-calendar-availabilities"><tpl for="availability"><li>{.}</li></tpl></ul><span class="gnt-calendar-overridesource"> __BASEDON__: <tpl if="override">__OVERRIDE__ "{name}" __INCALENDAR__ "{calendarName}"<tpl else>__DAYINCALENDAR__ "{calendarName}"</tpl></span>',constructor:function(b){Ext.apply(this,b);this.markup=this.markup.replace("__WORKINGHOURS__",this.workingHoursText).replace("__NONWORKING__",this.nonWorkingText).replace("__BASEDON__",this.basedOnText).replace("__OVERRIDE__",this.overrideText).replace("__INCALENDAR__",this.inCalendarText).replace("__DAYINCALENDAR__",this.dayInCalendarText);this.callParent([this.markup])}});Ext.define("Gnt.template.CalendarLegend",{extend:Ext.Template,disableFormats:true,markup:'<ul class="gnt-calendar-legend"><li class="gnt-calendar-legend-item"><div class="gnt-calendar-legend-itemstyle {workingDayCls}"></div><span class="gnt-calendar-legend-itemname">{workingDayText}</span><div style="clear: both"></div></li><li><div class="gnt-calendar-legend-itemstyle {nonWorkingDayCls}"></div><span class="gnt-calendar-legend-itemname">{weekendsText}</span><div style="clear: both"></div></li><li class="gnt-calendar-legend-override"><div class="gnt-calendar-legend-itemstyle {overriddenDayCls}">31</div><span class="gnt-calendar-legend-itemname">{overriddenDayText}</span><div style="clear: both"></div></li><li class="gnt-calendar-legend-override"><div class="gnt-calendar-legend-itemstyle {overriddenWeekDayCls}">31</div><span class="gnt-calendar-legend-itemname">{overriddenWeekText}</span><div style="clear: both"></div></li></ul>',constructor:function(){this.callParent([this.markup])}});Ext.define("Gnt.view.dependency.Painter",{extend:Sch.view.dependency.Painter,alias:"schdependencypainter.ganttdefault",createLineDef:function(x,z,B,w,r,v,A){var o=z.self.Type,u=this,y=u.pathFinder.getHorizontalMargin(),p=x.getRowHeight(),q=u.callParent(arguments);q.verticalMargin=(p-(r.bottom-r.top))/2;if(z.getType()==o.EndToStart&&r.bottom<v.top&&(r.end-v.start<y)){q.startShift=w.isMilestone()?0:(y-(v.end-v.start)/2);q.endSide="top"}var t=q.endBox;var s=q.endSide;q.startArrowSize=q.endArrowSize;q.startArrowMargin=q.endArrowMargin;q.endArrowSize=0;q.endArrowMargin=0;q.endBox=q.startBox;q.endSide=q.startSide;q.startBox=t;q.startSide=s;return q}});Ext.define("Gnt.view.dependency.View",{extend:Sch.view.dependency.View,alias:"schdependencyview.basegantt",alternateClassName:"Gnt.view.Dependency",config:{painterConfig:{type:"ganttdefault"}},onPrimaryViewItemUpdate:function(e,d,f){this.updateDependencies(e.getAllDependencies())}});Ext.define("Gnt.widget.Calendar",{extend:Ext.picker.Date,alias:"widget.ganttcalendar",mixins:[Gnt.mixin.Localizable],calendar:null,startDate:null,endDate:null,initComponent:function(){if(!this.calendar){Ext.Error.raise('Required attribute "calendar" missing during initialization of `Gnt.widget.Calendar`')}if(!this.startDate){Ext.Error.raise('Required attribute "startDate" missing during initialization of `Gnt.widget.Calendar`')}if(!this.endDate){this.endDate=Sch.util.Date.add(this.startDate,Sch.util.Date.MONTH,1)}this.setCalendar(this.calendar);this.minDate=this.value=this.startDate;this.callParent(arguments);this.injectDates()},injectDates:function(){var d=this;var c=d.disabledDates=[];Ext.Array.each(d.calendar.getHolidaysRanges(d.startDate,d.endDate),function(a){a.forEachDate(function(b){c.push(Ext.Date.format(b,d.format))})});d.setDisabledDates(c)},setCalendar:function(c){var d={update:this.injectDates,remove:this.injectDates,add:this.injectDates,load:this.injectDates,clear:this.injectDates,scope:this};if(this.calendar){this.mun(c,d)}this.calendar=c;if(c){this.mon(c,d)}}});Ext.define("Gnt.widget.calendar.AvailabilityGrid",{extend:Ext.grid.Panel,mixins:[Gnt.mixin.Localizable],alias:"widget.calendaravailabilitygrid",calendarDay:null,height:160,addButton:null,removeButton:null,maxIntervalsNum:5,initComponent:function(){if(!this.tbar){this.tbar=this.buildToolbar()}Ext.applyIf(this,{store:new Ext.data.Store({fields:["startTime","endTime"],autoDestroy:true,data:this.calendarDay.getAvailability()}),plugins:[new Ext.grid.plugin.CellEditing({clicksToEdit:2})],columns:[{xtype:"datecolumn",header:this.L("startText"),format:"g:i a",dataIndex:"startTime",flex:1,editor:{xtype:"timefield",allowBlank:false,initDate:"31/12/1899"}},{xtype:"datecolumn",header:this.L("endText"),format:"g:i a",dataIndex:"endTime",flex:1,editor:{xtype:"timefield",allowBlank:false,initDate:"31/12/1899"}}],listeners:{selectionchange:this.onAvailabilityGridSelectionChange,scope:this}});this.callParent(arguments)},buildToolbar:function(){this.addButton=new Ext.Button({text:this.L("addText"),iconCls:"gnt-action-add",handler:this.addAvailability,scope:this});this.removeButton=new Ext.Button({text:this.L("removeText"),iconCls:"gnt-action-remove",handler:this.removeAvailability,scope:this,disabled:true});return[this.addButton,this.removeButton]},onAvailabilityGridSelectionChange:function(d,c){this.removeButton.setDisabled(!c.length)},setAvailability:function(b){this.store.loadData(b);this.addButton.setDisabled(this.store.getCount()>=this.maxIntervalsNum)},addAvailability:function(){var d=this.getStore(),c=d.count();if(c>=this.maxIntervalsNum){return}d.add({startTime:new Date(0,0,0,12,0),endTime:new Date(0,0,0,13,0)});if(c+1>=this.maxIntervalsNum&&this.addButton){this.addButton.disable()}},removeAvailability:function(){var e=this.getStore(),f=e.getCount(),d=this.getSelection();if(!d.length){return}e.remove(d[0]);if(f<this.maxIntervalsNum&&this.addButton){this.addButton.enable()}},isValid:function(c){try{this.calendarDay.verifyAvailability(this.getIntervals())}catch(d){if(!c){Ext.MessageBox.show({title:this.L("error"),msg:d,modal:true,icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK})}return false}return true},extractTimeFromDate:function(b){return new Date(0,0,0,b.getHours(),b.getMinutes(),b.getSeconds())},getIntervals:function(){var d=[];var c=this;this.getStore().each(function(a){var b=c.extractTimeFromDate(a.get("endTime"));if(b-new Date(0,0,0,0,0,0)===0){b=new Date(0,0,1,0,0)}d.push({startTime:c.extractTimeFromDate(a.get("startTime")),endTime:b})});return d}});Ext.define("Gnt.widget.calendar.DayEditor",{extend:Gnt.widget.calendar.AvailabilityGrid,mixins:[Gnt.mixin.Localizable],alias:"widget.calendardayeditor",height:160,initComponent:function(){var b=this.calendarDay.getIsWorkingDay();this.dockedItems=this.dockedItems||[{xtype:"radiogroup",dock:"top",name:"dayType",padding:"0 5px",margin:0,items:[{boxLabel:this.L("workingTimeText"),name:"IsWorkingDay",inputValue:true,checked:b},{boxLabel:this.L("nonworkingTimeText"),name:"IsWorkingDay",inputValue:false,checked:!b}],listeners:{change:this.onDayTypeChanged,scope:this}}];this.on("afterrender",this.myApplyState,this);this.callParent(arguments)},getDayTypeRadioGroup:function(){return this.down('radiogroup[name="dayType"]')},myApplyState:function(){if(!this.isWorkingDay()){this.viewSetDisabled(true);this.addButton.disable()}},viewSetDisabled:function(b){if(b){this.getView().getEl().mask();this.getHeaderContainer().getEl().mask()}else{this.getView().getEl().unmask();this.getHeaderContainer().getEl().unmask()}},onDayTypeChanged:function(d){var c=d.getValue();if(Ext.isArray(c.IsWorkingDay)){return}this.viewSetDisabled(!c.IsWorkingDay);this.addButton.setDisabled(!c.IsWorkingDay||this.getStore().getCount()>=this.maxIntervalsNum)},isWorkingDay:function(){return this.getDayTypeRadioGroup().getValue().IsWorkingDay},isValid:function(){if(this.isWorkingDay()){return this.callParent()}return true},getIntervals:function(){if(!this.isWorkingDay()){return[]}return this.callParent()}});Ext.define("Gnt.widget.calendar.WeekEditor",{extend:Ext.form.Panel,mixins:[Gnt.mixin.Localizable],alias:"widget.calendarweekeditor",weekName:null,startDate:null,endDate:null,weekAvailability:null,calendarWeekAvailability:null,defaultWeekAvailability:null,backupWeekAvailability:null,layout:"anchor",defaults:{border:false,anchor:"100%"},calendarDayModel:null,currentDayIndex:null,_weekDaysGrid:null,_availabilityGrid:null,initComponent:function(){this.backupWeekAvailability=[];this.items=[{xtype:"radiogroup",padding:"0 5px",name:"dayType",items:[{boxLabel:this.L("defaultTimeText"),name:"IsWorkingDay",inputValue:0},{boxLabel:this.L("workingTimeText"),name:"IsWorkingDay",inputValue:1},{boxLabel:this.L("nonworkingTimeText"),name:"IsWorkingDay",inputValue:2}],listeners:{change:this.onDayTypeChanged,scope:this}},{layout:"column",padding:"0 0 5px 0",defaults:{border:false},items:[{margin:"0 10px 0 5px",columnWidth:0.5,items:this.getWeekDaysGrid()},{columnWidth:0.5,margin:"0 5px 0 0",items:this.getAvailabilityGrid()}]}];this.callParent(arguments)},getWeekDaysGrid:function(){if(this._weekDaysGrid!=null){return this._weekDaysGrid}var b=Ext.Date.dayNames;return this._weekDaysGrid=new Ext.grid.Panel({hideHeaders:true,height:160,columns:[{header:"",dataIndex:"name",flex:1}],store:new Ext.data.Store({autoDestroy:true,fields:["id","name"],idProperty:"id",data:[{id:1,name:b[1]},{id:2,name:b[2]},{id:3,name:b[3]},{id:4,name:b[4]},{id:5,name:b[5]},{id:6,name:b[6]},{id:0,name:b[0]}]}),listeners:{viewready:this.onWeekDaysListViewReady,selectionchange:this.onWeekDaysListSelectionChange,beforeselect:this.onWeekDaysListBeforeSelect,scope:this}})},getAvailabilityGrid:function(){if(!this._availabilityGrid){this._availabilityGrid=new Gnt.widget.calendar.AvailabilityGrid({calendarDay:new this.calendarDayModel()})}return this._availabilityGrid},getDayTypeRadioGroup:function(){if(!this.dayTypeRadioGroup){this.dayTypeRadioGroup=this.down('radiogroup[name="dayType"]')}return this.dayTypeRadioGroup},getWeekAvailability:function(){return this.weekAvailability},onWeekDaysListViewReady:function(){var c=this.getWeekDaysGrid(),d=c.getStore().getAt(0);this.currentDayIndex=d.getId();this.readFromData();c.getSelectionModel().select(d,false,true)},onWeekDaysListBeforeSelect:function(){if(!this.saveToData()){return false}},applyChanges:function(h){if(!this.saveToData()){return false}var f=this.weekAvailability;var i=false;for(var j=0;j<7;j++){var g=f[j];if(g){i=true;if(!h[j]){h[j]=g}h[j].setIsWorkingDay(g.getIsWorkingDay());h[j].setAvailability(g.getAvailability())}else{h[j]=null}}if(!i){Ext.MessageBox.show({title:this.L("error"),msg:this.L("noOverrideError"),modal:true,icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK});return false}return true},onWeekDaysListSelectionChange:function(d,c){this.currentDayIndex=c[0].getId();this.readFromData()},getCurrentTypeOfWeekDay:function(b){return this.weekAvailability[b]?(this.weekAvailability[b].getIsWorkingDay()?1:2):0},getCurrentWeekDay:function(b){return this.weekAvailability[b]||this.calendarWeekAvailability[b]||this.defaultWeekAvailability[b]},saveToData:function(){var h=this.currentDayIndex;var g=this.getDayTypeRadioGroup().getValue().IsWorkingDay;var f=this.weekAvailability;if(g===0){f[h]=null;return true}var e=this.getAvailabilityGrid();if(g==1){if(!e.isValid()){return false}if(!f[h]){f[h]=this.copyDefaultWeekDay(h)}f[h].setIsWorkingDay(true);f[h].setAvailability(e.getIntervals());this.backupWeekAvailability[h]=null;return true}if(!f[h]){f[h]=this.copyDefaultWeekDay(h)}f[h].setIsWorkingDay(false);f[h].setAvailability([]);return true},copyDefaultWeekDay:function(d){var c=(this.calendarWeekAvailability[d]||this.defaultWeekAvailability[d]).copy();c.phantom=true;c.beginEdit();c.setType("WEEKDAYOVERRIDE");c.setOverrideStartDate(this.startDate);c.setOverrideEndDate(this.endDate);c.setName(this.weekName);c.endEdit();return c},readFromData:function(f){var g=this.getCurrentWeekDay(this.currentDayIndex);var i=this.getCurrentTypeOfWeekDay(this.currentDayIndex);var j=this.getAvailabilityGrid();j.setAvailability(f||g.getAvailability());var h=this.getDayTypeRadioGroup();h.suspendEvents();h.setValue({IsWorkingDay:[i]});h.resumeEvents();j.setDisabled(i!=1)},onDayTypeChanged:function(o,q,r){var l=o.getValue();if(l.IsWorkingDay==null||Ext.isArray(l.IsWorkingDay)){return}var n=this.weekAvailability;var m=this.backupWeekAvailability;var k=this.currentDayIndex;var p=this.getAvailabilityGrid();var j;if(r.IsWorkingDay==1){m[k]=p.getIntervals()}switch(l.IsWorkingDay){case 0:n[k]=null;break;case 1:if(!n[k]){n[k]=this.copyDefaultWeekDay(k)}j=m[k];n[k].setIsWorkingDay(true);break;case 2:if(!n[k]){n[k]=this.copyDefaultWeekDay(k)}n[k].setAvailability([]);n[k].setIsWorkingDay(false);break;default:throw"Unrecognized day type"}this.readFromData(j)}});Ext.define("Gnt.widget.calendar.DatePicker",{extend:Ext.picker.Date,alias:"widget.gntdatepicker",workingDayCls:"gnt-datepicker-workingday",nonWorkingDayCls:"gnt-datepicker-nonworkingday",overriddenDayCls:"gnt-datepicker-overriddenday",overriddenWeekDayCls:"gnt-datepicker-overriddenweekday",weekOverridesStore:null,dayOverridesCalendar:null,update:function(){this.callParent(arguments);this.refreshCssClasses()},refreshCssClasses:function(){var h=this,f=h.cells.elements;this.removeCustomCls();for(var e=0;e<h.numDays;e++){var g=f[e].firstChild.dateValue;f[e].className+=" "+this.getDateCls(new Date(g))}},getDateCls:function(j){var g="";if(j.getMonth()!==this.getActive().getMonth()){return}var l=this.dayOverridesCalendar;if(l.getOwnCalendarDay(j)){g+=" "+this.overriddenDayCls;if(!l.isWorkingDay(j)){g+=" "+this.nonWorkingDayCls}}else{var i=null;this.weekOverridesStore.each(function(a){if(Ext.Date.between(j,a.get("startDate"),a.get("endDate"))){i=a;return false}});if(i){g+=" "+this.overriddenWeekDayCls;var k=j.getDay(),h=i.get("weekAvailability");if(h&&h[k]&&!h[k].getIsWorkingDay()){g+=" "+this.nonWorkingDayCls}}else{if(!l.isWorkingDay(j)){g+=" "+this.nonWorkingDayCls}}}return g||this.workingDayCls},removeCustomCls:function(){this.cells.removeCls([this.overriddenDayCls,this.nonWorkingDayCls,this.workingDayCls,this.overriddenWeekDayCls])}});Ext.define("Gnt.widget.calendar.Calendar",{extend:Ext.form.Panel,mixins:[Gnt.mixin.Localizable],alias:"widget.calendar",defaults:{border:false},workingDayCls:"gnt-datepicker-workingday",nonWorkingDayCls:"gnt-datepicker-nonworkingday",overriddenDayCls:"gnt-datepicker-overriddenday",overriddenWeekDayCls:"gnt-datepicker-overriddenweekday",calendar:null,calendarManager:null,dayGridConfig:null,weekGridConfig:null,datePickerConfig:null,readOnly:false,dayGrid:null,weekGrid:null,datePicker:null,legendTpl:null,dateInfoTpl:null,dayOverridesCalendar:null,weekOverridesStore:null,currentDayOverrideEditor:null,calendarDayModel:null,layout:{type:"vbox",align:"stretch"},initComponent:function(){var d=this;d.setupTemplates();var c=d.calendar;if(!c&&d.calendarManager){c=d.calendarManager.getProjectCalendar()||d.calendarManager.getRoot().firstChild}if(!d.calendarDayModel){d.calendarDayModel=c&&c.getModel&&c.getModel()||c.model}d.buildItems();d.bindListeners();d.callParent(arguments);d.setReadOnly(d.readOnly);c&&d.setCalendar(c)},setReadOnly:function(b){this.readOnly=b;this.cmbParentCalendar.setDisabled(b);this.down("#calendarName").setDisabled(b);this.setGridReadOnly(this.dayGrid,b);this.setGridReadOnly(this.weekGrid,b)},getReadOnly:function(){return this.readOnly},isReadOnly:function(){return this.getReadOnly()},setGridReadOnly:function(d,f){var e=d.getPlugin("editingPlugin");e&&e[f?"disable":"enable"]();d.down("#btnAdd").setDisabled(f);d.down("#btnEdit").setDisabled(f);d.down("#btnRemove").setDisabled(f)},bindListeners:function(){var b=this;b.on("calendarset",b.onCalendarSet);b.on("afterrender",b.onCalendarSet);b.dayGrid.on({selectionchange:b.onDayGridSelectionChange,validateedit:b.onDayGridValidateEdit,edit:b.onDayGridEdit,scope:b});b.dayGrid.store.on({update:b.refreshView,remove:b.refreshView,add:b.refreshView,scope:b});b.weekGrid.on({selectionchange:b.onWeekGridSelectionChange,validateedit:b.onWeekGridValidateEdit,edit:b.onWeekGridEdit,scope:b});b.weekGrid.store.on({update:b.refreshView,remove:b.refreshView,add:b.refreshView,scope:b});b.datePicker.on({select:b.onDateSelect,scope:b})},buildItems:function(){this.dateInfoPanel=new Ext.Component({cls:"gnt-calendar-dateinfo",margin:"20 10",flex:1,border:false});this.cmbParentCalendar=new Ext.form.field.ComboBox({name:"cmb_parentCalendar",fieldLabel:this.L("parentCalendarText"),labelAlign:"top",store:{autoDestroy:true,fields:["Id","Name"]},queryMode:"local",displayField:"Name",valueField:"Id",anchor:"100%",editable:false,emptyText:this.L("selectParentText")});this.buildWeekGrid();this.buildDayGrid();this.buildDatePicker();this.items=[{xtype:"container",layout:"hbox",items:[{xtype:"container",flex:1,margin:"15 15 15 15",layout:"anchor",items:[{xtype:"textfield",itemId:"calendarName",fieldLabel:this.L("calendarNameText"),labelAlign:"top",anchor:"100%"},this.cmbParentCalendar,{xtype:"component",padding:"10 0 0 0",renderTpl:this.legendTpl,anchor:"100%",renderData:{workingDayText:this.L("workingDayText"),weekendsText:this.L("weekendsText"),overriddenDayText:this.L("overriddenDayText"),overriddenWeekText:this.L("overriddenWeekText"),workingDayCls:this.workingDayCls,nonWorkingDayCls:this.nonWorkingDayCls,overriddenDayCls:this.overriddenDayCls,overriddenWeekDayCls:this.overriddenWeekDayCls}}]},this.datePicker,this.dateInfoPanel]},{xtype:"tabpanel",height:300,items:[this.dayGrid,this.weekGrid]}]},buildDayGrid:function(){var b=this.calendarDayModel.prototype;this.dayGrid=new Ext.grid.Panel(Ext.apply({title:this.L("dayOverridesText"),itemId:"dayGrid",tbar:[{text:this.L("addText"),itemId:"btnAdd",action:"add",iconCls:"gnt-action-add",handler:this.addDay,scope:this},{text:this.L("editText"),itemId:"btnEdit",action:"edit",iconCls:"gnt-action-edit",handler:this.editDay,scope:this},{text:this.L("removeText"),itemId:"btnRemove",action:"remove",iconCls:"gnt-action-remove",handler:this.removeDay,scope:this}],store:new Gnt.data.Calendar(),plugins:[new Ext.grid.plugin.CellEditing({clicksToEdit:2,pluginId:"editingPlugin"})],columns:[{header:this.L("dayOverrideNameHeaderText"),dataIndex:b.nameField,flex:1,editor:{allowBlank:false}},{header:this.L("dateText"),dataIndex:b.dateField,width:100,xtype:"datecolumn",editor:{xtype:"datefield"}}]},this.dayGridConfig||{}));this.dayOverridesCalendar=this.dayGrid.store},updateGrids:function(){this.dayGrid&&this.fillDaysStore();this.weekGrid&&this.fillWeeksStore()},buildWeekGrid:function(){this.weekGrid=new Ext.grid.Panel(Ext.apply({title:this.L("weekOverridesText"),itemId:"weekGrid",plugins:[new Ext.grid.plugin.CellEditing({clicksToEdit:2,pluginId:"editingPlugin"})],store:new Ext.data.Store({autoDestroy:true,model:"Gnt.model.Week"}),tbar:[{text:this.L("addText"),itemId:"btnAdd",action:"add",iconCls:"gnt-action-add",handler:this.addWeek,scope:this},{text:this.L("editText"),itemId:"btnEdit",action:"edit",iconCls:"gnt-action-edit",handler:this.editWeek,scope:this},{text:this.L("removeText"),itemId:"btnRemove",action:"remove",iconCls:"gnt-action-remove",handler:this.removeWeek,scope:this}],columns:[{header:this.L("overrideName"),dataIndex:"name",flex:1,editor:{allowBlank:false}},{xtype:"datecolumn",header:this.L("startDate"),dataIndex:"startDate",width:100,editor:{xtype:"datefield"}},{xtype:"datecolumn",header:this.L("endDate"),dataIndex:"endDate",width:100,editor:{xtype:"datefield"}}]},this.weekGridConfig||{}));this.weekOverridesStore=this.weekGrid.store},buildDatePicker:function(){this.datePicker=new Gnt.widget.calendar.DatePicker(Ext.apply({dayOverridesCalendar:this.dayGrid.store,weekOverridesStore:this.weekGrid.store,margin:"15 10 0 10",showToday:false},this.datePickerConfig))},onCalendarSet:function(){this.weekOverridesStore.commitChanges()},setCalendar:function(b){if(this.calendar){this.mun(this.calendar,{load:this.onCalendarChange,add:this.onCalendarChange,remove:this.onCalendarChange,update:this.onCalendarChange,parentchange:this.onParentChange,scope:this})}this.calendar=b;if(b){this.mon(this.calendar,{load:this.onCalendarChange,add:this.onCalendarChange,remove:this.onCalendarChange,update:this.onCalendarChange,parentchange:this.onParentChange,scope:this})}this.onCalendarChange();this.fireEvent("calendarset",b)},onParentChange:function(){this.updateComboBox()},updateComboBox:function(){var l=this,i=[];if(l.calendarManager){var h=l.calendarManager.getRoot();var k=l.calendarManager.getNodeByCalendar(l.calendar);h.cascadeBy(function(b){var a=b.getCalendar();if(b!==h&&b!==k&&!k.contains(b)){i.push({Id:a.calendarId,Name:b.getName()||a.calendarId})}})}else{i=l.calendar.getParentableCalendars()}this.cmbParentCalendar.store.loadData([{Id:-1,Name:this.L("noParentText")}].concat(i));var g=this.calendar&&this.calendar.parent,j=g&&g.calendarId;this.cmbParentCalendar.setValue(j||-1)},onCalendarChange:function(){this.updateComboBox();this.fillDaysStore();this.fillWeeksStore();this.refreshView()},setupTemplates:function(){var b=this.L("tplTexts");if(!(this.dateInfoTpl instanceof Ext.Template)){this.dateInfoTpl=new Gnt.template.CalendarDateInfo({workingHoursText:b.tplWorkingHours,nonWorkingText:b.tplIsNonWorking,basedOnText:b.tplBasedOn,overrideText:b.tplOverride,inCalendarText:b.tplInCalendar,dayInCalendarText:b.tplDayInCalendar})}if(!(this.legendTpl instanceof Ext.Template)){this.legendTpl=new Gnt.template.CalendarLegend()}},afterRender:function(){this.callParent(arguments);this.onDateSelect(this.datePicker,new Date())},fillDaysStore:function(){var b=Gnt.util.Data.cloneModelSet(this.calendar,function(a){return(a.getType()=="DAY"&&a.getDate())});this.dayOverridesCalendar.loadData(b)},copyCalendarDay:function(d){var c=d.copy(null);c.__COPYOF__=d.getId();return c},fillWeeksStore:function(){var d=this;var c=[];this.calendar.forEachNonStandardWeek(function(b){var a=Ext.apply({},b);a.weekAvailability=Ext.Array.map(a.weekAvailability,function(f){return f&&d.copyCalendarDay(f)||null});a.mainDay=d.copyCalendarDay(a.mainDay);c.push(a)});this.weekOverridesStore.loadData(c)},addDay:function(){var f=this.datePicker.getValue();if(this.dayOverridesCalendar.getOwnCalendarDay(f)){this.alert({msg:this.L("overrideErrorText")});return}var e=this.calendar.model;var g=e.prototype;var h={};h[g.nameField]=this.L("newDayName");h[g.typeField]="DAY";h[g.dateField]=f;h=new e(h);this.dayGrid.getStore().insert(0,h);this.dayGrid.getSelectionModel().select([h],false,false)},editDay:function(){var h=this,j=this.dayGrid.getSelection(),g=j[0];if(g){var f=this.currentDayOverrideEditor=new Gnt.widget.calendar.DayEditor({addText:this.L("addText"),removeText:this.L("removeText"),workingTimeText:this.L("workingTimeText"),nonworkingTimeText:this.L("nonworkingTimeText"),calendarDay:g});var i=Ext.create("Ext.window.Window",{title:this.L("dayOverridesText"),modal:true,width:280,height:260,layout:"fit",items:f,buttons:[{text:this.L("okText"),handler:function(){if(f.isValid()){var a=f.calendarDay;a.setIsWorkingDay(f.isWorkingDay());a.setAvailability(f.getIntervals());h.applyCalendarDay(a,g);h.refreshView();i.close()}}},{text:this.L("cancelText"),handler:function(){i.close()}}]});i.show()}},removeDay:function(){var d=this.dayGrid,c=d.getSelection();if(!c[0]){return}d.getStore().remove(c[0]);this.refreshView()},refreshView:function(){var m=this.datePicker.getValue(),i=this.getCalendarDay(m),n=this.weekGrid,j=this.dayGrid,o=this.dayOverridesCalendar.getOwnCalendarDay(m),k;var p;if(o){j.getSelectionModel().select([o],false,true);p=o.getName()}else{k=this.getWeekOverrideByDate(m);if(k){n.getSelectionModel().select([k],false,true);p=k.get("name")}}var l={name:p||i.getName(),date:Ext.Date.format(m,"M j, Y"),calendarName:this.calendar.name||this.calendar.calendarId,availability:i.getAvailability(true),override:Boolean(o||k),isWorkingDay:i.getIsWorkingDay()};this.dateInfoPanel.update(this.dateInfoTpl.apply(l));this.down("#calendarName").setValue(this.calendar.name);this.datePicker.rendered&&this.datePicker.refreshCssClasses()},onDayGridSelectionChange:function(d,c){if(c[0]){this.datePicker.setValue(c[0].getDate());this.refreshView()}},onDayGridEdit:function(c,d){if(d.field==="Date"){d.grid.getStore().clearCache();this.datePicker.setValue(d.value)}this.refreshView()},onDayGridValidateEdit:function(d,e){var f=this.dayGrid.store;if(e.field===f.model.prototype.dateField&&f.getOwnCalendarDay(e.value)&&e.value!==e.originalValue){this.alert({msg:this.L("overrideErrorText")});return false}},onDateSelect:function(){this.refreshView()},getCalendarDay:function(c){var d=this.dayOverridesCalendar.getOwnCalendarDay(c);if(d){return d}d=this.getWeekOverrideDay(c);if(d){return d}return this.calendar.weekAvailability[c.getDay()]||this.calendar.defaultWeekAvailability[c.getDay()]},getWeekOverrideDay:function(g){var e=this.getWeekOverrideByDate(g),h=g.getDay();if(e==null){return null}var f=e.get("weekAvailability");if(!f){return null}return f[h]},getWeekOverrideByDate:function(d){var c=null;this.weekOverridesStore.each(function(a){if(Ext.Date.between(d,a.get("startDate"),a.get("endDate"))){c=a;return false}});return c},intersectsWithCurrentWeeks:function(e,g,h){var f=false;this.weekOverridesStore.each(function(b){if(b==h){return}var c=b.get("startDate");var a=b.get("endDate");if(c<=e&&e<a||c<g&&g<=a){f=true;return false}});return f},addWeek:function(){var l=this.weekOverridesStore;var h=this.datePicker.getValue();var i;for(var j=7;j>0;j--){i=Sch.util.Date.add(h,Sch.util.Date.DAY,j);if(!this.intersectsWithCurrentWeeks(h,i)){break}}if(!j){this.alert({msg:Ext.String.format(this.L("overrideDateError"),Ext.Date.format(h,"Y/m/d"))});return}var k=new this.calendar.model();k.setType("WEEKDAYOVERRIDE");k.setName(this.L("newDayName"));k.setOverrideStartDate(h);k.setOverrideEndDate(i);k.setWeekday(-1);var g=l.insert(0,{name:this.L("newDayName"),startDate:h,endDate:i,weekAvailability:[],mainDay:k})[0];this.weekGrid.getSelectionModel().select([g],false,false)},editWeek:function(){var j=this.weekGrid.getSelection(),h=this;if(j.length===0){return}var f=j[0];var g=new Gnt.widget.calendar.WeekEditor({startDate:f.get("startDate"),endDate:f.get("endDate"),weekName:f.get("name"),calendarDayModel:this.calendar.model,weekAvailability:f.get("weekAvailability"),calendarWeekAvailability:this.calendar.weekAvailability,defaultWeekAvailability:this.calendar.defaultWeekAvailability});var i=Ext.create("Ext.window.Window",{title:this.L("weekOverridesText"),modal:true,width:370,defaults:{border:false},layout:"fit",items:g,buttons:[{action:"ok",text:this.L("okText"),handler:function(){if(g.applyChanges(f.get("weekAvailability"))){h.refreshView();i.close()}}},{text:this.L("cancelText"),handler:function(){i.close()}}]});i.show()},removeWeek:function(){var b=this.weekGrid.getSelection();if(b[0]){this.weekOverridesStore.remove(b[0]);this.refreshView()}},onWeekGridSelectionChange:function(d,c){if(c[0]){this.datePicker.setValue(c[0].get("startDate"))}},onWeekGridEdit:function(i,f){var j=f.record,g=j.get("startDate"),h=j.get("endDate");if(f.field=="startDate"||f.field=="endDate"){Ext.Array.each(j.get("weekAvailability").concat(j.get("mainDay")),function(a){if(a){a.setOverrideStartDate(g);a.setOverrideEndDate(h)}});this.datePicker.setValue(g)}this.refreshView()},alert:function(b){b=b||{};Ext.MessageBox.show(Ext.applyIf(b,{title:this.L("error"),icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK}))},onWeekGridValidateEdit:function(i,f){var j=f.record,g=f.field=="startDate"?f.value:j.get("startDate"),h=f.field=="endDate"?f.value:j.get("endDate");if(g>h){this.alert({msg:this.L("startAfterEndError")});return false}if(this.intersectsWithCurrentWeeks(g,h,j)){this.alert({msg:this.L("weeksIntersectError")});return false}},applyCalendarDay:function(g,h){h.beginEdit();h.setName(g.getName());h.setIsWorkingDay(g.getIsWorkingDay());h.setDate(g.getDate());h.setOverrideStartDate(g.getOverrideStartDate());h.setOverrideEndDate(g.getOverrideEndDate());var e=g.getAvailability(true);var f=h.getAvailability(true);if(e+""!=f+""){h.setAvailability(g.getAvailability())}h.endEdit()},applySingleDay:function(c,d){if(c.__COPYOF__){this.applyCalendarDay(c,this.calendar.getModelById(c.__COPYOF__))}else{if(c.store){c.unjoin(c.store)}c.setId(null);d.push(c.getData())}},applyChanges:function(){var l=this;var k=this.calendar;var n=this.down('combobox[name="cmb_parentCalendar"]').getValue(),j=this.down("#calendarName").getValue();if(this.calendarManager){var m=this.calendarManager.getModelById(k.calendarId);if(m){m.setName(j)}}k.suspendEvents(true);k.suspendCacheUpdate++;k.name=j;k.setParent(n?Gnt.data.Calendar.getCalendar(n):null);if(k.getProxy()&&k.getProxy().extraParams){k.getProxy().extraParams.calendarId=k.calendarId}Gnt.util.Data.applyCloneChanges(this.dayOverridesCalendar,k);var p=[];var i=[];var o={};this.weekOverridesStore.each(function(a){Ext.Array.each(a.get("weekAvailability").concat(a.get("mainDay")),function(b){if(b){if(b.__COPYOF__){o[b.__COPYOF__]=true}l.applySingleDay(b,p)}})});k.forEachNonStandardWeek(function(a){Ext.Array.each(a.weekAvailability.concat(a.mainDay),function(b){if(b&&!o[b.getId()]){i.push(b)}})});k.add(p);k.remove(i);k.suspendCacheUpdate--;k.clearCache();k.resumeEvents();this.fireEvent("calendarset",k)},hasChanges:function(){if(!this.calendar){return false}var g=this.dayOverridesCalendar.getModifiedRecords().length||this.dayOverridesCalendar.getRemovedRecords().length,i=this.weekOverridesStore.getModifiedRecords().length||this.weekOverridesStore.getRemovedRecords().length,j=this.down("#calendarName").getValue()!=this.calendar.name,h=this.calendar.parent&&this.calendar.parent.calendarId||-1,f=this.cmbParentCalendar.getValue()!=h;return g||i||j||f}});Ext.define("Gnt.widget.calendar.CalendarManager",{extend:Ext.Container,mixins:[Gnt.mixin.Localizable],alias:"widget.calendarmanager",treePanelConfig:null,treePanel:null,calendarPanelConfig:null,calendarManager:null,readOnly:false,calendarPanel:null,layout:"border",width:800,height:600,initComponent:function(){var c=this;c.cls=c.cls+" gnt-calendarmanager";c.treePanel=c.buildTreePanel();c.calendarPanel=new Gnt.widget.calendar.Calendar(Ext.apply({region:"center",calendar:c.calendar,split:true,scrollable:true,calendarManager:c.calendarManager,readOnly:c.readOnly},c.calendarPanelConfig));c.items=[c.treePanel,c.calendarPanel];c.callParent(arguments);c.contextMenu=c.buildContextMenu();c.setReadOnly(c.readOnly);var d=c.calendarManager;c.setCalendar(c.calendar||d.getProjectCalendar()||d.getRoot().firstChild);c.counter=1},setReadOnly:function(g){this.readOnly=g;var e=this.treePanel;e.down("#btnAdd").setDisabled(g);e.down("#btnRemove").setDisabled(g);var f=e.getView(),h=g?"disable":"enable";if(f.rendered){f.getPlugin("treeDragDrop")[h]()}else{f.on("render",function(){f.getPlugin("treeDragDrop")[h]()},this,{single:true})}this.contextMenu.setDisabled(g);this.calendarPanel.setReadOnly(g)},getReadOnly:function(){return this.readOnly},isReadOnly:function(){return this.getReadOnly()},buildTreePanel:function(){var b=this;return new Ext.tree.Panel(Ext.apply({split:true,region:"west",width:200,store:b.calendarManager,displayField:b.calendarManager.model.prototype.nameField,rootVisible:false,tbar:[{itemId:"btnAdd",text:b.L("addText"),action:"add",iconCls:"gnt-action-add",handler:b.doAddRootNode,scope:b},{itemId:"btnRemove",text:b.L("removeText"),action:"remove",iconCls:"gnt-action-remove",handler:b.doRemoveCalendar,scope:b}],viewConfig:{plugins:{ptype:"treeviewdragdrop",pluginId:"treeDragDrop",allowContainerDrops:true,dropZone:{onNodeDrop:function(g,j,h,a){var i=true;this.overRecord=this.view.getRecord(g);this.currentPosition="append";Ext.Array.each(a.records,function(c){if(c.contains(this.overRecord)){i=false;return false}},this);this.valid=i;if(this.overRecord.isLeaf()){this.overRecord.set("expanded",true);this.overRecord.childNodes=[]}return this.self.prototype.onNodeDrop.apply(this,arguments)}}},getRowClass:function(a){if(b.calendarManager.getProjectCalendar()==a.calendar){return"gnt-project-calendar-row"}},listeners:{drop:b.onDrop,scope:b}},listeners:{containercontextmenu:b.onContainerContextMenu,itemcontextmenu:b.onItemContextMenu,selectionchange:b.onSelectionChange,scope:b}},b.treePanelConfig))},buildContextMenu:function(){return new Ext.menu.Menu({margin:"0 0 10 0",items:[{text:this.L("add_node"),handler:this.doAddRootNode,itemId:"add-node",scope:this},{text:this.L("add_child"),handler:this.doAddChildNode,scope:this},{text:this.L("add_sibling"),handler:this.doAddSiblingCalendar,scope:this},{text:this.L("remove"),handler:this.doRemoveCalendar,itemId:"remove-node",scope:this}]})},showContextMenu:function(f,d){var e=this.contextMenu.query("menuitem");Ext.Array.each(e,function(a){a.setVisible(!!d)});this.contextMenu.down("#add-node").setVisible(!d);f.stopEvent();this.contextMenu.showAt(f.getXY())},onContainerContextMenu:function(d,c){this.showContextMenu(c)},onItemContextMenu:function(g,h,j,e,i){this.showContextMenu(i,h)},hasChanges:function(){return this.calendarPanel.hasChanges()},onSelectionChange:function(l,r,p){var o=this,s=o.calendarManager,k=o.calendarPanel;if(r.length>0){var q=r[0];var n=q.getCalendar();var m=s.getProjectCalendar();var t=n===m||m&&Boolean(q.findChild(q.idProperty,m.calendarId));if(!o.isReadOnly()){o.treePanel.down("#btnRemove").setDisabled(t);o.contextMenu.down("#remove-node").setDisabled(t)}if(k.calendar&&k.hasChanges()){Ext.Msg.show({title:o.L("confirm_action"),msg:o.L("confirm_message"),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(a){if(a=="yes"){o.applyChanges();k.setCalendar(n)}else{if(a=="no"){k.setCalendar(n)}else{l.suspendEvents();l.select(s.getNodeByCalendar(k.calendar));l.resumeEvents()}}}})}else{k.setCalendar(n)}}},onDrop:function(e,g,h,f){h=h||this.calendarManager.getRootNode();h.expand()},onDestroy:function(){this.contextMenu.destroy();this.callParent(arguments)},applyChanges:function(){this.calendarPanel.applyChanges()},doAddRootNode:function(){this.addCalendar()},doAddChildNode:function(){var b=this.treePanel.getSelectionModel().getSelection();this.addCalendar(b[0])},doAddSiblingCalendar:function(){var b=this.treePanel.getSelectionModel().getSelection();this.addCalendar(b[0]&&b[0].parentNode)},doRemoveCalendar:function(){var b=this.treePanel.getSelectionModel().getSelection();this.removeCalendar(b[0])},addCalendar:function(h){var g=Ext.ClassManager.get(this.calendarManager.calendarClass).prototype;var f=this.calendarManager.model.prototype;var e=f.getModelConfig(g);e[f.nameField]=this.L("calendarName")+this.counter++;e.expanded=true;e.leaf=true;h=h||this.treePanel.getRootNode();h.data.expanded=true;h.appendChild(e)},removeCalendar:function(f){var e=this.treePanel.getRootNode();if(f){var d=f.nextSibling||f.previousSibling||(f.parentNode==e?e.firstChild:f.parentNode);if(d){this.treePanel.getSelectionModel().select(d)}f.remove()}},setCalendar:function(b){if(b instanceof Gnt.model.Calendar){this.treePanel.setSelection(b)}else{this.treePanel.setSelection(this.calendarManager.getNodeByCalendar(b))}}});Ext.define("Gnt.widget.calendar.CalendarManagerWindow",{extend:Ext.window.Window,mixins:[Gnt.mixin.Localizable],alias:"widget.calendarmanagerwindow",layout:"fit",border:false,constrain:true,calendarConfig:null,calendarManager:null,panel:null,closing:false,initComponent:function(){this.panel=new Gnt.widget.calendar.CalendarManager({calendarManager:this.calendarManager,calendarPanelConfig:this.calendarConfig});Ext.applyIf(this,{width:Math.min(Ext.getBody().getWidth()-100,1050),height:Math.min(Ext.getBody().getHeight()-100,750)});Ext.apply(this,{title:this.title||this.L("title"),items:[this.panel],buttons:[{text:this.L("ok"),handler:function(){this.applyChanges()},scope:this},{text:this.L("cancel"),handler:function(){this.close()},scope:this}],listeners:{beforeclose:this.onBeforeClose,close:this.onAfterClose}});this.callParent(arguments)},applyChanges:function(){this.panel.applyChanges()},onBeforeClose:function(){var c=this;var d=this.panel;if(!c.closing&&d.hasChanges()){Ext.Msg.show({title:c.L("confirm_action"),msg:c.L("confirm_message"),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(a){switch(a){case"yes":d.applyChanges();c.close();break;case"no":c.closing=true;c.close();break}}});return false}},onAfterClose:function(){this.closing=false}});Ext.define("Gnt.widget.calendar.CalendarWindow",{extend:Ext.window.Window,mixins:[Gnt.mixin.Localizable],alias:"widget.calendarwindow",calendarConfig:null,calendar:null,calendarWidget:null,initComponent:function(){Ext.apply(this,{width:600,layout:"fit",items:this.calendarWidget=new Gnt.widget.calendar.Calendar(Ext.apply({calendar:this.calendar},this.calendarConfig)),buttons:[{text:this.L("ok"),handler:function(){this.applyChanges();this.close()},scope:this},{text:this.L("cancel"),handler:this.close,scope:this}]});this.callParent(arguments)},applyChanges:function(){this.calendarWidget.applyChanges()},setCalendar:function(b){this.calendarWidget.setCalendar(b)}});Ext.define("Gnt.widget.calendar.ResourceCalendarGrid",{extend:Ext.grid.Panel,mixins:[Gnt.mixin.Localizable],alias:"widget.resourcecalendargrid",resourceStore:null,calendarStore:null,cellEditingConfig:null,initComponent:function(){var c=this;this.calendarStore=this.calendarStore||{xclass:"Ext.data.Store",model:"Gnt.model.Calendar"};if(!(this.calendarStore instanceof Ext.data.Store)){this.calendarStore=Ext.create(this.calendarStore)}var d=Ext.create("Ext.grid.plugin.CellEditing",Ext.apply({clicksToEdit:2},this.cellEditingConfig));this.mon(d,{edit:function(b,a){this.onCalendarChange(a.record,a.value)},scope:this});Ext.apply(c,{store:c.resourceStore,columns:[{header:this.L("name"),dataIndex:"Name",flex:1},{header:this.L("calendar"),flex:1,renderer:function(j,b,l){var i=l.getCalendar();var k=c.calendarStore.getModelById?"getModelById":"getById";var a=c.calendarStore[k](i&&i.calendarId);return a&&a.getName()||j},editor:{xtype:"combobox",store:c.calendarStore,queryMode:"local",displayField:"Name",valueField:"Id",editable:false,allowBlank:false}}],border:true,height:180,plugins:d});this.calendarStore.loadData(this.getCalendarData());this.callParent(arguments)},getCalendarData:function(){return Ext.Array.map(Gnt.data.Calendar.getAllCalendars(),function(b){return{Id:b.calendarId,Name:b.name||b.calendarId}})},onCalendarChange:function(d,c){d.setCalendarId(c)},destroy:function(){this.calendarStore.destroy();this.callParent(arguments)}});Ext.define("Robo.util.Array",{singleton:true,reduce:function(i,j,h){i=Object(i);var l=0,k=i.length>>>0,g=h;if(arguments.length<3){while(true){if(l in i){g=i[l++];break}if(++l>=k){throw new TypeError("Reduce of empty array with no initial value")}}}for(;l<k;++l){if(l in i){g=j(g,i[l],l,i)}}return g}});Ext.define("Gnt.column.ClientName",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.ClientColumn",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"ClientName",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){return c.data.ClientName}});Ext.define("Gnt.column.ResponsiblePersonName",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.ResponsibleColumn",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Text1",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){return c.data.ResponsiblePersonName}});Ext.define("Gnt.column.Text1",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Text1column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Text1",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){return c.data.Text1}});Ext.define("Gnt.column.Text2",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Text2column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Text2",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){return c.data.Text2}});Ext.define("Gnt.column.Text3",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Text3column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Text3",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){return c.data.Text3}});Ext.define("Gnt.column.Text4",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Text4column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Text4",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){return c.data.Text4}});Ext.define("Gnt.column.Text5",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Text5column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Text5",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){return c.data.Text5}});Ext.define("Gnt.column.Text6",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Text6column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Text6",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){return c.data.Text6}});Ext.define("Gnt.column.Text7",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Text7column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Text7",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){return c.data.Text6}});Ext.define("Gnt.column.Text8",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Text8column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Text8",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){return c.data.Text8}});Ext.define("Gnt.column.Text9",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Text9column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Text9",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){return c.data.Text9}});Ext.define("Gnt.column.Text10",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Text10column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Text10",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){return c.data.Text10}});Ext.define("Gnt.column.Number1",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Number1column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Number1",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){if(c.data.Number1==0){return""}return c.data.Number1}});Ext.define("Gnt.column.Number2",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Number2column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Number2",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){if(c.data.Number2==0){return""}return c.data.Number2}});Ext.define("Gnt.column.Number3",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Number3column",decimalPrecision:2,useAbbreviation:false,width:100,dataIndex:"Number3",align:"left",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){if(c.data.Number3==0){return""}return c.data.Number3}});Ext.define("Gnt.column.Number4",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Number4column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Number4",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){if(c.data.Number4==0){return""}return c.data.Number4}});Ext.define("Gnt.column.Number5",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Number5column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Number5",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){if(c.data.Number5==0){return""}return c.data.Number5}});Ext.define("Gnt.column.Number6",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Number6column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Number6",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){if(c.data.Number6==0){return""}return c.data.Number6}});Ext.define("Gnt.column.Number7",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Number7column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Number7",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){if(c.data.Number7==0){return""}return c.data.Number7}});Ext.define("Gnt.column.Number8",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Number8column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Number8",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){if(c.data.Number8==0){return""}return c.data.Number8}});Ext.define("Gnt.column.Number9",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Number9column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Number9",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){if(c.data.Number9==0){return""}return c.data.Number9}});Ext.define("Gnt.column.Number10",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.Number10column",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Number10",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){if(c.data.Number10==0){return""}return c.data.Number10}});Ext.define("Gnt.column.Priority",{extend:"Ext.grid.column.Column",requires:["Ext.Number"],mixins:["Gnt.mixin.Localizable"],alias:"widget.PriorityColumn",decimalPrecision:2,useAbbreviation:false,width:100,align:"left",dataIndex:"Priority",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,a,c){if(c.data.Number10==0){return""}return c.data.Priority}});Ext.define("Gnt.column.Completed",{extend:Ext.grid.column.Date,mixins:[Gnt.mixin.Localizable],alias:["widget.completedcolumn"],width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){return Ext.util.Format.date(e.data.Completed,this.format)}});Ext.define("Gnt.column.CreatedDate",{extend:Ext.grid.column.Date,mixins:[Gnt.mixin.Localizable],alias:["widget.createdcolumn"],width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){return Ext.util.Format.date(e.data.Created,this.format)}});Ext.define("Gnt.column.ReshowDate",{extend:Ext.grid.column.Date,mixins:[Gnt.mixin.Localizable],alias:["widget.ReshowDateColumn"],width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){return Ext.util.Format.date(e.data.Reshow_Date,this.format)}});Ext.define("Gnt.column.LateFinish",{extend:Ext.grid.column.Date,mixins:[Gnt.mixin.Localizable],alias:["widget.LatefinishColumn"],width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){return Ext.util.Format.date(e.data.LateFinish,this.format)}});Ext.define("Gnt.column.LateStart",{extend:Ext.grid.column.Date,mixins:[Gnt.mixin.Localizable],alias:["widget.LateStartColumn"],width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){return Ext.util.Format.date(e.data.LateStart,this.format)}});Ext.define("Gnt.column.EarlyStart",{extend:Ext.grid.column.Date,mixins:[Gnt.mixin.Localizable],alias:["widget.EarlyStartColumn"],width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){return Ext.util.Format.date(e.data.EarlyStart,this.format)}});Ext.define("Gnt.column.EndProg",{extend:Ext.grid.column.Date,mixins:[Gnt.mixin.Localizable],alias:["widget.LatestEndDateColumn"],width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){return Ext.util.Format.date(e.data.LatestEndDate,this.format)}});Ext.define("Gnt.column.ActualStart",{extend:Ext.grid.column.Date,mixins:[Gnt.mixin.Localizable],alias:["widget.ActualStartColumn"],width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){return Ext.util.Format.date(e.data.Actual_Start,this.format)}});Ext.define("Gnt.column.ActualEnd",{extend:Ext.grid.column.Date,mixins:[Gnt.mixin.Localizable],alias:["widget.ActualEndColumn"],width:100,align:"left",adjustMilestones:true,constructor:function(b){b=b||{};this.text=b.text||this.L("text");this.callParent(arguments);this.renderer=b.renderer||this.rendererFunc;this.scope=b.scope||this;this.hasCustomRenderer=true},afterRender:function(){var b=this.up("ganttpanel");b.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(d,f,e){return Ext.util.Format.date(e.data.Actual_End,this.format)}});
